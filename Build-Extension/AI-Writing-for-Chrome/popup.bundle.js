/*! For license information please see popup.bundle.js.LICENSE.txt */
(()=>{var t={63675:function(t,e){var r,n,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[t],r=function(t){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const e="The message port closed before a response was received.",r=t=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(t,e=void 0){super(e),this.createItem=t}get(t){return this.has(t)||this.set(t,this.createItem(t)),super.get(t)}}const o=t=>t&&"object"==typeof t&&"function"==typeof t.then,i=(e,r)=>(...n)=>{t.runtime.lastError?e.reject(new Error(t.runtime.lastError.message)):r.singleCallbackArg||n.length<=1&&!1!==r.singleCallbackArg?e.resolve(n[0]):e.resolve(n)},a=t=>1==t?"argument":"arguments",c=(t,e)=>function(r,...n){if(n.length<e.minArgs)throw new Error(`Expected at least ${e.minArgs} ${a(e.minArgs)} for ${t}(), got ${n.length}`);if(n.length>e.maxArgs)throw new Error(`Expected at most ${e.maxArgs} ${a(e.maxArgs)} for ${t}(), got ${n.length}`);return new Promise(((o,a)=>{if(e.fallbackToNoCallback)try{r[t](...n,i({resolve:o,reject:a},e))}catch(i){console.warn(`${t} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),r[t](...n),e.fallbackToNoCallback=!1,e.noCallback=!0,o()}else e.noCallback?(r[t](...n),o()):r[t](...n,i({resolve:o,reject:a},e))}))},u=(t,e,r)=>new Proxy(e,{apply:(e,n,o)=>r.call(n,t,...o)});let s=Function.call.bind(Object.prototype.hasOwnProperty);const l=(t,e={},r={})=>{let n=Object.create(null),o={has:(e,r)=>r in t||r in n,get(o,i,a){if(i in n)return n[i];if(!(i in t))return;let f=t[i];if("function"==typeof f)if("function"==typeof e[i])f=u(t,t[i],e[i]);else if(s(r,i)){let e=c(i,r[i]);f=u(t,t[i],e)}else f=f.bind(t);else if("object"==typeof f&&null!==f&&(s(e,i)||s(r,i)))f=l(f,e[i],r[i]);else{if(!s(r,"*"))return Object.defineProperty(n,i,{configurable:!0,enumerable:!0,get:()=>t[i],set(e){t[i]=e}}),f;f=l(f,e[i],r["*"])}return n[i]=f,f},set:(e,r,o,i)=>(r in n?n[r]=o:t[r]=o,!0),defineProperty:(t,e,r)=>Reflect.defineProperty(n,e,r),deleteProperty:(t,e)=>Reflect.deleteProperty(n,e)},i=Object.create(t);return new Proxy(i,o)},f=t=>({addListener(e,r,...n){e.addListener(t.get(r),...n)},hasListener:(e,r)=>e.hasListener(t.get(r)),removeListener(e,r){e.removeListener(t.get(r))}}),h=new n((t=>"function"!=typeof t?t:function(e){const r=l(e,{},{getContent:{minArgs:0,maxArgs:0}});t(r)})),p=new n((t=>"function"!=typeof t?t:function(e,r,n){let i,a,c=!1,u=new Promise((t=>{i=function(e){c=!0,t(e)}}));try{a=t(e,r,i)}catch(t){a=Promise.reject(t)}const s=!0!==a&&o(a);if(!0!==a&&!s&&!c)return!1;const l=t=>{t.then((t=>{n(t)}),(t=>{let e;e=t&&(t instanceof Error||"string"==typeof t.message)?t.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:e})})).catch((t=>{console.error("Failed to send onMessage rejected reply",t)}))};return l(s?a:u),!0})),d=({reject:r,resolve:n},o)=>{t.runtime.lastError?t.runtime.lastError.message===e?n():r(new Error(t.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?r(new Error(o.message)):n(o)},y=(t,e,r,...n)=>{if(n.length<e.minArgs)throw new Error(`Expected at least ${e.minArgs} ${a(e.minArgs)} for ${t}(), got ${n.length}`);if(n.length>e.maxArgs)throw new Error(`Expected at most ${e.maxArgs} ${a(e.maxArgs)} for ${t}(), got ${n.length}`);return new Promise(((t,e)=>{const o=d.bind(null,{resolve:t,reject:e});n.push(o),r.sendMessage(...n)}))},v={devtools:{network:{onRequestFinished:f(h)}},runtime:{onMessage:f(p),onMessageExternal:f(p),sendMessage:y.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:y.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},g={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":g},services:{"*":g},websites:{"*":g}},l(t,v,r)};t.exports=r(chrome)}},void 0===(o="function"==typeof r?r.apply(e,n):r)||(t.exports=o)}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=r(63675),e=r.n(t);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(){o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof b?e:b,i=Object.create(o.prototype),c=new P(n||[]);return a(i,"_invoke",{value:S(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",y="suspendedYield",v="executing",g="completed",m={};function b(){}function w(){}function x(){}var E={};f(E,u,(function(){return this}));var L=Object.getPrototypeOf,T=L&&L(L(j([])));T&&T!==r&&i.call(T,u)&&(E=T);var k=x.prototype=b.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,a,c,u){var s=p(t[o],t,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==n(f)&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}})}function S(e,r,n){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=A(c,n);if(u){if(u===m)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?g:y,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=g,n.method="throw",n.arg=s.arg)}}}function A(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function j(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=x,a(k,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},_(O.prototype),f(O.prototype,s,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(k),f(k,l,"Generator"),f(k,u,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=j,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),s=i.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:j(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function s(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){u(i,n,o,a,c,"next",t)}function c(t){u(i,n,o,a,c,"throw",t)}a(void 0)}))}}var l={APP_NAME:"AI Writing Companion",USE_MOCK:!1,DEBUG_MODE:!1,EXTENSION_ENABLED:!0,APPLICATION_LOCALIZE:"Farsi",SOURCE_LANGUAGE:"English",TARGET_LANGUAGE:"Farsi",TRANSLATION_API:"gemini",API_URL:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",API_KEY:"",WEBAI_API_URL:"http://localhost:6969/translate",WEBAI_API_MODEL:"gemini-2.0-flash",OPENAI_API_KEY:"",OPENAI_API_URL:"https://api.openai.com/v1/chat/completions",OPENAI_API_MODEL:"gpt-3.5-turbo",OPENROUTER_API_KEY:"",OPENROUTER_API_URL:"https://openrouter.ai/api/v1/chat/completions",OPENROUTER_API_MODEL:"openai/gpt-3.5-turbo",TRANSLATE_ON_TEXT_FIELDS:!0,ENABLE_SHORTCUT_FOR_TEXT_FIELDS:!0,TRANSLATE_WITH_SELECT_ELEMENT:!0,TRANSLATE_ON_TEXT_SELECTION:!0,REQUIRE_CTRL_FOR_TEXT_SELECTION:!1,ENABLE_DICTIONARY:!0,HIGHTLIH_NEW_ELEMETN_RED:"2px solid red",TRANSLATION_ICON_TITLE:"Translate Text",HIGHLIGHT_STYLE:"2px solid red",ICON_TRANSLATION:"🌐",ICON_SUCCESS:"✅ ",ICON_WARNING:"⚠️ ",ICON_STATUS:"⏳ ",ICON_ERROR:"❌ ",ICON_INFO:"🔵 ",ICON_REVERT:"↩️",NOTIFICATION_ALIGNMENT:"right",NOTIFICATION_TEXT_DIRECTION:"rtl",NOTIFICATION_TEXT_ALIGNMENT:"right",RTL_REGEX:/[\u0600-\u06FF]/,PERSIAN_REGEX:/^(?=.*[\u0600-\u06FF])[\u0600-\u06FF\u0660-\u0669\u06F0-\u06F9\u0041-\u005A\u0061-\u007A\u0030-\u0039\s.,:;؟!()«»@#\n\t\u200C]+$/,PROMPT_BASE_FIELD:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n  - If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n  - If the input is in any other language, translate it to $_{TARGET}.\n  - If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_BASE_SELECT:'Act as an automated JSON translation service. The input is a JSON array where each object contains a "text" property.\n\n  1. Translate each "text" value according to the given rules: $_{USER_RULES}\n  2. Preserve all input elements. **Do not omit, modify, or skip any entry.**\n  3. If translation is not needed for a specific item (e.g., numbers, hashtags, URLs), **return the original value unchanged.**\n  4. Maintain the internal structure, formatting, and line breaks exactly.\n  5. Output **only** the translated JSON array, with no extra text, explanations, or markdown.\n\n  ```json input\n  $_{TEXT}\n  ```\n    ',PROMPT_BASE_DICTIONARY:'You are a $_{TARGET} dictionary service. Your task is to provide in detailed dictionary definitions while strictly preserving the input structure and formatting. Follow these rules:\n\n  - Provide the translation of the input word or phrase.\n  - Include synonyms, word type (noun, verb, adjective, etc.), and a brief definition.\n  - If applicable, provide example sentences using the word or phrase in context.\n  - If the input is ambiguous, return the most common meanings.\n  - If no definition is found, return "No definition available."\n\n  Return in $_{TARGET} language, and **ONLY** the dictionary entry without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ',PROMPT_BASE_POPUP_TRANSLATE:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in any language, translate it to $_{TARGET}.\n\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_TEMPLATE:"- If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n- If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n- If the input is in any other language, translate it to $_{TARGET}.\n- If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.",DEBUG_TRANSLATED_ENGLISH:"This is a mock translation to English.",DEBUG_TRANSLATED_PERSIAN:"این یک ترجمه آزمایشی به فارسی است.",DEBUG_TRANSLATED_ENGLISH_With_NewLine:"This is a mock \ntranslation to English with \nnew lines.",DEBUG_TRANSLATED_PERSIAN_With_NewLine:"این یک ترجمه آزمایشی \nبرای ترجمه به فارسی \nبا خطوط جدید است."},f="field",h="select_element",p="dictionary",d="popup_translate",y={selectElementActive:!1,highlightedElement:null,activeTranslateIcon:null,originalTexts:new Map,translateMode:null},v=null,g=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===v){t.next=2;break}return t.abrupt("return",v);case 2:return t.abrupt("return",e().storage.local.get(null).then((function(t){return v=a(a({},l),t)})).catch((function(t){return Dt("Error fetching settings:",t),v=a({},l)})));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e()&&e().storage&&e().storage.onChanged?e().storage.onChanged.addListener((function(t,e){if("local"===e&&v){Object.keys(t).forEach((function(e){if(l.hasOwnProperty(e)||v&&v.hasOwnProperty(e)){var r=t[e].newValue;v[e]!==r&&(v[e]=r,!0)}}))}})):Dt("Browser.storage.onChanged not available. Settings cache might become stale.");var m=function(){var t=s(o().mark((function t(e,r){var n,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g();case 2:return i=t.sent,t.abrupt("return",null!==(n=null==i?void 0:i[e])&&void 0!==n?n:r);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),b=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",m("DEBUG_MODE",l.DEBUG_MODE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),w=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!v||void 0===v.DEBUG_MODE){t.next=2;break}return t.abrupt("return",v.DEBUG_MODE);case 2:return t.abrupt("return",b());case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),x=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",m("APPLICATION_LOCALIZE",l.APPLICATION_LOCALIZE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),E=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",m("EXTENSION_ENABLED",l.EXTENSION_ENABLED));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),L=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",m("SOURCE_LANGUAGE",l.SOURCE_LANGUAGE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),T=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",m("TARGET_LANGUAGE",l.TARGET_LANGUAGE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),k=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",m("TRANSLATE_WITH_SELECT_ELEMENT",l.TRANSLATE_WITH_SELECT_ELEMENT));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),_=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",m("REQUIRE_CTRL_FOR_TEXT_SELECTION",l.REQUIRE_CTRL_FOR_TEXT_SELECTION));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,N(n.key),n)}}function A(t,e,r){return e&&S(t.prototype,e),r&&S(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function I(t,e,r){return(e=N(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function N(t){var e=function(t,e){if("object"!=O(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==O(e)?e:e+""}var P,j,C,R,G,F,M,D,H,U,B=A((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));function $(t){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$(t)}function z(t,e,r){return(e=Y(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function X(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Y(n.key),n)}}function Y(t){var e=function(t,e){if("object"!=$(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==$(e)?e:e+""}I(B,"API","API"),I(B,"HTTP_ERROR","HTTP_ERROR"),I(B,"NETWORK_ERROR","NETWORK_ERROR"),I(B,"API_RESPONSE_INVALID","API_RESPONSE_INVALID"),I(B,"SERVICE","SERVICE"),I(B,"VALIDATION","VALIDATION"),I(B,"TAB_AVAILABILITY","TAB"),I(B,"CONTEXT","CONTEXT"),I(B,"UI","UI"),I(B,"INTEGRATION","INTEGRATION"),I(B,"UNKNOWN","UNKNOWN"),I(B,"PROMPT_INVALID","PROMPT_INVALID"),I(B,"TEXT_EMPTY","TEXT_EMPTY"),I(B,"TEXT_TOO_LONG","TEXT_TOO_LONG"),I(B,"TRANSLATION_NOT_FOUND","TRANSLATION_NOT_FOUND"),I(B,"TRANSLATION_FAILED","TRANSLATION_FAILED"),I(B,"API_KEY_MISSING","API_KEY_MISSING"),I(B,"API_KEY_INVALID","API_KEY_INVALID"),I(B,"API_URL_MISSING","API_URL_MISSING"),I(B,"MODEL_MISSING","MODEL_MISSING"),I(B,"QUOTA_EXCEEDED","QUOTA_EXCEEDED"),I(B,"GEMINI_QUOTA_REGION","GEMINI_QUOTA_REGION");var q={ICON_TRANSLATION:null!==(P=null==l?void 0:l.ICON_TRANSLATION)&&void 0!==P?P:"🌐",ICON_SUCCESS:null!==(j=null==l?void 0:l.ICON_SUCCESS)&&void 0!==j?j:"✅",ICON_WARNING:null!==(C=null==l?void 0:l.ICON_WARNING)&&void 0!==C?C:"⚠️",ICON_STATUS:null!==(R=null==l?void 0:l.ICON_STATUS)&&void 0!==R?R:"⏳",ICON_ERROR:null!==(G=null==l?void 0:l.ICON_ERROR)&&void 0!==G?G:"❌",ICON_INFO:null!==(F=null==l?void 0:l.ICON_INFO)&&void 0!==F?F:"🔵",ICON_REVERT:null!==(M=null==l?void 0:l.ICON_REVERT)&&void 0!==M?M:"↩️",NOTIF_ALIGN:null!==(D=null==l?void 0:l.NOTIFICATION_ALIGNMENT)&&void 0!==D?D:"right",TEXT_DIR:null!==(H=null==l?void 0:l.NOTIFICATION_TEXT_DIRECTION)&&void 0!==H?H:"rtl",TEXT_ALIGN:null!==(U=null==l?void 0:l.NOTIFICATION_TEXT_ALIGNMENT)&&void 0!==U?U:"right"},V=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errorHandler=e||{handle:function(){}},this.map={error:{title:"AI Writing Companion - Error",icon:q.ICON_ERROR,cls:"AIWC-error",dur:5e3},warning:{title:"AI Writing Companion - Warning",icon:q.ICON_WARNING,cls:"AIWC-warning",dur:4e3},success:{title:"AI Writing Companion - Success",icon:q.ICON_SUCCESS,cls:"AIWC-success",dur:3e3},info:{title:"AI Writing Companion - Info",icon:q.ICON_INFO,cls:"AIWC-info",dur:3e3},status:{title:"AI Writing Companion - Status",icon:q.ICON_INFO,cls:"AIWC-status",dur:2e3},revert:{title:"AI Writing Companion - Revert",icon:q.ICON_REVERT,cls:"AIWC-revert",dur:800}},"undefined"!=typeof document?this.container=this._makeContainer():this.container=null},r=[{key:"_makeContainer",value:function(){var t="AIWritingCompanion-notifications",e=document.getElementById(t);return e||((e=document.createElement("div")).id=t,Object.assign(e.style,z(z(z({position:"fixed",top:"20px",zIndex:"2147483646",display:"flex",flexDirection:"column",gap:"10px"},"right"===q.NOTIF_ALIGN?"right":"left","20px"),"direction",q.TEXT_DIR),"textAlign",q.TEXT_ALIGN)),document.body.appendChild(e),e)}},{key:"show",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0,i=this.map[e]||this.map.info,a=null!=n?n:i.dur;if(this.container&&document.body.contains(this.container))try{return this._toastInPage(t,i,r,a,o)}catch(t){var c,u;return null===(c=(u=this.errorHandler).handle)||void 0===c||c.call(u,t,{type:B.UI,context:"NotificationManager-show"}),null}return this._sendToActiveTab(t,e,r,a,o),null}},{key:"dismiss",value:function(t){t&&"function"==typeof t.remove&&(t.style.opacity="0",setTimeout((function(){return t.remove()}),500))}},{key:"_toastInPage",value:function(t,e,r,n,o){var i=this,a=document.createElement("div");return a.className="AIWC-notification ".concat(e.cls),a.style.cssText="\n      background:#fff;color:#333;padding:10px 15px;\n      border-radius:6px;font-size:14px;border:1px solid #ddd;\n      box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;\n      align-items:center;cursor:pointer;opacity:1;\n      transition:opacity .5s",a.innerHTML='<span style="margin-inline-end:6px;">'.concat(e.icon,"</span><span>").concat(t,"</span>"),a.addEventListener("click",(function(){try{"function"==typeof o&&o()}catch(t){Dt(t)}i.dismiss(a)})),this.container.appendChild(a),r&&"AIWC-status"!==e.cls&&setTimeout((function(){return i.dismiss(a)}),n),a}},{key:"_sendToActiveTab",value:function(t,r,n,o,i){var a=this;return e().tabs.query({active:!0,currentWindow:!0}).then((function(i){var a,c=null==i||null===(a=i[0])||void 0===a?void 0:a.id;if(c)return Ut()?e().tabs.sendMessage(c,{action:"show_notification",payload:{message:t,type:r,autoDismiss:n,duration:o}}):void 0})).then((function(t){if(i&&void 0!==t){var r=function(t){"notification_clicked"===(null==t?void 0:t.action)&&(i(),e().runtime.onMessage.removeListener(r))};e().runtime.onMessage.addListener(r)}})).catch((function(e){a._osNotification(t,r,i)}))}},{key:"_osNotification",value:function(t,r,n){var o=this.map[r]||this.map.info;e().notifications.create({type:"basic",iconUrl:e().runtime.getURL("icons/extension_icon.png"),title:o.title,message:t}).then((function(t){if(n){var r=function(o){o===t&&(n(),e().notifications.clear(t),e().notifications.onClicked.removeListener(r))};e().notifications.onClicked.addListener(r)}})).catch((function(){}))}}],r&&X(t.prototype,r),n&&X(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n}();function W(t){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(t)}function K(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("string"==typeof t){var e=t.trim();if(Object.values(B).includes(e))return e}if(t&&"object"===W(t)){if(t.type)return t.type;var r=t.statusCode;if("number"==typeof r&&r>=400&&r<600)return B.HTTP_ERROR}var n=String(t).toLowerCase().trim();return/\b(403|404|500|502|503|504)\b/.test(n)?B.HTTP_ERROR:n.includes("text is empty")?B.TEXT_EMPTY:n.includes("prompt is invalid")?B.PROMPT_INVALID:n.includes("text is too long")||n.includes("too long")?B.TEXT_TOO_LONG:n.includes("translation not found")?B.TRANSLATION_NOT_FOUND:n.includes("translation failed")?B.TRANSLATION_FAILED:n.includes("wrong api key")||n.includes("api key not valid")||n.includes("no auth credentials")||n.includes("incorrect api key provided")?B.API_KEY_INVALID:n.includes("api key is missing")||n.includes("key missing")?B.API_KEY_MISSING:n.includes("api url")&&n.includes("missing")?B.API_URL_MISSING:n.includes("not a valid model id")||n.includes("invalid model")||n.includes("model not found")||n.includes("model is missing")||n.includes("model not available")||n.includes("the model `")&&n.includes("does not exist or you do not have access to it")?B.MODEL_MISSING:n.includes("quota exceeded")&&n.includes("region")?(Dt("[ErrorMatcher] Quota exceeded with region, indicating Gemini-specific quota."),B.GEMINI_QUOTA_REGION):n.includes("quota exceeded")||n.includes("gemini quota")?B.QUOTA_EXCEEDED:n.includes("failed to fetch")||n.includes("network failure")||n.includes("connection failed")||n.includes("networkerror")||n.includes("networkerror when attempting to fetch resource")?B.NETWORK_ERROR:n.includes("http error")||n.includes("http status")||n.includes("http response")||n.includes("operation was aborted")||n.includes("the operation was aborted.")?B.HTTP_ERROR:n.includes("context")||n.includes("context invalid")||n.includes("extension context")||n.includes("context invalidated")||n.includes("extension context invalidated")?B.CONTEXT:B.UNKNOWN}var Z=[{name:"English",voiceCode:"en-US",promptName:"English",code:"en",locale:"en",flag:"🇬🇧"},{name:"Farsi",voiceCode:"fa-IR",promptName:"Farsi",code:"fa",locale:"fa",flag:"🇮🇷"},{name:"German",voiceCode:"de-DE",promptName:"German",code:"de"},{name:"French",voiceCode:"fr-FR",promptName:"French",code:"fr"},{name:"Chinese (Simplified)",voiceCode:"zh-CN",promptName:"Chinese (Simplified)",code:"zh"},{name:"Spanish",voiceCode:"es-ES",promptName:"Spanish",code:"es"},{name:"Hindi",voiceCode:"hi-IN",promptName:"Hindi",code:"hi"},{name:"Arabic",voiceCode:"ar-SA",promptName:"Arabic",code:"ar"},{name:"Bengali",voiceCode:"bn-BD",promptName:"Bengali",code:"bn"},{name:"Portuguese",voiceCode:"pt-PT",promptName:"Portuguese",code:"pt"},{name:"Russian",voiceCode:"ru-RU",promptName:"Russian",code:"ru"},{name:"Japanese",voiceCode:"ja-JP",promptName:"Japanese",code:"ja"},{name:"Urdu",voiceCode:"ur-PK",promptName:"Urdu",code:"ur"},{name:"Indonesian",voiceCode:"id-ID",promptName:"Indonesian",code:"id"},{name:"Italian",voiceCode:"it-IT",promptName:"Italian",code:"it"},{name:"Swahili",voiceCode:"sw-KE",promptName:"Swahili",code:"sw"},{name:"Marathi",voiceCode:"mr-IN",promptName:"Marathi",code:"mr"},{name:"Telugu",voiceCode:"te-IN",promptName:"Telugu",code:"te"},{name:"Tamil",voiceCode:"ta-IN",promptName:"Tamil",code:"ta"},{name:"Turkish",voiceCode:"tr-TR",promptName:"Turkish",code:"tr"},{name:"Vietnamese",voiceCode:"vi-VN",promptName:"Vietnamese",code:"vi"},{name:"Korean",voiceCode:"ko-KR",promptName:"Korean",code:"ko"},{name:"Thai",voiceCode:"th-TH",promptName:"Thai",code:"th"},{name:"Malay",voiceCode:"ms-MY",promptName:"Malay",code:"ms"},{name:"Polish",voiceCode:"pl-PL",promptName:"Polish",code:"pl"},{name:"Dutch",voiceCode:"nl-NL",promptName:"Dutch",code:"nl"},{name:"Filipino",voiceCode:"fil-PH",promptName:"Filipino",code:"fi"},{name:"Ukrainian",voiceCode:"uk-UA",promptName:"Ukrainian",code:"uk"},{name:"Romanian",voiceCode:"ro-RO",promptName:"Romanian",code:"ro"},{name:"Greek",voiceCode:"el-GR",promptName:"Greek",code:"el"},{name:"Czech",voiceCode:"cs-CZ",promptName:"Czech",code:"cs"},{name:"Hungarian",voiceCode:"hu-HU",promptName:"Hungarian",code:"hu"},{name:"Swedish",voiceCode:"sv-SE",promptName:"Swedish",code:"sv"},{name:"Norwegian",voiceCode:"no-NO",promptName:"Norwegian",code:"no"},{name:"Danish",voiceCode:"da-DK",promptName:"Danish",code:"da"},{name:"Finnish",voiceCode:"fi-FI",promptName:"Finnish",code:"fi"},{name:"Hebrew",voiceCode:"he-IL",promptName:"Hebrew",code:"he"},{name:"Afrikaans",voiceCode:"af-ZA",promptName:"Afrikaans",code:"af"},{name:"Albanian",voiceCode:"sq-AL",promptName:"Albanian",code:"sq"},{name:"Bulgarian",voiceCode:"bg-BG",promptName:"Bulgarian",code:"bg"},{name:"Catalan",voiceCode:"ca-ES",promptName:"Catalan",code:"ca"},{name:"Croatian",voiceCode:"hr-HR",promptName:"Croatian",code:"hr"},{name:"Estonian",voiceCode:"et-EE",promptName:"Estonian",code:"et"},{name:"Latvian",voiceCode:"lv-LV",promptName:"Latvian",code:"lv"},{name:"Lithuanian",voiceCode:"lt-LT",promptName:"Lithuanian",code:"lt"},{name:"Slovak",voiceCode:"sk-SK",promptName:"Slovak",code:"sk"},{name:"Slovenian",voiceCode:"sl-SI",promptName:"Slovenian",code:"sl"},{name:"Serbian",voiceCode:"sr-RS",promptName:"Serbian",code:"sr"},{name:"Malayalam",voiceCode:"ml-IN",promptName:"Malayalam",code:"ml"},{name:"Kannada",voiceCode:"kn-IN",promptName:"Kannada",code:"kn"},{name:"Odia",voiceCode:"or-IN",promptName:"Odia",code:"or"},{name:"Punjabi",voiceCode:"pa-IN",promptName:"Punjabi",code:"pa"},{name:"Sinhala",voiceCode:"si-LK",promptName:"Sinhala",code:"si"},{name:"Nepali",voiceCode:"ne-NP",promptName:"Nepali",code:"ne"},{name:"Azerbaijani",voiceCode:"az-AZ",promptName:"Azerbaijani",code:"az"},{name:"Belarusian",voiceCode:"be-BY",promptName:"Belarusian",code:"be"},{name:"Kazakh",voiceCode:"kk-KZ",promptName:"Kazakh",code:"kk"},{name:"Uzbek",voiceCode:"uz-UZ",promptName:"Uzbek",code:"uz"},{name:"Pashto",voiceCode:"ps-AF",promptName:"Pashto",code:"ps"},{name:"Tagalog",voiceCode:"tl-PH",promptName:"Tagalog",code:"tl"},{name:"Cebuano",voiceCode:"en-US",promptName:"Cebuano",code:"en"}];var Q=function(t){return l.RTL_REGEX.test(t)},J=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&t.style){var r=e;t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}},tt=function(t,e){if(t){var r=function(t){return function(t){return/[\u0600-\u06FF]/.test(t)}(t)||Q(t)}(e),n=r?"rtl":"ltr",o=r?"right":"left";t.style?(t.style.direction=n,t.style.textAlign=o):t.setAttribute("style","direction: ".concat(n,"; text-align: ").concat(o,";"))}};function et(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;t.style.opacity="0",t.style.transform="scale(0.95)",t.style.transition="opacity ".concat(e,"ms ease-out, transform ").concat(e,"ms ease-out"),t.getBoundingClientRect(),t.style.opacity="1",t.style.transform="scale(1)"}function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function nt(){nt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==rt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(rt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ot(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function it(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ot(i,n,o,a,c,"next",t)}function c(t){ot(i,n,o,a,c,"throw",t)}a(void 0)}))}}function at(t){return"true"===String(t).trim().toLowerCase()}var ct,ut=new Map;function st(t){return lt.apply(this,arguments)}function lt(){return(lt=it(nt().mark((function t(r){var n,o,i;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!ut.has(r)){t.next=2;break}return t.abrupt("return",ut.get(r));case 2:return t.prev=2,n=e().runtime.getURL("_locales/".concat(r,"/messages.json")),t.next=6,fetch(n);case 6:if((o=t.sent).ok){t.next=9;break}return t.abrupt("return",null);case 9:return t.next=11,o.json();case 11:return i=t.sent,ut.set(r,i),t.abrupt("return",i);case 16:return t.prev=16,t.t0=t.catch(2),t.abrupt("return",null);case 19:case"end":return t.stop()}}),t,null,[[2,16]])})))).apply(this,arguments)}function ft(t,e){return ht.apply(this,arguments)}function ht(){return(ht=it(nt().mark((function t(e,r){var n,o,i,a,c;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((o=r)&&2===o.length){t.next=7;break}return t.next=4,x();case 4:i=t.sent,a=Z.find((function(t){return t.name===i||t.locale===i})),o=(null==a?void 0:a.code)||(2===(null==i?void 0:i.length)?i:"en");case 7:return t.next=9,st(o);case 9:if(!(c=t.sent)||null===(n=c[e])||void 0===n||!n.message){t.next=12;break}return t.abrupt("return",c[e].message);case 12:return t.abrupt("return",null);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pt(t,r){t.querySelectorAll("[data-i18n]").forEach((function(t){var n=t.getAttribute("data-i18n"),o="";o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n),t.matches("input, textarea")?t.value=o:t.matches("img")?t.setAttribute("alt",o):t.textContent=o})),t.querySelectorAll("[data-i18n-title]").forEach((function(t){var n=t.getAttribute("data-i18n-title"),o="";o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n),t.setAttribute("title",o)})),t.querySelectorAll("[data-i18n-placeholder]").forEach((function(t){var n=t.getAttribute("data-i18n-placeholder"),o="";(o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n))&&(t.placeholder=o)}))}function dt(t){return yt.apply(this,arguments)}function yt(){return(yt=it(nt().mark((function t(e){var r,n,o,i,a,c;return nt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=null,t.next=3,x();case 3:if(o=t.sent,(!(i=e)||(null===(r=i)||void 0===r?void 0:r.length)>2)&&Z.forEach((function(t){t.name!==o&&t.locale!==o||(i=t.locale)})),!i){t.next=10;break}return t.next=9,st(i);case 9:n=t.sent;case 10:a=document.body,c=document.head,pt(a,n),c&&pt(c,n),et(a,300);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function vt(){vt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==gt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(gt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function gt(t){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gt(t)}function mt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function bt(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=gt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==gt(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var wt=(bt(bt(bt(bt(bt(bt(bt(bt(bt(bt(ct={},B.TEXT_EMPTY,"Text is empty"),B.PROMPT_INVALID,"Prompt is invalid"),B.TEXT_TOO_LONG,"Text is too long"),B.TRANSLATION_NOT_FOUND,"Translation not found"),B.TRANSLATION_FAILED,"Translation failed"),B.API,"API error"),B.API_KEY_MISSING,"API Key is missing"),B.API_KEY_INVALID,"API Key is wrong or invalid"),B.API_URL_MISSING,"API URL is missing"),B.MODEL_MISSING,"AI Model is missing or invalid"),bt(bt(bt(bt(bt(bt(bt(bt(bt(bt(ct,B.QUOTA_EXCEEDED,"You exceeded your current quota"),B.GEMINI_QUOTA_REGION,"You reached the Gemini quota. (Region issue)"),B.NETWORK_ERROR,"Connection to server failed"),B.HTTP_ERROR,"HTTP error"),B.CONTEXT,"Extension context lost"),B.UNKNOWN,"An unknown error occurred"),B.TAB_AVAILABILITY,"Tab not available"),B.UI,"User Interface error"),B.INTEGRATION,"Integration error"),B.SERVICE,"Service error"),bt(ct,B.VALIDATION,"Validation error"));function xt(t){return Et.apply(this,arguments)}function Et(){var t;return t=vt().mark((function t(e){var r,n;return vt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.startsWith("ERRORS_")?e:"ERRORS_".concat(e),t.next=3,ft(r);case 3:return(n=t.sent)&&n.trim()||(n=wt[e]||wt[B.UNKNOWN]),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})),Et=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){mt(i,n,o,a,c,"next",t)}function c(t){mt(i,n,o,a,c,"throw",t)}a(void 0)}))},Et.apply(this,arguments)}function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function Tt(t,e,r){return(e=At(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function kt(){kt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Lt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Lt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function _t(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ot(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){_t(i,n,o,a,c,"next",t)}function c(t){_t(i,n,o,a,c,"throw",t)}a(void 0)}))}}function St(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,At(n.key),n)}}function At(t){var e=function(t,e){if("object"!=Lt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Lt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Lt(e)?e:e+""}var It=new Set([B.CONTEXT]),Nt=new Set([B.CONTEXT,B.API,B.API_KEY_INVALID,B.API_KEY_MISSING,B.API_URL_MISSING,B.MODEL_MISSING,B.QUOTA_EXCEEDED,B.GEMINI_QUOTA_REGION,B.NETWORK_ERROR,B.HTTP_ERROR,B.INTEGRATION,B.SERVICE,B.VALIDATION,B.UI,B.PROMPT_INVALID,B.TEXT_EMPTY,B.TEXT_TOO_LONG,B.TRANSLATION_NOT_FOUND,B.TRANSLATION_FAILED,B.TAB_AVAILABILITY]),Pt=new Set([B.API_KEY_INVALID,B.API_KEY_MISSING,B.MODEL_MISSING,B.API_URL_MISSING,B.QUOTA_EXCEEDED,B.HTTP_ERROR,B.GEMINI_QUOTA_REGION]),jt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=new V,this.displayedErrors=new Set,this.handling=!1},e=[{key:"handle",value:(i=Ot(kt().mark((function t(e){var r,n,o,i,a,c=arguments;return kt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:{},!this.handling){t.next=3;break}return t.abrupt("return",e);case 3:return this.handling=!0,t.prev=4,n=e instanceof Error?e.message:String(e),o=K(n),t.next=9,xt(o);case 9:return i=t.sent,t.next=12,b().catch((function(){return l.DEBUG_MODE}));case 12:if(t.sent&&!Nt.has(o)&&console.error("[".concat(o,"] ").concat(n),e.stack),!It.has(o)){t.next=16;break}return t.abrupt("return",e);case 16:return a=Pt.has(o)?Bt:void 0,this._notifyUser(i,r.type||B.SERVICE,a),t.abrupt("return",e);case 19:return t.prev=19,this.handling=!1,t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[4,,19,22]])}))),function(t){return i.apply(this,arguments)})},{key:"handle_OLD",value:(o=Ot(kt().mark((function t(e){var r,n,o,i,a,c,u=arguments;return kt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:{},null==e||!e._isHandled){t.next=3;break}return t.abrupt("return",e);case 3:if(!this.isHandling){t.next=5;break}return t.abrupt("return",e);case 5:return this.isHandling=!0,t.prev=6,t.next=9,extractError(e);case 9:return n=t.sent,o=n._errorKey,i=o.toUpperCase(),t.next=14,b().catch((function(){return l.DEBUG_MODE}));case 14:if(t.sent&&!SUPPRESS_CONSOLE_LOG_ERRORS.has(i)&&this._logError(n,r),!SILENT_ERRORS.has(i)){t.next=20;break}return n._isHandled=!0,t.abrupt("return",n);case 20:return t.next=22,getErrorMessageByKey(o);case 22:return a=t.sent,OPEN_SETTINGS_ERRORS.has(i)&&(c=function(){return Bt()}),this._notifyUser(a,r.type||B.SERVICE,c),n._isHandled=!0,t.abrupt("return",n);case 29:return t.prev=29,t.t0=t.catch(6),Dt("[ErrorService] Fatal error in handler:",t.t0),t.abrupt("return",t.t0);case 33:return t.prev=33,this.isHandling=!1,t.finish(33);case 36:case"end":return t.stop()}}),t,this,[[6,29,33,36]])}))),function(t){return o.apply(this,arguments)})},{key:"_logError",value:function(t,e){console.error("[ErrorService] ".concat(t.name,": ").concat(t.message,"\nContext: ").concat(e.context,"\nType: ").concat(e.type,"\nStack: ").concat(t.stack))}},{key:"_notifyUser",value:function(t,e,r){var n,o=this;if(!this.displayedErrors.has(t)){var i=(Tt(Tt(Tt(Tt(Tt(Tt(Tt(Tt(Tt(Tt(n={},B.API,"error"),B.UI,"error"),B.NETWORK_ERROR,"warning"),B.HTTP_ERROR,"warning"),B.SERVICE,"error"),B.CONTEXT,"warning"),B.VALIDATION,"warning"),B.INTEGRATION,"warning"),B.API_KEY_INVALID,"error"),B.API_KEY_MISSING,"error"),Tt(Tt(Tt(n,B.API_URL_MISSING,"error"),B.MODEL_MISSING,"error"),B.QUOTA_EXCEEDED,"warning"))[e]||"error";this.notifier.show(t,i,!0,4e3,r),this.displayedErrors.add(t),setTimeout((function(){return o.displayedErrors.delete(t)}),4500)}}}],r=[{key:"processError",value:(n=Ot(kt().mark((function t(e){return kt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e||!e.then){t.next=6;break}return t.next=3,e;case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=e;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})}],e&&St(t.prototype,e),r&&St(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i}();function Ct(){return Ct=Ot(kt().mark((function t(e){var r,n,o=arguments;return kt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:"",n=new jt,t.abrupt("return",n.handle(e,{type:B.UI,context:r}));case 3:case"end":return t.stop()}}),t)}))),Ct.apply(this,arguments)}var Rt=new jt,Gt=function(t){return new Promise((function(e){return setTimeout(e,t)}))};function Ft(t,e,r){}var Mt,Dt=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];w().then((function(t){var r;t&&(r=console).debug.apply(r,e)}))},Ht=function(t){if(null!=t&&t.isContentEditable)return!0;if("TEXTAREA"===(null==t?void 0:t.tagName))return!0;if("INPUT"===(null==t?void 0:t.tagName)){var e,r=(null===(e=t.getAttribute("type"))||void 0===e?void 0:e.toLowerCase())||"text";return["text","search"].includes(r)}return!(null==t||!t.closest||!t.closest('[contenteditable="true"]'))},Ut=function(){try{var t,r;return!(null===e()||void 0===e()||null===(t=e().runtime)||void 0===t||!t.id||null===e()||void 0===e()||null===(r=e().storage)||void 0===r||!r.local)}catch(t){return!1}},Bt=function(){e().runtime.openOptionsPage?e().runtime.openOptionsPage():window.open(e().runtime.getURL("html/options.html"))};Mt=null;function $t(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{var e;if(null===(e=document)||void 0===e||!e.body)return;document.documentElement.classList.toggle("AIWritingCompanion-disable-links",t)}catch(t){throw Rt.handle(t,{type:B.CONTEXT,context:"taggleLinks",details:{errorType:t.message.includes("context invalidated")?"CONTEXT_INVALIDATED":"UNKNOWN_ERROR"}})}}var zt,Xt;function Yt(t){return document.getElementById(t)}const qt={translationForm:Yt("translationForm"),sourceText:Yt("sourceText"),translationResult:Yt("translationResult"),sourceContainer:null===(zt=Yt("sourceText"))||void 0===zt?void 0:zt.parentElement,resultContainer:null===(Xt=Yt("translationResult"))||void 0===Xt?void 0:Xt.parentElement,sourceLanguageInput:Yt("sourceLanguageInput"),targetLanguageInput:Yt("targetLanguageInput"),sourceLanguagesList:Yt("sourceLanguagesList"),targetLanguagesList:Yt("targetLanguagesList"),clearSourceLanguage:Yt("clearSourceLanguage"),clearTargetLanguage:Yt("clearTargetLanguage"),swapLanguagesBtn:Yt("swapLanguagesBtn"),translateBtn:Yt("translateBtn"),copySourceBtn:Yt("copySourceBtn"),pasteSourceBtn:Yt("pasteSourceBtn"),voiceSourceIcon:Yt("voiceSourceIcon"),copyTargetBtn:Yt("copyTargetBtn"),voiceTargetIcon:Yt("voiceTargetIcon"),translatePageLink:Yt("translatePageLink"),selectElementIcon:Yt("selectElementIcon"),clearStorageBtn:Yt("clearStorageBtn"),revertIcon:Yt("revertActionIcon"),settingsIcon:Yt("settingsIcon"),popupContainer:document.body,$:Yt};function Vt(t,e){var r=null==t?void 0:t.parentElement;r&&e&&r.classList.toggle("has-value",!!t.value)}function Wt(t){var e=null==t?void 0:t.parentElement;if(e){var r=(t.value||t.textContent||"").trim();e.classList.toggle("has-content",r&&r!==ft("popup_string_during_translate")||"در حال ترجمه...")}}function Kt(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(t){var r="feedback-".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success");t.classList.add(r),setTimeout((function(){t.classList.remove(r)}),e)}}var Zt="Auto Detect";function Qt(t){if(!t)return null;var e=t.trim();if(e===Zt)return Zt;var r=Z.find((function(t){return t.name===e||t.promptName===e||t.voiceCode===e}));return r?r.voiceCode:null}function Jt(t){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jt(t)}function te(){te=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Jt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Jt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ee(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function re(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ee(i,n,o,a,c,"next",t)}function c(t){ee(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ne(t){if(!t)return null;var e=t.trim();if(e===Zt)return Zt;var r=Z.find((function(t){return t.name===e||t.promptName===e}));return r?r.promptName||r.name:null}function oe(t){if(!t||t===Zt)return Zt;var e=Z.find((function(e){return e.code===t||e.name===t||e.promptName===t}));return e?e.promptName||e.name:""}function ie(){if(Z.forEach((function(t){var e,r=document.createElement("option");if(r.value=t.promptName||t.name,null===(e=qt.sourceLanguagesList)||void 0===e||e.appendChild(r),t.code!==Zt){var n,o=document.createElement("option");o.value=t.promptName||t.name,null===(n=qt.targetLanguagesList)||void 0===n||n.appendChild(o)}})),!Z.some((function(t){return t.name===Zt||t.promptName===Zt}))){var t,e=document.createElement("option");e.value=Zt,null===(t=qt.sourceLanguagesList)||void 0===t||t.prepend(e)}}function ae(){return ce.apply(this,arguments)}function ce(){return(ce=re(te().mark((function t(){var e;return te().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return qt.sourceLanguageInput.value=Zt,Vt(qt.sourceLanguageInput,qt.clearSourceLanguage),t.prev=2,t.next=5,T();case 5:e=t.sent,qt.targetLanguageInput.value=oe(e)||oe("en"),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(2),Dt("[LangManager]: Error getting target language:",t.t0),qt.targetLanguageInput.value=oe("en");case 13:return t.prev=13,Vt(qt.targetLanguageInput,qt.clearTargetLanguage),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[2,9,13,16]])})))).apply(this,arguments)}function ue(t){null==t||t.focus()}function se(){return le.apply(this,arguments)}function le(){return(le=re(te().mark((function t(){return te().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ie(),t.next=3,ae();case 3:e=void 0,r=void 0,n=void 0,o=void 0,i=void 0,a=void 0,c=void 0,null===(e=qt.sourceLanguageInput)||void 0===e||e.addEventListener("click",(function(){return ue(qt.sourceLanguageInput)})),null===(r=qt.targetLanguageInput)||void 0===r||r.addEventListener("click",(function(){return ue(qt.targetLanguageInput)})),null===(n=qt.clearSourceLanguage)||void 0===n||n.addEventListener("click",(function(){qt.sourceLanguageInput.value="",Vt(qt.sourceLanguageInput,qt.clearSourceLanguage),qt.sourceLanguageInput.focus()})),null===(o=qt.clearTargetLanguage)||void 0===o||o.addEventListener("click",(function(){qt.targetLanguageInput.value="",Vt(qt.targetLanguageInput,qt.clearTargetLanguage),qt.targetLanguageInput.focus()})),null===(i=qt.sourceLanguageInput)||void 0===i||i.addEventListener("input",(function(){return Vt(qt.sourceLanguageInput,qt.clearSourceLanguage)})),null===(a=qt.targetLanguageInput)||void 0===a||a.addEventListener("input",(function(){return Vt(qt.targetLanguageInput,qt.clearTargetLanguage)})),null===(c=qt.swapLanguagesBtn)||void 0===c||c.addEventListener("click",re(te().mark((function t(){var e,r,n,o,i,a,c,u,s,l;return te().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=qt.sourceLanguageInput.value,r=qt.targetLanguageInput.value,n=Qt(e),o=Qt(r),i=n,a=o,n!==Zt){t.next=16;break}return t.prev=7,t.next=10,L();case 10:i=t.sent,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(7),Dt("[LangManager]: Failed to load source language from settings",t.t0);case 16:if(o!==Zt){t.next=26;break}return t.prev=17,t.next=20,T();case 20:a=t.sent,t.next=26;break;case 23:t.prev=23,t.t1=t.catch(17),Dt("[LangManager]: Failed to load target language from settings",t.t1);case 26:if(!i||!a){t.next=52;break}if(c=oe(a),u=oe(i),qt.sourceLanguageInput.value=c||r,qt.targetLanguageInput.value=u||e,Vt(qt.sourceLanguageInput,qt.clearSourceLanguage),Vt(qt.targetLanguageInput,qt.clearTargetLanguage),s=qt.sourceText.value,l=qt.translationResult.textContent,t.t2=l,!t.t2){t.next=42;break}return t.t3=l,t.next=40,ft("popup_string_during_translate");case 40:t.t4=t.sent,t.t2=t.t3!==t.t4;case 42:if(!t.t2){t.next=50;break}qt.sourceText.value=l,qt.translationResult.textContent=s,tt(qt.sourceText,l),tt(qt.translationResult,s),Wt(qt.sourceText),Wt(qt.translationResult),document.dispatchEvent(new CustomEvent("translationSwapped"));case 50:t.next=54;break;case 52:Dt("[LangManager]: Cannot swap - invalid language selection.",{sourceCode:n,targetCode:o}),qt.swapLanguagesBtn&&Kt(qt.swapLanguagesBtn,"error",500);case 54:case"end":return t.stop()}}),t,null,[[7,13],[17,23]])})))),Dt("[LangManager]: Initialized.");case 5:case"end":return t.stop()}var e,r,n,o,i,a,c}),t)})))).apply(this,arguments)}function fe(t){return fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fe(t)}function he(){he=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==fe(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(fe(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function pe(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function de(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){pe(i,n,o,a,c,"next",t)}function c(t){pe(i,n,o,a,c,"throw",t)}a(void 0)}))}}var ye=!1;function ve(){return ge.apply(this,arguments)}function ge(){return(ge=de(he().mark((function t(){return he().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.readText();case 3:return t.abrupt("return",!0);case 6:return t.prev=6,t.t0=t.catch(0),Dt("[Clipboard]: Clipboard read permission denied.",t.t0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))).apply(this,arguments)}function me(){return be.apply(this,arguments)}function be(){return(be=de(he().mark((function t(){var e,r;return he().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=qt.pasteSourceBtn){t.next=3;break}return t.abrupt("return");case 3:if(e.classList.add("hidden-by-clipboard"),!ye||document.hasFocus()){t.next=7;break}return Dt("[Clipboard]: Visibility check deferred until window focus."),t.abrupt("return");case 7:if(navigator.clipboard&&navigator.clipboard.readText){t.next=10;break}return Dt("[Clipboard]: Clipboard API unavailable."),t.abrupt("return");case 10:return t.prev=10,t.next=13,navigator.clipboard.readText();case 13:r=t.sent,ye=!1,null!=r&&r.trim()?(e.classList.remove("hidden-by-clipboard"),Dt("[Clipboard]: Clipboard has text, showing Paste button.")):Dt("[Clipboard]: Clipboard empty or no text, hiding Paste button."),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(10),"NotAllowedError"!==t.t0.name||document.hasFocus()||ye?(Dt("[Clipboard]: Error reading clipboard.",t.t0),ye=!1):(ye=!0,Dt("[Clipboard]: Permission error; deferring until focus."),window.addEventListener("focus",me,{once:!0}));case 21:case"end":return t.stop()}}),t,null,[[10,18]])})))).apply(this,arguments)}function we(){return xe.apply(this,arguments)}function xe(){return(xe=de(he().mark((function t(){return he().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=void 0,r=void 0,n=void 0,null===(e=qt.copySourceBtn)||void 0===e||e.addEventListener("click",de(he().mark((function t(){var e,r;return he().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=qt.sourceText.value){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,navigator.clipboard.writeText(e);case 6:Dt("[Clipboard]: Source text copied successfully."),null===(r=qt.pasteSourceBtn)||void 0===r||r.classList.remove("hidden-by-clipboard"),Kt(qt.copySourceBtn),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(3),Dt("[Clipboard]: Failed to copy source text.",t.t0),Kt(qt.copySourceBtn,"error");case 15:case"end":return t.stop()}}),t,null,[[3,11]])})))),null===(r=qt.pasteSourceBtn)||void 0===r||r.addEventListener("click",de(he().mark((function t(){var e;return he().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ve();case 2:if(t.sent){t.next=6;break}return Kt(qt.pasteSourceBtn,"error"),qt.pasteSourceBtn.classList.add("hidden-by-clipboard"),t.abrupt("return");case 6:return t.prev=6,t.next=9,navigator.clipboard.readText();case 9:return(e=t.sent)&&(qt.sourceText.value=e,qt.sourceText.dispatchEvent(new Event("input",{bubbles:!0})),qt.sourceText.focus()),t.next=13,me();case 13:t.next=20;break;case 15:t.prev=15,t.t0=t.catch(6),Dt("[Clipboard]: Error pasting text.",t.t0),Kt(qt.pasteSourceBtn,"error"),qt.pasteSourceBtn.classList.add("hidden-by-clipboard");case 20:case"end":return t.stop()}}),t,null,[[6,15]])})))),null===(n=qt.copyTargetBtn)||void 0===n||n.addEventListener("click",de(he().mark((function t(){var e,r;return he().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=qt.translationResult.textContent,t.t0=!e,t.t0){t.next=8;break}return t.t1=e,t.next=6,ft("popup_string_during_translate");case 6:t.t2=t.sent,t.t0=t.t1===t.t2;case 8:if(!t.t0){t.next=10;break}return t.abrupt("return");case 10:return t.prev=10,t.next=13,navigator.clipboard.writeText(e);case 13:Dt("[Clipboard]: Translation copied successfully."),null===(r=qt.pasteSourceBtn)||void 0===r||r.classList.remove("hidden-by-clipboard"),Kt(qt.copyTargetBtn),t.next=22;break;case 18:t.prev=18,t.t3=t.catch(10),Dt("[Clipboard]: Failed to copy translation.",t.t3),Kt(qt.copyTargetBtn,"error");case 22:case"end":return t.stop()}}),t,null,[[10,18]])})))),document.addEventListener("translationSwapped",me),t.next=3,me();case 3:Dt("[Clipboard]: Clipboard manager initialized.");case 4:case"end":return t.stop()}var e,r,n}),t)})))).apply(this,arguments)}function Ee(t){return Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ee(t)}function Le(){Le=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ee(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ee(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Te(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ke(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Te(i,n,o,a,c,"next",t)}function c(t){Te(i,n,o,a,c,"throw",t)}a(void 0)}))}}function _e(){var t,r,n,o,i,a;t=document.querySelector("#sourceLanguageInput"),r=document.querySelector("#targetLanguageInput"),n=document.querySelector("#voiceSourceIcon"),o=document.querySelector("#voiceTargetIcon"),i=document.querySelector("#sourceText"),a=document.querySelector("#translationResult"),null==n||n.addEventListener("click",ke(Le().mark((function r(){var n,o,a;return Le().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=null==i?void 0:i.value.trim()){r.next=4;break}return i.focus(),r.abrupt("return");case 4:return r.prev=4,o=(null==t?void 0:t.value)||Zt,r.next=8,e().runtime.sendMessage({action:"speak",text:n,lang:o});case 8:(a=r.sent)?a.success?Dt("[Popup TTS]: TTS playback started."):Dt("[Popup TTS]: TTS error:",a.error):Dt("[Popup TTS]: No response from background."),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(4),Dt("[Popup TTS]: Error sending message:",r.t0);case 15:case"end":return r.stop()}}),r,null,[[4,12]])})))),null==o||o.addEventListener("click",ke(Le().mark((function t(){var n,o,i,c;return Le().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=null==a||null===(n=a.textContent)||void 0===n?void 0:n.trim()){t.next=4;break}return a.scrollIntoView({behavior:"smooth",block:"center"}),t.abrupt("return");case 4:return t.prev=4,i=(null==r?void 0:r.value)||Zt,t.next=8,e().runtime.sendMessage({action:"speak",text:o,lang:i});case 8:(c=t.sent)?c.success?Dt("[Popup TTS]: TTS playback started for target text."):Dt("[Popup TTS]: TTS error (target):",c.error):Dt("[Popup TTS]: No response from background."),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),Dt("[Popup TTS]: Error sending message (target):",t.t0);case 15:case"end":return t.stop()}}),t,null,[[4,12]])})))),Dt("[Popup TTS]: Initialized.")}function Oe(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Se={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function Ae(t){Se=t}const Ie={exec:()=>null};function Ne(t,e=""){let r="string"==typeof t?t:t.source;const n={replace:(t,e)=>{let o="string"==typeof e?e:e.source;return o=o.replace(Pe.caret,"$1"),r=r.replace(t,o),n},getRegex:()=>new RegExp(r,e)};return n}const Pe={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},je=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Ce=/(?:[*+-]|\d{1,9}[.)])/,Re=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ge=Ne(Re).replace(/bull/g,Ce).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Fe=Ne(Re).replace(/bull/g,Ce).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Me=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,De=/(?!\s*\])(?:\\.|[^\[\]\\])+/,He=Ne(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",De).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Ue=Ne(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Ce).getRegex(),Be="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",$e=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,ze=Ne("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",$e).replace("tag",Be).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Xe=Ne(Me).replace("hr",je).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex(),Ye={blockquote:Ne(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Xe).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:He,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:je,html:ze,lheading:Ge,list:Ue,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:Xe,table:Ie,text:/^[^\n]+/},qe=Ne("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",je).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex(),Ve={...Ye,lheading:Fe,table:qe,paragraph:Ne(Me).replace("hr",je).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",qe).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Be).getRegex()},We={...Ye,html:Ne("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",$e).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ie,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Ne(Me).replace("hr",je).replace("heading"," *#{1,6} *[^\n]").replace("lheading",Ge).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Ke=/^( {2,}|\\)\n(?!\s*$)/,Ze=/[\p{P}\p{S}]/u,Qe=/[\s\p{P}\p{S}]/u,Je=/[^\s\p{P}\p{S}]/u,tr=Ne(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Qe).getRegex(),er=/(?!~)[\p{P}\p{S}]/u,rr=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,nr=Ne(rr,"u").replace(/punct/g,Ze).getRegex(),or=Ne(rr,"u").replace(/punct/g,er).getRegex(),ir="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",ar=Ne(ir,"gu").replace(/notPunctSpace/g,Je).replace(/punctSpace/g,Qe).replace(/punct/g,Ze).getRegex(),cr=Ne(ir,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,er).getRegex(),ur=Ne("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Je).replace(/punctSpace/g,Qe).replace(/punct/g,Ze).getRegex(),sr=Ne(/\\(punct)/,"gu").replace(/punct/g,Ze).getRegex(),lr=Ne(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),fr=Ne($e).replace("(?:--\x3e|$)","--\x3e").getRegex(),hr=Ne("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",fr).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),pr=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,dr=Ne(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",pr).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),yr=Ne(/^!?\[(label)\]\[(ref)\]/).replace("label",pr).replace("ref",De).getRegex(),vr=Ne(/^!?\[(ref)\](?:\[\])?/).replace("ref",De).getRegex(),gr={_backpedal:Ie,anyPunctuation:sr,autolink:lr,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:Ke,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:Ie,emStrongLDelim:nr,emStrongRDelimAst:ar,emStrongRDelimUnd:ur,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:dr,nolink:vr,punctuation:tr,reflink:yr,reflinkSearch:Ne("reflink|nolink(?!\\()","g").replace("reflink",yr).replace("nolink",vr).getRegex(),tag:hr,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:Ie},mr={...gr,link:Ne(/^!?\[(label)\]\((.*?)\)/).replace("label",pr).getRegex(),reflink:Ne(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",pr).getRegex()},br={...gr,emStrongRDelimAst:cr,emStrongLDelim:or,url:Ne(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},wr={...br,br:Ne(Ke).replace("{2,}","*").getRegex(),text:Ne(br.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},xr={normal:Ye,gfm:Ve,pedantic:We},Er={normal:gr,gfm:br,breaks:wr,pedantic:mr},Lr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Tr=t=>Lr[t];function kr(t,e){if(e){if(Pe.escapeTest.test(t))return t.replace(Pe.escapeReplace,Tr)}else if(Pe.escapeTestNoEncode.test(t))return t.replace(Pe.escapeReplaceNoEncode,Tr);return t}function _r(t){try{t=encodeURI(t).replace(Pe.percentDecode,"%")}catch{return null}return t}function Or(t,e){const r=t.replace(Pe.findPipe,((t,e,r)=>{let n=!1,o=e;for(;--o>=0&&"\\"===r[o];)n=!n;return n?"|":" |"})).split(Pe.splitPipe);let n=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;n<r.length;n++)r[n]=r[n].trim().replace(Pe.slashPipe,"|");return r}function Sr(t,e,r){const n=t.length;if(0===n)return"";let o=0;for(;o<n;){if(t.charAt(n-o-1)!==e)break;o++}return t.slice(0,n-o)}function Ar(t,e,r,n,o){const i=e.href,a=e.title||null,c=t[1].replace(o.other.outputLinkReplace,"$1");if("!"!==t[0].charAt(0)){n.state.inLink=!0;const t={type:"link",raw:r,href:i,title:a,text:c,tokens:n.inlineTokens(c)};return n.state.inLink=!1,t}return{type:"image",raw:r,href:i,title:a,text:c}}class Ir{options;rules;lexer;constructor(t){this.options=t||Se}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:Sr(t,"\n")}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const t=e[0],r=function(t,e,r){const n=t.match(r.other.indentCodeCompensation);if(null===n)return e;const o=n[1];return e.split("\n").map((t=>{const e=t.match(r.other.beginningSpace);if(null===e)return t;const[n]=e;return n.length>=o.length?t.slice(o.length):t})).join("\n")}(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){const e=Sr(t,"#");this.options.pedantic?t=e.trim():e&&!this.rules.other.endingSpaceChar.test(e)||(t=e.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Sr(e[0],"\n")}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let t=Sr(e[0],"\n").split("\n"),r="",n="";const o=[];for(;t.length>0;){let e=!1;const i=[];let a;for(a=0;a<t.length;a++)if(this.rules.other.blockquoteStart.test(t[a]))i.push(t[a]),e=!0;else{if(e)break;i.push(t[a])}t=t.slice(a);const c=i.join("\n"),u=c.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}\n${c}`:c,n=n?`${n}\n${u}`:u;const s=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,o,!0),this.lexer.state.top=s,0===t.length)break;const l=o.at(-1);if("code"===l?.type)break;if("blockquote"===l?.type){const e=l,i=e.raw+"\n"+t.join("\n"),a=this.blockquote(i);o[o.length-1]=a,r=r.substring(0,r.length-e.raw.length)+a.raw,n=n.substring(0,n.length-e.text.length)+a.text;break}if("list"!==l?.type);else{const e=l,i=e.raw+"\n"+t.join("\n"),a=this.list(i);o[o.length-1]=a,r=r.substring(0,r.length-l.raw.length)+a.raw,n=n.substring(0,n.length-e.raw.length)+a.raw,t=i.substring(o.at(-1).raw.length).split("\n")}}return{type:"blockquote",raw:r,tokens:o,text:n}}}list(t){let e=this.rules.block.list.exec(t);if(e){let r=e[1].trim();const n=r.length>1,o={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");const i=this.rules.other.listItemRegex(r);let a=!1;for(;t;){let r=!1,n="",c="";if(!(e=i.exec(t)))break;if(this.rules.block.hr.test(t))break;n=e[0],t=t.substring(n.length);let u=e[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,(t=>" ".repeat(3*t.length))),s=t.split("\n",1)[0],l=!u.trim(),f=0;if(this.options.pedantic?(f=2,c=u.trimStart()):l?f=e[1].length+1:(f=e[2].search(this.rules.other.nonSpaceChar),f=f>4?1:f,c=u.slice(f),f+=e[1].length),l&&this.rules.other.blankLine.test(s)&&(n+=s+"\n",t=t.substring(s.length+1),r=!0),!r){const e=this.rules.other.nextBulletRegex(f),r=this.rules.other.hrRegex(f),o=this.rules.other.fencesBeginRegex(f),i=this.rules.other.headingBeginRegex(f),a=this.rules.other.htmlBeginRegex(f);for(;t;){const h=t.split("\n",1)[0];let p;if(s=h,this.options.pedantic?(s=s.replace(this.rules.other.listReplaceNesting,"  "),p=s):p=s.replace(this.rules.other.tabCharGlobal,"    "),o.test(s))break;if(i.test(s))break;if(a.test(s))break;if(e.test(s))break;if(r.test(s))break;if(p.search(this.rules.other.nonSpaceChar)>=f||!s.trim())c+="\n"+p.slice(f);else{if(l)break;if(u.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(o.test(u))break;if(i.test(u))break;if(r.test(u))break;c+="\n"+s}l||s.trim()||(l=!0),n+=h+"\n",t=t.substring(h.length+1),u=p.slice(f)}}o.loose||(a?o.loose=!0:this.rules.other.doubleBlankLine.test(n)&&(a=!0));let h,p=null;this.options.gfm&&(p=this.rules.other.listIsTask.exec(c),p&&(h="[ ] "!==p[0],c=c.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:n,task:!!p,checked:h,loose:!1,text:c,tokens:[]}),o.raw+=n}const c=o.items.at(-1);if(!c)return;c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd(),o.raw=o.raw.trimEnd();for(let t=0;t<o.items.length;t++)if(this.lexer.state.top=!1,o.items[t].tokens=this.lexer.blockTokens(o.items[t].text,[]),!o.loose){const e=o.items[t].tokens.filter((t=>"space"===t.type)),r=e.length>0&&e.some((t=>this.rules.other.anyLine.test(t.raw)));o.loose=r}if(o.loose)for(let t=0;t<o.items.length;t++)o.items[t].loose=!0;return o}}html(t){const e=this.rules.block.html.exec(t);if(e){return{type:"html",block:!0,raw:e[0],pre:"pre"===e[1]||"script"===e[1]||"style"===e[1],text:e[0]}}}def(t){const e=this.rules.block.def.exec(t);if(e){const t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:r,title:n}}}table(t){const e=this.rules.block.table.exec(t);if(!e)return;if(!this.rules.other.tableDelimiter.test(e[2]))return;const r=Or(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],i={type:"table",raw:e[0],header:[],align:[],rows:[]};if(r.length===n.length){for(const t of n)this.rules.other.tableAlignRight.test(t)?i.align.push("right"):this.rules.other.tableAlignCenter.test(t)?i.align.push("center"):this.rules.other.tableAlignLeft.test(t)?i.align.push("left"):i.align.push(null);for(let t=0;t<r.length;t++)i.header.push({text:r[t],tokens:this.lexer.inline(r[t]),header:!0,align:i.align[t]});for(const t of o)i.rows.push(Or(t,i.header.length).map(((t,e)=>({text:t,tokens:this.lexer.inline(t),header:!1,align:i.align[e]}))));return i}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:"="===e[2].charAt(0)?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const t="\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;const e=Sr(t.slice(0,-1),"\\");if((t.length-e.length)%2==0)return}else{const t=function(t,e){if(-1===t.indexOf(e[1]))return-1;let r=0;for(let n=0;n<t.length;n++)if("\\"===t[n])n++;else if(t[n]===e[0])r++;else if(t[n]===e[1]&&(r--,r<0))return n;return-1}(e[2],"()");if(t>-1){const r=(0===e[0].indexOf("!")?5:4)+e[1].length+t;e[2]=e[2].substring(0,t),e[0]=e[0].substring(0,r).trim(),e[3]=""}}let r=e[2],n="";if(this.options.pedantic){const t=this.rules.other.pedanticHrefTitle.exec(r);t&&(r=t[1],n=t[3])}else n=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(r=this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?r.slice(1):r.slice(1,-1)),Ar(e,{href:r?r.replace(this.rules.inline.anyPunctuation,"$1"):r,title:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n},e[0],this.lexer,this.rules)}}reflink(t,e){let r;if((r=this.rules.inline.reflink.exec(t))||(r=this.rules.inline.nolink.exec(t))){const t=e[(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!t){const t=r[0].charAt(0);return{type:"text",raw:t,text:t}}return Ar(r,t,r[0],this.lexer,this.rules)}}emStrong(t,e,r=""){let n=this.rules.inline.emStrongLDelim.exec(t);if(!n)return;if(n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))return;if(!(n[1]||n[2]||"")||!r||this.rules.inline.punctuation.exec(r)){const r=[...n[0]].length-1;let o,i,a=r,c=0;const u="*"===n[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(u.lastIndex=0,e=e.slice(-1*t.length+r);null!=(n=u.exec(e));){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(i=[...o].length,n[3]||n[4]){a+=i;continue}if((n[5]||n[6])&&r%3&&!((r+i)%3)){c+=i;continue}if(a-=i,a>0)continue;i=Math.min(i,i+a+c);const e=[...n[0]][0].length,u=t.slice(0,r+n.index+e+i);if(Math.min(r,i)%2){const t=u.slice(1,-1);return{type:"em",raw:u,text:t,tokens:this.lexer.inlineTokens(t)}}const s=u.slice(2,-2);return{type:"strong",raw:u,text:s,tokens:this.lexer.inlineTokens(s)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," ");const r=this.rules.other.nonSpaceChar.test(t),n=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return r&&n&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let t,r;return"@"===e[2]?(t=e[1],r="mailto:"+t):(t=e[1],r=t),{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let t,r;if("@"===e[2])t=e[0],r="mailto:"+t;else{let n;do{n=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??""}while(n!==e[0]);t=e[0],r="www."===e[1]?"http://"+e[0]:e[0]}return{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){const t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}}class Nr{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Se,this.options.tokenizer=this.options.tokenizer||new Ir,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={other:Pe,block:xr.normal,inline:Er.normal};this.options.pedantic?(e.block=xr.pedantic,e.inline=Er.pedantic):this.options.gfm&&(e.block=xr.gfm,this.options.breaks?e.inline=Er.breaks:e.inline=Er.gfm),this.tokenizer.rules=e}static get rules(){return{block:xr,inline:Er}}static lex(t,e){return new Nr(e).lex(t)}static lexInline(t,e){return new Nr(e).inlineTokens(t)}lex(t){t=t.replace(Pe.carriageReturn,"\n"),this.blockTokens(t,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const e=this.inlineQueue[t];this.inlineTokens(e.src,e.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],r=!1){for(this.options.pedantic&&(t=t.replace(Pe.tabCharGlobal,"    ").replace(Pe.spaceLine,""));t;){let n;if(this.options.extensions?.block?.some((r=>!!(n=r.call({lexer:this},t,e))&&(t=t.substring(n.raw.length),e.push(n),!0))))continue;if(n=this.tokenizer.space(t)){t=t.substring(n.raw.length);const r=e.at(-1);1===n.raw.length&&void 0!==r?r.raw+="\n":e.push(n);continue}if(n=this.tokenizer.code(t)){t=t.substring(n.raw.length);const r=e.at(-1);"paragraph"===r?.type||"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.at(-1).src=r.text):e.push(n);continue}if(n=this.tokenizer.fences(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.heading(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.hr(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.blockquote(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.list(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.html(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.def(t)){t=t.substring(n.raw.length);const r=e.at(-1);"paragraph"===r?.type||"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.raw,this.inlineQueue.at(-1).src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.lheading(t)){t=t.substring(n.raw.length),e.push(n);continue}let o=t;if(this.options.extensions?.startBlock){let e=1/0;const r=t.slice(1);let n;this.options.extensions.startBlock.forEach((t=>{n=t.call({lexer:this},r),"number"==typeof n&&n>=0&&(e=Math.min(e,n))})),e<1/0&&e>=0&&(o=t.substring(0,e+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o))){const i=e.at(-1);r&&"paragraph"===i?.type?(i.raw+="\n"+n.raw,i.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):e.push(n),r=o.length!==t.length,t=t.substring(n.raw.length)}else if(n=this.tokenizer.text(t)){t=t.substring(n.raw.length);const r=e.at(-1);"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):e.push(n)}else if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(e);break}throw new Error(e)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){let r=t,n=null;if(this.tokens.links){const t=Object.keys(this.tokens.links);if(t.length>0)for(;null!=(n=this.tokenizer.rules.inline.reflinkSearch.exec(r));)t.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(n=this.tokenizer.rules.inline.blockSkip.exec(r));)r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(n=this.tokenizer.rules.inline.anyPunctuation.exec(r));)r=r.slice(0,n.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o=!1,i="";for(;t;){let n;if(o||(i=""),o=!1,this.options.extensions?.inline?.some((r=>!!(n=r.call({lexer:this},t,e))&&(t=t.substring(n.raw.length),e.push(n),!0))))continue;if(n=this.tokenizer.escape(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.tag(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.link(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(n.raw.length);const r=e.at(-1);"text"===n.type&&"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):e.push(n);continue}if(n=this.tokenizer.emStrong(t,r,i)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.codespan(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.br(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.del(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.autolink(t)){t=t.substring(n.raw.length),e.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(t))){t=t.substring(n.raw.length),e.push(n);continue}let a=t;if(this.options.extensions?.startInline){let e=1/0;const r=t.slice(1);let n;this.options.extensions.startInline.forEach((t=>{n=t.call({lexer:this},r),"number"==typeof n&&n>=0&&(e=Math.min(e,n))})),e<1/0&&e>=0&&(a=t.substring(0,e+1))}if(n=this.tokenizer.inlineText(a)){t=t.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(i=n.raw.slice(-1)),o=!0;const r=e.at(-1);"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):e.push(n)}else if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(e);break}throw new Error(e)}}return e}}class Pr{options;parser;constructor(t){this.options=t||Se}space(t){return""}code({text:t,lang:e,escaped:r}){const n=(e||"").match(Pe.notSpaceStart)?.[0],o=t.replace(Pe.endingNewline,"")+"\n";return n?'<pre><code class="language-'+kr(n)+'">'+(r?o:kr(o,!0))+"</code></pre>\n":"<pre><code>"+(r?o:kr(o,!0))+"</code></pre>\n"}blockquote({tokens:t}){return`<blockquote>\n${this.parser.parse(t)}</blockquote>\n`}html({text:t}){return t}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>\n`}hr(t){return"<hr>\n"}list(t){const e=t.ordered,r=t.start;let n="";for(let e=0;e<t.items.length;e++){const r=t.items[e];n+=this.listitem(r)}const o=e?"ol":"ul";return"<"+o+(e&&1!==r?' start="'+r+'"':"")+">\n"+n+"</"+o+">\n"}listitem(t){let e="";if(t.task){const r=this.checkbox({checked:!!t.checked});t.loose?"paragraph"===t.tokens[0]?.type?(t.tokens[0].text=r+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&"text"===t.tokens[0].tokens[0].type&&(t.tokens[0].tokens[0].text=r+" "+kr(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):e+=r+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>\n`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>\n`}table(t){let e="",r="";for(let e=0;e<t.header.length;e++)r+=this.tablecell(t.header[e]);e+=this.tablerow({text:r});let n="";for(let e=0;e<t.rows.length;e++){const o=t.rows[e];r="";for(let t=0;t<o.length;t++)r+=this.tablecell(o[t]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),"<table>\n<thead>\n"+e+"</thead>\n"+n+"</table>\n"}tablerow({text:t}){return`<tr>\n${t}</tr>\n`}tablecell(t){const e=this.parser.parseInline(t.tokens),r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>\n`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${kr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:r}){const n=this.parser.parseInline(r),o=_r(t);if(null===o)return n;let i='<a href="'+(t=o)+'"';return e&&(i+=' title="'+kr(e)+'"'),i+=">"+n+"</a>",i}image({href:t,title:e,text:r}){const n=_r(t);if(null===n)return kr(r);let o=`<img src="${t=n}" alt="${r}"`;return e&&(o+=` title="${kr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:kr(t.text)}}class jr{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}}class Cr{options;renderer;textRenderer;constructor(t){this.options=t||Se,this.options.renderer=this.options.renderer||new Pr,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new jr}static parse(t,e){return new Cr(e).parse(t)}static parseInline(t,e){return new Cr(e).parseInline(t)}parse(t,e=!0){let r="";for(let n=0;n<t.length;n++){const o=t[n];if(this.options.extensions?.renderers?.[o.type]){const t=o,e=this.options.extensions.renderers[t.type].call({parser:this},t);if(!1!==e||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(t.type)){r+=e||"";continue}}const i=o;switch(i.type){case"space":r+=this.renderer.space(i);continue;case"hr":r+=this.renderer.hr(i);continue;case"heading":r+=this.renderer.heading(i);continue;case"code":r+=this.renderer.code(i);continue;case"table":r+=this.renderer.table(i);continue;case"blockquote":r+=this.renderer.blockquote(i);continue;case"list":r+=this.renderer.list(i);continue;case"html":r+=this.renderer.html(i);continue;case"paragraph":r+=this.renderer.paragraph(i);continue;case"text":{let o=i,a=this.renderer.text(o);for(;n+1<t.length&&"text"===t[n+1].type;)o=t[++n],a+="\n"+this.renderer.text(o);r+=e?this.renderer.paragraph({type:"paragraph",raw:a,text:a,tokens:[{type:"text",raw:a,text:a,escaped:!0}]}):a;continue}default:{const t='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(t),"";throw new Error(t)}}}return r}parseInline(t,e=this.renderer){let r="";for(let n=0;n<t.length;n++){const o=t[n];if(this.options.extensions?.renderers?.[o.type]){const t=this.options.extensions.renderers[o.type].call({parser:this},o);if(!1!==t||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){r+=t||"";continue}}const i=o;switch(i.type){case"escape":case"text":r+=e.text(i);break;case"html":r+=e.html(i);break;case"link":r+=e.link(i);break;case"image":r+=e.image(i);break;case"strong":r+=e.strong(i);break;case"em":r+=e.em(i);break;case"codespan":r+=e.codespan(i);break;case"br":r+=e.br(i);break;case"del":r+=e.del(i);break;default:{const t='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(t),"";throw new Error(t)}}}return r}}class Rr{options;block;constructor(t){this.options=t||Se}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?Nr.lex:Nr.lexInline}provideParser(){return this.block?Cr.parse:Cr.parseInline}}const Gr=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Cr;Renderer=Pr;TextRenderer=jr;Lexer=Nr;Tokenizer=Ir;Hooks=Rr;constructor(...t){this.use(...t)}walkTokens(t,e){let r=[];for(const n of t)switch(r=r.concat(e.call(this,n)),n.type){case"table":{const t=n;for(const n of t.header)r=r.concat(this.walkTokens(n.tokens,e));for(const n of t.rows)for(const t of n)r=r.concat(this.walkTokens(t.tokens,e));break}case"list":{const t=n;r=r.concat(this.walkTokens(t.items,e));break}default:{const t=n;this.defaults.extensions?.childTokens?.[t.type]?this.defaults.extensions.childTokens[t.type].forEach((n=>{const o=t[n].flat(1/0);r=r.concat(this.walkTokens(o,e))})):t.tokens&&(r=r.concat(this.walkTokens(t.tokens,e)))}}return r}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach((t=>{const r={...t};if(r.async=this.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach((t=>{if(!t.name)throw new Error("extension name required");if("renderer"in t){const r=e.renderers[t.name];e.renderers[t.name]=r?function(...e){let n=t.renderer.apply(this,e);return!1===n&&(n=r.apply(this,e)),n}:t.renderer}if("tokenizer"in t){if(!t.level||"block"!==t.level&&"inline"!==t.level)throw new Error("extension level must be 'block' or 'inline'");const r=e[t.level];r?r.unshift(t.tokenizer):e[t.level]=[t.tokenizer],t.start&&("block"===t.level?e.startBlock?e.startBlock.push(t.start):e.startBlock=[t.start]:"inline"===t.level&&(e.startInline?e.startInline.push(t.start):e.startInline=[t.start]))}"childTokens"in t&&t.childTokens&&(e.childTokens[t.name]=t.childTokens)})),r.extensions=e),t.renderer){const e=this.defaults.renderer||new Pr(this.defaults);for(const r in t.renderer){if(!(r in e))throw new Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;const n=r,o=t.renderer[n],i=e[n];e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r||""}}r.renderer=e}if(t.tokenizer){const e=this.defaults.tokenizer||new Ir(this.defaults);for(const r in t.tokenizer){if(!(r in e))throw new Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;const n=r,o=t.tokenizer[n],i=e[n];e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r}}r.tokenizer=e}if(t.hooks){const e=this.defaults.hooks||new Rr;for(const r in t.hooks){if(!(r in e))throw new Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;const n=r,o=t.hooks[n],i=e[n];Rr.passThroughHooks.has(r)?e[n]=t=>{if(this.defaults.async)return Promise.resolve(o.call(e,t)).then((t=>i.call(e,t)));const r=o.call(e,t);return i.call(e,r)}:e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r}}r.hooks=e}if(t.walkTokens){const e=this.defaults.walkTokens,n=t.walkTokens;r.walkTokens=function(t){let r=[];return r.push(n.call(this,t)),e&&(r=r.concat(e.call(this,t))),r}}this.defaults={...this.defaults,...r}})),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Nr.lex(t,e??this.defaults)}parser(t,e){return Cr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,r)=>{const n={...r},o={...this.defaults,...n},i=this.onError(!!o.silent,!!o.async);if(!0===this.defaults.async&&!1===n.async)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==e)return i(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof e)return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=t);const a=o.hooks?o.hooks.provideLexer():t?Nr.lex:Nr.lexInline,c=o.hooks?o.hooks.provideParser():t?Cr.parse:Cr.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(e):e).then((t=>a(t,o))).then((t=>o.hooks?o.hooks.processAllTokens(t):t)).then((t=>o.walkTokens?Promise.all(this.walkTokens(t,o.walkTokens)).then((()=>t)):t)).then((t=>c(t,o))).then((t=>o.hooks?o.hooks.postprocess(t):t)).catch(i);try{o.hooks&&(e=o.hooks.preprocess(e));let t=a(e,o);o.hooks&&(t=o.hooks.processAllTokens(t)),o.walkTokens&&this.walkTokens(t,o.walkTokens);let r=c(t,o);return o.hooks&&(r=o.hooks.postprocess(r)),r}catch(t){return i(t)}}}onError(t,e){return r=>{if(r.message+="\nPlease report this to https://github.com/markedjs/marked.",t){const t="<p>An error occurred:</p><pre>"+kr(r.message+"",!0)+"</pre>";return e?Promise.resolve(t):t}if(e)return Promise.reject(r);throw r}}};function Fr(t,e){return Gr.parse(t,e)}Fr.options=Fr.setOptions=function(t){return Gr.setOptions(t),Fr.defaults=Gr.defaults,Ae(Fr.defaults),Fr},Fr.getDefaults=Oe,Fr.defaults=Se,Fr.use=function(...t){return Gr.use(...t),Fr.defaults=Gr.defaults,Ae(Fr.defaults),Fr},Fr.walkTokens=function(t,e){return Gr.walkTokens(t,e)},Fr.parseInline=Gr.parseInline,Fr.Parser=Cr,Fr.parser=Cr.parse,Fr.Renderer=Pr,Fr.TextRenderer=jr,Fr.Lexer=Nr,Fr.lexer=Nr.lex,Fr.Tokenizer=Ir,Fr.Hooks=Rr,Fr.parse=Fr;Fr.options,Fr.setOptions,Fr.use,Fr.walkTokens,Fr.parseInline,Cr.parse,Nr.lex;function Mr(t){return Mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mr(t)}function Dr(){Dr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Mr(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Mr(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Hr(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ur(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Hr(i,n,o,a,c,"next",t)}function c(t){Hr(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Br(t){if(!t)return"";if("string"==typeof t)return t;if(t._originalMessage&&"string"==typeof t._originalMessage)return t._originalMessage;if("string"==typeof t.message)return t.message;try{return JSON.stringify(t)}catch(t){return""}}function $r(t,e,r,n){return zr.apply(this,arguments)}function zr(){return(zr=Ur(Dr().mark((function t(r,n,o,i){var a,c,u,s,l,f,h,p,d;return Dr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e().runtime.lastError){t.next=6;break}return c=e().runtime.lastError.message,qt.translationResult.textContent=c,tt(qt.translationResult,c),Wt(qt.translationResult),t.abrupt("return");case 6:if(null==r||!r.success||null===(a=r.data)||void 0===a||!a.translatedText){t.next=19;break}u=r.data.translatedText,qt.translationResult.classList.remove("fade-in"),qt.translationResult.offsetWidth,qt.translationResult.innerHTML=Fr.parse(u),qt.translationResult.classList.add("fade-in"),tt(qt.translationResult,u),s=Qt(o),l=Qt(i),e().storage.local.set({lastTranslation:{sourceText:n,translatedText:u,sourceLanguage:s||Zt,targetLanguage:l}}).then((function(){Dt("[Translate]: Last translation saved to storage.")})).catch((function(t){Dt("[Translate]: Error saving last translation:",t)})),!r.data.detectedSourceLang||s&&s!==Zt||(f=oe(r.data.detectedSourceLang))&&(qt.sourceLanguageInput.value=f,Vt(qt.sourceLanguageInput,qt.clearSourceLanguage),Dt("[Translate]: Source language updated to detected: ".concat(f))),t.next=32;break;case 19:return t.next=21,ft("popup_string_translate_error_response");case 21:if(t.t0=t.sent,t.t0){t.next=24;break}t.t0="(⚠️ خطایی در ترجمه رخ داد.)";case 24:h=t.t0,p=Br(null==r?void 0:r.error)||h,v=void 0,(d="string"!=typeof(y=p)?null:null!==(v=wt[y])&&void 0!==v?v:null)&&(p=d),qt.translationResult.innerHTML="",qt.translationResult.textContent=p,tt(qt.translationResult,p),Dt("[Translate-Popup] API error:",p);case 32:Wt(qt.translationResult);case 33:case"end":return t.stop()}var y,v}),t)})))).apply(this,arguments)}function Xr(){return Yr.apply(this,arguments)}function Yr(){return(Yr=Ur(Dr().mark((function t(){var r,n,o,i,a,c,u,s,l,f,h;return Dr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=qt.sourceText.value.trim(),n=qt.targetLanguageInput.value.trim(),o=qt.sourceLanguageInput.value.trim(),r){t.next=7;break}return qt.sourceText.focus(),Dt("[Translate-Popup]: No text to translate."),t.abrupt("return");case 7:return tt(qt.sourceText,r),t.t0=J,t.t1=qt.translationResult,t.t2=at,t.next=13,ft("IsRTL");case 13:if(t.t3=t.sent,t.t4=(0,t.t2)(t.t3),(0,t.t0)(t.t1,t.t4),n){t.next=21;break}return Dt("[Translate-Popup]: Missing target language identifier."),qt.targetLanguageInput.focus(),Kt(qt.targetLanguageInput.parentElement,"error",500),t.abrupt("return");case 21:if((i=ne(n))&&i!==Zt){t.next=27;break}return Dt("[Translate-Popup]: Invalid target language selected:",n),qt.targetLanguageInput.focus(),Kt(qt.targetLanguageInput.parentElement,"error",500),t.abrupt("return");case 27:return(a=ne(o))&&a!==Zt||(a=null),qt.translationResult.innerHTML='\n<div class="spinner-overlay">\n  <div class="spinner-center">\n    <div class="spinner"></div>\n  </div>\n</div>\n',Wt(qt.translationResult),c=r.trim().split(/\s+/),u=d,s=["the","a","an","is","are","was","were","in","on","at","to","of","for","with","by","from"],(1===c.length&&!s.includes(c[0].toLowerCase())&&r.length<=30||c.length>1&&r.length<=30)&&(u=p),t.prev=37,t.next=40,e().runtime.sendMessage({action:"fetchTranslation",payload:{promptText:r,sourceLanguage:a,targetLanguage:i,translateMode:u}});case 40:return l=t.sent,Dt("[Translate-Popup]: Response from background:",l),t.next=44,$r(l,r,o,n);case 44:t.next=60;break;case 46:return t.prev=46,t.t5=t.catch(37),Dt("[Translate-Popup]: Error sending message to background:",t.t5),t.next=51,ft("popup_string_translate_error_trigger");case 51:if(t.t6=t.sent,t.t6){t.next=54;break}t.t6="(⚠️ خطایی در ترجمه پاپ‌آپ رخ داد.)";case 54:f=t.t6,h=Br(t.t5)||f,qt.translationResult.innerHTML="",qt.translationResult.textContent=h,tt(qt.translationResult,h),Wt(qt.translationResult);case 60:case"end":return t.stop()}}),t,null,[[37,46]])})))).apply(this,arguments)}function qr(){var t,e,r;null===(t=qt.translationForm)||void 0===t||t.addEventListener("submit",(function(t){t.preventDefault(),Dt("[Translate-Popup]: Translation form submitted via button."),Xr()})),null===(e=qt.sourceText)||void 0===e||e.addEventListener("keydown",(function(t){var e=t.ctrlKey||t.metaKey,r="Enter"===t.key,n="/"===t.key;e&&(r||n)&&(t.preventDefault(),Dt("[Translate-Popup]: Shortcut (".concat(t.ctrlKey?"Ctrl":"Cmd","+").concat(t.key,") triggered translation.")),Xr())})),null===(r=qt.sourceText)||void 0===r||r.addEventListener("input",(function(){Wt(qt.sourceText)})),Dt("[Translate-Popup]: Initialized.")}function Vr(t){return Vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vr(t)}function Wr(){Wr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Vr(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Vr(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Kr(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Zr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Qr(n.key),n)}}function Qr(t){var e=function(t,e){if("object"!=Vr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Vr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Vr(e)?e:e+""}var Jr=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=e,this.errorHandler=r},e=[{key:"extractText",value:function(t){try{var e,r,n;return t?t.isContentEditable?(null===(n=t.innerText)||void 0===n?void 0:n.trim())||"":(null===(e=t.value)||void 0===e?void 0:e.trim())||(null===(r=t.textContent)||void 0===r?void 0:r.trim())||"":""}catch(t){var o;return null===(o=this.errorHandler)||void 0===o||o.handle(t,{type:B.UI,context:"platform-strategy-extractText"}),""}}},{key:"findField",value:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=t,o=0;o<r&&n;o++){var i=n.closest(e);if(i)return i;n=n.parentElement}return document.querySelector(e)}},{key:"validateField",value:function(t){return t&&t.isConnected&&(this.isInputElement(t)||t.hasAttribute("contenteditable"))}},{key:"applyVisualFeedback",value:(n=Wr().mark((function t(e){var r,n;return Wr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:try{r=e.style.backgroundColor,e.style.transition="background-color 0.5s ease",e.style.backgroundColor="#d4f8d4",requestAnimationFrame((function(){setTimeout((function(){e.style.backgroundColor=r}),300)}))}catch(t){null===(n=this.errorHandler)||void 0===n||n.handle(t,{type:B.UI,context:"platform-strategy-animation"})}case 3:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){Kr(i,r,o,a,c,"next",t)}function c(t){Kr(i,r,o,a,c,"throw",t)}a(void 0)}))},function(t){return o.apply(this,arguments)})},{key:"applyTextDirection",value:function(t,e){try{var r=l.RTL_REGEX.test(e);"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.setAttribute("dir",r?"rtl":"ltr"):(t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left")}catch(t){var n;throw null===(n=this.errorHandler)||void 0===n?void 0:n.handle(t,{type:B.UI,code:"text-direction-error",context:"platform-strategy-TextDirection"})}}},{key:"handleFieldError",value:function(t,e){var r={FIELD_NOT_FOUND:"لطفا روی فیلد متن ".concat(e," کلیک کنید"),CLIPBOARD_ERROR:"خطای دسترسی به کلیپبورد"};if(this.notifier&&this.notifier.show(r[t],"warning"),!this.errorHandler)throw new Error(t);this.errorHandler.handle(new Error(t),{type:B.UI,context:"platform-strategy-field-error"})}}],e&&Zr(t.prototype,e),r&&Zr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o}();function tn(t){return tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tn(t)}function en(){en=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==tn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(tn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function rn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function nn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){rn(i,n,o,a,c,"next",t)}function c(t){rn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function on(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,an(n.key),n)}}function an(t){var e=function(t,e){if("object"!=tn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==tn(e)?e:e+""}function cn(t,e,r){return e=sn(e),function(t,e){if(e&&("object"==tn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,un()?Reflect.construct(e,r||[],sn(t).constructor):e.apply(t,r))}function un(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(un=function(){return!!t})()}function sn(t){return sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},sn(t)}function ln(t,e){return ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ln(t,e)}var fn=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=cn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ln(t,e)}(e,t),r=e,n=[{key:"isWhatsAppElement",value:function(t){return!!t.closest('[aria-label="Type a message"]')}},{key:"updateElement",value:(u=nn(en().mark((function t(e,r){var n;return en().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=this.findField(e,'[role="textbox"], .copyable-text.selectable-text')){t.next=6;break}return Dt("فیلد واتساپ یافت نشد"),t.abrupt("return");case 6:if(("INPUT"===n.tagName||"TEXTAREA"===n.tagName||n.hasAttribute("contenteditable"))&&n.isConnected){t.next=10;break}return Dt("فیلد واتساپ نامعتبر است"),t.abrupt("return",!1);case 10:if(this.isWhatsAppElement(e)){t.next=13;break}return t.abrupt("return",!1);case 13:if(document.body.contains(e)){t.next=16;break}return Dt("Element removed from DOM"),t.abrupt("return",!1);case 16:return t.next=18,this.safeFocus(e);case 18:return this.applyVisualFeedback(n),t.next=21,this.selectAllContent(n);case 21:return t.next=23,this.simulatePaste(n,r);case 23:return this.triggerStateUpdate(n),t.abrupt("return",!0);case 27:return t.prev=27,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.PARSE_INPUT,context:"whatsapp-strategy-updateElement"}),t.abrupt("return",!1);case 31:case"end":return t.stop()}}),t,this,[[0,27]])}))),function(t,e){return u.apply(this,arguments)})},{key:"extractText",value:function(t){try{if(!t)return"";if(t.isContentEditable)return t.innerText.trim();if(t.value)return t.value.trim();if(t.textContent)return t.textContent.trim()}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"WhatsApp-strategy-extractText-fallback"})}return""}},{key:"safeFocus",value:(c=nn(en().mark((function t(e){return en().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.focus({preventScroll:!0}),t.next=3,Gt(100);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=nn(en().mark((function t(e){var r,n;return en().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=window.getSelection(),(n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n),t.next=8,Gt(100);case 8:return t.abrupt("return",e);case 11:t.prev=11,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.PARSE_INPUT,context:"whatsapp-strategy-selectAllContent"});case 14:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=nn(en().mark((function t(e,r){var n,o,i,a;return en().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&null!=r){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n=(n=r.trim()).replace(/\n{2,}/g,"\n"),o=n.replace(/\n/g,"<br>"),(i=new DataTransfer).setData("text/plain",n),i.setData("text/html",o),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a),t.next=13,Gt(50);case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.PARSE_INPUT,context:"whatsapp-strategy-simulatePaste"});case 18:case"end":return t.stop()}}),t,this,[[2,15]])}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&on(r.prototype,n),o&&on(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,u}(Jr);function hn(t){return hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hn(t)}function pn(){pn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==hn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(hn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function dn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function yn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){dn(i,n,o,a,c,"next",t)}function c(t){dn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function vn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,gn(n.key),n)}}function gn(t){var e=function(t,e){if("object"!=hn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=hn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==hn(e)?e:e+""}function mn(t,e,r){return e=wn(e),function(t,e){if(e&&("object"==hn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,bn()?Reflect.construct(e,r||[],wn(t).constructor):e.apply(t,r))}function bn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(bn=function(){return!!t})()}function wn(t){return wn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},wn(t)}function xn(t,e){return xn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xn(t,e)}var En=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=mn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xn(t,e)}(e,t),r=e,n=[{key:"isDirectMessageInputField",value:function(t){return!(!t||!t.matches('div[role="textbox"][contenteditable="true"]'))}},{key:"updateElement",value:(l=yn(pn().mark((function t(e,r){return pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isDirectMessageInputField(e)){t.next=10;break}return t.next=4,this.clearContent(e);case 4:return t.next=6,this.pasteText(e,r);case 6:this.triggerStateUpdate(e),this.applyVisualFeedback(e),t.next=11;break;case 10:e.isContentEditable?(e.innerHTML=r,this.applyTextDirection(e,r),this.applyVisualFeedback(e)):(e.value=r,this.applyTextDirection(e,r),this.applyVisualFeedback(e));case 11:return t.abrupt("return",!0);case 14:return t.prev=14,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"instagram-strategy-updateElement"}),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t,this,[[0,14]])}))),function(t,e){return l.apply(this,arguments)})},{key:"clearContent",value:(s=yn(pn().mark((function t(e){return pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.safeFocus(e);case 5:return t.next=7,this.selectAllContent(e);case 7:return t.next=9,this.simulatePaste(e,"");case 9:return t.next=11,Gt(50);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.UI,context:"instagram-strategy-clearContent"});case 16:case"end":return t.stop()}}),t,this,[[2,13]])}))),function(t){return s.apply(this,arguments)})},{key:"pasteText",value:(u=yn(pn().mark((function t(e,r){var n,o;return pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=10,Gt(50);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.UI,context:"instagram-strategy-pasteText"});case 15:case"end":return t.stop()}}),t,this,[[2,12]])}))),function(t,e){return u.apply(this,arguments)})},{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t?null!=t&&t.isContentEditable?(null==t||null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":"INPUT"===(null==t?void 0:t.tagName)||"TEXTAREA"===(null==t?void 0:t.tagName)?(null==t||null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null==t||null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":""}catch(t){return this.errorHandler.handle(t,{type:B.UI,context:"instagram-strategy-extractText"}),""}}},{key:"safeFocus",value:(c=yn(pn().mark((function t(e){return pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.focus({preventScroll:!0}),t.next=4,Gt(100);case 4:return t.abrupt("return",e);case 7:t.prev=7,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"instagram-strategy-safeFocus"});case 10:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=yn(pn().mark((function t(e){var r,n;return pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=window.getSelection(),(n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n),t.next=8,Gt(100);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"instagram-strategy-selectAllContent"});case 13:return t.abrupt("return",e);case 14:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=yn(pn().mark((function t(e,r){var n,o;return pn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=7,Gt(50);case 7:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&vn(r.prototype,n),o&&vn(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,u,s,l}(Jr);function Ln(t){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ln(t)}function Tn(){Tn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ln(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ln(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function kn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function _n(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){kn(i,n,o,a,c,"next",t)}function c(t){kn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function On(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Sn(n.key),n)}}function Sn(t){var e=function(t,e){if("object"!=Ln(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ln(e)?e:e+""}function An(t,e,r){return e=Nn(e),function(t,e){if(e&&("object"==Ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,In()?Reflect.construct(e,r||[],Nn(t).constructor):e.apply(t,r))}function In(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(In=function(){return!!t})()}function Nn(t){return Nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nn(t)}function Pn(t,e){return Pn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pn(t,e)}var jn=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=An(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pn(t,e)}(e,t),r=e,n=[{key:"isTwitterElement",value:function(t){if(!(t&&t instanceof Element))return!1;try{return!!t.closest('[data-testid="tweetTextarea_0"], [data-testid="tweetTextarea"]')}catch(t){return!1}}},{key:"isDMElement",value:function(t){if(!(t&&t instanceof Element))return!1;try{return!!t.closest('[data-testid="dmComposerTextInput"], [role="textbox"][aria-label="Text message"]')}catch(t){return!1}}},{key:"clearTweetField",value:function(t){if(t)try{t.focus();var e=window.getSelection();if(!(e.toString().length>0)){var r=document.createRange();r.selectNodeContents(t),e.removeAllRanges(),e.addRange(r)}var n=new DataTransfer;n.setData("text/plain","");var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n});t.dispatchEvent(o)}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"twitter-strategy-clearTweetField"})}}},{key:"pasteText_OLD",value:(c=_n(Tn().mark((function t(e,r){var n,o,i,a;return Tn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,r&&"string"==typeof r){for(n=r.split("\n");n.length>0&&""===n[n.length-1].trim();)n.pop();o=n.join("\n"),(i=new DataTransfer).setData("text/plain",o),i.setData("text/html",o.replace(/\n/g,"<br>")),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a)}t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.UI,context:"twitter-strategy-pasteText"});case 10:case"end":return t.stop()}}),t,this,[[2,6]])}))),function(t,e){return c.apply(this,arguments)})},{key:"pasteText",value:(a=_n(Tn().mark((function t(e,r){var n,o,i,a,c,u;return Tn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,!r||"string"!=typeof r){t.next=22;break}return n=r.split("\n").filter((function(t){return""!==t.trim()})),o=n.join("\n"),e.focus(),t.next=9,Gt(20);case 9:(i=document.createRange()).selectNodeContents(e),i.collapse(!1),(a=window.getSelection()).removeAllRanges(),a.addRange(i),(c=new DataTransfer).setData("text/plain",o),c.setData("text/html",o.replace(/\n/g,"<br>")),u=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:c}),e.dispatchEvent(u)&&""!==e.innerText.trim()||(e.innerText=o,e.dispatchEvent(new Event("beforeinput",{bubbles:!0})),e.dispatchEvent(new Event("input",{bubbles:!0}))),this.setCursorToEnd(e);case 22:t.next=28;break;case 24:throw t.prev=24,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.UI,context:"twitter-strategy-pasteText"});case 28:case"end":return t.stop()}}),t,this,[[2,24]])}))),function(t,e){return a.apply(this,arguments)})},{key:"setCursorToEnd",value:function(t){if(t)try{var e=window.getSelection(),r=document.createRange();r.selectNodeContents(t),r.collapse(!1),e.removeAllRanges(),e.addRange(r)}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"twitter-strategy-setCursorToEnd"})}}},{key:"isInputElement",value:function(t){return!!t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName)}},{key:"updateElement",value:(i=_n(Tn().mark((function t(e,r){var n,o,i,a,c,u;return Tn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=document.querySelector('[data-testid="SearchBox_Search_Input"]'))){t.next=11;break}o=!1;try{e&&"function"==typeof e.contains&&(o=e.contains(n))}catch(t){}if(!this.validateField(n)||e!==n&&!o&&document.activeElement!==n){t.next=11;break}return this.applyVisualFeedback(n),n.value=r,n.dispatchEvent(new Event("input",{bubbles:!0})),this.applyTextDirection(n,r),t.abrupt("return",!0);case 11:if(i=!1,e&&(i=this.isDMElement(e)),a=this.isDMElement(document.activeElement),!i&&!a){t.next=31;break}if(c=null,!(c=this.findField(e||document.activeElement,'[data-testid="dmComposerTextInput"]'))){t.next=31;break}try{window.getSelection().removeAllRanges()}catch(t){Dt("[DEBUG] updateElement - Error removing selection ranges:",t)}return c.focus(),this.applyVisualFeedback(c),this.clearTweetField(c),t.next=25,Gt(50);case 25:return this.pasteText(c,r),this.applyTextDirection(c,r),t.next=29,Gt(100);case 29:return this.setCursorToEnd(c),t.abrupt("return",!0);case 31:return t.abrupt("return",!1);case 46:return this.pasteText(u,r),this.applyTextDirection(u,r),t.next=50,Gt(100);case 50:this.setCursorToEnd(u);case 51:t.next=58;break;case 53:return t.prev=53,t.t0=t.catch(0),Dt("[DEBUG] Critical error in updateElement:",t.t0),this.errorHandler.handle(t.t0,{type:B.UI,context:"twitter-strategy-updateElement"}),t.abrupt("return",!1);case 58:case"end":return t.stop()}}),t,this,[[0,53]])}))),function(t,e){return i.apply(this,arguments)})},{key:"extractText",value:function(t){var e=document.querySelector('[data-testid="SearchBox_Search_Input"]');if(e){var r=!1;if(t&&"function"==typeof t.contains&&(r=t.contains(e)),this.validateField(e)&&(t===e||document.activeElement===e||r))return e.value.trim()}var n,o=!1;if(t&&(o=this.isDMElement(t)),n=this.isDMElement(document.activeElement),o||n){var i=null;if(i=this.findField(t||document.activeElement,'[data-testid="dmComposerTextInput"]')){var a="";if("DIV"===i.tagName){var c=i.querySelector('[data-contents="true"]');a=c?Array.from(c.querySelectorAll(":scope > div")).map((function(t){return t.textContent})).join("\n").trim():i.textContent.trim()}else a=(i.value||"").trim();return a}}var u,s=null;u=this.isTwitterElement(document.activeElement);var l=!1;if(t&&(l=this.isTwitterElement(t)),!(s=u?document.activeElement:l?t:this.findField(t||document.body,'[data-testid="tweetTextarea_0"], [data-testid="tweetTextarea"]')))return"";var f="";if("DIV"===s.tagName){var h=s.querySelector('[data-contents="true"]');f=h?Array.from(h.querySelectorAll(":scope > div")).map((function(t){return t.textContent})).join("\n").trim():s.textContent.trim()}else f=(s.value||"").trim();return f}},{key:"validateField",value:function(t){try{return!!t&&t instanceof Element}catch(t){return!1}}},{key:"findField",value:function(t,e){if(!t)return null;try{return t.matches&&t.matches(e)?t:"function"==typeof t.querySelector?t.querySelector(e):document.querySelector(e)}catch(t){return null}}}],n&&On(r.prototype,n),o&&On(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c}(Jr);function Cn(t){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cn(t)}function Rn(){Rn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Cn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Cn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Gn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Fn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Gn(i,n,o,a,c,"next",t)}function c(t){Gn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Mn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Dn(n.key),n)}}function Dn(t){var e=function(t,e){if("object"!=Cn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Cn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Cn(e)?e:e+""}function Hn(t,e,r){return e=Bn(e),function(t,e){if(e&&("object"==Cn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Un()?Reflect.construct(e,r||[],Bn(t).constructor):e.apply(t,r))}function Un(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Un=function(){return!!t})()}function Bn(t){return Bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bn(t)}function $n(t,e){return $n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$n(t,e)}var zn=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Hn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$n(t,e)}(e,t),r=e,n=[{key:"isInputField",value:function(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName}},{key:"isContentEditable",value:function(t){return t.isContentEditable}},{key:"getTelegramField",value:function(t){if(t)try{if(this.isInputField(t)||this.isContentEditable(t))return t;var e=t.closest('[aria-label="Message input"]')||t.closest(".composer_rich_textarea")||t.closest(".public_DraftEditor-content");if(!e){var r=document.querySelectorAll('[contenteditable="true"]');e=1===r.length?r[0]:null}if(e&&!this.isContentEditable(e)){var n=e.querySelector('[contenteditable="true"]');n&&(e=n)}return e}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"telegram-strategy-getTelegramField"})}}},{key:"clearField",value:(s=Fn(Rn().mark((function t(e){var r,n,o,i;return Rn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}return t.abrupt("return");case 3:if(!this.isInputField(e)){t.next=7;break}e.value="",t.next=18;break;case 7:return(r=window.getSelection())&&((n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n)),t.next=11,Gt(50);case 11:return e.innerHTML="",(o=new DataTransfer).setData("text/plain",""),i=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:o}),t.next=17,Gt(50);case 17:e.dispatchEvent(i);case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"telegram-strategy-Clearfield"});case 23:case"end":return t.stop()}}),t,this,[[0,20]])}))),function(t){return s.apply(this,arguments)})},{key:"pasteText",value:function(t,e){try{if(!t)return;if(null!=e){var r=new DataTransfer;r.setData("text/plain",e);var n=e.replace(/\n/g,"<br>");r.setData("text/html",n);var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:r});t.dispatchEvent(o)}}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"telegram-strategy-pasteText"})}}},{key:"setCursorToEnd",value:function(t){try{if(!t)return;if(this.isInputField(t)){var e=t.value.length;t.setSelectionRange(e,e)}else{var r=window.getSelection(),n=document.createRange();n.selectNodeContents(t),n.collapse(!1),r.removeAllRanges(),r.addRange(n)}}catch(t){this.errorHandler.handle(t,{type:B.SERVICE,context:"telegram-strategy-setCursorToEnd"})}}},{key:"updateElement",value:(u=Fn(Rn().mark((function t(e,r){var n,o;return Rn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return",!1);case 2:if(e){t.next=4;break}return t.abrupt("return",!1);case 4:return n='[aria-label="Message input"], .composer_rich_textarea, .public_DraftEditor-content, [contenteditable="true"]',t.prev=5,t.next=8,Gt(100);case 8:if(o=this.findField(e,n)||this.getTelegramField(e)||document.querySelector(n),this.validateField(o)){t.next=12;break}return Dt("فیلد تلگرام یافت نشد"),t.abrupt("return",!1);case 12:if(e===o||o.contains(e)){t.next=14;break}return t.abrupt("return",!1);case 14:return t.next=16,this.safeFocus(o);case 16:if(this.applyVisualFeedback(document.getElementById("message-input-text")),!this.isInputField(o)){t.next=23;break}o.value=r,o.setAttribute("dir",l.RTL_REGEX.test(r)?"rtl":"ltr"),o.dispatchEvent(new Event("input",{bubbles:!0})),t.next=26;break;case 23:return t.next=25,this.clearField(o);case 25:this.pasteText(o,r);case 26:return this.setCursorToEnd(o),t.abrupt("return",!0);case 30:return t.prev=30,t.t0=t.catch(5),this.errorHandler.handle(t.t0,{type:B.SERVICE,context:"telegram-strategy-updateElement"}),t.abrupt("return",!1);case 34:case"end":return t.stop()}}),t,this,[[5,30]])}))),function(t,e){return u.apply(this,arguments)})},{key:"extractText",value:function(t){try{if(!t)return"";if(t.isContentEditable)return t.innerText.trim();if(t.value)return t.value.trim();if(t.textContent)return t.textContent.trim()}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"Telegram-strategy-extractText-fallback"})}return""}},{key:"validateField",value:function(t){var e=null==t?void 0:t.querySelector('[contenteditable="true"]');return t&&t.isConnected&&(this.isInputField(t)||this.isContentEditable(t)||e)}},{key:"safeFocus",value:(c=Fn(Rn().mark((function t(e){return Rn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.focus({preventScroll:!0}),t.next=6,Gt(100);case 6:return t.abrupt("return",e);case 9:t.prev=9,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.UI,context:"telegram-strategy-safeFocus"});case 12:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=Fn(Rn().mark((function t(e){return Rn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,document.execCommand("selectAll"),t.next=6,Gt(100);case 6:return t.abrupt("return",e);case 9:t.prev=9,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.UI,context:"telegram-strategy-SelectAllContent"});case 12:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=Fn(Rn().mark((function t(e,r){var n,o,i,a;return Rn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&null!=r){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n=(n=r.trim()).replace(/\n{2,}/g,"\n"),o=n.replace(/\n/g,"<br>"),(i=new DataTransfer).setData("text/plain",n),i.setData("text/html",o),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a),t.next=13,Gt(50);case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.UI,context:"telegram-strategy-simulatePaste"});case 18:case"end":return t.stop()}}),t,this,[[2,15]])}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&Mn(r.prototype,n),o&&Mn(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,u,s}(Jr);function Xn(t){return Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xn(t)}function Yn(){Yn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Xn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Xn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function qn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Vn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){qn(i,n,o,a,c,"next",t)}function c(t){qn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Wn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Kn(n.key),n)}}function Kn(t){var e=function(t,e){if("object"!=Xn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Xn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Xn(e)?e:e+""}function Zn(t,e,r){return e=Jn(e),function(t,e){if(e&&("object"==Xn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Qn()?Reflect.construct(e,r||[],Jn(t).constructor):e.apply(t,r))}function Qn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Qn=function(){return!!t})()}function Jn(t){return Jn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jn(t)}function to(t,e){return to=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},to(t,e)}var eo=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Zn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&to(t,e)}(e,t),r=e,n=[{key:"shouldShowDefaultIcon",value:function(){return!0}},{key:"isMediumElement",value:function(t){return!(!t.closest('[role="textbox"]')&&!t.closest('[data-testid="editor-container"]'))}},{key:"updateElement",value:(u=Vn(Yn().mark((function t(e,r){var n;return Yn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName){t.next=5;break}return e.value=r,e.dispatchEvent(new Event("input",{bubbles:!0})),this.applyVisualFeedback(e),t.abrupt("return",!0);case 5:return t.abrupt("return",!1);case 9:return this.safeFocus(n),t.prev=10,t.next=13,navigator.clipboard.writeText(r);case 13:Dt("MediumStrategy: clipboard write SUCCESS for:",r.substring(0,20)+"..."),this.notifier.show("✅ ترجمه در حافظه کپی شد. (Ctrl+V)","success",!0,3e3),this.applyVisualFeedback(n),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(10),this.errorHandler.handle(t.t0,{type:B.UI,context:"medium-strategy-updateElement"});case 21:case"end":return t.stop()}}),t,this,[[10,18]])}))),function(t,e){return u.apply(this,arguments)})},{key:"extractText",value:function(t){try{var e,r,n,o;if(!t)return"";if("INPUT"===t.tagName||"TEXTAREA"===t.tagName)return(null==t||null===(n=t.value)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"";var i=this.findMediumTextField(t);return(null==i||null===(e=i.innerText)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||""}catch(t){return this.errorHandler.handle(t,{type:B.UI,context:"medium-strategy-extractText"}),""}}},{key:"safeFocus",value:(c=Vn(Yn().mark((function t(e){return Yn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.isConnected){t.next=3;break}return t.abrupt("return",null);case 3:return e.focus({preventScroll:!0}),t.next=6,Gt(150);case 6:if(document.activeElement===e){t.next=10;break}return e.focus({preventScroll:!0}),t.next=10,Gt(100);case 10:return t.abrupt("return",e);case 13:t.prev=13,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"medium-strategy-safeFocus"});case 16:case"end":return t.stop()}}),t,this,[[0,13]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=Vn(Yn().mark((function t(e){return Yn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return document.execCommand("selectAll"),t.next=3,Gt(100);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=Vn(Yn().mark((function t(e,r){var n,o;return Yn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=7,Gt(50);case 7:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"findMediumTextField",value:function(t){for(var e=t,r=0;r<5&&e;r++){var n=e.closest('[role="textbox"][contenteditable="true"], [data-testid="editor-container"]');if(n)return n;e=e.parentElement}return document.querySelector('[role="textbox"][contenteditable="true"], [data-testid="editor-container"]')}},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&Wn(r.prototype,n),o&&Wn(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,u}(Jr),ro=function(t){try{if(null==t||!t.isConnected)return;if(t.focus(),"INPUT"===t.tagName||"TEXTAREA"===t.tagName)t.selectionStart=t.selectionEnd=t.value.length;else if(t.isContentEditable){var e=document.createRange(),r=window.getSelection();e.selectNodeContents(t),e.collapse(!1),r.removeAllRanges(),r.addRange(e)}t.scrollTop=t.scrollHeight}catch(t){throw errorHandler.handle(t,{type:B.UI,context:"helpers-setCursorToEnd"})}};function no(t){return no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},no(t)}function oo(){oo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==no(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(no(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function io(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ao(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,co(n.key),n)}}function co(t){var e=function(t,e){if("object"!=no(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=no(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==no(e)?e:e+""}function uo(t,e,r){return e=lo(e),function(t,e){if(e&&("object"==no(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,so()?Reflect.construct(e,r||[],lo(t).constructor):e.apply(t,r))}function so(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(so=function(){return!!t})()}function lo(t){return lo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lo(t)}function fo(t,e){return fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fo(t,e)}var ho=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=uo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fo(t,e)}(e,t),r=e,n=[{key:"isChatGPTElement",value:function(t){return"prompt-textarea"===t.id}},{key:"extractText",value:function(t){try{if(document.querySelector(".absolute .inset-0"))return"";var e=t;if(e&&this.isChatGPTElement(e)||(e=document.querySelector("#prompt-textarea")),!e)throw new Error("عنصر ChatGPT برای استخراج متن شناسایی نشد.");return Array.from(e.querySelectorAll("p")).map((function(t){return t.textContent.trim()})).join("\n")}catch(t){return this.errorHandler.handle(t,{type:B.UI,context:"chatgpt-strategy-extractText"}),""}}},{key:"updateElement",value:(i=oo().mark((function t(e,r){return oo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!document.querySelector(".absolute .inset-0")){t.next=4;break}return t.abrupt("return",!1);case 4:return e.innerHTML=r.replace(/\n/g,"<br>"),this.applyBaseStyling(e,r),ro(e),this.applyVisualFeedback(e),t.abrupt("return",!0);case 11:return t.prev=11,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"chatgpt-strategy-updateElement"}),t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})),a=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=i.apply(t,e);function a(t){io(o,r,n,a,c,"next",t)}function c(t){io(o,r,n,a,c,"throw",t)}a(void 0)}))},function(t,e){return a.apply(this,arguments)})},{key:"applyBaseStyling",value:function(t,e){var r=l.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}],n&&ao(r.prototype,n),o&&ao(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(Jr);function po(t){return po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},po(t)}function yo(){yo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==po(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(po(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function vo(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function go(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){vo(i,n,o,a,c,"next",t)}function c(t){vo(i,n,o,a,c,"throw",t)}a(void 0)}))}}function mo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,bo(n.key),n)}}function bo(t){var e=function(t,e){if("object"!=po(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=po(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==po(e)?e:e+""}function wo(t,e,r){return e=Eo(e),function(t,e){if(e&&("object"==po(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xo()?Reflect.construct(e,r||[],Eo(t).constructor):e.apply(t,r))}function xo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xo=function(){return!!t})()}function Eo(t){return Eo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Eo(t)}function Lo(t,e){return Lo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lo(t,e)}var To=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=wo(this,e,[t,r])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lo(t,e)}(e,t),r=e,n=[{key:"isYoutube_ExtraField",value:function(t){return!(!t||"INPUT"!==t.tagName||"search_query"!==t.getAttribute("name")&&"end"!==t.getAttribute("id"))}},{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t?null!=t&&t.isContentEditable?(null==t||null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":null==t||!t.tagName||"TEXTAREA"!==t.tagName&&"INPUT"!==t.tagName?(null==t||null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":(null==t||null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":""}catch(t){return this.errorHandler.handle(t,{type:B.UI,context:"youtube-strategy-extractText"}),""}try{var c,u,s,l;return t&&t.isConnected?t.isContentEditable?(null===(s=t.innerText)||void 0===s||null===(l=s.trim)||void 0===l?void 0:l.call(s))||"":t.value||(null===(c=t.textContent)||void 0===c||null===(u=c.trim)||void 0===u?void 0:u.call(c))||"":""}catch(e){return this.errorHandler.handle(e,{type:B.UI,context:"youtube-strategy-extractText",element:null==t?void 0:t.tagName}),""}}},{key:"updateElement",value:(a=go(yo().mark((function t(e,r){var n;return yo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.isConnected){t.next=4;break}return Dt("عنصر معتبر برای به‌روزرسانی وجود ندارد"),t.abrupt("return",!1);case 4:return null!=r&&(e.isContentEditable?(n=r.replace(/\n/g,"<br>"),e.innerHTML=n,this.applyVisualFeedback(e),this.applyTextDirection(e,n)):(e.value=r,this.applyVisualFeedback(e),this.applyTextDirection(e,r))),t.abrupt("return",!0);case 8:return t.prev=8,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"youtube-strategy-updateElement",element:null==e?void 0:e.tagName}),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(t,e){return a.apply(this,arguments)})},{key:"clearContent",value:(i=go(yo().mark((function t(e){return yo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.isConnected){t.next=3;break}return t.abrupt("return");case 3:"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value="":e.innerHTML="",this.applyVisualFeedback(e),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"youtube-strategy-clearContent",element:null==e?void 0:e.tagName});case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return i.apply(this,arguments)})}],n&&mo(r.prototype,n),o&&mo(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(Jr);function ko(t){return ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ko(t)}function _o(){_o=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==ko(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ko(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Oo(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function So(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ao(n.key),n)}}function Ao(t){var e=function(t,e){if("object"!=ko(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=ko(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ko(e)?e:e+""}function Io(t,e,r){return e=Po(e),function(t,e){if(e&&("object"==ko(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,No()?Reflect.construct(e,r||[],Po(t).constructor):e.apply(t,r))}function No(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(No=function(){return!!t})()}function Po(t){return Po=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Po(t)}function jo(t,e){return jo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},jo(t,e)}var Co=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Io(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jo(t,e)}(e,t),r=e,n=[{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t&&t instanceof Element?t.isContentEditable?(null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":["TEXTAREA","INPUT"].includes(t.tagName)?(null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":""}catch(t){return this.errorHandler.handle(t,{type:B.UI,context:"default-strategy-extractText"}),""}}},{key:"updateElement",value:(i=_o().mark((function t(e,r){var n;return _o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,null==r){t.next=4;break}return e.isContentEditable?(n=r.replace(/\n/g,"<br>"),e.innerHTML=n,this.applyVisualFeedback(e),this.applyTextDirection(e,n)):(e.value=r,this.applyVisualFeedback(e),this.applyTextDirection(e,r)),t.abrupt("return",!0);case 4:t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"default-strategy-updateElement"}),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this,[[0,6]])})),a=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=i.apply(t,e);function a(t){Oo(o,r,n,a,c,"next",t)}function c(t){Oo(o,r,n,a,c,"throw",t)}a(void 0)}))},function(t,e){return a.apply(this,arguments)})},{key:"clearContent",value:function(t){if(t)try{"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value="":t.innerHTML=""}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"default-strategy-clearContent"})}}}],n&&So(r.prototype,n),o&&So(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(Jr);function Ro(t){return Ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ro(t)}function Go(){Go=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ro(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ro(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Fo(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Mo(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Fo(i,n,o,a,c,"next",t)}function c(t){Fo(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Do(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ho(n.key),n)}}function Ho(t){var e=function(t,e){if("object"!=Ro(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ro(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ro(e)?e:e+""}function Uo(t,e,r){return e=$o(e),function(t,e){if(e&&("object"==Ro(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Bo()?Reflect.construct(e,r||[],$o(t).constructor):e.apply(t,r))}function Bo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Bo=function(){return!!t})()}function $o(t){return $o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$o(t)}function zo(t,e){return zo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},zo(t,e)}var Xo=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Uo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zo(t,e)}(e,t),r=e,n=[{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t&&t instanceof HTMLElement?t.isContentEditable?(null===(i=t.innerText)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null===(e=t.value)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||(null===(n=t.textContent)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":""}catch(t){return this.errorHandler.handle(t,{type:B.UI,context:"discord-strategy-extractText"}),""}}},{key:"updateElement",value:(a=Mo(Go().mark((function t(e,r){return Go().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!document.querySelector(".keyboardShortcutsModal_f061f6")){t.next=4;break}return t.abrupt("return",!1);case 4:if(null==r){t.next=25;break}if(!e.isContentEditable){t.next=16;break}return e.focus(),e.value=r,this.applyVisualFeedback(e),this.clearField(e),t.next=12,Gt(200);case 12:this.pasteText(e,r),this.applyTextDirection(e,r),t.next=24;break;case 16:return e.focus(),e.value=r,this.applyVisualFeedback(e),this.clearField(e),t.next=22,Gt(200);case 22:this.pasteText(e,r),this.applyTextDirection(e,r);case 24:return t.abrupt("return",!0);case 25:t.next=31;break;case 27:return t.prev=27,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.UI,context:"Discord-strategy-updateElement"}),t.abrupt("return",!1);case 31:case"end":return t.stop()}}),t,this,[[0,27]])}))),function(t,e){return a.apply(this,arguments)})},{key:"clearField",value:function(t){if(t)try{t.focus();var e=window.getSelection();if(!(e.toString().length>0)){var r=document.createRange();r.selectNodeContents(t),e.removeAllRanges(),e.addRange(r)}var n=new DataTransfer;n.setData("text/plain","");var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n});t.dispatchEvent(o)}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"Discord-strategy-clearField"})}}},{key:"pasteText",value:(i=Mo(Go().mark((function t(e,r){var n,o,i,a,c,u,s=this;return Go().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&r&&"string"==typeof r){t.next=2;break}return t.abrupt("return");case 2:for(t.prev=2,n=r.split("\n");n.length>0&&""===n[n.length-1].trim();)n.pop();if(o=n.join("\n"),!navigator.clipboard||!navigator.clipboard.writeText){t.next=18;break}return i=window.getSelection(),a=i.getRangeAt(0).cloneRange(),t.next=11,navigator.clipboard.writeText(o);case 11:if(e.focus(),i.removeAllRanges(),i.addRange(a),!document.execCommand("paste")){t.next=16;break}return t.abrupt("return");case 16:return this.simulateInputInsertion(e,o),t.abrupt("return");case 18:(c=new DataTransfer).setData("text/plain",o),c.setData("text/html",o.replace(/\n/g,"<br>")),u=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:c}),e.focus(),e.dispatchEvent(u),setTimeout((function(){s.simulateInputInsertion(e,o)}),100),t.next=31;break;case 27:throw t.prev=27,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:B.UI,context:"Discord-strategy-pasteText"});case 31:case"end":return t.stop()}}),t,this,[[2,27]])}))),function(t,e){return i.apply(this,arguments)})},{key:"simulateInputInsertion",value:function(t,e){try{if(document.execCommand("insertText",!1,e))return}catch(t){}if("INPUT"===t.tagName||"TEXTAREA"===t.tagName){var r=t.selectionStart||0,n=t.selectionEnd||0,o=t.value.substring(0,r),i=t.value.substring(n);return t.value=o+e+i,t.selectionStart=t.selectionEnd=r+e.length,void t.dispatchEvent(new Event("input",{bubbles:!0}))}if(t.isContentEditable){var a=window.getSelection(),c=a.getRangeAt(0);c.deleteContents();var u=document.createTextNode(e);c.insertNode(u),c.setStartAfter(u),c.setEndAfter(u),a.removeAllRanges(),a.addRange(c),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0}))}}}],n&&Do(r.prototype,n),o&&Do(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(Jr);function Yo(t){return Yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yo(t)}function qo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Vo(n.key),n)}}function Vo(t){var e=function(t,e){if("object"!=Yo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Yo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Yo(e)?e:e+""}var Wo=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errorHandler=e},(r=[{key:"cleanup",value:function(){y.highlightedElement&&(y.highlightedElement.style.outline="",y.highlightedElement=null),document.querySelectorAll(".AIWritingCompanion-translation-icon-extension").forEach((function(t){t.classList.add("fade-out"),setTimeout((function(){return t.remove()}),50)})),y.activeTranslateIcon=null}},{key:"applyTextDirection",value:function(t,e){if(null!=t&&t.style){var r=l.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}},{key:"createTranslateIcon",value:function(t){try{if(null==t||!t.isConnected)return null;n="styles/icon.css",(o=document.createElement("link")).rel="stylesheet",o.type="text/css",o.href=e().runtime.getURL(n),document.head.appendChild(o);var r=document.createElement("button");return r.className="AIWritingCompanion-translation-icon-extension",r.textContent=l.ICON_TRANSLATION,r.title=l.TRANSLATION_ICON_TITLE,r.style.display="none",document.body.appendChild(r),requestAnimationFrame((function(){if(t.isConnected){var e=t.getBoundingClientRect();r.style.top="".concat(e.top+window.scrollY+10,"px"),r.style.left="".concat(e.left+window.scrollX+e.width+10,"px"),r.style.display="block",r.classList.add("AIWritingCompanion-translation-icon-extension-fade-in")}})),r}catch(t){return this.errorHandler.handle(t,{type:B.UI,context:"IconManager-createTranslateIcon"}),null}var n,o}}])&&qo(t.prototype,r),n&&qo(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n}();var Ko="default",Zo="whatsapp",Qo="telegram",Jo="instagram",ti="twitter",ei="medium",ri="chatgpt",ni="youtube",oi="discrod";function ii(){var t=window.location.hostname.toLowerCase();return{"web.whatsapp.com":Zo,"web.telegram.org":Qo,"www.instagram.com":Jo,"twitter.com":ti,"x.com":ti,"medium.com":ei,"chat.openai.com":ri,"chat.com":ri,"chatgpt.com":ri,"www.youtube.com":ni,"discord.com":oi}[t]||Ko}function ai(t){return ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ai(t)}function ci(){ci=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==ai(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ai(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ui(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var si=new Map;function li(t){var e=[],r=new Map;return Array.from(t.keys()).forEach((function(t){si.has(t)?r.set(t,si.get(t)):e.push(t)})),{textsToTranslate:e,cachedTranslations:r}}function fi(t){for(var e,r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),n=[],o=new Map;e=r.nextNode();){var i=e.textContent.trim();n.push(e),i&&(o.has(i)?o.get(i).push(e):o.set(i,[e]))}return{textNodes:n,originalTextsMap:o}}function hi(t,e,r){t.forEach((function(t){if(t.parentNode&&t.nodeType===Node.TEXT_NODE){var n=t.textContent,o=n.trim(),i=e.get(o);if(i&&o){var a=t.parentNode;!function(t){t.dataset.aiwcOriginalDirection||(t.dataset.aiwcOriginalDirection=t.style.direction||"");t.dataset.aiwcOriginalTextAlign||(t.dataset.aiwcOriginalTextAlign=t.style.textAlign||"")}(a);var c=document.createElement("span"),u="aiwc-".concat(Math.random().toString(36).substring(2,15));c.setAttribute("data-aiwc-original-id",u),c.setAttribute("data-aiwc-original-text",n);var s=n.split("\n"),l=i.split("\n");s.forEach((function(t,e){var n=void 0!==l[e]?l[e]:"",o=document.createElement("span");if(o.textContent=n,r.state.originalTexts.set(u,{originalText:t,wrapperElement:o}),c.appendChild(o),e<s.length-1){var i=document.createElement("br");i.setAttribute("data-aiwc-br","true"),c.appendChild(i)}})),function(t,e){if(t&&t.style){var r=Q(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}(a,!0),tt(a,l);try{a.replaceChild(c,t)}catch(e){Dt("AIWC Error replacing text node with container:",e,{textNode:t,containerSpan:c,parentElement:a}),r.state.originalTexts.delete(u),e=jt.processError(e),r.errorHandler.handle(e,{type:B.PARSE_SELECT_ELEMENT,context:"textExtraction-apply-translations-replace",elementId:"multiple"})}}}}))}function pi(){var t;return t=ci().mark((function t(e){var r,n;return ci().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=0,document.querySelectorAll("span[data-aiwc-original-text]").forEach((function(t){var r=t.getAttribute("data-aiwc-original-text");if(null!==r)try{var o=t.parentNode;gi(o);var i=document.createTextNode(r);o.replaceChild(i,t),n++;for(var a=i.nextSibling;a&&"BR"===a.nodeName&&"true"===a.getAttribute("data-aiwc-br");){var c=a;a=a.nextSibling,c.parentNode.removeChild(c)}}catch(r){e.errorHandler.handle(r,{type:B.PARSE_SELECT_ELEMENT,context:"revert-translations-replace",elementId:t.getAttribute("data-aiwc-original-id")}),Dt("Failed to revert container with original text.",r)}})),!(n>0)){t.next=16;break}return t.t0=e.notifier,t.t1="".concat(n," "),t.next=8,ft("STATUS_Revert_Number");case 8:if(t.t2=t.sent,t.t2){t.next=11;break}t.t2="(مورد بازگردانی شد)";case 11:t.t3=t.t2,t.t4=t.t1.concat.call(t.t1,t.t3),t.t0.show.call(t.t0,t.t4,"revert"),t.next=27;break;case 16:return t.next=18,w();case 18:if(!t.sent){t.next=27;break}return t.t5=e.notifier,t.next=22,ft("STATUS_REVERT_NOT_FOUND");case 22:if(t.t6=t.sent,t.t6){t.next=25;break}t.t6="(هیچ متنی برای بازگردانی یافت نشد)";case 25:t.t7=t.t6,t.t5.show.call(t.t5,t.t7,"warning");case 27:return null===(r=e.IconManager)||void 0===r||r.cleanup(),e.state.originalTexts.clear(),t.abrupt("return",n);case 30:case"end":return t.stop()}}),t)})),pi=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ui(i,n,o,a,c,"next",t)}function c(t){ui(i,n,o,a,c,"throw",t)}a(void 0)}))},pi.apply(this,arguments)}function di(t,e){var r=t.trim().match(/(\[(?:[^]|\n|\r)*\]|\{(?:[^]|\n|\r)*\})/);if(!r||!r[1]){Dt("No JSON structure (array or object) found in the response string.");var n=new Error("هیچ ساختار JSON معتبری در پاسخ یافت نشد.");return e.errorHandler.handle(n,{type:B.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-NoJsonFound"}),[]}var o=r[1].trim();try{return JSON.parse(o)}catch(t){if(Dt("Initial JSON.parse failed. Attempting repair by removing the last element.",t.message),!(o.startsWith("[")&&t instanceof SyntaxError)){Dt("Initial parse failed, and repair condition not met (not array or not SyntaxError).");var i=jt.processError(t);return e.errorHandler.handle(i,{type:B.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-InitialErrorNotRepaired"}),Dt("Original problematic string:",o),[]}var a=o.lastIndexOf(",",o.length-2);if(-1===a){Dt("Could not repair JSON: No comma found to separate the last element.");var c=jt.processError(t);return e.errorHandler.handle(c,{type:B.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-NoCommaForRepair"}),Dt("Original problematic string:",o),[]}var u=o.substring(0,a);u=u.trimEnd()+"]",Dt("Attempting to parse repaired JSON string:",u);try{var s=JSON.parse(u);return Dt("Successfully parsed JSON after removing the potentially corrupted last element.","warning"),s}catch(r){Dt("Repair attempt also failed.",r.message);var l=jt.processError(t);return e.errorHandler.handle(l,{type:B.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-RepairFailed"}),Dt("Original problematic string:",o),[]}}}function yi(t){var e=[],r=[],n=new Map;return t.forEach((function(t,o){var i=t.split("\n"),a=[];i.forEach((function(t,n){e.push(t),r.push({originalIndex:o,segmentIndex:n}),a.push(e.length-1)})),n.set(o,a)})),{expandedTexts:e,originMapping:r,originalToExpandedIndices:n}}function vi(t,e){return Array.isArray(t)?t.length===e.length||(Dt("عدم تطابق طول.","طول مورد انتظار (بر اساس متن‌های گسترش‌یافته): ".concat(e.length),"طول دریافت شده: ".concat(t.length),"علت احتمالی: تقسیم/ادغام متفاوت متن توسط API یا افزودن/حذف آیتم‌ها.","تلاش برای پردازش با داده‌های موجود ادامه می‌یابد..."),Math.abs(t.length-e.length)<3/7*e.length):(Dt("پاسخ ترجمه یک آرایه نیست.","داده پارس شده:",t),!1)}function gi(t){void 0!==t.dataset.aiwcOriginalDirection&&(t.style.direction=t.dataset.aiwcOriginalDirection,delete t.dataset.aiwcOriginalDirection),void 0!==t.dataset.aiwcOriginalTextAlign&&(t.style.textAlign=t.dataset.aiwcOriginalTextAlign,delete t.dataset.aiwcOriginalTextAlign)}function mi(t,e,r,n,o){for(var i=new Map,a=new Map,c=Math.min(e.length,t.length),u=0;u<c;u++){var s=t[u],l=r[u];if(s&&"string"==typeof s.text&&l){var f=l.originalIndex;a.has(f)||a.set(f,[]),a.get(f).push(s.text)}else if(Dt("داده ترجمه نامعتبر یا گمشده برای آیتم در اندیس ".concat(u,"."),"آیتم دریافتی:",s,"اطلاعات نگاشت:",l),l){var h=l.originalIndex;a.has(h)||a.set(h,[]),a.get(h).push(e[u])}}return n.forEach((function(t,e){if(a.has(e)){var r=a.get(e).join("\n");i.set(t,r),si.set(t,r)}else o.has(t)||i.set(t,t)})),i}function bi(t){return bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bi(t)}function wi(){wi=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==bi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(bi(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function xi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ei(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?xi(Object(r),!0).forEach((function(e){Li(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Li(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=bi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=bi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==bi(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ti(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ki(){if(!document.getElementById("__AI_WRITING_BRIDGE")){var t=document.createElement("script");t.src=e().runtime.getURL("./pageBridge.js"),t.id="__AI_WRITING_BRIDGE",(document.head||document.documentElement).appendChild(t)}}function _i(t){return Oi.apply(this,arguments)}function Oi(){var t;return t=wi().mark((function t(r){var n,o,i,a=arguments;return wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"Popup_Translate",t.prev=1,t.next=4,e().runtime.sendMessage({action:"fetchTranslation",payload:{promptText:r,translationMode:n}});case 4:return o=t.sent,t.abrupt("return",Ei(Ei({},o),{},{viaBridge:!1}));case 8:return t.prev=8,t.t0=t.catch(1),Dt("[BridgeIntegration] Normal translate failed. Falling back to bridge."),t.next=13,Si(r,n);case 13:return i=t.sent,t.abrupt("return",i);case 15:case"end":return t.stop()}}),t,null,[[1,8]])})),Oi=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ti(i,n,o,a,c,"next",t)}function c(t){Ti(i,n,o,a,c,"throw",t)}a(void 0)}))},Oi.apply(this,arguments)}function Si(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Popup_Translate";return new Promise((function(r,n){var o="".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),i=function(t){var e,a;t.source===window&&"AI_WRITING_TRANSLATE_RESPONSE"===(null===(e=t.data)||void 0===e?void 0:e.type)&&(null===(a=t.data)||void 0===a||null===(a=a.original)||void 0===a?void 0:a.__requestId)===o&&(window.removeEventListener("message",i),t.data.error?n(new Error(t.data.error)):r(Ei(Ei({},t.data.result),{},{viaBridge:!0})))};window.addEventListener("message",i),window.postMessage({type:"AI_WRITING_TRANSLATE_REQUEST",text:t,translateMode:e,__requestId:o},"*")}))}function Ai(t){return Ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ai(t)}function Ii(){Ii=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ai(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ai(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ni(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Pi(t){return ji.apply(this,arguments)}function ji(){var t;return t=Ii().mark((function t(r){var n,o,i,a,c,u,s,l,p,d,y,v,g,m,b,w,x,E,L,T,k,_,O,S,A;return Ii().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.text,a=r.translationHandler,c=r.target,u=r.selectionRange,s=void 0===u?null:u,i&&a){t.next=3;break}return t.abrupt("return");case 3:return l=s?h:f,p=null!==(n=null===(o=a.detectPlatform)||void 0===o?void 0:o.call(a,c))&&void 0!==n?n:ii(),t.prev=5,ki(),t.next=9,_i(i,l);case 9:if(!1!==(null==(E=t.sent)?void 0:E.success)){t.next=16;break}return(L=new Error(E.error||B.API)).type=B.API,t.next=15,a.errorHandler.handle(L,{type:B.API,context:"smartTranslate-response-handler",statusCode:E.statusCode||400,isPrimary:!0});case 15:return t.abrupt("return");case 16:if(T=(null!==(d=null!==(y=null!==(v=null!==(g=null===(m=E.data)||void 0===m?void 0:m.translatedText)&&void 0!==g?g:E.translatedText)&&void 0!==v?v:null===(b=E.result)||void 0===b||null===(b=b.data)||void 0===b?void 0:b.translatedText)&&void 0!==y?y:null===(w=E.result)||void 0===w?void 0:w.translatedText)&&void 0!==d?d:"").trim()){t.next=23;break}return(k=new Error(B.TRANSLATION_NOT_FOUND)).type=B.API,t.next=22,a.errorHandler.handle(k,{type:B.API,context:"smartTranslate-handler-main",isPrimary:!0});case 22:return t.abrupt("return");case 23:if(_=null!=c&&c.isContentEditable?c.innerText.trim():c&&"value"in c?c.value.trim():null,Dt("[SmartTranslateHandler] Initial value:",_),O=!1,!s||null===(x=a.strategies[p])||void 0===x||!x.updateElement){t.next=32;break}return t.next=29,a.strategies[p].updateElement(s,T);case 29:O=t.sent,t.next=36;break;case 32:if(!c){t.next=36;break}return t.next=35,a.updateTargetElement(c,T);case 35:O=t.sent;case 36:if(Dt("[SmartTranslateHandler] updateElement result:",O),!O){t.next=40;break}return Dt("[SmartTranslateHandler] Strategy applied successfully"),t.abrupt("return");case 40:if((null!=c&&c.isContentEditable?c.innerText.trim():c&&"value"in c?c.value.trim():null)!==T){t.next=44;break}return Dt("[SmartTranslateHandler] DOM already updated"),t.abrupt("return");case 44:return Dt("[SmartTranslateHandler] ❗ Fallback to manual apply"),t.next=47,e().runtime.sendMessage({action:"applyTranslationToActiveElement",payload:{translatedText:T}});case 47:if(!0===(S=t.sent)||S&&!0===S.success){t.next=53;break}throw(A=new Error((null==S?void 0:S.error)||B.API_SERVICE)).type=B.API,A;case 53:return Dt("[SmartTranslateHandler] Fallback applied successfully"),t.prev=54,t.next=57,navigator.clipboard.writeText(T);case 57:return t.t0=a.notifier,t.next=60,ft("STATUS_SMARTTRANSLATE_COPIED");case 60:if(t.t1=t.sent,t.t1){t.next=63;break}t.t1="ترجمه در حافظه کپی شد. (Ctrl+V)";case 63:t.t2=t.t1,t.t0.show.call(t.t0,t.t2,"success",!0,3e3),t.next=71;break;case 67:return t.prev=67,t.t3=t.catch(54),t.next=71,a.errorHandler.handle(t.t3,{type:B.UI,context:"smartTranslation-clipboard"});case 71:t.next=77;break;case 73:return t.prev=73,t.t4=t.catch(5),t.next=77,a.errorHandler.handle(t.t4,{type:t.t4.type||B.API,context:"smartTranslate-handler-main-second"});case 77:case"end":return t.stop()}}),t,null,[[5,73],[54,67]])})),ji=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ni(i,n,o,a,c,"next",t)}function c(t){Ni(i,n,o,a,c,"throw",t)}a(void 0)}))},ji.apply(this,arguments)}function Ci(t){return Ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ci(t)}function Ri(){Ri=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ci(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ci(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Gi(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Fi(t,e,r,n,o){if(t&&e){var i,a=!1,c=new Set,u=function(){var r;a||(a=!0,c.forEach((function(t){return cancelAnimationFrame(t)})),null===(r=i)||void 0===r||r.disconnect(),t.removeEventListener("click",s),t.removeEventListener("blur",l),e.removeEventListener("blur",l),t.classList.add("fade-out"),setTimeout((function(){return t.remove()}),50),y.activeTranslateIcon=null)},s=function(){var t,i=(t=Ri().mark((function t(i){var a,c,s,l;return Ri().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.preventDefault(),i.stopPropagation(),Ut()){t.next=7;break}throw(a=new Error(B.CONTEXT)).type=B.CONTEXT,a.context="iconbehavior-click-context",a;case 7:if(c=null,t.prev=8,s=ii(),l=o[s].extractText(e)){t.next=13;break}return t.abrupt("return");case 13:return t.t0=n,t.next=16,ft("STATUS_TRANSLATING_ICON");case 16:if(t.t1=t.sent,t.t1){t.next=19;break}t.t1="در حال ترجمه...";case 19:return t.t2=t.t1,c=t.t0.show.call(t.t0,t.t2,"status",!1),t.next=23,Pi({text:l,target:e,translationHandler:r});case 23:t.next=28;break;case 25:t.prev=25,t.t3=t.catch(8),Dt("[IconBehavior] ",t.t3);case 28:return t.prev=28,c&&n.dismiss(c),u(),t.finish(28);case 32:case"end":return t.stop()}}),t,null,[[8,25,28,32]])})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Gi(i,n,o,a,c,"next",t)}function c(t){Gi(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return i.apply(this,arguments)}}(),l=function(e){e.relatedTarget&&t.contains(e.relatedTarget)||setTimeout(u,50)},f=function(){if(e.isConnected&&t.isConnected){var r=requestAnimationFrame((function(){var r=e.getBoundingClientRect();t.style.top="".concat(r.bottom+window.scrollY+5,"px"),t.style.left="".concat(r.left+window.scrollX,"px"),t.style.display="block",t.classList.add("fade-in")}));c.add(r)}else u()};try{t instanceof HTMLElement&&t.isConnected||Dt("[IconBehavior] آیکون معتبر نیست"),e.isConnected&&document.contains(e)||Dt("[IconBehavior] المان هدف در DOM وجود ندارد"),t.style.display="none",document.body.appendChild(t),(i=new ResizeObserver(f)).observe(e),t.addEventListener("click",s),t.addEventListener("blur",l),e.addEventListener("blur",l),f(),y.activeTranslateIcon=t}catch(t){u(),r.errorHandler.handle(t,{type:B.UI,context:"IconBehavior-setup"})}}}function Mi(t){return Mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mi(t)}function Di(){Di=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Mi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Mi(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Hi(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ui(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Hi(i,n,o,a,c,"next",t)}function c(t){Hi(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Bi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$i(n.key),n)}}function $i(t){var e=function(t,e){if("object"!=Mi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Mi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Mi(e)?e:e+""}var zi,Xi=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fadeInDuration=e.fadeInDuration||50,this.fadeOutDuration=e.fadeOutDuration||125,this.isVisible=!1,this.displayElement=null,this.innerContainer=null,this.removeMouseDownListener=null,this.translationHandler=e.translationHandler,this.notifier=e.notifier,this.originalText=null,this.isTranslationCancelled=!1,this.show=this.show.bind(this),this.cancelCurrentTranslation=this.cancelCurrentTranslation.bind(this)},r=[{key:"show",value:(i=Ui(Di().mark((function t(r,n){var o,i,a,c,u,s,l,h=this;return Di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Ut()){t.next=6;break}return(o=new Error(B.CONTEXT)).type=B.CONTEXT,t.next=5,this.translationHandler.errorHandler.handle(o,{type:B.CONTEXT,context:"SelectionWindows-show-context",statusCode:"context-invalid"});case 5:return t.abrupt("return",t.sent);case 6:if(r&&(!this.isVisible||r!==this.originalText)){t.next=8;break}return t.abrupt("return");case 8:if(this.dismiss(!1),this.originalText=r,this.isTranslationCancelled=!1,i=f,(1===(a=r.trim().split(/\s+/)).length&&!["the","a","an","is","are"].includes(a[0].toLowerCase())||a.length>1)&&r.length<=30&&(i=p),this.displayElement=document.createElement("div"),this.displayElement.classList.add("aiwc-selection-popup-host"),this.applyInitialStyles(n),this.displayElement){t.next=19;break}return t.abrupt("return");case 19:c=this.displayElement.attachShadow({mode:"open"}),(u=document.createElement("style"))&&(u.textContent="\n        .popup-container {\n          background-color: #f8f8f8;\n          color: #333;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          padding: 8px 12px;\n          font-size: 14px;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n          max-width: 300px;\n          overflow-wrap: break-word;\n        }\n        .loading-container {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n        @keyframes blink {\n          0% { opacity: 0.3; }\n          50% { opacity: 0.8; }\n          100% { opacity: 0.3; }\n        }\n        .loading-dot {\n          font-size: 1.2em;\n          margin: 0 2px;\n          animation: blink 0.7s infinite;\n        }\n        .first-line { margin-bottom: 6px; display: flex; align-items: center; }\n        .original-text { font-weight: bold; margin-left: 6px; }\n        .second-line { margin-top: 4px; }\n        .tts-icon { width: 16px; height: 16px; cursor: pointer; margin-right: 6px; }\n      ",c.appendChild(u)),this.innerContainer=document.createElement("div"),this.innerContainer.classList.add("popup-container"),c.appendChild(this.innerContainer),s=this.createLoadingDots(),this.innerContainer.appendChild(s),document.body.appendChild(this.displayElement),this.isVisible=!0,requestAnimationFrame((function(){h.displayElement.style.opacity="0.9",h.displayElement.style.transform="scale(1)"})),e().runtime.sendMessage({action:"fetchTranslationBackground",payload:{promptText:r,translationMode:i}}).then((function(t){if(!h.isTranslationCancelled&&h.originalText===r){if(null==t||!t.success)throw new Error(t.error||B.SERVICE);var e=(t.data.translatedText||"").trim();if(!e)throw new Error(B.TRANSLATION_NOT_FOUND);h.transitionToTranslatedText(e,s,r,i)}})).catch(function(){var t=Ui(Di().mark((function t(e){return Di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.handleTranslationError(e,s);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),Ut()&&(l=function(t){h.displayElement.contains(t.target)||h.cancelCurrentTranslation()},document.addEventListener("mousedown",l),this.removeMouseDownListener=l);case 32:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"cancelCurrentTranslation",value:function(){this.dismiss(),this.isTranslationCancelled=!0,this.originalText=null,this.translatedText=null,this.stoptts_playing()}},{key:"stoptts_playing",value:function(){Ut()&&e().runtime.sendMessage({action:"stopTTS"})}},{key:"applyInitialStyles",value:function(t){Object.assign(this.displayElement.style,{position:"absolute",zIndex:"2147483637",left:"".concat(t.x,"px"),top:"".concat(t.y,"px"),transform:"scale(0.1)",transformOrigin:"top left",opacity:"0.6",transition:"transform 0.1s ease-out, opacity ".concat(this.fadeInDuration,"ms ease-in-out")})}},{key:"createLoadingDots",value:function(){var t=document.createElement("div");return t.classList.add("loading-container"),[0,1,2].forEach((function(){var e=document.createElement("span");e.classList.add("loading-dot"),e.textContent=".",t.appendChild(e)})),t}},{key:"transitionToTranslatedText",value:function(t,e,r,n){var o=this;e.remove(),this.innerContainer.innerHTML="";var i=document.createElement("div");i.classList.add("first-line");var a=this.createTTSIcon(r);if(i.appendChild(a),n===p){var c=document.createElement("span");c.classList.add("original-text"),c.textContent=r,i.appendChild(c)}this.innerContainer.appendChild(i);var u=document.createElement("div");u.classList.add("second-line");var s=document.createElement("span");s.classList.add("text-content"),s.innerHTML=Fr.parse(t),u.appendChild(s),this.applyTextDirection(u,t),this.innerContainer.appendChild(u),requestAnimationFrame((function(){o.displayElement.style.transition="opacity 0.15s ease-in-out",o.displayElement.style.opacity="0.9"}))}},{key:"createTTSIcon",value:function(t){var r=document.createElement("img");return r.src=e().runtime.getURL("icons/speaker.png"),r.classList.add("tts-icon"),r.addEventListener("click",(function(r){r.stopPropagation(),Ut()&&e().runtime.sendMessage({action:"speak",text:t,lang:Zt})})),r}},{key:"handleTranslationError",value:(o=Ui(Di().mark((function t(e,r){var n;return Di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.remove(),n=e instanceof Error?e:new Error(String(e)),t.next=4,this.translationHandler.errorHandler.handle(n,{type:n.type||B.API,context:"selection-window-translate"});case 4:this.dismiss(!1);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"dismiss",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.displayElement&&this.isVisible&&(this.removeMouseDownListener&&(document.removeEventListener("mousedown",this.removeMouseDownListener),this.removeMouseDownListener=null),this.isVisible=!1,e&&this.fadeOutDuration>0?(this.displayElement.style.transition="opacity ".concat(this.fadeOutDuration,"ms ease-in-out"),this.displayElement.style.opacity="0",this.displayElement.addEventListener("transitionend",(function(){return t.removeElement()}),{once:!0})):this.removeElement())}},{key:"removeElement",value:function(){this.displayElement&&this.displayElement.parentNode&&this.displayElement.remove(),this.displayElement=null,this.innerContainer=null,this.isVisible=!1,this.originalText=null,this.isTranslationCancelled=!1}},{key:"applyTextDirection",value:function(t,e){if(t){var r=l.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}}],r&&Bi(t.prototype,r),n&&Bi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i}();function Yi(t){return Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yi(t)}function qi(t){return function(t){if(Array.isArray(t))return Vi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Vi(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Vi(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Wi(){Wi=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Yi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Yi(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ki(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Zi(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ki(i,n,o,a,c,"next",t)}function c(t){Ki(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Qi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ji(n.key),n)}}function Ji(t){var e=function(t,e){if("object"!=Yi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Yi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Yi(e)?e:e+""}function ta(t,e,r,n,o){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(t,e,i),null):i}var ea=(zi=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.translationHandler=e,this.featureManager=r,this.IconManager=e.IconManager,this.notifier=e.notifier,this.strategies=e.strategies,this.isProcessing=e.isProcessing,this.SelectionWindows=new Xi({translationHandler:e,notifier:e.notifier}),this.select_Element_ModeActive=e.select_Element_ModeActive,this.handleEvent=this.handleEvent.bind(this),this.handleSelect_ElementModeClick=this.handleSelect_ElementClick.bind(this),this.handleEscape=this.handleEscape.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.selectionTimeoutId=null,this.cancelSelectionTranslation=this.cancelSelectionTranslation.bind(this)},r=[{key:"setFeatureManager",value:function(t){this.featureManager=t}},{key:"handleEvent",value:(l=Zi(Wi().mark((function t(e){var r,n;return Wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isEscapeEvent(e)){t.next=4;break}return this.handleEscape(e),t.abrupt("return");case 4:if(!this.select_Element_ModeActive||"click"!==e.type){t.next=8;break}return t.next=7,this.handleSelect_ElementClick(e);case 7:case 11:case 15:return t.abrupt("return");case 8:if(!this.isCtrlSlashEvent(e)){t.next=12;break}return t.next=11,this.handleCtrlSlash(e);case 12:if(!this.isEditableTarget(e.target)||null===(r=this.featureManager)||void 0===r||!r.isOn("TEXT_FIELDS")){t.next=16;break}return t.next=15,this.handleEditableElement(e);case 16:if(!this.isMouseUp(e)){t.next=24;break}return t.next=19,_();case 19:if(!t.sent||this.isMouseUpCtrl(e)){t.next=22;break}return t.abrupt("return");case 22:return t.next=24,this.handleMouseUp(e);case 24:t.next=33;break;case 26:return t.prev=26,t.t0=t.catch(0),t.next=30,ProcessError.processError(t.t0);case 30:return n=t.sent,t.next=33,this.translationHandler.errorHandler.handle(n,{type:B.UI,context:"event-handling",eventType:e.type});case 33:case"end":return t.stop()}}),t,this,[[0,26]])}))),function(t){return l.apply(this,arguments)})},{key:"isMouseUpCtrl",value:function(t){return"mouseup"===t.type&&(t.ctrlKey||t.metaKey)}},{key:"isMouseUp",value:function(t){return"mouseup"===t.type}},{key:"isCtrlSlashEvent",value:function(t){return(t.ctrlKey||t.metaKey)&&"/"===t.key&&!t.repeat}},{key:"isEscapeEvent",value:function(t){return"Escape"===t.key&&!t.repeat}},{key:"_getSelectedTextWithDash",value:function(){var t=window.getSelection(),e="";if(t.rangeCount>1)for(var r=0;r<t.rangeCount;r++)e+=t.getRangeAt(r).toString().trim(),r<t.rangeCount-1&&(e+=" - \n");else e=t.toString().trim();return e.trim()}},{key:"_getEventPath",value:function(t){var e=t.composedPath?t.composedPath():[];if(!e||0===e.length){var r=t.target;for(e=[];r;)e.push(r),r=r.parentNode}return e}},{key:"handleMouseUp",value:(s=Zi(Wi().mark((function t(e){var r,n,o,i,a,c=this;return Wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=this._getSelectedTextWithDash(),i=this._getEventPath(e),null===(r=this.SelectionWindows)||void 0===r||!r.isVisible||!i.includes(null===(n=this.SelectionWindows)||void 0===n?void 0:n.displayElement)){t.next=4;break}return t.abrupt("return");case 4:o?this.selectionTimeoutId||(this.selectionTimeoutId=setTimeout((function(){c.selectionTimeoutId=null,c.processSelectedText(o,e)}),250),document.addEventListener("mousedown",this.cancelSelectionTranslation)):(this.selectionTimeoutId&&(clearTimeout(this.selectionTimeoutId),this.selectionTimeoutId=null,document.removeEventListener("mousedown",this.cancelSelectionTranslation)),null!==(a=this.SelectionWindows)&&void 0!==a&&a.isVisible&&this.SelectionWindows.dismiss());case 5:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"cancelSelectionTranslation",value:function(){if(this.selectionTimeoutId){clearTimeout(this.selectionTimeoutId),this.selectionTimeoutId=null;try{document.removeEventListener("mousedown",this.cancelSelectionTranslation)}catch(t){}}}},{key:"processSelectedText",value:(u=Zi(Wi().mark((function t(e,r){var n,o,i,a,c,u;return Wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=window.getSelection(),i={x:0,y:0},o.rangeCount>0&&(a=o.getRangeAt(0),c=a.getBoundingClientRect(),i={x:c.left+window.scrollX,y:c.bottom+window.scrollY+15},u=window.innerWidth,i.x<10?i.x=10:i.x+300>u-10&&(i.x=u-300-10)),null===(n=this.SelectionWindows)||void 0===n||n.show(e,i),document.removeEventListener("mousedown",this.cancelSelectionTranslation);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"isEditableTarget",value:function(t){return(null==t?void 0:t.isContentEditable)||["INPUT","TEXTAREA"].includes(null==t?void 0:t.tagName)||(null==t?void 0:t.closest)&&t.closest('[contenteditable="true"]')}},{key:"_processEditableElement",value:function(t){if(!this.IconManager||!this.featureManager.isOn("EXTENSION_ENABLED"))return null;if(!this.IconManager)return null;if(this.IconManager.cleanup(),ii()===ni){var e,r=this.strategies.youtube;if(null!=r&&null!==(e=r.isYoutube_ExtraField)&&void 0!==e&&e.call(r,t))return null}var n=this.IconManager.createTranslateIcon(t);return n?(Fi(n,t,this.translationHandler,this.notifier,this.strategies),n):null}},{key:"handleEditableFocus",value:function(t){var e;y.activeTranslateIcon||null!==(e=this.featureManager)&&void 0!==e&&e.isOn("TEXT_FIELDS")&&this._processEditableElement(t)}},{key:"handleEditableElement",value:(c=Zi(Wi().mark((function t(e){var r,n;return Wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!y.activeTranslateIcon){t.next=2;break}return t.abrupt("return");case 2:e.stopPropagation(),n=e.target,null!==(r=this.featureManager)&&void 0!==r&&r.isOn("TEXT_FIELDS")&&this._processEditableElement(n);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"handleEditableBlur",value:function(){var t=this;setTimeout((function(){var e,r;null!==(e=document.activeElement)&&void 0!==e&&e.isConnected&&(document.activeElement===y.activeTranslateIcon||document.activeElement.closest(".AIWritingCompanion-translation-icon-extension"))||null===(r=t.IconManager)||void 0===r||r.cleanup()}),100)}},{key:"cleanCache",value:(a=Zi(Wi().mark((function t(){return Wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={state:y},si.clear(),e&&e.state&&e.state.originalTexts&&e.state.originalTexts.clear(),t.t0=this.notifier,t.next=4,ft("STATUS_REMOVE_MEMORY");case 4:if(t.t1=t.sent,t.t1){t.next=7;break}t.t1="Memory Cleared";case 7:t.t2=t.t1,t.t0.show.call(t.t0,t.t2,"info",!0,2e3);case 9:case"end":return t.stop()}var e}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"handleSelect_ElementClick",value:(i=Zi(Wi().mark((function t(r){var n,o,i,a,c,u,s,l,f,p,d,v,g,m,b,w,x,E,L,T,k,_,O,S,A=this;return Wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if($t(!1),this.translationHandler.select_Element_ModeActive=!1,y.selectElementActive=!1,this.IconManager&&this.IconManager.cleanup(),n=r.target,o=fi(n),i=o.textNodes,(a=o.originalTextsMap).size){t.next=8;break}return t.abrupt("return",{status:"empty",reason:"no_text_found"});case 8:if(c=li(a),u=c.textsToTranslate,s=c.cachedTranslations,u.length||!s.size){t.next=21;break}return hi(i,s,{state:y,IconManager:this.IconManager}),t.t0=this.notifier,t.next=14,ft("STATUS_FROM_MEMORY");case 14:if(t.t1=t.sent,t.t1){t.next=17;break}t.t1="از حافظه";case 17:return t.t2=t.t1,t.t3=function(){return A.cleanCache()},t.t0.show.call(t.t0,t.t2,"info",!0,2e3,t.t3),t.abrupt("return",{status:"success",source:"cache",translatedCount:s.size});case 21:if(u.length){t.next=23;break}return t.abrupt("return",{status:"skip",reason:"no_new_texts"});case 23:return t.t4=this.notifier,t.next=26,ft("STATUS_TRANSLATING_SELECT_ELEMENT");case 26:if(t.t5=t.sent,t.t5){t.next=29;break}t.t5="در حال ترجمه…";case 29:if(t.t6=t.t5,l=t.t4.show.call(t.t4,t.t6,"status",!1),y.translateMode=h,t.prev=32,p=yi(u),d=p.expandedTexts,v=p.originMapping,!((g=JSON.stringify(d.map((function(t){return{text:t}})))).length>2e4)){t.next=39;break}return m="متن انتخابی بسیار بزرگ است (".concat(g.length," بایت)"),this.notifier.show(m,"warning",!0,3e3),t.abrupt("return",{status:"error",reason:"payload_large",message:m});case 39:return t.next=41,e().runtime.sendMessage({action:"fetchTranslationBackground",payload:{promptText:g,translationMode:h}});case 41:if(null!=(b=t.sent)&&b.success){t.next=47;break}return w=(null==b?void 0:b.error)||"(⚠️ خطایی در ترجمه رخ داد.)",t.next=46,this.translationHandler.errorHandler.handle(new Error(w),{type:B.API,statusCode:(null==b?void 0:b.statusCode)||401,context:"select-element-response"});case 46:return t.abrupt("return",{status:"error",reason:"backend_error",message:w});case 47:if(!b||!1!==b.success){t.next=52;break}return E="string"==typeof b.error?b.error:(null===(x=b.error)||void 0===x?void 0:x.message)||"(⚠️ خطایی در ترجمه رخ داد.)",t.next=51,this.translationHandler.errorHandler.handle(new Error(E),{type:B.API,context:"select-element-response"});case 51:return t.abrupt("return",{status:"error",reason:"api_error",message:E});case 52:if("string"==typeof(L=null==b||null===(f=b.data)||void 0===f?void 0:f.translatedText)&&L.trim()){t.next=57;break}return T="(⚠️ ترجمه‌ای دریافت نشد.)",this.notifier.show(T,"warning",!0,3e3),t.abrupt("return",{status:"error",reason:"empty_translation",message:T});case 57:if(k=di(L,this.translationHandler)){t.next=63;break}return t.next=62,this.translationHandler.errorHandler.handle(new Error(err),{type:B.API,context:"select-element-response-format"});case 62:return t.abrupt("return",{status:"error",reason:"api_error",message:err});case 63:return vi(k,d)||this.notifier.show("(طول پاسخ ناهمخوان؛ مجدداً امتحان کنید.)","info",!0,1500),_=mi(k,d,v,u,s),O=new Map([].concat(qi(s),qi(_))),hi(i,O,{state:y,IconManager:this.IconManager}),l&&this.notifier.dismiss(l),t.abrupt("return",{status:"success",source:"translated",translatedCount:_.size,fromCache:s.size});case 71:return t.prev=71,t.t7=t.catch(32),t.next=75,jt.processError(t.t7);case 75:return S=t.sent,t.next=78,this.translationHandler.errorHandler.handle(S,{type:S.type||B.SERVICE,context:"EventHandler-handleSelect_ElementClick"});case 78:return t.abrupt("return",{status:"error",reason:"exception",message:S.message});case 79:return t.prev=79,l&&this.notifier.dismiss(l),t.finish(79);case 82:case"end":return t.stop()}}),t,this,[[32,71,79,82]])}))),function(t){return i.apply(this,arguments)})},{key:"handleEscape",value:function(t){$t(!1),this.cancelSelectionTranslation(),this.SelectionWindows.cancelCurrentTranslation(),this.translationHandler.select_Element_ModeActive=!1,y.selectElementActive=!1,y.translateMode===h&&function(t){pi.apply(this,arguments)}({state:y,errorHandler:this.translationHandler.errorHandler,notifier:this.notifier,IconManager:this.IconManager}),this.IconManager&&this.IconManager.cleanup()}},{key:"handleCtrlSlash",value:(o=Zi(Wi().mark((function t(e){var r,n,o,i,a,c;return Wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),e.stopPropagation(),!this.isProcessing){t.next=4;break}return t.abrupt("return");case 4:if(this.isProcessing=!0,t.prev=5,(r=this.translationHandler.getSelectElementContext()).select_element,n=r.activeElement,Ht(n)){t.next=9;break}return t.abrupt("return");case 9:if(o=this.translationHandler.extractFromActiveElement(n)){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,this.translationHandler.processTranslation_with_CtrlSlash({text:o,originalText:o,target:n,selectionRange:null});case 14:t.next=25;break;case 16:return t.prev=16,t.t0=t.catch(5),t.next=20,jt.processError(t.t0);case 20:if(t.t0=t.sent,Dt("[EventHandler] Ctrl+/ Error: ",t.t0),!t.t0.isFinal){t.next=24;break}return t.abrupt("return");case 24:null!==(i=t.t0.originalError)&&void 0!==i&&i.isPrimary||(a=t.t0.type||B.API,c=t.t0.statusCode||500,this.translationHandler.errorHandler.handle(t.t0,{type:a,statusCode:c,context:"ctrl-slash",suppressSecondary:!0}));case 25:return t.prev=25,this.isProcessing=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,this,[[5,16,25,28]])}))),function(t){return o.apply(this,arguments)})}],r&&Qi(t.prototype,r),n&&Qi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i,a,c,u,s,l}(),ta(zi.prototype,"handleEvent",[Ft],Object.getOwnPropertyDescriptor(zi.prototype,"handleEvent"),zi.prototype),ta(zi.prototype,"handleMouseUp",[Ft],Object.getOwnPropertyDescriptor(zi.prototype,"handleMouseUp"),zi.prototype),ta(zi.prototype,"handleSelect_ElementClick",[Ft],Object.getOwnPropertyDescriptor(zi.prototype,"handleSelect_ElementClick"),zi.prototype),zi);function ra(t){return ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ra(t)}function na(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return oa(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?oa(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oa(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function ia(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,aa(n.key),n)}}function aa(t){var e=function(t,e){if("object"!=ra(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=ra(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ra(e)?e:e+""}var ca=function(){return t=function t(){var r,n,o,i,a,c,u=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.keyMap={EXTENSION_ENABLED:"EXTENSION_ENABLED",TRANSLATE_ON_TEXT_FIELDS:"TEXT_FIELDS",ENABLE_SHORTCUT_FOR_TEXT_FIELDS:"SHORTCUT_TEXT_FIELDS",TRANSLATE_WITH_SELECT_ELEMENT:"SELECT_ELEMENT",TRANSLATE_ON_TEXT_SELECTION:"TEXT_SELECTION",ENABLE_DICTIONARY:"DICTIONARY"},this.flags={EXTENSION_ENABLED:null===(r=s.EXTENSION_ENABLED)||void 0===r||r,TEXT_FIELDS:null!==(n=s.TEXT_FIELDS)&&void 0!==n?n:l.TRANSLATE_ON_TEXT_FIELDS,SHORTCUT_TEXT_FIELDS:null!==(o=s.SHORTCUT_TEXT_FIELDS)&&void 0!==o?o:l.ENABLE_SHORTCUT_FOR_TEXT_FIELDS,SELECT_ELEMENT:null!==(i=s.SELECT_ELEMENT)&&void 0!==i?i:l.TRANSLATE_WITH_SELECT_ELEMENT,TEXT_SELECTION:null!==(a=s.TEXT_SELECTION)&&void 0!==a?a:l.TRANSLATE_ON_TEXT_SELECTION,DICTIONARY:null!==(c=s.DICTIONARY)&&void 0!==c?c:l.ENABLE_DICTIONARY},this._subscribers={},e().storage.local.get(Object.keys(this.keyMap)).then((function(t){Object.entries(t).forEach((function(t){var e,r=na(t,2),n=r[0],o=r[1],i=u.keyMap[n];i&&void 0!==o&&(u.flags[i]=o,null===(e=u._subscribers[i])||void 0===e||e.forEach((function(t){return t()})))}))})).catch((function(t){Dt("[FeatureManager] failed to load initial flags",t)})),e().storage.onChanged.addListener(this._onStorageChanged.bind(this))},r=[{key:"isOn",value:function(t){return this.flags[t]}},{key:"on",value:function(t,e){var r,n;(null!==(n=(r=this._subscribers)[t])&&void 0!==n?n:r[t]=[]).push(e)}},{key:"_onStorageChanged",value:function(t){var e=this;Object.entries(t).forEach((function(t){var r=na(t,2),n=r[0],o=r[1].newValue,i=e.keyMap[n];if(i){var a,c=null!=o?o:e.flags[i];e.flags[i]!==c&&(e.flags[i]=c,null===(a=e._subscribers[i])||void 0===a||a.forEach((function(t){return t()})))}}))}}],r&&ia(t.prototype,r),n&&ia(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n}();function ua(t){return ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ua(t)}function sa(){sa=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==ua(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ua(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function la(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function fa(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){la(i,n,o,a,c,"next",t)}function c(t){la(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ha(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pa(n.key),n)}}function pa(t){var e=function(t,e){if("object"!=ua(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=ua(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ua(e)?e:e+""}var da,ya=function(){return t=function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.translationHandler=e,this.errorHandler=e.errorHandler;var o=function(t){return function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];try{return t.apply(n,r)}catch(t){var i;!function(t){Ct.apply(this,arguments)}(t,{type:B.UI,context:"event-router",eventType:null===(i=r[0])||void 0===i?void 0:i.type})}}};this.handleFocus=o(this.handleFocusMethod),this.handleBlur=o(this.handleBlurMethod),this.handleClick=o(this.handleClickMethod),this.handleKeyDown=o(this.handleKeyDownMethod),this.handleMouseOver=o(this.handleMouseOverMethod),this.handleMouseUp=o(this.handleMouseUpMethod),this.featureManager=r,this._attached=new Set,this.featureEventMap={TEXT_FIELDS:[{target:document,type:"focus",listener:this.handleFocus,options:!0},{target:document,type:"blur",listener:this.handleBlur,options:!0}],SHORTCUT_TEXT_FIELDS:[{target:document,type:"keydown",listener:this.handleKeyDown}],SELECT_ELEMENT:[{target:document,type:"mouseover",listener:this.handleMouseOver},{target:document,type:"click",listener:this.handleClick}],TEXT_SELECTION:[{target:document,type:"mouseup",listener:this.handleMouseUp}]},this.initEventListeners(),this.featureManager.on("EXTENSION_ENABLED",(function(){return n.initEventListeners()})),Object.keys(this.featureEventMap).forEach((function(t){n.featureManager.on(t,(function(){return n.updateListeners(t)}))}))},e=[{key:"initEventListeners",value:function(){var t=this,e=this.featureManager.isOn("EXTENSION_ENABLED");Object.keys(this.featureEventMap).forEach((function(r){e?t.updateListeners(r):t.removeListeners(r)}))}},{key:"updateListeners",value:function(t){var e=this,r=this.featureManager.isOn(t)&&this.featureManager.isOn("EXTENSION_ENABLED");this.featureEventMap[t].forEach((function(n){var o=n.target,i=n.type,a=n.listener,c=n.options,u="".concat(i,"_").concat(t);r&&!e._attached.has(u)?(o.addEventListener(i,a,c),e._attached.add(u)):!r&&e._attached.has(u)&&(o.removeEventListener(i,a,c),e._attached.delete(u))}))}},{key:"removeListeners",value:function(t){var e=this;this.featureEventMap[t].forEach((function(r){var n=r.target,o=r.type,i=r.listener,a=r.options,c="".concat(o,"_").concat(t);e._attached.has(c)&&(n.removeEventListener(o,i,a),e._attached.delete(c))}))}},{key:"handleFocusMethod",value:(s=fa(sa().mark((function t(e){return sa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.featureManager.isOn("TEXT_FIELDS")&&e.target.isContentEditable&&this.translationHandler.handleEditableFocus(e.target);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"handleBlurMethod",value:(u=fa(sa().mark((function t(e){return sa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.featureManager.isOn("TEXT_FIELDS")&&e.target.isContentEditable&&this.translationHandler.handleEditableBlur(e.target);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"handleClickMethod",value:(c=fa(sa().mark((function t(e){return sa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(y.selectElementActive){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.translationHandler.eventHandler.handleSelect_ElementClick(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"handleKeyDownMethod",value:(a=fa(sa().mark((function t(e){return sa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.translationHandler.handleEvent(e);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"handleMouseOverMethod",value:(i=fa(sa().mark((function t(e){var r,n,o,i;return sa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(y.selectElementActive){t.next=2;break}return t.abrupt("return");case 2:if(null!=(i=(null===(r=e.composedPath)||void 0===r?void 0:r.call(e)[0])||e.target)&&null!==(n=i.innerText)&&void 0!==n&&n.trim()){t.next=5;break}return t.abrupt("return");case 5:(null===(o=y.highlightedElement)||void 0===o||null===(o=o.style)||void 0===o?void 0:o.outline)&&(y.highlightedElement.style.outline=""),y.highlightedElement=i,i.style.outline=l.HIGHLIGHT_STYLE;case 8:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})},{key:"handleMouseUpMethod",value:(o=fa(sa().mark((function t(e){return sa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.translationHandler.handleEvent(e);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"dispose",value:(n=fa(sa().mark((function t(){var e=this;return sa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Object.keys(this.featureEventMap).forEach((function(t){return e.removeListeners(t)}));case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],e&&ha(t.prototype,e),r&&ha(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,u,s}();function va(t){return va="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},va(t)}function ga(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return ma(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ma(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ma(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function ba(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function wa(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ba(Object(r),!0).forEach((function(e){xa(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ba(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function xa(t,e,r){return(e=La(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ea(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,La(n.key),n)}}function La(t){var e=function(t,e){if("object"!=va(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=va(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==va(e)?e:e+""}function Ta(t,e,r,n,o){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(t,e,i),null):i}function ka(){ka=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==va(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(va(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function _a(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Oa(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){_a(i,n,o,a,c,"next",t)}function c(t){_a(i,n,o,a,c,"throw",t)}a(void 0)}))}}var Sa=(da=function(){return t=function t(){var e,r,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=new V,this.errorHandler=new jt(this.notifier),this.ErrorTypes=B,this.handleEvent=(e=this.handleEvent.bind(this),r=300,function(){for(var t=this,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];clearTimeout(n),n=setTimeout((function(){clearTimeout(n),e.apply(t,i)}),r)}),this.strategies=xa(xa(xa(xa(xa(xa(xa(xa(xa({},Zo,new fn(this.notifier,this.errorHandler)),Jo,new En(this.notifier,this.errorHandler)),ei,new eo(this.notifier,this.errorHandler)),Qo,new zn(this.notifier,this.errorHandler)),ti,new jn(this.notifier,this.errorHandler)),ri,new ho(this.notifier,this.errorHandler)),ni,new To(this.notifier,this.errorHandler)),Ko,new Co(this.notifier,this.errorHandler)),oi,new Xo(this.notifier,this.errorHandler)),this.validateStrategies(),this.IconManager=new Wo(this.errorHandler),this.displayedErrors=new Set,this.isProcessing=!1,this.select_Element_ModeActive=!1,this.featureManager=new ca({TEXT_FIELDS:l.TRANSLATE_ON_TEXT_FIELDS,SHORTCUT_TEXT_FIELDS:l.ENABLE_SHORTCUT_FOR_TEXT_FIELDS,SELECT_ELEMENT:l.TRANSLATE_WITH_SELECT_ELEMENT,TEXT_SELECTION:l.TRANSLATE_ON_TEXT_SELECTION,DICTIONARY:l.ENABLE_DICTIONARY}),this.eventHandler=new ea(this,this.featureManager),this.eventRouter=new ya(this,this.featureManager)},e=[{key:"reinitialize",value:function(){Dt("[TranslationHandler] Reinitializing state after update..."),this.isProcessing=!1,this.select_Element_ModeActive=!1}},{key:"handleEvent",value:(s=Oa(ka().mark((function t(e){return ka().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.eventHandler.handleEvent(e);case 3:t.next=10;break;case 5:return t.prev=5,t.t0=t.catch(0),t.next=9,this.errorHandler.handle(t.t0,{type:t.t0.type||B.UI,context:"handleEvent",eventType:e.type});case 9:throw t.sent;case 10:case"end":return t.stop()}}),t,this,[[0,5]])}))),function(t){return s.apply(this,arguments)})},{key:"handleError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t instanceof Error?t:new Error(String(t));this.errorHandler.handle(r,wa(wa({},e),{},{origin:"TranslationHandler"}))}},{key:"handleError_OLD",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var r=t instanceof Error?t:new Error(String(t));this.errorHandler.handle(r,wa(wa({},e),{},{origin:"TranslationHandler"}))}catch(t){throw Dt("[TranslationHandler] Error handling failed:",t),this.errorHandler.handle(t,{type:B.UI,context:"TranslationHandler-handleError"})}}},{key:"handleEditableFocus",value:function(t){this.eventHandler.handleEditableFocus(t)}},{key:"handleEditableBlur",value:function(){this.eventHandler.handleEditableBlur()}},{key:"handleEscape",value:function(t){this.eventHandler.handleEscape(t)}},{key:"handleCtrlSlash",value:(u=Oa(ka().mark((function t(e){return ka().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.eventHandler.handleCtrlSlash(e);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"handleEditableElement",value:(c=Oa(ka().mark((function t(e){return ka().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.eventHandler.handleEditableElement(e);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"processTranslation_with_CtrlSlash",value:(a=Oa(ka().mark((function t(e){var r,n,o,i;return ka().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null,t.prev=1,Ut()){t.next=6;break}if(e.target){t.next=6;break}return this.errorHandler.handle(new Error(B.CONTEXT),{type:B.CONTEXT,context:"TranslationHandler-processTranslation-context",code:"context-invalid",statusCode:"context-invalid"}),t.abrupt("return");case 6:return t.t0=this.notifier,t.next=9,ft("STATUS_TRANSLATING_CTRLSLASH");case 9:if(t.t1=t.sent,t.t1){t.next=12;break}t.t1="(translating...)";case 12:return t.t2=t.t1,r=t.t0.show.call(t.t0,t.t2,"status"),y.translateMode=e.selectionRange?h:f,t.next=17,Pi({text:e.text,translationHandler:this,target:e.target,selectionRange:e.selectionRange});case 17:t.next=33;break;case 19:return t.prev=19,t.t3=t.catch(1),t.next=23,jt.processError(t.t3);case 23:return n=t.sent,t.next=26,this.errorHandler.handle(n,{type:n.type||B.CONTEXT,context:"TranslationHandler-processTranslation",translationParams:e,isPrimary:!0});case 26:if(o=t.sent,r&&this.notifier.dismiss(r),!o.isFinal&&!o.suppressSecondary){t.next=30;break}return t.abrupt("return");case 30:throw i=new Error(o.message),Object.assign(i,{type:o.type,statusCode:o.statusCode,isFinal:!0,originalError:t.t3}),i;case 33:return t.prev=33,r&&this.notifier.dismiss(r),t.finish(33);case 36:case"end":return t.stop()}}),t,this,[[1,19,33,36]])}))),function(t){return a.apply(this,arguments)})},{key:"validateStrategies",value:(i=Oa(ka().mark((function t(){return ka().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{Object.entries(this.strategies).forEach((function(t){var e=ga(t,2),r=e[0];if("function"!=typeof e[1].extractText)throw new Error("استراتژی ".concat(r," متد extractText را پیاده‌سازی نکرده است"))}))}catch(t){this.errorHandler.handle(t,{type:B.INTEGRATION,context:"strategy-validation"})}case 1:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"handleSelect_ElementTranslation",value:(o=Oa(ka().mark((function t(e,r,n){var o;return ka().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"string"==typeof n||n){t.next=3;break}return t.abrupt("return");case 3:if(null===(o=this.strategies[e])||void 0===o||!o.updateElement){t.next=8;break}return t.next=6,this.strategies[e].updateElement(r.selectionRange,n);case 6:t.next=9;break;case 8:this.errorHandler.handle(new Error("متد updateElement برای ".concat(e," تعریف نشده")),{type:B.UI,context:"select-element-translation-updateElement",platform:e});case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.SERVICE,context:"select-element-translation",platform:e});case 14:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(t,e,r){return o.apply(this,arguments)})},{key:"updateTargetElement",value:(n=Oa(ka().mark((function t(e,r){var n,o;return ka().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"string"!=typeof r||!r){t.next=7;break}if(o=ii(),null===(n=this.strategies[o])||void 0===n||!n.updateElement||"function"!=typeof this.strategies[o].updateElement){t.next=7;break}return t.next=6,this.strategies[o].updateElement(e,r);case 6:return t.abrupt("return",t.sent);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:B.SERVICE,context:"update-target-element",platform:ii()});case 12:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(t,e){return n.apply(this,arguments)})},{key:"getSelectElementContext",value:function(){return{select_element:window.getSelection(),activeElement:document.activeElement}}},{key:"extractFromActiveElement",value:function(t){var e=ii(),r=this.strategies[e];return r&&"function"==typeof r.extractText?r.extractText(t):(this.errorHandler.handle(new Error("extractText method not implemented for this platform"),{type:B.SERVICE,context:"TranslationHandler-extractFromActiveElement-".concat(e)}),"")}},{key:"pasteContent",value:function(t,e){try{var r=ii();this.strategies[r].pasteContent(t,e)}catch(t){this.errorHandler.handle(t,{type:B.UI,context:"paste-content",platform:ii()})}}}],e&&Ea(t.prototype,e),r&&Ea(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,u,s}(),Ta(da.prototype,"reinitialize",[Ft],Object.getOwnPropertyDescriptor(da.prototype,"reinitialize"),da.prototype),Ta(da.prototype,"handleEvent",[Ft],Object.getOwnPropertyDescriptor(da.prototype,"handleEvent"),da.prototype),Ta(da.prototype,"handleError",[Ft],Object.getOwnPropertyDescriptor(da.prototype,"handleError"),da.prototype),Ta(da.prototype,"handleError_OLD",[Ft],Object.getOwnPropertyDescriptor(da.prototype,"handleError_OLD"),da.prototype),Ta(da.prototype,"processTranslation_with_CtrlSlash",[Ft],Object.getOwnPropertyDescriptor(da.prototype,"processTranslation_with_CtrlSlash"),da.prototype),Ta(da.prototype,"handleSelect_ElementTranslation",[Ft],Object.getOwnPropertyDescriptor(da.prototype,"handleSelect_ElementTranslation"),da.prototype),Ta(da.prototype,"updateTargetElement",[Ft],Object.getOwnPropertyDescriptor(da.prototype,"updateTargetElement"),da.prototype),Ta(da.prototype,"pasteContent",[Ft],Object.getOwnPropertyDescriptor(da.prototype,"pasteContent"),da.prototype),da),Aa=null,Ia=null;function Na(t){return Na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Na(t)}function Pa(){Pa=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Na(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Na(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ja(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ca(){return Ra.apply(this,arguments)}function Ra(){var t;return t=Pa().mark((function t(){var r,n,o,i,a,c,u,s=arguments;return Pa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=s.length>0&&void 0!==s[0]?s[0]:null,n=s.length>1&&void 0!==s[1]&&s[1],o=s.length>2&&void 0!==s[2]&&s[2],t.prev=3,t.next=6,e().tabs.query({active:!0,currentWindow:!0});case 6:if(0!==(i=t.sent).length){t.next=9;break}return t.abrupt("return");case 9:if(Ut()){t.next=11;break}return t.abrupt("return");case 11:return i[0].id,a=!1,t.next=15,e().storage.local.get(["selectElementState"]);case 15:if(c=t.sent,a=c.selectElementState,null===r&&(r=!a),!o&&r===a){t.next=25;break}return t.next=21,e().storage.local.set({selectElementState:r});case 21:return t.next=23,e().runtime.sendMessage({action:"activateSelectElementMode",data:r});case 23:u=t.sent,Dt("Select Mode Updated:",u);case 25:n&&window.close(),t.next=31;break;case 28:t.prev=28,t.t0=t.catch(3),Dt("Error in Active_SelectElement:",t.t0);case 31:case"end":return t.stop()}}),t,null,[[3,28]])})),Ra=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ja(i,n,o,a,c,"next",t)}function c(t){ja(i,n,o,a,c,"throw",t)}a(void 0)}))},Ra.apply(this,arguments)}function Ga(t){return Ga="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ga(t)}function Fa(){Fa=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ga(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ga(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ma(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Da(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ma(i,n,o,a,c,"next",t)}function c(t){Ma(i,n,o,a,c,"throw",t)}a(void 0)}))}}!function(){if(!Ia){var t=(Aa||(Aa=new Sa),Aa);e=t,r=t.featureManager,Ia=new ya(e,r)}var e,r}();function Ha(){var t,r,n,o,i;null===(t=qt.clearStorageBtn)||void 0===t||t.addEventListener("click",(function(){e().storage.local.remove("lastTranslation").then(Da(Fa().mark((function t(){var e;return Fa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return qt.sourceText.value="",qt.translationResult.textContent="",Wt(qt.sourceText),Wt(qt.translationResult),qt.sourceLanguageInput.value=Zt,t.prev=5,t.next=8,T();case 8:e=t.sent,qt.targetLanguageInput.value=oe(e),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),qt.targetLanguageInput.value=oe("en");case 15:return t.prev=15,Vt(qt.targetLanguageInput,qt.clearTargetLanguage),t.finish(15);case 18:Vt(qt.sourceLanguageInput,qt.clearSourceLanguage),qt.sourceText.focus(),Dt("[HeaderActions]: Translation history and fields cleared."),me();case 22:case"end":return t.stop()}}),t,null,[[5,12,15,18]])})))).catch((function(t){Dt("[HeaderActions]: Error removing last translation:",t)}))})),null===(r=qt.translatePageLink)||void 0===r||r.addEventListener("click",(function(){Dt("[HeaderActions]: Translate page icon clicked - using Google Translate tab.");var t=qt.targetLanguageInput.value,r=Qt(t);r&&r!==Zt||(Dt("[HeaderActions]: Invalid target language for page translation: '".concat(t,"'. Defaulting to 'en'.")),r="en"),e().tabs.query({active:!0,currentWindow:!0}).then((function(t){var n;if(t.length>0&&null!==(n=t[0])&&void 0!==n&&n.url){var o=t[0].url;if(!o.startsWith("http"))return Dt("[HeaderActions]: Cannot translate non-HTTP(S) URL: ".concat(o)),void window.close();var i=encodeURIComponent(o),a="https://translate.google.com/translate?sl=auto&tl=".concat(r,"&u=").concat(i);Dt("[HeaderActions]: Opening Google Translate for page: ".concat(a)),e().tabs.create({url:a}),window.close()}else Dt("[HeaderActions]: No active tab found or URL is missing."),window.close()})).catch((function(t){Dt("[HeaderActions]: Error querying active tab:",t),window.close()}))})),null===(n=qt.settingsIcon)||void 0===n||n.addEventListener("click",(function(){Dt("[Popup]: Opening options page."),Bt(),window.close()})),null===(o=qt.selectElementIcon)||void 0===o||o.addEventListener("click",(function(){Dt("[HeaderActions]: Select element icon clicked."),Ca(!0,!0)})),null===(i=qt.revertIcon)||void 0===i||i.addEventListener("click",(function(){e().runtime.sendMessage({action:"revertTranslation"}).catch((function(t){Dt("[Popup-Header] Could not send revert message:",t)})),window.close()})),Dt("[HeaderActions]: Initialized.")}function Ua(t){return Ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ua(t)}function Ba(){Ba=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ua(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ua(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function $a(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function za(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){$a(i,n,o,a,c,"next",t)}function c(t){$a(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Xa(){return Ya.apply(this,arguments)}function Ya(){return Ya=za(Ba().mark((function t(){var r,n=arguments;return Ba().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!(n.length>0&&void 0!==n[0])||n[0],t.abrupt("return",new Promise(function(){var t=za(Ba().mark((function t(n){var o,i,a;return Ba().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e().storage.local.get(["lastTranslation"]);case 3:if(o=t.sent,i="",o.lastTranslation?(Dt("[InitManager]: Loading last translation from storage."),qt.sourceText.value=o.lastTranslation.sourceText||"",tt(qt.sourceText,o.lastTranslation.sourceText),qt.translationResult.innerHTML=Fr.parse(o.lastTranslation.translatedText||""),tt(qt.translationResult,o.lastTranslation.translatedText),qt.sourceLanguageInput.value=oe(o.lastTranslation.sourceLanguage)||Zt,i=oe(o.lastTranslation.targetLanguage)):(Dt("[InitManager]: No last translation found in storage."),qt.sourceText.value="",qt.translationResult.textContent="",qt.sourceLanguageInput.value=Zt),(!r||i)&&i!==Zt){t.next=18;break}return t.prev=7,t.next=10,T();case 10:a=t.sent,i=oe(a)||oe("en"),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(7),Dt("[InitManager]: Error getting default target language:",t.t0),i=oe("en");case 18:i&&(qt.targetLanguageInput.value=i),Vt(qt.sourceLanguageInput,qt.clearSourceLanguage),Vt(qt.targetLanguageInput,qt.clearTargetLanguage),Wt(qt.sourceText),Wt(qt.translationResult),n(),t.next=30;break;case 26:t.prev=26,t.t1=t.catch(0),Dt("[InitManager]: Error loading last translation:",t.t1),n();case 30:case"end":return t.stop()}}),t,null,[[0,26],[7,14]])})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)}))),Ya.apply(this,arguments)}function qa(){return Va.apply(this,arguments)}function Va(){return Va=za(Ba().mark((function t(){return Ba().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=za(Ba().mark((function t(r){var n,o,i,a;return Ba().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e().tabs.query({active:!0,currentWindow:!0});case 3:if(!((n=t.sent).length>0&&null!=n[0].id)){t.next=40;break}return o=n[0].id,t.prev=6,a={},t.prev=8,t.next=11,e().tabs.sendMessage(o,{action:"getSelectedText"});case 11:a=t.sent,t.next=17;break;case 14:t.prev=14,t.t0=t.catch(8),Dt("[InitManager]: Failed to sendMessage to content script: ".concat(t.t0.message));case 17:if(null===(i=a)||void 0===i||!i.selectedText){t.next=28;break}Dt("[InitManager]: Received selected text from content script."),qt.sourceText.value=a.selectedText,qt.translationResult.textContent="",qt.sourceLanguageInput.value=Zt,Vt(qt.sourceLanguageInput,qt.clearSourceLanguage),Vt(qt.targetLanguageInput,qt.clearTargetLanguage),Wt(qt.sourceText),Wt(qt.translationResult),t.next=31;break;case 28:return Dt("[InitManager]: No selected text received. Loading from storage."),t.next=31,Xa();case 31:t.next=38;break;case 33:return t.prev=33,t.t1=t.catch(6),Dt("[InitManager]: Error getting selected text (Tab ".concat(o,"): ").concat(t.t1.message,". Loading from storage.")),t.next=38,Xa();case 38:t.next=43;break;case 40:return Dt("[InitManager]: No active/valid tab. Loading from storage."),t.next=43,Xa();case 43:r(),t.next=50;break;case 46:t.prev=46,t.t2=t.catch(0),Dt("[InitManager]: Error loading initial state:",t.t2),r();case 50:case"end":return t.stop()}}),t,null,[[0,46],[6,33],[8,14]])})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)}))),Va.apply(this,arguments)}function Wa(){return Ka.apply(this,arguments)}function Ka(){return(Ka=za(Ba().mark((function t(){return Ba().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,qa();case 2:Dt("[InitManager]: Initialized.");case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Za(t){return Za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Za(t)}function Qa(){Qa=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Za(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Za(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ja(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function tc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ja(i,n,o,a,c,"next",t)}function c(t){Ja(i,n,o,a,c,"throw",t)}a(void 0)}))}}var ec=!1,rc=null,nc=null,oc=null,ic=!1;function ac(){nc&&(clearTimeout(nc),nc=null)}function cc(){rc&&(clearTimeout(rc),rc=null)}function uc(){oc&&(clearTimeout(oc),oc=null)}function sc(){return lc.apply(this,arguments)}function lc(){return(lc=tc(Qa().mark((function t(){var e,r;return Qa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,E();case 2:return e=t.sent,t.next=5,k();case 5:if(r=t.sent,!e||!r){t.next=11;break}return setTimeout((function(){Ca(!0,!1,!0)}),100),t.abrupt("return",!0);case 11:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function fc(){return hc.apply(this,arguments)}function hc(){return(hc=tc(Qa().mark((function t(){return Qa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,sc();case 3:t.sent&&(e=void 0,r=void 0,n=void 0,null===(e=qt.popupContainer)||void 0===e||e.addEventListener("mouseenter",(function(){ec=!0,ac("mouseenter"),uc(),ic||(rc=setTimeout((function(){ic=!0,Ca(!1)}),1e3))})),null===(r=qt.popupContainer)||void 0===r||r.addEventListener("mouseleave",(function(){ec=!1,cc(),ic||(nc=setTimeout((function(){Ca(!0,!0)}),800))})),null===(n=qt.popupContainer)||void 0===n||n.addEventListener("mousedown",(function(){ic||(ic=!0,cc(),ac("mousedown"),uc(),Ca(!1))})),oc=setTimeout((function(){ec||ic||Ca(!0,!0)}),800));case 6:case"end":return t.stop()}var e,r,n}),t)})))).apply(this,arguments)}function pc(t){return pc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pc(t)}function dc(){dc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==pc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(pc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function yc(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function vc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){yc(i,n,o,a,c,"next",t)}function c(t){yc(i,n,o,a,c,"throw",t)}a(void 0)}))}}function gc(t){try{return new URL(t).origin}catch(e){return Dt("[excludeManager]: Invalid URL for origin extraction:",t),t}}function mc(){return bc.apply(this,arguments)}function bc(){return bc=vc(dc().mark((function t(){var r,n,o,i,a,c,u,s,l;return dc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=document.getElementById("excludeCurrentPageToggle")){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,e().tabs.query({active:!0,currentWindow:!0});case 6:n=t.sent,t.next=12;break;case 9:return t.prev=9,t.t0=t.catch(3),t.abrupt("return");case 12:o=n[0],i=gc(o.url);try{a=new URL(o.url).protocol}catch(t){a=null}if(c="http:"===a||"https:"===a,r.disabled=!c,c){t.next=25;break}return r.checked=!1,t.next=21,ft("popup_exclude_toggle_title");case 21:if(t.t1=t.sent,t.t1){t.next=24;break}t.t1="(فعال/غیرفعال در این صفحه)";case 24:r.title=t.t1;case 25:return t.next=27,e().storage.local.get("EXCLUDED_SITES");case 27:u=t.sent,s=u.EXCLUDED_SITES,l=void 0===s?[]:s,r.checked=c&&!l.includes(i),r.addEventListener("change",vc(dc().mark((function t(){var n,o,a;return dc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.disabled){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e().storage.local.get("EXCLUDED_SITES");case 4:return n=t.sent,o=n.EXCLUDED_SITES,a=(a=void 0===o?[]:o).filter((function(t){return t!==i})),r.checked||a.push(i),t.next=11,e().storage.local.set({EXCLUDED_SITES:a});case 11:Dt("[excludeManager]: ".concat(i," ").concat(r.checked?"removed from":"added to"," exclude list"));case 12:case"end":return t.stop()}}),t)}))));case 32:case"end":return t.stop()}}),t,null,[[3,9]])}))),bc.apply(this,arguments)}function wc(t){return wc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wc(t)}function xc(){xc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==wc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(wc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ec(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Lc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ec(i,n,o,a,c,"next",t)}function c(t){Ec(i,n,o,a,c,"throw",t)}a(void 0)}))}}document.addEventListener("DOMContentLoaded",Lc(xc().mark((function t(){return xc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Dt("[Popup Main]: DOMContentLoaded event fired."),t.prev=1,t.next=4,se();case 4:return t.next=6,we();case 6:return _e(),qr(),Ha(),t.next=11,Wa();case 11:return t.next=13,fc();case 13:return t.next=15,mc();case 15:try{browser.runtime.connect({name:"popup"}).postMessage({action:"popupOpened"})}catch(t){Dt("[Popup Main]: Failed to connect popup port:",t.message)}Dt("[Popup Main]: All modules initialized successfully."),t.next=24;break;case 19:t.prev=19,t.t0=t.catch(1),Dt("[Popup Main]: Error during initialization:",t.t0),Dt("Popup initialization failed:",t.t0),document.body.innerHTML='<div style="padding: 10px; color: red;">[AIWC] Failed to initialize extension popup. Please try reloading.</div>';case 24:return t.prev=24,dt(l.APPLICATION_LOCALIZE),t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[1,19,24,27]])}))))})()})();