/*! For license information please see popup.bundle.js.LICENSE.txt */
(()=>{var t={63675:function(t,e){var r,n,o;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=[t],r=function(t){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const e="The message port closed before a response was received.",r=t=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(t,e=void 0){super(e),this.createItem=t}get(t){return this.has(t)||this.set(t,this.createItem(t)),super.get(t)}}const o=t=>t&&"object"==typeof t&&"function"==typeof t.then,i=(e,r)=>(...n)=>{t.runtime.lastError?e.reject(new Error(t.runtime.lastError.message)):r.singleCallbackArg||n.length<=1&&!1!==r.singleCallbackArg?e.resolve(n[0]):e.resolve(n)},a=t=>1==t?"argument":"arguments",c=(t,e)=>function(r,...n){if(n.length<e.minArgs)throw new Error(`Expected at least ${e.minArgs} ${a(e.minArgs)} for ${t}(), got ${n.length}`);if(n.length>e.maxArgs)throw new Error(`Expected at most ${e.maxArgs} ${a(e.maxArgs)} for ${t}(), got ${n.length}`);return new Promise(((o,a)=>{if(e.fallbackToNoCallback)try{r[t](...n,i({resolve:o,reject:a},e))}catch(i){console.warn(`${t} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),r[t](...n),e.fallbackToNoCallback=!1,e.noCallback=!0,o()}else e.noCallback?(r[t](...n),o()):r[t](...n,i({resolve:o,reject:a},e))}))},s=(t,e,r)=>new Proxy(e,{apply:(e,n,o)=>r.call(n,t,...o)});let u=Function.call.bind(Object.prototype.hasOwnProperty);const l=(t,e={},r={})=>{let n=Object.create(null),o={has:(e,r)=>r in t||r in n,get(o,i,a){if(i in n)return n[i];if(!(i in t))return;let f=t[i];if("function"==typeof f)if("function"==typeof e[i])f=s(t,t[i],e[i]);else if(u(r,i)){let e=c(i,r[i]);f=s(t,t[i],e)}else f=f.bind(t);else if("object"==typeof f&&null!==f&&(u(e,i)||u(r,i)))f=l(f,e[i],r[i]);else{if(!u(r,"*"))return Object.defineProperty(n,i,{configurable:!0,enumerable:!0,get:()=>t[i],set(e){t[i]=e}}),f;f=l(f,e[i],r["*"])}return n[i]=f,f},set:(e,r,o,i)=>(r in n?n[r]=o:t[r]=o,!0),defineProperty:(t,e,r)=>Reflect.defineProperty(n,e,r),deleteProperty:(t,e)=>Reflect.deleteProperty(n,e)},i=Object.create(t);return new Proxy(i,o)},f=t=>({addListener(e,r,...n){e.addListener(t.get(r),...n)},hasListener:(e,r)=>e.hasListener(t.get(r)),removeListener(e,r){e.removeListener(t.get(r))}}),h=new n((t=>"function"!=typeof t?t:function(e){const r=l(e,{},{getContent:{minArgs:0,maxArgs:0}});t(r)})),p=new n((t=>"function"!=typeof t?t:function(e,r,n){let i,a,c=!1,s=new Promise((t=>{i=function(e){c=!0,t(e)}}));try{a=t(e,r,i)}catch(t){a=Promise.reject(t)}const u=!0!==a&&o(a);if(!0!==a&&!u&&!c)return!1;const l=t=>{t.then((t=>{n(t)}),(t=>{let e;e=t&&(t instanceof Error||"string"==typeof t.message)?t.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:e})})).catch((t=>{console.error("Failed to send onMessage rejected reply",t)}))};return l(u?a:s),!0})),d=({reject:r,resolve:n},o)=>{t.runtime.lastError?t.runtime.lastError.message===e?n():r(new Error(t.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?r(new Error(o.message)):n(o)},y=(t,e,r,...n)=>{if(n.length<e.minArgs)throw new Error(`Expected at least ${e.minArgs} ${a(e.minArgs)} for ${t}(), got ${n.length}`);if(n.length>e.maxArgs)throw new Error(`Expected at most ${e.maxArgs} ${a(e.maxArgs)} for ${t}(), got ${n.length}`);return new Promise(((t,e)=>{const o=d.bind(null,{resolve:t,reject:e});n.push(o),r.sendMessage(...n)}))},v={devtools:{network:{onRequestFinished:f(h)}},runtime:{onMessage:f(p),onMessageExternal:f(p),sendMessage:y.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:y.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},g={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":g},services:{"*":g},websites:{"*":g}},l(t,v,r)};t.exports=r(chrome)}},void 0===(o="function"==typeof r?r.apply(e,n):r)||(t.exports=o)}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=r(63675),e=r.n(t);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(){o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof b?e:b,i=Object.create(o.prototype),c=new N(n||[]);return a(i,"_invoke",{value:S(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",y="suspendedYield",v="executing",g="completed",m={};function b(){}function w(){}function x(){}var E={};f(E,s,(function(){return this}));var L=Object.getPrototypeOf,k=L&&L(L(j([])));k&&k!==r&&i.call(k,s)&&(E=k);var T=x.prototype=b.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,a,c,s){var u=p(t[o],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==n(f)&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}})}function S(e,r,n){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=A(c,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?g:y,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function A(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function j(e){if(e||""===e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=x,a(T,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},_(O.prototype),f(O.prototype,u,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(T),f(T,l,"Generator"),f(T,s,(function(){return this})),f(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=j,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:j(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function u(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){s(i,n,o,a,c,"next",t)}function c(t){s(i,n,o,a,c,"throw",t)}a(void 0)}))}}var l="Extension context invalid. Please refresh the page to continue.",f="API Key is missing",h="API URL is missing",p={APP_NAME:"AI Writing Companion",USE_MOCK:!1,DEBUG_MODE:!1,EXTENSION_ENABLED:!0,APPLICATION_LOCALIZE:"Farsi",SOURCE_LANGUAGE:"English",TARGET_LANGUAGE:"Farsi",TRANSLATION_API:"gemini",API_URL:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",API_KEY:"",WEBAI_API_URL:"http://localhost:6969/translate",WEBAI_API_MODEL:"gemini-2.0-flash",OPENAI_API_KEY:"",OPENAI_API_URL:"https://api.openai.com/v1/chat/completions",OPENAI_API_MODEL:"gpt-3.5-turbo",OPENROUTER_API_KEY:"",OPENROUTER_API_URL:"https://openrouter.ai/api/v1/chat/completions",OPENROUTER_API_MODEL:"openai/gpt-3.5-turbo",TRANSLATE_ON_TEXT_FIELDS:!0,ENABLE_SHORTCUT_FOR_TEXT_FIELDS:!0,TRANSLATE_WITH_SELECT_ELEMENT:!0,TRANSLATE_ON_TEXT_SELECTION:!0,REQUIRE_CTRL_FOR_TEXT_SELECTION:!1,ENABLE_DICTIONARY:!0,HIGHTLIH_NEW_ELEMETN_RED:"2px solid red",TRANSLATION_ICON_TITLE:"Translate Text",HIGHLIGHT_STYLE:"2px solid red",ICON_TRANSLATION:"🌐",ICON_SECCESS:"✅ ",ICON_WARNING:"⚠️ ",ICON_STATUS:"⏳ ",ICON_ERROR:"❌ ",ICON_INFO:"🔵 ",ICON_REVERT:"",NOTIFICATION_ALIGNMENT:"right",NOTIFICATION_TEXT_DIRECTION:"rtl",NOTIFICATION_TEXT_ALIGNMENT:"right",RTL_REGEX:/[\u0600-\u06FF]/,PERSIAN_REGEX:/^(?=.*[\u0600-\u06FF])[\u0600-\u06FF\u0660-\u0669\u06F0-\u06F9\u0041-\u005A\u0061-\u007A\u0030-\u0039\s.,:;؟!()«»@#\n\t\u200C]+$/,PROMPT_BASE_FIELD:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n  - If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n  - If the input is in any other language, translate it to $_{TARGET}.\n  - If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_BASE_SELECT:'Act as an automated JSON translation service. The input is a JSON array where each object contains a "text" property.\n\n  1. Translate each "text" value according to the given rules: $_{USER_RULES}\n  2. Preserve all input elements. **Do not omit, modify, or skip any entry.**\n  3. If translation is not needed for a specific item (e.g., numbers, hashtags, URLs), **return the original value unchanged.**\n  4. Maintain the internal structure, formatting, and line breaks exactly.\n  5. Output **only** the translated JSON array, with no extra text, explanations, or markdown.\n\n  ```json input\n  $_{TEXT}\n  ```\n    ',PROMPT_BASE_DICTIONARY:'You are a $_{TARGET} dictionary service. Your task is to provide in detailed dictionary definitions while strictly preserving the input structure and formatting. Follow these rules:\n\n  - Provide the translation of the input word or phrase.\n  - Include synonyms, word type (noun, verb, adjective, etc.), and a brief definition.\n  - If applicable, provide example sentences using the word or phrase in context.\n  - If the input is ambiguous, return the most common meanings.\n  - If no definition is found, return "No definition available."\n\n  Return in $_{TARGET} language, and **ONLY** the dictionary entry without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ',PROMPT_BASE_POPUP_TRANSLATE:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in any language, translate it to $_{TARGET}.\n\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_TEMPLATE:"- If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n- If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n- If the input is in any other language, translate it to $_{TARGET}.\n- If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.",DEBUG_TRANSLATED_ENGLISH:"This is a mock translation to English.",DEBUG_TRANSLATED_PERSIAN:"این یک ترجمه آزمایشی به فارسی است.",DEBUG_TRANSLATED_ENGLISH_With_NewLine:"This is a mock \ntranslation to English with \nnew lines.",DEBUG_TRANSLATED_PERSIAN_With_NewLine:"این یک ترجمه آزمایشی \nبرای ترجمه به فارسی \nبا خطوط جدید است."},d={Field:"field",SelectElement:"select_element",Selection:"selection",Dictionary_Translation:"dictionary",Popup_Translate:"popup_translate"},y={selectElementActive:!1,highlightedElement:null,activeTranslateIcon:null,originalTexts:new Map,translateMode:null},v=null,g=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===v){t.next=2;break}return t.abrupt("return",v);case 2:return t.abrupt("return",e().storage.local.get(null).then((function(t){return v=a(a({},p),t)})).catch((function(t){return Xt("Error fetching settings:",t),v=a({},p)})));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e()&&e().storage&&e().storage.onChanged?e().storage.onChanged.addListener((function(t,e){if("local"===e&&v){Object.keys(t).forEach((function(e){if(p.hasOwnProperty(e)||v&&v.hasOwnProperty(e)){var r=t[e].newValue;v[e]!==r&&(v[e]=r,!0)}}))}})):Xt("Browser.storage.onChanged not available. Settings cache might become stale.");var m,b,w,x,E,L,k,T,_=function(){var t=u(o().mark((function t(e,r){var n,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g();case 2:return i=t.sent,t.abrupt("return",null!==(n=null==i?void 0:i[e])&&void 0!==n?n:r);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),O=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("USE_MOCK",p.USE_MOCK));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),S=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("DEBUG_MODE",p.DEBUG_MODE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),A=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!v||void 0===v.DEBUG_MODE){t.next=2;break}return t.abrupt("return",v.DEBUG_MODE);case 2:return t.abrupt("return",S());case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),P=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("API_KEY",p.API_KEY));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),I=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("API_URL",p.API_URL));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),N=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("APPLICATION_LOCALIZE",p.APPLICATION_LOCALIZE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),j=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("EXTENSION_ENABLED",p.EXTENSION_ENABLED));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),C=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("SOURCE_LANGUAGE",p.SOURCE_LANGUAGE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),R=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("TARGET_LANGUAGE",p.TARGET_LANGUAGE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),G=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("ENABLE_DICTIONARY",p.ENABLE_DICTIONARY));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),F=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("PROMPT_TEMPLATE",p.PROMPT_TEMPLATE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),M=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("PROMPT_BASE_DICTIONARY",p.PROMPT_BASE_DICTIONARY));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),D=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("PROMPT_BASE_POPUP_TRANSLATE",p.PROMPT_BASE_POPUP_TRANSLATE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),H=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("PROMPT_BASE_SELECT",p.PROMPT_BASE_SELECT));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),U=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("PROMPT_BASE_FIELD",p.PROMPT_BASE_FIELD));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),B=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("TRANSLATION_API",p.TRANSLATION_API));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),$=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("WEBAI_API_URL",p.WEBAI_API_URL));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),z=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("WEBAI_API_MODEL",p.WEBAI_API_MODEL));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Y=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("OPENAI_API_KEY",p.OPENAI_API_KEY));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),X=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",p.OPENAI_API_URL);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),W=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("OPENAI_API_MODEL",p.OPENAI_API_MODEL));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),q=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("OPENROUTER_API_KEY",p.OPENROUTER_API_KEY));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),V=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("OPENROUTER_API_MODEL",p.OPENROUTER_API_MODEL));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),K=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("TRANSLATE_WITH_SELECT_ELEMENT",p.TRANSLATE_WITH_SELECT_ELEMENT));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Z=function(){var t=u(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",_("REQUIRE_CTRL_FOR_TEXT_SELECTION",p.REQUIRE_CTRL_FOR_TEXT_SELECTION));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function Q(t,e,r){return(e=et(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function tt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,et(n.key),n)}}function et(t){var e=function(t,e){if("object"!=J(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==J(e)?e:e+""}var rt={ICON_ERROR:null!==(m=null==p?void 0:p.ICON_ERROR)&&void 0!==m?m:"❌",ICON_WARNING:null!==(b=null==p?void 0:p.ICON_WARNING)&&void 0!==b?b:"⚠️",ICON_SUCCESS:null!==(w=null==p?void 0:p.ICON_SUCCESS)&&void 0!==w?w:"✅",ICON_INFO:null!==(x=null==p?void 0:p.ICON_INFO)&&void 0!==x?x:"ℹ️",ICON_REVERT:null!==(E=null==p?void 0:p.ICON_REVERT)&&void 0!==E?E:"↩️",NOTIF_ALIGN:null!==(L=null==p?void 0:p.NOTIFICATION_ALIGNMENT)&&void 0!==L?L:"right",TEXT_DIR:null!==(k=null==p?void 0:p.NOTIFICATION_TEXT_DIRECTION)&&void 0!==k?k:"rtl",TEXT_ALIGN:null!==(T=null==p?void 0:p.NOTIFICATION_TEXT_ALIGNMENT)&&void 0!==T?T:"right"},nt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.map={error:{title:"AI Writing Companion - Error",icon:rt.ICON_ERROR,cls:"AIWC-error",dur:5e3},warning:{title:"AI Writing Companion - Warning",icon:rt.ICON_WARNING,cls:"AIWC-warning",dur:4e3},success:{title:"AI Writing Companion - Success",icon:rt.ICON_SUCCESS,cls:"AIWC-success",dur:3e3},info:{title:"AI Writing Companion - Info",icon:rt.ICON_INFO,cls:"AIWC-info",dur:3e3},status:{title:"AI Writing Companion - Status",icon:rt.ICON_INFO,cls:"AIWC-status",dur:2e3},revert:{title:"AI Writing Companion - Revert",icon:rt.ICON_REVERT,cls:"AIWC-revert",dur:800}},"undefined"!=typeof document?this.container=this._makeContainer():this.container=null},r=[{key:"_makeContainer",value:function(){var t="AIWritingCompanion-notifications",e=document.getElementById(t);return e||((e=document.createElement("div")).id=t,Object.assign(e.style,Q(Q(Q({position:"fixed",top:"20px",zIndex:"2147483646",display:"flex",flexDirection:"column",gap:"10px"},"right"===rt.NOTIF_ALIGN?"right":"left","20px"),"direction",rt.TEXT_DIR),"textAlign",rt.TEXT_ALIGN)),document.body.appendChild(e),e)}},{key:"show",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0,a=this.map[r]||this.map.info,c=o||a.dur;return this.container&&document.body.contains(this.container)?this._toastInPage(t,a,n,c,i):(this._sendToActiveTab(t,r,n,c,i).catch((function(){e._osNotification(t,r,i)})),null)}},{key:"dismiss",value:function(t){t&&"function"==typeof t.remove&&(t.style.opacity="0",setTimeout((function(){return t.remove()}),500))}},{key:"_toastInPage",value:function(t,e,r,n,o){var i=this,a=document.createElement("div");return a.className="AIWC-notification ".concat(e.cls),a.style.cssText="\n      background:#fff;color:#333;padding:10px 15px;border-radius:6px;font-size:14px;\n      border:1px solid #ddd;box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;\n      align-items:center;cursor:pointer;opacity:1;transition:opacity .5s",a.innerHTML='<span style="margin-inline-end:6px;">'.concat(e.icon,"</span><span>").concat(t,"</span>"),a.addEventListener("click",(function(){try{"function"==typeof o&&o()}catch(t){Xt(t)}i.dismiss(a)})),this.container.appendChild(a),r&&"AIWC-status"!==e.cls&&setTimeout((function(){return i.dismiss(a)}),n),a}},{key:"_sendToActiveTab",value:function(t,r,n,o,i){return e().tabs.query({active:!0,currentWindow:!0}).then((function(i){var a,c=null==i||null===(a=i[0])||void 0===a?void 0:a.id;if(!c)throw new Error("No active tab");return e().tabs.sendMessage(c,{action:"show_notification",payload:{message:t,type:r,autoDismiss:n,duration:o}}).catch((function(t){throw t}))})).then((function(){i&&e().runtime.onMessage.addListener((function t(r){"notification_clicked"===(null==r?void 0:r.action)&&(i(),e().runtime.onMessage.removeListener(t))}))}))}},{key:"_osNotification",value:function(t,r,n){var o=this.map[r]||this.map.info;e().notifications.create({type:"basic",iconUrl:e().runtime.getURL("icons/extension_icon.png"),title:o.title,message:t}).then((function(t){if(n){var r=function(o){o===t&&(n(),e().notifications.clear(t),e().notifications.onClicked.removeListener(r))};e().notifications.onClicked.addListener(r)}})).catch((function(t){return Xt("OS‑notification error:",t)}))}}],r&&tt(t.prototype,r),n&&tt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n}(),ot=[{name:"English",voiceCode:"en-US",promptName:"English",code:"en",locale:"en",flag:"🇬🇧"},{name:"Farsi",voiceCode:"fa-IR",promptName:"Farsi",code:"fa",locale:"fa",flag:"🇮🇷"},{name:"German",voiceCode:"de-DE",promptName:"German",code:"de"},{name:"French",voiceCode:"fr-FR",promptName:"French",code:"fr"},{name:"Chinese (Simplified)",voiceCode:"zh-CN",promptName:"Chinese (Simplified)",code:"zh"},{name:"Spanish",voiceCode:"es-ES",promptName:"Spanish",code:"es"},{name:"Hindi",voiceCode:"hi-IN",promptName:"Hindi",code:"hi"},{name:"Arabic",voiceCode:"ar-SA",promptName:"Arabic",code:"ar"},{name:"Bengali",voiceCode:"bn-BD",promptName:"Bengali",code:"bn"},{name:"Portuguese",voiceCode:"pt-PT",promptName:"Portuguese",code:"pt"},{name:"Russian",voiceCode:"ru-RU",promptName:"Russian",code:"ru"},{name:"Japanese",voiceCode:"ja-JP",promptName:"Japanese",code:"ja"},{name:"Urdu",voiceCode:"ur-PK",promptName:"Urdu",code:"ur"},{name:"Indonesian",voiceCode:"id-ID",promptName:"Indonesian",code:"id"},{name:"Italian",voiceCode:"it-IT",promptName:"Italian",code:"it"},{name:"Swahili",voiceCode:"sw-KE",promptName:"Swahili",code:"sw"},{name:"Marathi",voiceCode:"mr-IN",promptName:"Marathi",code:"mr"},{name:"Telugu",voiceCode:"te-IN",promptName:"Telugu",code:"te"},{name:"Tamil",voiceCode:"ta-IN",promptName:"Tamil",code:"ta"},{name:"Turkish",voiceCode:"tr-TR",promptName:"Turkish",code:"tr"},{name:"Vietnamese",voiceCode:"vi-VN",promptName:"Vietnamese",code:"vi"},{name:"Korean",voiceCode:"ko-KR",promptName:"Korean",code:"ko"},{name:"Thai",voiceCode:"th-TH",promptName:"Thai",code:"th"},{name:"Malay",voiceCode:"ms-MY",promptName:"Malay",code:"ms"},{name:"Polish",voiceCode:"pl-PL",promptName:"Polish",code:"pl"},{name:"Dutch",voiceCode:"nl-NL",promptName:"Dutch",code:"nl"},{name:"Filipino",voiceCode:"fil-PH",promptName:"Filipino",code:"fi"},{name:"Ukrainian",voiceCode:"uk-UA",promptName:"Ukrainian",code:"uk"},{name:"Romanian",voiceCode:"ro-RO",promptName:"Romanian",code:"ro"},{name:"Greek",voiceCode:"el-GR",promptName:"Greek",code:"el"},{name:"Czech",voiceCode:"cs-CZ",promptName:"Czech",code:"cs"},{name:"Hungarian",voiceCode:"hu-HU",promptName:"Hungarian",code:"hu"},{name:"Swedish",voiceCode:"sv-SE",promptName:"Swedish",code:"sv"},{name:"Norwegian",voiceCode:"no-NO",promptName:"Norwegian",code:"no"},{name:"Danish",voiceCode:"da-DK",promptName:"Danish",code:"da"},{name:"Finnish",voiceCode:"fi-FI",promptName:"Finnish",code:"fi"},{name:"Hebrew",voiceCode:"he-IL",promptName:"Hebrew",code:"he"},{name:"Afrikaans",voiceCode:"af-ZA",promptName:"Afrikaans",code:"af"},{name:"Albanian",voiceCode:"sq-AL",promptName:"Albanian",code:"sq"},{name:"Bulgarian",voiceCode:"bg-BG",promptName:"Bulgarian",code:"bg"},{name:"Catalan",voiceCode:"ca-ES",promptName:"Catalan",code:"ca"},{name:"Croatian",voiceCode:"hr-HR",promptName:"Croatian",code:"hr"},{name:"Estonian",voiceCode:"et-EE",promptName:"Estonian",code:"et"},{name:"Latvian",voiceCode:"lv-LV",promptName:"Latvian",code:"lv"},{name:"Lithuanian",voiceCode:"lt-LT",promptName:"Lithuanian",code:"lt"},{name:"Slovak",voiceCode:"sk-SK",promptName:"Slovak",code:"sk"},{name:"Slovenian",voiceCode:"sl-SI",promptName:"Slovenian",code:"sl"},{name:"Serbian",voiceCode:"sr-RS",promptName:"Serbian",code:"sr"},{name:"Malayalam",voiceCode:"ml-IN",promptName:"Malayalam",code:"ml"},{name:"Kannada",voiceCode:"kn-IN",promptName:"Kannada",code:"kn"},{name:"Odia",voiceCode:"or-IN",promptName:"Odia",code:"or"},{name:"Punjabi",voiceCode:"pa-IN",promptName:"Punjabi",code:"pa"},{name:"Sinhala",voiceCode:"si-LK",promptName:"Sinhala",code:"si"},{name:"Nepali",voiceCode:"ne-NP",promptName:"Nepali",code:"ne"},{name:"Azerbaijani",voiceCode:"az-AZ",promptName:"Azerbaijani",code:"az"},{name:"Belarusian",voiceCode:"be-BY",promptName:"Belarusian",code:"be"},{name:"Kazakh",voiceCode:"kk-KZ",promptName:"Kazakh",code:"kk"},{name:"Uzbek",voiceCode:"uz-UZ",promptName:"Uzbek",code:"uz"},{name:"Pashto",voiceCode:"ps-AF",promptName:"Pashto",code:"ps"},{name:"Tagalog",voiceCode:"tl-PH",promptName:"Tagalog",code:"tl"},{name:"Cebuano",voiceCode:"en-US",promptName:"Cebuano",code:"en"}];var it=function(t){return p.PERSIAN_REGEX.test(t)},at=function(t){return p.RTL_REGEX.test(t)},ct=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&t.style){var r=e;t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}},st=function(t,e){if(t){var r=function(t){return function(t){return/[\u0600-\u06FF]/.test(t)}(t)||at(t)}(e),n=r?"rtl":"ltr",o=r?"right":"left";t.style?(t.style.direction=n,t.style.textAlign=o):t.setAttribute("style","direction: ".concat(n,"; text-align: ").concat(o,";"))}};function ut(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;t.style.opacity="0",t.style.transform="scale(0.95)",t.style.transition="opacity ".concat(e,"ms ease-out, transform ").concat(e,"ms ease-out"),t.getBoundingClientRect(),t.style.opacity="1",t.style.transform="scale(1)"}function lt(t){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lt(t)}function ft(){ft=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==lt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(lt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ht(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function pt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ht(i,n,o,a,c,"next",t)}function c(t){ht(i,n,o,a,c,"throw",t)}a(void 0)}))}}function dt(t){return"true"===String(t).trim().toLowerCase()}var yt=new Map;function vt(t){return gt.apply(this,arguments)}function gt(){return(gt=pt(ft().mark((function t(r){var n,o,i;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!yt.has(r)){t.next=2;break}return t.abrupt("return",yt.get(r));case 2:return t.prev=2,n=e().runtime.getURL("_locales/".concat(r,"/messages.json")),t.next=6,fetch(n);case 6:if((o=t.sent).ok){t.next=9;break}return t.abrupt("return",null);case 9:return t.next=11,o.json();case 11:return i=t.sent,yt.set(r,i),t.abrupt("return",i);case 16:return t.prev=16,t.t0=t.catch(2),t.abrupt("return",null);case 19:case"end":return t.stop()}}),t,null,[[2,16]])})))).apply(this,arguments)}function mt(t,e){return bt.apply(this,arguments)}function bt(){return(bt=pt(ft().mark((function t(e,r){var n,o,i,a,c;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((o=r)&&2===o.length){t.next=7;break}return t.next=4,N();case 4:i=t.sent,a=ot.find((function(t){return t.name===i||t.locale===i})),o=(null==a?void 0:a.code)||(2===(null==i?void 0:i.length)?i:"en");case 7:return t.next=9,vt(o);case 9:if(!(c=t.sent)||null===(n=c[e])||void 0===n||!n.message){t.next=12;break}return t.abrupt("return",c[e].message);case 12:return t.abrupt("return",null);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function wt(t,r){t.querySelectorAll("[data-i18n]").forEach((function(t){var n=t.getAttribute("data-i18n"),o="";o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n),t.matches("input, textarea")?t.value=o:t.matches("img")?t.setAttribute("alt",o):t.textContent=o})),t.querySelectorAll("[data-i18n-title]").forEach((function(t){var n=t.getAttribute("data-i18n-title"),o="";o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n),t.setAttribute("title",o)})),t.querySelectorAll("[data-i18n-placeholder]").forEach((function(t){var n=t.getAttribute("data-i18n-placeholder"),o="";(o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n))&&(t.placeholder=o)}))}function xt(t){return Et.apply(this,arguments)}function Et(){return(Et=pt(ft().mark((function t(e){var r,n,o,i,a,c;return ft().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=null,t.next=3,N();case 3:if(o=t.sent,(!(i=e)||(null===(r=i)||void 0===r?void 0:r.length)>2)&&ot.forEach((function(t){t.name!==o&&t.locale!==o||(i=t.locale)})),!i){t.next=10;break}return t.next=9,vt(i);case 9:n=t.sent;case 10:a=document.body,c=document.head,wt(a,n),c&&wt(c,n),ut(a,300);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Lt(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toLowerCase().replace(/[.,!?؛،ء]/g,"").trim();return t.includes("api key not valid")||t.includes("wrong api key")||t.includes("api key is wrong")?"ERRORS_API_KEY_WRONG":t.includes("api key is missing")?"ERRORS_API_KEY_MISSING":t.includes("context invalidated")||t.includes("extension context lost")||t.includes("context lost")||t.includes("context invalid")||t.includes("context invalid. please refresh")?"ERRORS_CONTEXT_LOST":t.includes("failed to fetch")?"ERRORS_NETWORK_FAILURE":t.includes("invalid api response")?"ERRORS_INVALID_RESPONSE":t.includes("translation failed")?"ERRORS_SMARTTRANSLATE_FAILED":t.includes("quota exceeded")&&t.includes("generate content api requests per minute")?"ERRORS_GEMINI_GENERATE_QUOTA":t.includes("you exceeded your current quota")||t.includes("check your plan and billing")||t.includes("exceeded your quota limit")||t.includes("quota exceeded")||t.includes("quota has been exceeded")?"ERRORS_QUOTA_EXCEEDED":null}function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function Tt(){Tt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==kt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(kt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function _t(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ot(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_t(Object(r),!0).forEach((function(e){jt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_t(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function St(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function At(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){St(i,n,o,a,c,"next",t)}function c(t){St(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Pt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ct(n.key),n)}}function It(t,e,r){return e&&Pt(t.prototype,e),r&&Pt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jt(t,e,r){return(e=Ct(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ct(t){var e=function(t,e){if("object"!=kt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==kt(e)?e:e+""}var Rt=It((function t(){Nt(this,t)}));jt(Rt,"API","API"),jt(Rt,"NETWORK","NETWORK"),jt(Rt,"SERVICE","SERVICE"),jt(Rt,"VALIDATIONMODEL","VALIDATIONMODEL"),jt(Rt,"CONTEXT","CONTEXT"),jt(Rt,"UI","UI"),jt(Rt,"INTEGRATION","INTEGRATION"),jt(Rt,"PARSE_SELECT_ELEMENT","PARSING_RESPONSE"),jt(Rt,"PARSE_INPUT","PARSING_EXTRACT_FIELD");var Gt=new Set(["ERRORS_CONTEXT_LOST"]),Ft=new Set(["ERRORS_CONTEXT_LOST","ERRORS_API_KEY_WRONG","ERRORS_API_KEY_MISSING","ERRORS_QUOTA_EXCEEDED","ERRORS_API_URL_MISSING","ERRORS_API_KEY_FORBIDDEN","ERRORS_GEMINI_GENERATE_QUOTA"]);function Mt(t){return Dt.apply(this,arguments)}function Dt(){return(Dt=At(Tt().mark((function t(e){var r,n,o,i;return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",new Error("(Unknown Error)"));case 2:if(r="string"==typeof e?e:e instanceof Error||"string"==typeof e.message?e.message:function(){try{return JSON.stringify(e)}catch(t){return"(Unknown Error)"}}(),!(n=Lt(r))){t.next=10;break}return t.next=7,mt(n);case 7:t.t0=t.sent,t.next=11;break;case 10:t.t0=null;case 11:return o=t.t0,(i=new Error(o||r))._originalMessage=r,i._errorKey=n||null,t.abrupt("return",i);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Ht=function(){return It((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new nt;Nt(this,t),this.notifier=e,this.displayedErrors=new Set,this.isHandling=!1}),[{key:"handle",value:(e=At(Tt().mark((function t(e){var r,n,o,i,a,c,s,u,l=arguments;return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=l.length>1&&void 0!==l[1]?l[1]:{},null===(r=e)||void 0===r||!r._isHandled){t.next=3;break}return t.abrupt("return",e);case 3:if("function"!=typeof(null===(n=e)||void 0===n?void 0:n.then)){t.next=7;break}return t.next=6,e;case 6:e=t.sent;case 7:if(!this.isHandling){t.next=9;break}return t.abrupt("return",e);case 9:return this.isHandling=!0,t.prev=10,t.next=13,Mt(e);case 13:return i=t.sent,a=Ot(Ot(Ot({},i.meta||{}),o),{},{type:o.type||Rt.SERVICE,statusCode:o.statusCode||500,context:o.context||""}),c=i._errorKey,s=c?c.toUpperCase():"UNKNOWN-ERROR",t.next=19,S().catch((function(){return p.DEBUG_MODE}));case 19:if(t.sent&&!Ft.has(s)&&this._logError(i,a),!Gt.has(s)){t.next=25;break}return i._isHandled=!0,t.abrupt("return",i);case 25:if(!c){t.next=31;break}return t.next=28,mt(c);case 28:t.t0=t.sent,t.next=32;break;case 31:t.t0=i.message;case 32:return u=t.t0,this._notifyUser(u,a.type,s),i._isHandled=!0,t.abrupt("return",i);case 38:return t.prev=38,t.t1=t.catch(10),Xt("[ErrorService] Critical error:",t.t1),t.abrupt("return",t.t1);case 42:return t.prev=42,this.isHandling=!1,t.finish(42);case 45:case"end":return t.stop()}}),t,this,[[10,38,42,45]])}))),function(t){return e.apply(this,arguments)})},{key:"_logError",value:function(t,e){var r={name:t.name,message:t.message,type:e.type,statusCode:e.statusCode,context:e.context,stack:t.stack};console.error("[ErrorService] ".concat(r.name,": ").concat(r.message,"\nType: ").concat(r.type,"\nStatus: ").concat(r.statusCode,"\nContext: ").concat(r.context)),r.stack&&console.error("[Stack Trace]",r.stack)}},{key:"_notifyUser",value:function(t,e,r){var n=this;if(!this.displayedErrors.has(t)){var o=jt(jt(jt(jt(jt(jt(jt({},Rt.API,"error"),Rt.UI,"error"),Rt.NETWORK,"warning"),Rt.SERVICE,"error"),Rt.CONTEXT,"warning"),Rt.VALIDATIONMODEL,"warning"),Rt.INTEGRATION,"warning")[e]||"error",i=new Set(["ERRORS_API_KEY_WRONG","ERRORS_API_KEY_MISSING","ERRORS_API_URL_MISSING","ERRORS_API_KEY_FORBIDDEN","ERRORS_QUOTA_EXCEEDED","ERRORS_GEMINI_GENERATE_QUOTA"]),a=e===Rt.API&&i.has(r)?Vt:void 0;this.notifier.show(t,o,!0,4e3,a),this.displayedErrors.add(t),setTimeout((function(){return n.displayedErrors.delete(t)}),4e3)}}}],[{key:"processError",value:(t=At(Tt().mark((function t(e){return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof(null==e?void 0:e.then)){t.next=4;break}return t.next=3,e;case 3:return t.abrupt("return",t.sent);case 4:return t.abrupt("return",e);case 5:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]);var t,e}();function Ut(){return Ut=At(Tt().mark((function t(e){var r,n,o=arguments;return Tt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:"",n=new Ht,t.next=4,n.handle(e,{type:Rt.UI,context:r});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)}))),Ut.apply(this,arguments)}var Bt=new Ht,$t=function(t){return new Promise((function(e){return setTimeout(e,t)}))};function zt(t,e,r){}var Yt,Xt=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];A().then((function(t){var r;t&&(r=console).debug.apply(r,e)}))},Wt=function(t){if(null!=t&&t.isContentEditable)return!0;if("TEXTAREA"===(null==t?void 0:t.tagName))return!0;if("INPUT"===(null==t?void 0:t.tagName)){var e,r=(null===(e=t.getAttribute("type"))||void 0===e?void 0:e.toLowerCase())||"text";return["text","search"].includes(r)}return!(null==t||!t.closest||!t.closest('[contenteditable="true"]'))},qt=function(){try{var t,r;return!(null===e()||void 0===e()||null===(t=e().runtime)||void 0===t||!t.id||null===e()||void 0===e()||null===(r=e().storage)||void 0===r||!r.local)}catch(t){return!1}},Vt=function(){e().runtime.openOptionsPage?e().runtime.openOptionsPage():window.open(e().runtime.getURL("html/options.html"))};Yt=null;function Kt(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{var e;if(null===(e=document)||void 0===e||!e.body)return;document.documentElement.classList.toggle("AIWritingCompanion-disable-links",t)}catch(t){throw Bt.handle(t,{type:Rt.CONTEXT,context:"taggleLinks",details:{errorType:t.message.includes("context invalidated")?"CONTEXT_INVALIDATED":"UNKNOWN_ERROR"}})}}var Zt,Jt;function Qt(t){var e=document.getElementById(t);return e||console.warn("[AIWC-DOM] Element not found for selector: ".concat(t)),e}const te={translationForm:Qt("translationForm"),sourceText:Qt("sourceText"),translationResult:Qt("translationResult"),sourceContainer:null===(Zt=Qt("sourceText"))||void 0===Zt?void 0:Zt.parentElement,resultContainer:null===(Jt=Qt("translationResult"))||void 0===Jt?void 0:Jt.parentElement,sourceLanguageInput:Qt("sourceLanguageInput"),targetLanguageInput:Qt("targetLanguageInput"),sourceLanguagesList:Qt("sourceLanguagesList"),targetLanguagesList:Qt("targetLanguagesList"),clearSourceLanguage:Qt("clearSourceLanguage"),clearTargetLanguage:Qt("clearTargetLanguage"),swapLanguagesBtn:Qt("swapLanguagesBtn"),translateBtn:Qt("translateBtn"),copySourceBtn:Qt("copySourceBtn"),pasteSourceBtn:Qt("pasteSourceBtn"),voiceSourceIcon:Qt("voiceSourceIcon"),copyTargetBtn:Qt("copyTargetBtn"),voiceTargetIcon:Qt("voiceTargetIcon"),translatePageLink:Qt("translatePageLink"),selectElementIcon:Qt("selectElementIcon"),clearStorageBtn:Qt("clearStorageBtn"),revertIcon:Qt("revertActionIcon"),settingsIcon:Qt("settingsIcon"),popupContainer:document.body,$:Qt};function ee(t,e){var r=null==t?void 0:t.parentElement;r&&e&&r.classList.toggle("has-value",!!t.value)}function re(t){var e=null==t?void 0:t.parentElement;if(e){var r=(t.value||t.textContent||"").trim();e.classList.toggle("has-content",r&&r!==mt("popup_string_during_translate")||"در حال ترجمه...")}}function ne(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(t){var r="feedback-".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success");t.classList.add(r),setTimeout((function(){t.classList.remove(r)}),e)}}var oe="Auto Detect";function ie(t){if(!t)return null;var e=t.trim();if(e===oe)return oe;var r=ot.find((function(t){return t.name===e||t.promptName===e||t.voiceCode===e}));return r?r.voiceCode:null}function ae(t){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(t)}function ce(){ce=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ae(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ae(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function se(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ue(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){se(i,n,o,a,c,"next",t)}function c(t){se(i,n,o,a,c,"throw",t)}a(void 0)}))}}function le(t){if(!t)return null;var e=t.trim();if(e===oe)return oe;var r=ot.find((function(t){return t.name===e||t.promptName===e}));return r?r.promptName||r.name:null}function fe(t){if(!t||t===oe)return oe;var e=ot.find((function(e){return e.code===t||e.name===t||e.promptName===t}));return e?e.promptName||e.name:""}function he(){if(ot.forEach((function(t){var e,r=document.createElement("option");if(r.value=t.promptName||t.name,null===(e=te.sourceLanguagesList)||void 0===e||e.appendChild(r),t.code!==oe){var n,o=document.createElement("option");o.value=t.promptName||t.name,null===(n=te.targetLanguagesList)||void 0===n||n.appendChild(o)}})),!ot.some((function(t){return t.name===oe||t.promptName===oe}))){var t,e=document.createElement("option");e.value=oe,null===(t=te.sourceLanguagesList)||void 0===t||t.prepend(e)}}function pe(){return de.apply(this,arguments)}function de(){return(de=ue(ce().mark((function t(){var e;return ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return te.sourceLanguageInput.value=oe,ee(te.sourceLanguageInput,te.clearSourceLanguage),t.prev=2,t.next=5,R();case 5:e=t.sent,te.targetLanguageInput.value=fe(e)||fe("en"),t.next=13;break;case 9:t.prev=9,t.t0=t.catch(2),Xt("[LangManager]: Error getting target language:",t.t0),te.targetLanguageInput.value=fe("en");case 13:return t.prev=13,ee(te.targetLanguageInput,te.clearTargetLanguage),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[2,9,13,16]])})))).apply(this,arguments)}function ye(t){null==t||t.focus()}function ve(){return ge.apply(this,arguments)}function ge(){return(ge=ue(ce().mark((function t(){return ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return he(),t.next=3,pe();case 3:e=void 0,r=void 0,n=void 0,o=void 0,i=void 0,a=void 0,c=void 0,null===(e=te.sourceLanguageInput)||void 0===e||e.addEventListener("click",(function(){return ye(te.sourceLanguageInput)})),null===(r=te.targetLanguageInput)||void 0===r||r.addEventListener("click",(function(){return ye(te.targetLanguageInput)})),null===(n=te.clearSourceLanguage)||void 0===n||n.addEventListener("click",(function(){te.sourceLanguageInput.value="",ee(te.sourceLanguageInput,te.clearSourceLanguage),te.sourceLanguageInput.focus()})),null===(o=te.clearTargetLanguage)||void 0===o||o.addEventListener("click",(function(){te.targetLanguageInput.value="",ee(te.targetLanguageInput,te.clearTargetLanguage),te.targetLanguageInput.focus()})),null===(i=te.sourceLanguageInput)||void 0===i||i.addEventListener("input",(function(){return ee(te.sourceLanguageInput,te.clearSourceLanguage)})),null===(a=te.targetLanguageInput)||void 0===a||a.addEventListener("input",(function(){return ee(te.targetLanguageInput,te.clearTargetLanguage)})),null===(c=te.swapLanguagesBtn)||void 0===c||c.addEventListener("click",ue(ce().mark((function t(){var e,r,n,o,i,a,c,s,u,l;return ce().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=te.sourceLanguageInput.value,r=te.targetLanguageInput.value,n=ie(e),o=ie(r),i=n,a=o,n!==oe){t.next=16;break}return t.prev=7,t.next=10,C();case 10:i=t.sent,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(7),Xt("[LangManager]: Failed to load source language from settings",t.t0);case 16:if(o!==oe){t.next=26;break}return t.prev=17,t.next=20,R();case 20:a=t.sent,t.next=26;break;case 23:t.prev=23,t.t1=t.catch(17),Xt("[LangManager]: Failed to load target language from settings",t.t1);case 26:if(!i||!a){t.next=52;break}if(c=fe(a),s=fe(i),te.sourceLanguageInput.value=c||r,te.targetLanguageInput.value=s||e,ee(te.sourceLanguageInput,te.clearSourceLanguage),ee(te.targetLanguageInput,te.clearTargetLanguage),u=te.sourceText.value,l=te.translationResult.textContent,t.t2=l,!t.t2){t.next=42;break}return t.t3=l,t.next=40,mt("popup_string_during_translate");case 40:t.t4=t.sent,t.t2=t.t3!==t.t4;case 42:if(!t.t2){t.next=50;break}te.sourceText.value=l,te.translationResult.textContent=u,st(te.sourceText,l),st(te.translationResult,u),re(te.sourceText),re(te.translationResult),document.dispatchEvent(new CustomEvent("translationSwapped"));case 50:t.next=54;break;case 52:Xt("[LangManager]: Cannot swap - invalid language selection.",{sourceCode:n,targetCode:o}),te.swapLanguagesBtn&&ne(te.swapLanguagesBtn,"error",500);case 54:case"end":return t.stop()}}),t,null,[[7,13],[17,23]])})))),Xt("[LangManager]: Initialized.");case 5:case"end":return t.stop()}var e,r,n,o,i,a,c}),t)})))).apply(this,arguments)}function me(t){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},me(t)}function be(){be=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==me(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(me(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function we(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function xe(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){we(i,n,o,a,c,"next",t)}function c(t){we(i,n,o,a,c,"throw",t)}a(void 0)}))}}var Ee=!1;function Le(){return ke.apply(this,arguments)}function ke(){return(ke=xe(be().mark((function t(){return be().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.readText();case 3:return t.abrupt("return",!0);case 6:return t.prev=6,t.t0=t.catch(0),Xt("[Clipboard]: Clipboard read permission denied.",t.t0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))).apply(this,arguments)}function Te(){return _e.apply(this,arguments)}function _e(){return(_e=xe(be().mark((function t(){var e,r;return be().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=te.pasteSourceBtn){t.next=3;break}return t.abrupt("return");case 3:if(e.classList.add("hidden-by-clipboard"),!Ee||document.hasFocus()){t.next=7;break}return Xt("[Clipboard]: Visibility check deferred until window focus."),t.abrupt("return");case 7:if(navigator.clipboard&&navigator.clipboard.readText){t.next=10;break}return Xt("[Clipboard]: Clipboard API unavailable."),t.abrupt("return");case 10:return t.prev=10,t.next=13,navigator.clipboard.readText();case 13:r=t.sent,Ee=!1,null!=r&&r.trim()?(e.classList.remove("hidden-by-clipboard"),Xt("[Clipboard]: Clipboard has text, showing Paste button.")):Xt("[Clipboard]: Clipboard empty or no text, hiding Paste button."),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(10),"NotAllowedError"!==t.t0.name||document.hasFocus()||Ee?(Xt("[Clipboard]: Error reading clipboard.",t.t0),Ee=!1):(Ee=!0,Xt("[Clipboard]: Permission error; deferring until focus."),window.addEventListener("focus",Te,{once:!0}));case 21:case"end":return t.stop()}}),t,null,[[10,18]])})))).apply(this,arguments)}function Oe(){return Se.apply(this,arguments)}function Se(){return(Se=xe(be().mark((function t(){return be().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=void 0,r=void 0,n=void 0,null===(e=te.copySourceBtn)||void 0===e||e.addEventListener("click",xe(be().mark((function t(){var e,r;return be().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=te.sourceText.value){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,navigator.clipboard.writeText(e);case 6:Xt("[Clipboard]: Source text copied successfully."),null===(r=te.pasteSourceBtn)||void 0===r||r.classList.remove("hidden-by-clipboard"),ne(te.copySourceBtn),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(3),Xt("[Clipboard]: Failed to copy source text.",t.t0),ne(te.copySourceBtn,"error");case 15:case"end":return t.stop()}}),t,null,[[3,11]])})))),null===(r=te.pasteSourceBtn)||void 0===r||r.addEventListener("click",xe(be().mark((function t(){var e;return be().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Le();case 2:if(t.sent){t.next=6;break}return ne(te.pasteSourceBtn,"error"),te.pasteSourceBtn.classList.add("hidden-by-clipboard"),t.abrupt("return");case 6:return t.prev=6,t.next=9,navigator.clipboard.readText();case 9:return(e=t.sent)&&(te.sourceText.value=e,te.sourceText.dispatchEvent(new Event("input",{bubbles:!0})),te.sourceText.focus()),t.next=13,Te();case 13:t.next=20;break;case 15:t.prev=15,t.t0=t.catch(6),Xt("[Clipboard]: Error pasting text.",t.t0),ne(te.pasteSourceBtn,"error"),te.pasteSourceBtn.classList.add("hidden-by-clipboard");case 20:case"end":return t.stop()}}),t,null,[[6,15]])})))),null===(n=te.copyTargetBtn)||void 0===n||n.addEventListener("click",xe(be().mark((function t(){var e,r;return be().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=te.translationResult.textContent,t.t0=!e,t.t0){t.next=8;break}return t.t1=e,t.next=6,mt("popup_string_during_translate");case 6:t.t2=t.sent,t.t0=t.t1===t.t2;case 8:if(!t.t0){t.next=10;break}return t.abrupt("return");case 10:return t.prev=10,t.next=13,navigator.clipboard.writeText(e);case 13:Xt("[Clipboard]: Translation copied successfully."),null===(r=te.pasteSourceBtn)||void 0===r||r.classList.remove("hidden-by-clipboard"),ne(te.copyTargetBtn),t.next=22;break;case 18:t.prev=18,t.t3=t.catch(10),Xt("[Clipboard]: Failed to copy translation.",t.t3),ne(te.copyTargetBtn,"error");case 22:case"end":return t.stop()}}),t,null,[[10,18]])})))),document.addEventListener("translationSwapped",Te),t.next=3,Te();case 3:Xt("[Clipboard]: Clipboard manager initialized.");case 4:case"end":return t.stop()}var e,r,n}),t)})))).apply(this,arguments)}function Ae(t){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ae(t)}function Pe(){Pe=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Ae(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ae(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ie(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Ne(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ie(i,n,o,a,c,"next",t)}function c(t){Ie(i,n,o,a,c,"throw",t)}a(void 0)}))}}function je(){var t,r,n,o,i,a;t=document.querySelector("#sourceLanguageInput"),r=document.querySelector("#targetLanguageInput"),n=document.querySelector("#voiceSourceIcon"),o=document.querySelector("#voiceTargetIcon"),i=document.querySelector("#sourceText"),a=document.querySelector("#translationResult"),null==n||n.addEventListener("click",Ne(Pe().mark((function r(){var n,o,a;return Pe().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n=null==i?void 0:i.value.trim()){r.next=4;break}return i.focus(),r.abrupt("return");case 4:return r.prev=4,o=(null==t?void 0:t.value)||oe,r.next=8,e().runtime.sendMessage({action:"speak",text:n,lang:o});case 8:(a=r.sent)?a.success?Xt("[Popup TTS]: TTS playback started."):Xt("[Popup TTS]: TTS error:",a.error):Xt("[Popup TTS]: No response from background."),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(4),Xt("[Popup TTS]: Error sending message:",r.t0);case 15:case"end":return r.stop()}}),r,null,[[4,12]])})))),null==o||o.addEventListener("click",Ne(Pe().mark((function t(){var n,o,i,c;return Pe().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((o=null==a||null===(n=a.textContent)||void 0===n?void 0:n.trim())&&"در حال ترجمه..."!==o){t.next=4;break}return a.scrollIntoView({behavior:"smooth",block:"center"}),t.abrupt("return");case 4:return t.prev=4,i=(null==r?void 0:r.value)||oe,t.next=8,e().runtime.sendMessage({action:"speak",text:o,lang:i});case 8:(c=t.sent)?c.success?Xt("[Popup TTS]: TTS playback started for target text."):Xt("[Popup TTS]: TTS error (target):",c.error):Xt("[Popup TTS]: No response from background."),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),Xt("[Popup TTS]: Error sending message (target):",t.t0);case 15:case"end":return t.stop()}}),t,null,[[4,12]])})))),Xt("[Popup TTS]: Initialized.")}function Ce(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let Re={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function Ge(t){Re=t}const Fe={exec:()=>null};function Me(t,e=""){let r="string"==typeof t?t:t.source;const n={replace:(t,e)=>{let o="string"==typeof e?e:e.source;return o=o.replace(De.caret,"$1"),r=r.replace(t,o),n},getRegex:()=>new RegExp(r,e)};return n}const De={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},He=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Ue=/(?:[*+-]|\d{1,9}[.)])/,Be=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,$e=Me(Be).replace(/bull/g,Ue).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),ze=Me(Be).replace(/bull/g,Ue).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Ye=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Xe=/(?!\s*\])(?:\\.|[^\[\]\\])+/,We=Me(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Xe).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),qe=Me(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Ue).getRegex(),Ve="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ke=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Ze=Me("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",Ke).replace("tag",Ve).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Je=Me(Ye).replace("hr",He).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ve).getRegex(),Qe={blockquote:Me(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Je).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:We,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:He,html:Ze,lheading:$e,list:qe,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:Je,table:Fe,text:/^[^\n]+/},tr=Me("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",He).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ve).getRegex(),er={...Qe,lheading:ze,table:tr,paragraph:Me(Ye).replace("hr",He).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",tr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ve).getRegex()},rr={...Qe,html:Me("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",Ke).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Fe,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Me(Ye).replace("hr",He).replace("heading"," *#{1,6} *[^\n]").replace("lheading",$e).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},nr=/^( {2,}|\\)\n(?!\s*$)/,or=/[\p{P}\p{S}]/u,ir=/[\s\p{P}\p{S}]/u,ar=/[^\s\p{P}\p{S}]/u,cr=Me(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,ir).getRegex(),sr=/(?!~)[\p{P}\p{S}]/u,ur=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,lr=Me(ur,"u").replace(/punct/g,or).getRegex(),fr=Me(ur,"u").replace(/punct/g,sr).getRegex(),hr="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",pr=Me(hr,"gu").replace(/notPunctSpace/g,ar).replace(/punctSpace/g,ir).replace(/punct/g,or).getRegex(),dr=Me(hr,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,sr).getRegex(),yr=Me("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,ar).replace(/punctSpace/g,ir).replace(/punct/g,or).getRegex(),vr=Me(/\\(punct)/,"gu").replace(/punct/g,or).getRegex(),gr=Me(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),mr=Me(Ke).replace("(?:--\x3e|$)","--\x3e").getRegex(),br=Me("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",mr).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),wr=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,xr=Me(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",wr).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Er=Me(/^!?\[(label)\]\[(ref)\]/).replace("label",wr).replace("ref",Xe).getRegex(),Lr=Me(/^!?\[(ref)\](?:\[\])?/).replace("ref",Xe).getRegex(),kr={_backpedal:Fe,anyPunctuation:vr,autolink:gr,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:nr,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:Fe,emStrongLDelim:lr,emStrongRDelimAst:pr,emStrongRDelimUnd:yr,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:xr,nolink:Lr,punctuation:cr,reflink:Er,reflinkSearch:Me("reflink|nolink(?!\\()","g").replace("reflink",Er).replace("nolink",Lr).getRegex(),tag:br,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:Fe},Tr={...kr,link:Me(/^!?\[(label)\]\((.*?)\)/).replace("label",wr).getRegex(),reflink:Me(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",wr).getRegex()},_r={...kr,emStrongRDelimAst:dr,emStrongLDelim:fr,url:Me(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Or={..._r,br:Me(nr).replace("{2,}","*").getRegex(),text:Me(_r.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Sr={normal:Qe,gfm:er,pedantic:rr},Ar={normal:kr,gfm:_r,breaks:Or,pedantic:Tr},Pr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ir=t=>Pr[t];function Nr(t,e){if(e){if(De.escapeTest.test(t))return t.replace(De.escapeReplace,Ir)}else if(De.escapeTestNoEncode.test(t))return t.replace(De.escapeReplaceNoEncode,Ir);return t}function jr(t){try{t=encodeURI(t).replace(De.percentDecode,"%")}catch{return null}return t}function Cr(t,e){const r=t.replace(De.findPipe,((t,e,r)=>{let n=!1,o=e;for(;--o>=0&&"\\"===r[o];)n=!n;return n?"|":" |"})).split(De.splitPipe);let n=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;n<r.length;n++)r[n]=r[n].trim().replace(De.slashPipe,"|");return r}function Rr(t,e,r){const n=t.length;if(0===n)return"";let o=0;for(;o<n;){if(t.charAt(n-o-1)!==e)break;o++}return t.slice(0,n-o)}function Gr(t,e,r,n,o){const i=e.href,a=e.title||null,c=t[1].replace(o.other.outputLinkReplace,"$1");if("!"!==t[0].charAt(0)){n.state.inLink=!0;const t={type:"link",raw:r,href:i,title:a,text:c,tokens:n.inlineTokens(c)};return n.state.inLink=!1,t}return{type:"image",raw:r,href:i,title:a,text:c}}class Fr{options;rules;lexer;constructor(t){this.options=t||Re}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:Rr(t,"\n")}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const t=e[0],r=function(t,e,r){const n=t.match(r.other.indentCodeCompensation);if(null===n)return e;const o=n[1];return e.split("\n").map((t=>{const e=t.match(r.other.beginningSpace);if(null===e)return t;const[n]=e;return n.length>=o.length?t.slice(o.length):t})).join("\n")}(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){const e=Rr(t,"#");this.options.pedantic?t=e.trim():e&&!this.rules.other.endingSpaceChar.test(e)||(t=e.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Rr(e[0],"\n")}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let t=Rr(e[0],"\n").split("\n"),r="",n="";const o=[];for(;t.length>0;){let e=!1;const i=[];let a;for(a=0;a<t.length;a++)if(this.rules.other.blockquoteStart.test(t[a]))i.push(t[a]),e=!0;else{if(e)break;i.push(t[a])}t=t.slice(a);const c=i.join("\n"),s=c.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}\n${c}`:c,n=n?`${n}\n${s}`:s;const u=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(s,o,!0),this.lexer.state.top=u,0===t.length)break;const l=o.at(-1);if("code"===l?.type)break;if("blockquote"===l?.type){const e=l,i=e.raw+"\n"+t.join("\n"),a=this.blockquote(i);o[o.length-1]=a,r=r.substring(0,r.length-e.raw.length)+a.raw,n=n.substring(0,n.length-e.text.length)+a.text;break}if("list"!==l?.type);else{const e=l,i=e.raw+"\n"+t.join("\n"),a=this.list(i);o[o.length-1]=a,r=r.substring(0,r.length-l.raw.length)+a.raw,n=n.substring(0,n.length-e.raw.length)+a.raw,t=i.substring(o.at(-1).raw.length).split("\n")}}return{type:"blockquote",raw:r,tokens:o,text:n}}}list(t){let e=this.rules.block.list.exec(t);if(e){let r=e[1].trim();const n=r.length>1,o={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");const i=this.rules.other.listItemRegex(r);let a=!1;for(;t;){let r=!1,n="",c="";if(!(e=i.exec(t)))break;if(this.rules.block.hr.test(t))break;n=e[0],t=t.substring(n.length);let s=e[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,(t=>" ".repeat(3*t.length))),u=t.split("\n",1)[0],l=!s.trim(),f=0;if(this.options.pedantic?(f=2,c=s.trimStart()):l?f=e[1].length+1:(f=e[2].search(this.rules.other.nonSpaceChar),f=f>4?1:f,c=s.slice(f),f+=e[1].length),l&&this.rules.other.blankLine.test(u)&&(n+=u+"\n",t=t.substring(u.length+1),r=!0),!r){const e=this.rules.other.nextBulletRegex(f),r=this.rules.other.hrRegex(f),o=this.rules.other.fencesBeginRegex(f),i=this.rules.other.headingBeginRegex(f),a=this.rules.other.htmlBeginRegex(f);for(;t;){const h=t.split("\n",1)[0];let p;if(u=h,this.options.pedantic?(u=u.replace(this.rules.other.listReplaceNesting,"  "),p=u):p=u.replace(this.rules.other.tabCharGlobal,"    "),o.test(u))break;if(i.test(u))break;if(a.test(u))break;if(e.test(u))break;if(r.test(u))break;if(p.search(this.rules.other.nonSpaceChar)>=f||!u.trim())c+="\n"+p.slice(f);else{if(l)break;if(s.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(o.test(s))break;if(i.test(s))break;if(r.test(s))break;c+="\n"+u}l||u.trim()||(l=!0),n+=h+"\n",t=t.substring(h.length+1),s=p.slice(f)}}o.loose||(a?o.loose=!0:this.rules.other.doubleBlankLine.test(n)&&(a=!0));let h,p=null;this.options.gfm&&(p=this.rules.other.listIsTask.exec(c),p&&(h="[ ] "!==p[0],c=c.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:n,task:!!p,checked:h,loose:!1,text:c,tokens:[]}),o.raw+=n}const c=o.items.at(-1);if(!c)return;c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd(),o.raw=o.raw.trimEnd();for(let t=0;t<o.items.length;t++)if(this.lexer.state.top=!1,o.items[t].tokens=this.lexer.blockTokens(o.items[t].text,[]),!o.loose){const e=o.items[t].tokens.filter((t=>"space"===t.type)),r=e.length>0&&e.some((t=>this.rules.other.anyLine.test(t.raw)));o.loose=r}if(o.loose)for(let t=0;t<o.items.length;t++)o.items[t].loose=!0;return o}}html(t){const e=this.rules.block.html.exec(t);if(e){return{type:"html",block:!0,raw:e[0],pre:"pre"===e[1]||"script"===e[1]||"style"===e[1],text:e[0]}}}def(t){const e=this.rules.block.def.exec(t);if(e){const t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:r,title:n}}}table(t){const e=this.rules.block.table.exec(t);if(!e)return;if(!this.rules.other.tableDelimiter.test(e[2]))return;const r=Cr(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],i={type:"table",raw:e[0],header:[],align:[],rows:[]};if(r.length===n.length){for(const t of n)this.rules.other.tableAlignRight.test(t)?i.align.push("right"):this.rules.other.tableAlignCenter.test(t)?i.align.push("center"):this.rules.other.tableAlignLeft.test(t)?i.align.push("left"):i.align.push(null);for(let t=0;t<r.length;t++)i.header.push({text:r[t],tokens:this.lexer.inline(r[t]),header:!0,align:i.align[t]});for(const t of o)i.rows.push(Cr(t,i.header.length).map(((t,e)=>({text:t,tokens:this.lexer.inline(t),header:!1,align:i.align[e]}))));return i}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:"="===e[2].charAt(0)?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const t="\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;const e=Rr(t.slice(0,-1),"\\");if((t.length-e.length)%2==0)return}else{const t=function(t,e){if(-1===t.indexOf(e[1]))return-1;let r=0;for(let n=0;n<t.length;n++)if("\\"===t[n])n++;else if(t[n]===e[0])r++;else if(t[n]===e[1]&&(r--,r<0))return n;return-1}(e[2],"()");if(t>-1){const r=(0===e[0].indexOf("!")?5:4)+e[1].length+t;e[2]=e[2].substring(0,t),e[0]=e[0].substring(0,r).trim(),e[3]=""}}let r=e[2],n="";if(this.options.pedantic){const t=this.rules.other.pedanticHrefTitle.exec(r);t&&(r=t[1],n=t[3])}else n=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(r=this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?r.slice(1):r.slice(1,-1)),Gr(e,{href:r?r.replace(this.rules.inline.anyPunctuation,"$1"):r,title:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n},e[0],this.lexer,this.rules)}}reflink(t,e){let r;if((r=this.rules.inline.reflink.exec(t))||(r=this.rules.inline.nolink.exec(t))){const t=e[(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!t){const t=r[0].charAt(0);return{type:"text",raw:t,text:t}}return Gr(r,t,r[0],this.lexer,this.rules)}}emStrong(t,e,r=""){let n=this.rules.inline.emStrongLDelim.exec(t);if(!n)return;if(n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))return;if(!(n[1]||n[2]||"")||!r||this.rules.inline.punctuation.exec(r)){const r=[...n[0]].length-1;let o,i,a=r,c=0;const s="*"===n[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(s.lastIndex=0,e=e.slice(-1*t.length+r);null!=(n=s.exec(e));){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(i=[...o].length,n[3]||n[4]){a+=i;continue}if((n[5]||n[6])&&r%3&&!((r+i)%3)){c+=i;continue}if(a-=i,a>0)continue;i=Math.min(i,i+a+c);const e=[...n[0]][0].length,s=t.slice(0,r+n.index+e+i);if(Math.min(r,i)%2){const t=s.slice(1,-1);return{type:"em",raw:s,text:t,tokens:this.lexer.inlineTokens(t)}}const u=s.slice(2,-2);return{type:"strong",raw:s,text:u,tokens:this.lexer.inlineTokens(u)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," ");const r=this.rules.other.nonSpaceChar.test(t),n=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return r&&n&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let t,r;return"@"===e[2]?(t=e[1],r="mailto:"+t):(t=e[1],r=t),{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let t,r;if("@"===e[2])t=e[0],r="mailto:"+t;else{let n;do{n=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??""}while(n!==e[0]);t=e[0],r="www."===e[1]?"http://"+e[0]:e[0]}return{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){const t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}}class Mr{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Re,this.options.tokenizer=this.options.tokenizer||new Fr,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={other:De,block:Sr.normal,inline:Ar.normal};this.options.pedantic?(e.block=Sr.pedantic,e.inline=Ar.pedantic):this.options.gfm&&(e.block=Sr.gfm,this.options.breaks?e.inline=Ar.breaks:e.inline=Ar.gfm),this.tokenizer.rules=e}static get rules(){return{block:Sr,inline:Ar}}static lex(t,e){return new Mr(e).lex(t)}static lexInline(t,e){return new Mr(e).inlineTokens(t)}lex(t){t=t.replace(De.carriageReturn,"\n"),this.blockTokens(t,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const e=this.inlineQueue[t];this.inlineTokens(e.src,e.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],r=!1){for(this.options.pedantic&&(t=t.replace(De.tabCharGlobal,"    ").replace(De.spaceLine,""));t;){let n;if(this.options.extensions?.block?.some((r=>!!(n=r.call({lexer:this},t,e))&&(t=t.substring(n.raw.length),e.push(n),!0))))continue;if(n=this.tokenizer.space(t)){t=t.substring(n.raw.length);const r=e.at(-1);1===n.raw.length&&void 0!==r?r.raw+="\n":e.push(n);continue}if(n=this.tokenizer.code(t)){t=t.substring(n.raw.length);const r=e.at(-1);"paragraph"===r?.type||"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.at(-1).src=r.text):e.push(n);continue}if(n=this.tokenizer.fences(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.heading(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.hr(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.blockquote(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.list(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.html(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.def(t)){t=t.substring(n.raw.length);const r=e.at(-1);"paragraph"===r?.type||"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.raw,this.inlineQueue.at(-1).src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.lheading(t)){t=t.substring(n.raw.length),e.push(n);continue}let o=t;if(this.options.extensions?.startBlock){let e=1/0;const r=t.slice(1);let n;this.options.extensions.startBlock.forEach((t=>{n=t.call({lexer:this},r),"number"==typeof n&&n>=0&&(e=Math.min(e,n))})),e<1/0&&e>=0&&(o=t.substring(0,e+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o))){const i=e.at(-1);r&&"paragraph"===i?.type?(i.raw+="\n"+n.raw,i.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):e.push(n),r=o.length!==t.length,t=t.substring(n.raw.length)}else if(n=this.tokenizer.text(t)){t=t.substring(n.raw.length);const r=e.at(-1);"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):e.push(n)}else if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(e);break}throw new Error(e)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){let r=t,n=null;if(this.tokens.links){const t=Object.keys(this.tokens.links);if(t.length>0)for(;null!=(n=this.tokenizer.rules.inline.reflinkSearch.exec(r));)t.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(n=this.tokenizer.rules.inline.blockSkip.exec(r));)r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(n=this.tokenizer.rules.inline.anyPunctuation.exec(r));)r=r.slice(0,n.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o=!1,i="";for(;t;){let n;if(o||(i=""),o=!1,this.options.extensions?.inline?.some((r=>!!(n=r.call({lexer:this},t,e))&&(t=t.substring(n.raw.length),e.push(n),!0))))continue;if(n=this.tokenizer.escape(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.tag(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.link(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(n.raw.length);const r=e.at(-1);"text"===n.type&&"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):e.push(n);continue}if(n=this.tokenizer.emStrong(t,r,i)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.codespan(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.br(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.del(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.autolink(t)){t=t.substring(n.raw.length),e.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(t))){t=t.substring(n.raw.length),e.push(n);continue}let a=t;if(this.options.extensions?.startInline){let e=1/0;const r=t.slice(1);let n;this.options.extensions.startInline.forEach((t=>{n=t.call({lexer:this},r),"number"==typeof n&&n>=0&&(e=Math.min(e,n))})),e<1/0&&e>=0&&(a=t.substring(0,e+1))}if(n=this.tokenizer.inlineText(a)){t=t.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(i=n.raw.slice(-1)),o=!0;const r=e.at(-1);"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):e.push(n)}else if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(e);break}throw new Error(e)}}return e}}class Dr{options;parser;constructor(t){this.options=t||Re}space(t){return""}code({text:t,lang:e,escaped:r}){const n=(e||"").match(De.notSpaceStart)?.[0],o=t.replace(De.endingNewline,"")+"\n";return n?'<pre><code class="language-'+Nr(n)+'">'+(r?o:Nr(o,!0))+"</code></pre>\n":"<pre><code>"+(r?o:Nr(o,!0))+"</code></pre>\n"}blockquote({tokens:t}){return`<blockquote>\n${this.parser.parse(t)}</blockquote>\n`}html({text:t}){return t}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>\n`}hr(t){return"<hr>\n"}list(t){const e=t.ordered,r=t.start;let n="";for(let e=0;e<t.items.length;e++){const r=t.items[e];n+=this.listitem(r)}const o=e?"ol":"ul";return"<"+o+(e&&1!==r?' start="'+r+'"':"")+">\n"+n+"</"+o+">\n"}listitem(t){let e="";if(t.task){const r=this.checkbox({checked:!!t.checked});t.loose?"paragraph"===t.tokens[0]?.type?(t.tokens[0].text=r+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&"text"===t.tokens[0].tokens[0].type&&(t.tokens[0].tokens[0].text=r+" "+Nr(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):e+=r+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>\n`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>\n`}table(t){let e="",r="";for(let e=0;e<t.header.length;e++)r+=this.tablecell(t.header[e]);e+=this.tablerow({text:r});let n="";for(let e=0;e<t.rows.length;e++){const o=t.rows[e];r="";for(let t=0;t<o.length;t++)r+=this.tablecell(o[t]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),"<table>\n<thead>\n"+e+"</thead>\n"+n+"</table>\n"}tablerow({text:t}){return`<tr>\n${t}</tr>\n`}tablecell(t){const e=this.parser.parseInline(t.tokens),r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>\n`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Nr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:r}){const n=this.parser.parseInline(r),o=jr(t);if(null===o)return n;let i='<a href="'+(t=o)+'"';return e&&(i+=' title="'+Nr(e)+'"'),i+=">"+n+"</a>",i}image({href:t,title:e,text:r}){const n=jr(t);if(null===n)return Nr(r);let o=`<img src="${t=n}" alt="${r}"`;return e&&(o+=` title="${Nr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Nr(t.text)}}class Hr{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}}class Ur{options;renderer;textRenderer;constructor(t){this.options=t||Re,this.options.renderer=this.options.renderer||new Dr,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Hr}static parse(t,e){return new Ur(e).parse(t)}static parseInline(t,e){return new Ur(e).parseInline(t)}parse(t,e=!0){let r="";for(let n=0;n<t.length;n++){const o=t[n];if(this.options.extensions?.renderers?.[o.type]){const t=o,e=this.options.extensions.renderers[t.type].call({parser:this},t);if(!1!==e||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(t.type)){r+=e||"";continue}}const i=o;switch(i.type){case"space":r+=this.renderer.space(i);continue;case"hr":r+=this.renderer.hr(i);continue;case"heading":r+=this.renderer.heading(i);continue;case"code":r+=this.renderer.code(i);continue;case"table":r+=this.renderer.table(i);continue;case"blockquote":r+=this.renderer.blockquote(i);continue;case"list":r+=this.renderer.list(i);continue;case"html":r+=this.renderer.html(i);continue;case"paragraph":r+=this.renderer.paragraph(i);continue;case"text":{let o=i,a=this.renderer.text(o);for(;n+1<t.length&&"text"===t[n+1].type;)o=t[++n],a+="\n"+this.renderer.text(o);r+=e?this.renderer.paragraph({type:"paragraph",raw:a,text:a,tokens:[{type:"text",raw:a,text:a,escaped:!0}]}):a;continue}default:{const t='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(t),"";throw new Error(t)}}}return r}parseInline(t,e=this.renderer){let r="";for(let n=0;n<t.length;n++){const o=t[n];if(this.options.extensions?.renderers?.[o.type]){const t=this.options.extensions.renderers[o.type].call({parser:this},o);if(!1!==t||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){r+=t||"";continue}}const i=o;switch(i.type){case"escape":case"text":r+=e.text(i);break;case"html":r+=e.html(i);break;case"link":r+=e.link(i);break;case"image":r+=e.image(i);break;case"strong":r+=e.strong(i);break;case"em":r+=e.em(i);break;case"codespan":r+=e.codespan(i);break;case"br":r+=e.br(i);break;case"del":r+=e.del(i);break;default:{const t='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(t),"";throw new Error(t)}}}return r}}class Br{options;block;constructor(t){this.options=t||Re}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?Mr.lex:Mr.lexInline}provideParser(){return this.block?Ur.parse:Ur.parseInline}}const $r=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Ur;Renderer=Dr;TextRenderer=Hr;Lexer=Mr;Tokenizer=Fr;Hooks=Br;constructor(...t){this.use(...t)}walkTokens(t,e){let r=[];for(const n of t)switch(r=r.concat(e.call(this,n)),n.type){case"table":{const t=n;for(const n of t.header)r=r.concat(this.walkTokens(n.tokens,e));for(const n of t.rows)for(const t of n)r=r.concat(this.walkTokens(t.tokens,e));break}case"list":{const t=n;r=r.concat(this.walkTokens(t.items,e));break}default:{const t=n;this.defaults.extensions?.childTokens?.[t.type]?this.defaults.extensions.childTokens[t.type].forEach((n=>{const o=t[n].flat(1/0);r=r.concat(this.walkTokens(o,e))})):t.tokens&&(r=r.concat(this.walkTokens(t.tokens,e)))}}return r}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach((t=>{const r={...t};if(r.async=this.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach((t=>{if(!t.name)throw new Error("extension name required");if("renderer"in t){const r=e.renderers[t.name];e.renderers[t.name]=r?function(...e){let n=t.renderer.apply(this,e);return!1===n&&(n=r.apply(this,e)),n}:t.renderer}if("tokenizer"in t){if(!t.level||"block"!==t.level&&"inline"!==t.level)throw new Error("extension level must be 'block' or 'inline'");const r=e[t.level];r?r.unshift(t.tokenizer):e[t.level]=[t.tokenizer],t.start&&("block"===t.level?e.startBlock?e.startBlock.push(t.start):e.startBlock=[t.start]:"inline"===t.level&&(e.startInline?e.startInline.push(t.start):e.startInline=[t.start]))}"childTokens"in t&&t.childTokens&&(e.childTokens[t.name]=t.childTokens)})),r.extensions=e),t.renderer){const e=this.defaults.renderer||new Dr(this.defaults);for(const r in t.renderer){if(!(r in e))throw new Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;const n=r,o=t.renderer[n],i=e[n];e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r||""}}r.renderer=e}if(t.tokenizer){const e=this.defaults.tokenizer||new Fr(this.defaults);for(const r in t.tokenizer){if(!(r in e))throw new Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;const n=r,o=t.tokenizer[n],i=e[n];e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r}}r.tokenizer=e}if(t.hooks){const e=this.defaults.hooks||new Br;for(const r in t.hooks){if(!(r in e))throw new Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;const n=r,o=t.hooks[n],i=e[n];Br.passThroughHooks.has(r)?e[n]=t=>{if(this.defaults.async)return Promise.resolve(o.call(e,t)).then((t=>i.call(e,t)));const r=o.call(e,t);return i.call(e,r)}:e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r}}r.hooks=e}if(t.walkTokens){const e=this.defaults.walkTokens,n=t.walkTokens;r.walkTokens=function(t){let r=[];return r.push(n.call(this,t)),e&&(r=r.concat(e.call(this,t))),r}}this.defaults={...this.defaults,...r}})),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Mr.lex(t,e??this.defaults)}parser(t,e){return Ur.parse(t,e??this.defaults)}parseMarkdown(t){return(e,r)=>{const n={...r},o={...this.defaults,...n},i=this.onError(!!o.silent,!!o.async);if(!0===this.defaults.async&&!1===n.async)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==e)return i(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof e)return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=t);const a=o.hooks?o.hooks.provideLexer():t?Mr.lex:Mr.lexInline,c=o.hooks?o.hooks.provideParser():t?Ur.parse:Ur.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(e):e).then((t=>a(t,o))).then((t=>o.hooks?o.hooks.processAllTokens(t):t)).then((t=>o.walkTokens?Promise.all(this.walkTokens(t,o.walkTokens)).then((()=>t)):t)).then((t=>c(t,o))).then((t=>o.hooks?o.hooks.postprocess(t):t)).catch(i);try{o.hooks&&(e=o.hooks.preprocess(e));let t=a(e,o);o.hooks&&(t=o.hooks.processAllTokens(t)),o.walkTokens&&this.walkTokens(t,o.walkTokens);let r=c(t,o);return o.hooks&&(r=o.hooks.postprocess(r)),r}catch(t){return i(t)}}}onError(t,e){return r=>{if(r.message+="\nPlease report this to https://github.com/markedjs/marked.",t){const t="<p>An error occurred:</p><pre>"+Nr(r.message+"",!0)+"</pre>";return e?Promise.resolve(t):t}if(e)return Promise.reject(r);throw r}}};function zr(t,e){return $r.parse(t,e)}zr.options=zr.setOptions=function(t){return $r.setOptions(t),zr.defaults=$r.defaults,Ge(zr.defaults),zr},zr.getDefaults=Ce,zr.defaults=Re,zr.use=function(...t){return $r.use(...t),zr.defaults=$r.defaults,Ge(zr.defaults),zr},zr.walkTokens=function(t,e){return $r.walkTokens(t,e)},zr.parseInline=$r.parseInline,zr.Parser=Ur,zr.parser=Ur.parse,zr.Renderer=Dr,zr.TextRenderer=Hr,zr.Lexer=Mr,zr.lexer=Mr.lex,zr.Tokenizer=Fr,zr.Hooks=Br,zr.parse=zr;zr.options,zr.setOptions,zr.use,zr.walkTokens,zr.parseInline,Ur.parse,Mr.lex;function Yr(t){return Yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yr(t)}function Xr(){Xr=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Yr(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Yr(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Wr(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function qr(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Wr(i,n,o,a,c,"next",t)}function c(t){Wr(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Vr(t){if(!t)return"";if("string"==typeof t)return t;if("string"==typeof t.message)return t.message;try{return JSON.stringify(t)}catch(t){return""}}function Kr(t,e,r,n){return Zr.apply(this,arguments)}function Zr(){return(Zr=qr(Xr().mark((function t(r,n,o,i){var a,c,s,u,l,f,h,p;return Xr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e().runtime.lastError){t.next=6;break}return c=e().runtime.lastError.message,te.translationResult.textContent=c,st(te.translationResult,c),re(te.translationResult),t.abrupt("return");case 6:if(null==r||!r.success||null===(a=r.data)||void 0===a||!a.translatedText){t.next=20;break}s=r.data.translatedText,te.translationResult.classList.remove("fade-in"),te.translationResult.offsetWidth,te.translationResult.innerHTML=zr.parse(s),te.translationResult.classList.add("fade-in"),st(te.translationResult,s),st(te.translationResult,r.data.translatedText),u=ie(o),l=ie(i),e().storage.local.set({lastTranslation:{sourceText:n,translatedText:r.data.translatedText,sourceLanguage:u||oe,targetLanguage:l}}).then((function(){Xt("[Translate]: Last translation saved to storage.")})).catch((function(t){console.error("[Translate]: Error saving last translation:",t)})),!r.data.detectedSourceLang||u!==oe&&u||(f=fe(r.data.detectedSourceLang))&&(te.sourceLanguageInput.value=f,ee(te.sourceLanguageInput,te.clearSourceLanguage),Xt("[Translate]: Source language updated to detected: ".concat(f))),t.next=31;break;case 20:return t.next=22,mt("popup_string_translate_error_response");case 22:if(t.t0=t.sent,t.t0){t.next=25;break}t.t0="(⚠️ خطایی در ترجمه رخ داد.)";case 25:h=t.t0,p=Vr(null==r?void 0:r.error)||h,te.translationResult.innerHTML="",te.translationResult.textContent=p,st(te.translationResult,p),Xt("[Translate-Popup] API error:",p);case 31:re(te.translationResult);case 32:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Jr(){return Qr.apply(this,arguments)}function Qr(){return(Qr=qr(Xr().mark((function t(){var r,n,o,i,a,c,s,u,l,f,h,p;return Xr().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=te.sourceText.value.trim(),n=te.targetLanguageInput.value.trim(),o=te.sourceLanguageInput.value.trim(),r){t.next=7;break}return te.sourceText.focus(),Xt("[Translate-Popup]: No text to translate."),t.abrupt("return");case 7:return st(te.sourceText,r),t.t0=ct,t.t1=te.translationResult,t.t2=dt,t.next=13,mt("IsRTL");case 13:if(t.t3=t.sent,t.t4=(0,t.t2)(t.t3),(0,t.t0)(t.t1,t.t4),n){t.next=21;break}return Xt("[Translate-Popup]: Missing target language identifier."),te.targetLanguageInput.focus(),ne(te.targetLanguageInput.parentElement,"error",500),t.abrupt("return");case 21:if((i=le(n))&&i!==oe){t.next=27;break}return Xt("[Translate-Popup]: Invalid target language selected:",n),te.targetLanguageInput.focus(),ne(te.targetLanguageInput.parentElement,"error",500),t.abrupt("return");case 27:return(a=le(o))&&a!==oe||(a=null),t.next=31,mt("popup_string_during_translate");case 31:if(t.t5=t.sent,t.t5){t.next=34;break}t.t5="translating...";case 34:return te.translationResult.textContent=t.t5,te.translationResult.innerHTML='\n<div class="spinner-overlay">\n  <div class="spinner-center">\n    <div class="spinner"></div>\n  </div>\n</div>\n',re(te.translationResult),c=["the","a","an","is","are","was","were","in","on","at","to","of","for","with","by","from"],s=r.trim().split(/\s+/),u=d.Popup_Translate,s.length<=2&&r.length<=30&&(1===s.length?(l=s[0].toLowerCase(),c.includes(l)||(u=d.Dictionary_Translation)):s.length>1&&(u=d.Dictionary_Translation)),t.prev=43,t.next=46,e().runtime.sendMessage({action:"fetchTranslation",payload:{promptText:r,sourceLanguage:a,targetLanguage:i,translateMode:u}});case 46:return f=t.sent,Xt("[Translate-Popup]: Response from background:",f),t.next=50,Kr(f,r,o,n);case 50:t.next=66;break;case 52:return t.prev=52,t.t6=t.catch(43),Xt("[Translate-Popup]: Error sending message to background:",t.t6),te.translationResult.innerHTML="",t.next=58,mt("popup_string_translate_error_trigger");case 58:if(t.t7=t.sent,t.t7){t.next=61;break}t.t7="(⚠️ خطایی در ترجمه پر پاپ‌آپ رخ داد.)";case 61:h=t.t7,p=Vr(t.t6)||h,te.translationResult.textContent=p,st(te.translationResult,p),re(te.translationResult);case 66:case"end":return t.stop()}}),t,null,[[43,52]])})))).apply(this,arguments)}function tn(){var t,e,r;null===(t=te.translationForm)||void 0===t||t.addEventListener("submit",(function(t){t.preventDefault(),Xt("[Translate-Popup]: Translation form submitted via button."),Jr()})),null===(e=te.sourceText)||void 0===e||e.addEventListener("keydown",(function(t){var e=t.ctrlKey||t.metaKey,r="Enter"===t.key,n="/"===t.key;e&&(r||n)&&(t.preventDefault(),Xt("[Translate-Popup]: Shortcut (".concat(t.ctrlKey?"Ctrl":"Cmd","+").concat(t.key,") triggered translation.")),Jr())})),null===(r=te.sourceText)||void 0===r||r.addEventListener("input",(function(){re(te.sourceText)})),Xt("[Translate-Popup]: Initialized.")}function en(t){return en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},en(t)}function rn(){rn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==en(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(en(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function nn(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function on(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,an(n.key),n)}}function an(t){var e=function(t,e){if("object"!=en(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=en(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==en(e)?e:e+""}var cn=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=e,this.errorHandler=r},e=[{key:"extractText",value:function(t){try{var e,r,n;return t?t.isContentEditable?(null===(n=t.innerText)||void 0===n?void 0:n.trim())||"":(null===(e=t.value)||void 0===e?void 0:e.trim())||(null===(r=t.textContent)||void 0===r?void 0:r.trim())||"":""}catch(t){var o;return null===(o=this.errorHandler)||void 0===o||o.handle(t,{type:Rt.UI,context:"platform-strategy-extractText"}),""}}},{key:"findField",value:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=t,o=0;o<r&&n;o++){var i=n.closest(e);if(i)return i;n=n.parentElement}return document.querySelector(e)}},{key:"validateField",value:function(t){return t&&t.isConnected&&(this.isInputElement(t)||t.hasAttribute("contenteditable"))}},{key:"applyVisualFeedback",value:(n=rn().mark((function t(e){var r,n;return rn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:try{r=e.style.backgroundColor,e.style.transition="background-color 0.5s ease",e.style.backgroundColor="#d4f8d4",requestAnimationFrame((function(){setTimeout((function(){e.style.backgroundColor=r}),300)}))}catch(t){null===(n=this.errorHandler)||void 0===n||n.handle(t,{type:Rt.UI,context:"platform-strategy-animation"})}case 3:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){nn(i,r,o,a,c,"next",t)}function c(t){nn(i,r,o,a,c,"throw",t)}a(void 0)}))},function(t){return o.apply(this,arguments)})},{key:"applyTextDirection",value:function(t,e){try{var r=p.RTL_REGEX.test(e);"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.setAttribute("dir",r?"rtl":"ltr"):(t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left")}catch(t){var n;throw null===(n=this.errorHandler)||void 0===n?void 0:n.handle(t,{type:Rt.UI,code:"text-direction-error",context:"platform-strategy-TextDirection"})}}},{key:"handleFieldError",value:function(t,e){var r={FIELD_NOT_FOUND:"لطفا روی فیلد متن ".concat(e," کلیک کنید"),CLIPBOARD_ERROR:"خطای دسترسی به کلیپبورد"};if(this.notifier&&this.notifier.show(r[t],"warning"),!this.errorHandler)throw new Error(t);this.errorHandler.handle(new Error(t),{type:Rt.UI,context:"platform-strategy-field-error"})}}],e&&on(t.prototype,e),r&&on(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o}();function sn(t){return sn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sn(t)}function un(){un=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==sn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(sn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ln(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function fn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ln(i,n,o,a,c,"next",t)}function c(t){ln(i,n,o,a,c,"throw",t)}a(void 0)}))}}function hn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,pn(n.key),n)}}function pn(t){var e=function(t,e){if("object"!=sn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=sn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==sn(e)?e:e+""}function dn(t,e,r){return e=vn(e),function(t,e){if(e&&("object"==sn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,yn()?Reflect.construct(e,r||[],vn(t).constructor):e.apply(t,r))}function yn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(yn=function(){return!!t})()}function vn(t){return vn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},vn(t)}function gn(t,e){return gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gn(t,e)}var mn=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=dn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gn(t,e)}(e,t),r=e,n=[{key:"isWhatsAppElement",value:function(t){return!!t.closest('[aria-label="Type a message"]')}},{key:"updateElement",value:(s=fn(un().mark((function t(e,r){var n;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=this.findField(e,'[role="textbox"], .copyable-text.selectable-text')){t.next=6;break}return Xt("فیلد واتساپ یافت نشد"),t.abrupt("return");case 6:if(("INPUT"===n.tagName||"TEXTAREA"===n.tagName||n.hasAttribute("contenteditable"))&&n.isConnected){t.next=10;break}return Xt("فیلد واتساپ نامعتبر است"),t.abrupt("return",!1);case 10:if(this.isWhatsAppElement(e)){t.next=13;break}return t.abrupt("return",!1);case 13:if(document.body.contains(e)){t.next=16;break}return Xt("Element removed from DOM"),t.abrupt("return",!1);case 16:return t.next=18,this.safeFocus(e);case 18:return this.applyVisualFeedback(n),t.next=21,this.selectAllContent(n);case 21:return t.next=23,this.simulatePaste(n,r);case 23:return this.triggerStateUpdate(n),t.abrupt("return",!0);case 27:return t.prev=27,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.PARSE_INPUT,context:"whatsapp-strategy-updateElement"}),t.abrupt("return",!1);case 31:case"end":return t.stop()}}),t,this,[[0,27]])}))),function(t,e){return s.apply(this,arguments)})},{key:"extractText",value:function(t){try{if(!t)return"";if(t.isContentEditable)return t.innerText.trim();if(t.value)return t.value.trim();if(t.textContent)return t.textContent.trim()}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"WhatsApp-strategy-extractText-fallback"})}return""}},{key:"safeFocus",value:(c=fn(un().mark((function t(e){return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.focus({preventScroll:!0}),t.next=3,$t(100);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=fn(un().mark((function t(e){var r,n;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=window.getSelection(),(n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n),t.next=8,$t(100);case 8:return t.abrupt("return",e);case 11:t.prev=11,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.PARSE_INPUT,context:"whatsapp-strategy-selectAllContent"});case 14:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=fn(un().mark((function t(e,r){var n,o,i,a;return un().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&null!=r){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n=(n=r.trim()).replace(/\n{2,}/g,"\n"),o=n.replace(/\n/g,"<br>"),(i=new DataTransfer).setData("text/plain",n),i.setData("text/html",o),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a),t.next=13,$t(50);case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.PARSE_INPUT,context:"whatsapp-strategy-simulatePaste"});case 18:case"end":return t.stop()}}),t,this,[[2,15]])}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&hn(r.prototype,n),o&&hn(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,s}(cn);function bn(t){return bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bn(t)}function wn(){wn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==bn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(bn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function xn(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function En(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){xn(i,n,o,a,c,"next",t)}function c(t){xn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Ln(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,kn(n.key),n)}}function kn(t){var e=function(t,e){if("object"!=bn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=bn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==bn(e)?e:e+""}function Tn(t,e,r){return e=On(e),function(t,e){if(e&&("object"==bn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,_n()?Reflect.construct(e,r||[],On(t).constructor):e.apply(t,r))}function _n(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_n=function(){return!!t})()}function On(t){return On=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},On(t)}function Sn(t,e){return Sn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Sn(t,e)}var An=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Tn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sn(t,e)}(e,t),r=e,n=[{key:"isDirectMessageInputField",value:function(t){return!(!t||!t.matches('div[role="textbox"][contenteditable="true"]'))}},{key:"updateElement",value:(l=En(wn().mark((function t(e,r){return wn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isDirectMessageInputField(e)){t.next=10;break}return t.next=4,this.clearContent(e);case 4:return t.next=6,this.pasteText(e,r);case 6:this.triggerStateUpdate(e),this.applyVisualFeedback(e),t.next=11;break;case 10:e.isContentEditable?(e.innerHTML=r,this.applyTextDirection(e,r),this.applyVisualFeedback(e)):(e.value=r,this.applyTextDirection(e,r),this.applyVisualFeedback(e));case 11:return t.abrupt("return",!0);case 14:return t.prev=14,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"instagram-strategy-updateElement"}),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t,this,[[0,14]])}))),function(t,e){return l.apply(this,arguments)})},{key:"clearContent",value:(u=En(wn().mark((function t(e){return wn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.safeFocus(e);case 5:return t.next=7,this.selectAllContent(e);case 7:return t.next=9,this.simulatePaste(e,"");case 9:return t.next=11,$t(50);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"instagram-strategy-clearContent"});case 16:case"end":return t.stop()}}),t,this,[[2,13]])}))),function(t){return u.apply(this,arguments)})},{key:"pasteText",value:(s=En(wn().mark((function t(e,r){var n,o;return wn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=10,$t(50);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"instagram-strategy-pasteText"});case 15:case"end":return t.stop()}}),t,this,[[2,12]])}))),function(t,e){return s.apply(this,arguments)})},{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t?null!=t&&t.isContentEditable?(null==t||null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":"INPUT"===(null==t?void 0:t.tagName)||"TEXTAREA"===(null==t?void 0:t.tagName)?(null==t||null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null==t||null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":""}catch(t){return this.errorHandler.handle(t,{type:Rt.UI,context:"instagram-strategy-extractText"}),""}}},{key:"safeFocus",value:(c=En(wn().mark((function t(e){return wn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.focus({preventScroll:!0}),t.next=4,$t(100);case 4:return t.abrupt("return",e);case 7:t.prev=7,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"instagram-strategy-safeFocus"});case 10:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=En(wn().mark((function t(e){var r,n;return wn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=window.getSelection(),(n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n),t.next=8,$t(100);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"instagram-strategy-selectAllContent"});case 13:return t.abrupt("return",e);case 14:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=En(wn().mark((function t(e,r){var n,o;return wn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=7,$t(50);case 7:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&Ln(r.prototype,n),o&&Ln(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,s,u,l}(cn);function Pn(t){return Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pn(t)}function In(){In=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Pn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Pn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Nn(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function jn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Nn(i,n,o,a,c,"next",t)}function c(t){Nn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Cn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rn(n.key),n)}}function Rn(t){var e=function(t,e){if("object"!=Pn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Pn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Pn(e)?e:e+""}function Gn(t,e,r){return e=Mn(e),function(t,e){if(e&&("object"==Pn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Fn()?Reflect.construct(e,r||[],Mn(t).constructor):e.apply(t,r))}function Fn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Fn=function(){return!!t})()}function Mn(t){return Mn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mn(t)}function Dn(t,e){return Dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Dn(t,e)}var Hn=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Gn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Dn(t,e)}(e,t),r=e,n=[{key:"isTwitterElement",value:function(t){if(!(t&&t instanceof Element))return!1;try{return!!t.closest('[data-testid="tweetTextarea_0"], [data-testid="tweetTextarea"]')}catch(t){return!1}}},{key:"isDMElement",value:function(t){if(!(t&&t instanceof Element))return!1;try{return!!t.closest('[data-testid="dmComposerTextInput"], [role="textbox"][aria-label="Text message"]')}catch(t){return!1}}},{key:"clearTweetField",value:function(t){if(t)try{t.focus();var e=window.getSelection();if(!(e.toString().length>0)){var r=document.createRange();r.selectNodeContents(t),e.removeAllRanges(),e.addRange(r)}var n=new DataTransfer;n.setData("text/plain","");var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n});t.dispatchEvent(o)}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"twitter-strategy-clearTweetField"})}}},{key:"pasteText_OLD",value:(c=jn(In().mark((function t(e,r){var n,o,i,a;return In().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,r&&"string"==typeof r){for(n=r.split("\n");n.length>0&&""===n[n.length-1].trim();)n.pop();o=n.join("\n"),(i=new DataTransfer).setData("text/plain",o),i.setData("text/html",o.replace(/\n/g,"<br>")),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a)}t.next=10;break;case 6:throw t.prev=6,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"twitter-strategy-pasteText"});case 10:case"end":return t.stop()}}),t,this,[[2,6]])}))),function(t,e){return c.apply(this,arguments)})},{key:"pasteText",value:(a=jn(In().mark((function t(e,r){var n,o,i,a,c,s;return In().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,!r||"string"!=typeof r){t.next=22;break}return n=r.split("\n").filter((function(t){return""!==t.trim()})),o=n.join("\n"),e.focus(),t.next=9,$t(20);case 9:(i=document.createRange()).selectNodeContents(e),i.collapse(!1),(a=window.getSelection()).removeAllRanges(),a.addRange(i),(c=new DataTransfer).setData("text/plain",o),c.setData("text/html",o.replace(/\n/g,"<br>")),s=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:c}),e.dispatchEvent(s)&&""!==e.innerText.trim()||(e.innerText=o,e.dispatchEvent(new Event("beforeinput",{bubbles:!0})),e.dispatchEvent(new Event("input",{bubbles:!0}))),this.setCursorToEnd(e);case 22:t.next=28;break;case 24:throw t.prev=24,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"twitter-strategy-pasteText"});case 28:case"end":return t.stop()}}),t,this,[[2,24]])}))),function(t,e){return a.apply(this,arguments)})},{key:"setCursorToEnd",value:function(t){if(t)try{var e=window.getSelection(),r=document.createRange();r.selectNodeContents(t),r.collapse(!1),e.removeAllRanges(),e.addRange(r)}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"twitter-strategy-setCursorToEnd"})}}},{key:"isInputElement",value:function(t){return!!t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName)}},{key:"updateElement",value:(i=jn(In().mark((function t(e,r){var n,o,i,a,c,s;return In().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=document.querySelector('[data-testid="SearchBox_Search_Input"]'))){t.next=11;break}o=!1;try{e&&"function"==typeof e.contains&&(o=e.contains(n))}catch(t){}if(!this.validateField(n)||e!==n&&!o&&document.activeElement!==n){t.next=11;break}return this.applyVisualFeedback(n),n.value=r,n.dispatchEvent(new Event("input",{bubbles:!0})),this.applyTextDirection(n,r),t.abrupt("return",!0);case 11:if(i=!1,e&&(i=this.isDMElement(e)),a=this.isDMElement(document.activeElement),!i&&!a){t.next=31;break}if(c=null,!(c=this.findField(e||document.activeElement,'[data-testid="dmComposerTextInput"]'))){t.next=31;break}try{window.getSelection().removeAllRanges()}catch(t){Xt("[DEBUG] updateElement - Error removing selection ranges:",t)}return c.focus(),this.applyVisualFeedback(c),this.clearTweetField(c),t.next=25,$t(50);case 25:return this.pasteText(c,r),this.applyTextDirection(c,r),t.next=29,$t(100);case 29:return this.setCursorToEnd(c),t.abrupt("return",!0);case 31:return t.abrupt("return",!1);case 46:return this.pasteText(s,r),this.applyTextDirection(s,r),t.next=50,$t(100);case 50:this.setCursorToEnd(s);case 51:t.next=58;break;case 53:return t.prev=53,t.t0=t.catch(0),Xt("[DEBUG] Critical error in updateElement:",t.t0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"twitter-strategy-updateElement"}),t.abrupt("return",!1);case 58:case"end":return t.stop()}}),t,this,[[0,53]])}))),function(t,e){return i.apply(this,arguments)})},{key:"extractText",value:function(t){var e=document.querySelector('[data-testid="SearchBox_Search_Input"]');if(e){var r=!1;if(t&&"function"==typeof t.contains&&(r=t.contains(e)),this.validateField(e)&&(t===e||document.activeElement===e||r))return e.value.trim()}var n,o=!1;if(t&&(o=this.isDMElement(t)),n=this.isDMElement(document.activeElement),o||n){var i=null;if(i=this.findField(t||document.activeElement,'[data-testid="dmComposerTextInput"]')){var a="";if("DIV"===i.tagName){var c=i.querySelector('[data-contents="true"]');a=c?Array.from(c.querySelectorAll(":scope > div")).map((function(t){return t.textContent})).join("\n").trim():i.textContent.trim()}else a=(i.value||"").trim();return a}}var s,u=null;s=this.isTwitterElement(document.activeElement);var l=!1;if(t&&(l=this.isTwitterElement(t)),!(u=s?document.activeElement:l?t:this.findField(t||document.body,'[data-testid="tweetTextarea_0"], [data-testid="tweetTextarea"]')))return"";var f="";if("DIV"===u.tagName){var h=u.querySelector('[data-contents="true"]');f=h?Array.from(h.querySelectorAll(":scope > div")).map((function(t){return t.textContent})).join("\n").trim():u.textContent.trim()}else f=(u.value||"").trim();return f}},{key:"validateField",value:function(t){try{return!!t&&t instanceof Element}catch(t){return!1}}},{key:"findField",value:function(t,e){if(!t)return null;try{return t.matches&&t.matches(e)?t:"function"==typeof t.querySelector?t.querySelector(e):document.querySelector(e)}catch(t){return null}}}],n&&Cn(r.prototype,n),o&&Cn(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c}(cn);function Un(t){return Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Un(t)}function Bn(){Bn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Un(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Un(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function $n(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function zn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){$n(i,n,o,a,c,"next",t)}function c(t){$n(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Yn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Xn(n.key),n)}}function Xn(t){var e=function(t,e){if("object"!=Un(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Un(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Un(e)?e:e+""}function Wn(t,e,r){return e=Vn(e),function(t,e){if(e&&("object"==Un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,qn()?Reflect.construct(e,r||[],Vn(t).constructor):e.apply(t,r))}function qn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(qn=function(){return!!t})()}function Vn(t){return Vn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Vn(t)}function Kn(t,e){return Kn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kn(t,e)}var Zn=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Wn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kn(t,e)}(e,t),r=e,n=[{key:"isInputField",value:function(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName}},{key:"isContentEditable",value:function(t){return t.isContentEditable}},{key:"getTelegramField",value:function(t){if(t)try{if(this.isInputField(t)||this.isContentEditable(t))return t;var e=t.closest('[aria-label="Message input"]')||t.closest(".composer_rich_textarea")||t.closest(".public_DraftEditor-content");if(!e){var r=document.querySelectorAll('[contenteditable="true"]');e=1===r.length?r[0]:null}if(e&&!this.isContentEditable(e)){var n=e.querySelector('[contenteditable="true"]');n&&(e=n)}return e}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"telegram-strategy-getTelegramField"})}}},{key:"clearField",value:(u=zn(Bn().mark((function t(e){var r,n,o,i;return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}return t.abrupt("return");case 3:if(!this.isInputField(e)){t.next=7;break}e.value="",t.next=18;break;case 7:return(r=window.getSelection())&&((n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n)),t.next=11,$t(50);case 11:return e.innerHTML="",(o=new DataTransfer).setData("text/plain",""),i=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:o}),t.next=17,$t(50);case 17:e.dispatchEvent(i);case 18:t.next=23;break;case 20:t.prev=20,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"telegram-strategy-Clearfield"});case 23:case"end":return t.stop()}}),t,this,[[0,20]])}))),function(t){return u.apply(this,arguments)})},{key:"pasteText",value:function(t,e){try{if(!t)return;if(null!=e){var r=new DataTransfer;r.setData("text/plain",e);var n=e.replace(/\n/g,"<br>");r.setData("text/html",n);var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:r});t.dispatchEvent(o)}}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"telegram-strategy-pasteText"})}}},{key:"setCursorToEnd",value:function(t){try{if(!t)return;if(this.isInputField(t)){var e=t.value.length;t.setSelectionRange(e,e)}else{var r=window.getSelection(),n=document.createRange();n.selectNodeContents(t),n.collapse(!1),r.removeAllRanges(),r.addRange(n)}}catch(t){this.errorHandler.handle(t,{type:Rt.SERVICE,context:"telegram-strategy-setCursorToEnd"})}}},{key:"updateElement",value:(s=zn(Bn().mark((function t(e,r){var n,o;return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return",!1);case 2:if(e){t.next=4;break}return t.abrupt("return",!1);case 4:return n='[aria-label="Message input"], .composer_rich_textarea, .public_DraftEditor-content, [contenteditable="true"]',t.prev=5,t.next=8,$t(100);case 8:if(o=this.findField(e,n)||this.getTelegramField(e)||document.querySelector(n),this.validateField(o)){t.next=12;break}return Xt("فیلد تلگرام یافت نشد"),t.abrupt("return",!1);case 12:if(e===o||o.contains(e)){t.next=14;break}return t.abrupt("return",!1);case 14:return t.next=16,this.safeFocus(o);case 16:if(this.applyVisualFeedback(document.getElementById("message-input-text")),!this.isInputField(o)){t.next=23;break}o.value=r,o.setAttribute("dir",p.RTL_REGEX.test(r)?"rtl":"ltr"),o.dispatchEvent(new Event("input",{bubbles:!0})),t.next=26;break;case 23:return t.next=25,this.clearField(o);case 25:this.pasteText(o,r);case 26:return this.setCursorToEnd(o),t.abrupt("return",!0);case 30:return t.prev=30,t.t0=t.catch(5),this.errorHandler.handle(t.t0,{type:Rt.SERVICE,context:"telegram-strategy-updateElement"}),t.abrupt("return",!1);case 34:case"end":return t.stop()}}),t,this,[[5,30]])}))),function(t,e){return s.apply(this,arguments)})},{key:"extractText",value:function(t){try{if(!t)return"";if(t.isContentEditable)return t.innerText.trim();if(t.value)return t.value.trim();if(t.textContent)return t.textContent.trim()}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"Telegram-strategy-extractText-fallback"})}return""}},{key:"validateField",value:function(t){var e=null==t?void 0:t.querySelector('[contenteditable="true"]');return t&&t.isConnected&&(this.isInputField(t)||this.isContentEditable(t)||e)}},{key:"safeFocus",value:(c=zn(Bn().mark((function t(e){return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.focus({preventScroll:!0}),t.next=6,$t(100);case 6:return t.abrupt("return",e);case 9:t.prev=9,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"telegram-strategy-safeFocus"});case 12:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=zn(Bn().mark((function t(e){return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,document.execCommand("selectAll"),t.next=6,$t(100);case 6:return t.abrupt("return",e);case 9:t.prev=9,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"telegram-strategy-SelectAllContent"});case 12:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=zn(Bn().mark((function t(e,r){var n,o,i,a;return Bn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&null!=r){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n=(n=r.trim()).replace(/\n{2,}/g,"\n"),o=n.replace(/\n/g,"<br>"),(i=new DataTransfer).setData("text/plain",n),i.setData("text/html",o),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a),t.next=13,$t(50);case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"telegram-strategy-simulatePaste"});case 18:case"end":return t.stop()}}),t,this,[[2,15]])}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&Yn(r.prototype,n),o&&Yn(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,s,u}(cn);function Jn(t){return Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jn(t)}function Qn(){Qn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Jn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Jn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function to(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function eo(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){to(i,n,o,a,c,"next",t)}function c(t){to(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ro(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,no(n.key),n)}}function no(t){var e=function(t,e){if("object"!=Jn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Jn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Jn(e)?e:e+""}function oo(t,e,r){return e=ao(e),function(t,e){if(e&&("object"==Jn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,io()?Reflect.construct(e,r||[],ao(t).constructor):e.apply(t,r))}function io(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(io=function(){return!!t})()}function ao(t){return ao=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ao(t)}function co(t,e){return co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},co(t,e)}var so=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=oo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&co(t,e)}(e,t),r=e,n=[{key:"shouldShowDefaultIcon",value:function(){return!0}},{key:"isMediumElement",value:function(t){return!(!t.closest('[role="textbox"]')&&!t.closest('[data-testid="editor-container"]'))}},{key:"updateElement",value:(s=eo(Qn().mark((function t(e,r){var n;return Qn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName){t.next=5;break}return e.value=r,e.dispatchEvent(new Event("input",{bubbles:!0})),this.applyVisualFeedback(e),t.abrupt("return",!0);case 5:return t.abrupt("return",!1);case 11:return this.safeFocus(n),t.prev=12,t.next=15,navigator.clipboard.writeText(r);case 15:Xt("MediumStrategy: clipboard write SUCCESS for:",r.substring(0,20)+"..."),this.notifier.show("✅ ترجمه در حافظه کپی شد. (Ctrl+V)","success",!0,3e3),this.applyVisualFeedback(n),t.next=23;break;case 20:t.prev=20,t.t0=t.catch(12),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"medium-strategy-updateElement"});case 23:case"end":return t.stop()}}),t,this,[[12,20]])}))),function(t,e){return s.apply(this,arguments)})},{key:"extractText",value:function(t){try{var e,r,n,o;if(!t)return"";if("INPUT"===t.tagName||"TEXTAREA"===t.tagName)return(null==t||null===(n=t.value)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"";var i=this.findMediumTextField(t);return(null==i||null===(e=i.innerText)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||""}catch(t){return this.errorHandler.handle(t,{type:Rt.UI,context:"medium-strategy-extractText"}),""}}},{key:"safeFocus",value:(c=eo(Qn().mark((function t(e){return Qn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e.isConnected){t.next=4;break}return console.warn("Element not in DOM:",e),t.abrupt("return",null);case 4:return e.focus({preventScroll:!0}),t.next=7,$t(150);case 7:if(document.activeElement===e){t.next=12;break}return console.warn("Focus failed, retrying..."),e.focus({preventScroll:!0}),t.next=12,$t(100);case 12:return t.abrupt("return",e);case 15:t.prev=15,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"medium-strategy-safeFocus"});case 18:case"end":return t.stop()}}),t,this,[[0,15]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=eo(Qn().mark((function t(e){return Qn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return document.execCommand("selectAll"),t.next=3,$t(100);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=eo(Qn().mark((function t(e,r){var n,o;return Qn().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=7,$t(50);case 7:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"findMediumTextField",value:function(t){for(var e=t,r=0;r<5&&e;r++){var n=e.closest('[role="textbox"][contenteditable="true"], [data-testid="editor-container"]');if(n)return n;e=e.parentElement}return document.querySelector('[role="textbox"][contenteditable="true"], [data-testid="editor-container"]')}},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&ro(r.prototype,n),o&&ro(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,s}(cn),uo=function(t){try{if(null==t||!t.isConnected)return;if(t.focus(),"INPUT"===t.tagName||"TEXTAREA"===t.tagName)t.selectionStart=t.selectionEnd=t.value.length;else if(t.isContentEditable){var e=document.createRange(),r=window.getSelection();e.selectNodeContents(t),e.collapse(!1),r.removeAllRanges(),r.addRange(e)}t.scrollTop=t.scrollHeight}catch(t){throw errorHandler.handle(t,{type:ErrorTypes.UI,context:"helpers-setCursorToEnd"})}};function lo(t){return lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lo(t)}function fo(){fo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==lo(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(lo(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ho(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function po(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,yo(n.key),n)}}function yo(t){var e=function(t,e){if("object"!=lo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=lo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==lo(e)?e:e+""}function vo(t,e,r){return e=mo(e),function(t,e){if(e&&("object"==lo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,go()?Reflect.construct(e,r||[],mo(t).constructor):e.apply(t,r))}function go(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(go=function(){return!!t})()}function mo(t){return mo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},mo(t)}function bo(t,e){return bo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},bo(t,e)}var wo=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=vo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bo(t,e)}(e,t),r=e,n=[{key:"isChatGPTElement",value:function(t){return"prompt-textarea"===t.id}},{key:"extractText",value:function(t){try{if(document.querySelector(".absolute .inset-0"))return"";var e=t;if(e&&this.isChatGPTElement(e)||(e=document.querySelector("#prompt-textarea")),!e)throw new Error("عنصر ChatGPT برای استخراج متن شناسایی نشد.");return Array.from(e.querySelectorAll("p")).map((function(t){return t.textContent.trim()})).join("\n")}catch(t){return this.errorHandler.handle(t,{type:Rt.UI,context:"chatgpt-strategy-extractText"}),""}}},{key:"updateElement",value:(i=fo().mark((function t(e,r){return fo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!document.querySelector(".absolute .inset-0")){t.next=4;break}return t.abrupt("return",!1);case 4:return e.innerHTML=r.replace(/\n/g,"<br>"),this.applyBaseStyling(e,r),uo(e),this.applyVisualFeedback(e),t.abrupt("return",!0);case 11:return t.prev=11,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"chatgpt-strategy-updateElement"}),t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})),a=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=i.apply(t,e);function a(t){ho(o,r,n,a,c,"next",t)}function c(t){ho(o,r,n,a,c,"throw",t)}a(void 0)}))},function(t,e){return a.apply(this,arguments)})},{key:"applyBaseStyling",value:function(t,e){var r=p.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}],n&&po(r.prototype,n),o&&po(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(cn);function xo(t){return xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xo(t)}function Eo(){Eo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==xo(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(xo(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Lo(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ko(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Lo(i,n,o,a,c,"next",t)}function c(t){Lo(i,n,o,a,c,"throw",t)}a(void 0)}))}}function To(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_o(n.key),n)}}function _o(t){var e=function(t,e){if("object"!=xo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=xo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==xo(e)?e:e+""}function Oo(t,e,r){return e=Ao(e),function(t,e){if(e&&("object"==xo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,So()?Reflect.construct(e,r||[],Ao(t).constructor):e.apply(t,r))}function So(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(So=function(){return!!t})()}function Ao(t){return Ao=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ao(t)}function Po(t,e){return Po=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Po(t,e)}var Io=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Oo(this,e,[t,r])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Po(t,e)}(e,t),r=e,n=[{key:"isYoutube_ExtraField",value:function(t){return!(!t||"INPUT"!==t.tagName||"search_query"!==t.getAttribute("name")&&"end"!==t.getAttribute("id"))}},{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t?null!=t&&t.isContentEditable?(null==t||null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":null==t||!t.tagName||"TEXTAREA"!==t.tagName&&"INPUT"!==t.tagName?(null==t||null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":(null==t||null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":""}catch(t){return this.errorHandler.handle(t,{type:Rt.UI,context:"youtube-strategy-extractText"}),""}try{var c,s,u,l;return t&&t.isConnected?t.isContentEditable?(null===(u=t.innerText)||void 0===u||null===(l=u.trim)||void 0===l?void 0:l.call(u))||"":t.value||(null===(c=t.textContent)||void 0===c||null===(s=c.trim)||void 0===s?void 0:s.call(c))||"":""}catch(e){return this.errorHandler.handle(e,{type:Rt.UI,context:"youtube-strategy-extractText",element:null==t?void 0:t.tagName}),""}}},{key:"updateElement",value:(a=ko(Eo().mark((function t(e,r){var n;return Eo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.isConnected){t.next=4;break}return Xt("عنصر معتبر برای به‌روزرسانی وجود ندارد"),t.abrupt("return",!1);case 4:return null!=r&&(e.isContentEditable?(n=r.replace(/\n/g,"<br>"),e.innerHTML=n,this.applyVisualFeedback(e),this.applyTextDirection(e,n)):(e.value=r,this.applyVisualFeedback(e),this.applyTextDirection(e,r))),t.abrupt("return",!0);case 8:return t.prev=8,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"youtube-strategy-updateElement",element:null==e?void 0:e.tagName}),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(t,e){return a.apply(this,arguments)})},{key:"clearContent",value:(i=ko(Eo().mark((function t(e){return Eo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.isConnected){t.next=3;break}return t.abrupt("return");case 3:"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value="":e.innerHTML="",this.applyVisualFeedback(e),t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"youtube-strategy-clearContent",element:null==e?void 0:e.tagName});case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return i.apply(this,arguments)})}],n&&To(r.prototype,n),o&&To(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(cn);function No(t){return No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},No(t)}function jo(){jo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==No(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(No(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Co(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Ro(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Go(n.key),n)}}function Go(t){var e=function(t,e){if("object"!=No(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=No(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==No(e)?e:e+""}function Fo(t,e,r){return e=Do(e),function(t,e){if(e&&("object"==No(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Mo()?Reflect.construct(e,r||[],Do(t).constructor):e.apply(t,r))}function Mo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Mo=function(){return!!t})()}function Do(t){return Do=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Do(t)}function Ho(t,e){return Ho=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ho(t,e)}var Uo=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Fo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ho(t,e)}(e,t),r=e,n=[{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t&&t instanceof Element?t.isContentEditable?(null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":["TEXTAREA","INPUT"].includes(t.tagName)?(null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":""}catch(t){return this.errorHandler.handle(t,{type:Rt.UI,context:"default-strategy-extractText"}),""}}},{key:"updateElement",value:(i=jo().mark((function t(e,r){var n;return jo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,null==r){t.next=4;break}return e.isContentEditable?(n=r.replace(/\n/g,"<br>"),e.innerHTML=n,this.applyVisualFeedback(e),this.applyTextDirection(e,n)):(e.value=r,this.applyVisualFeedback(e),this.applyTextDirection(e,r)),t.abrupt("return",!0);case 4:t.next=10;break;case 6:return t.prev=6,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"default-strategy-updateElement"}),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this,[[0,6]])})),a=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=i.apply(t,e);function a(t){Co(o,r,n,a,c,"next",t)}function c(t){Co(o,r,n,a,c,"throw",t)}a(void 0)}))},function(t,e){return a.apply(this,arguments)})},{key:"clearContent",value:function(t){if(t)try{"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value="":t.innerHTML=""}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"default-strategy-clearContent"})}}}],n&&Ro(r.prototype,n),o&&Ro(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(cn);function Bo(t){return Bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bo(t)}function $o(){$o=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Bo(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Bo(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function zo(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Yo(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){zo(i,n,o,a,c,"next",t)}function c(t){zo(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Xo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Wo(n.key),n)}}function Wo(t){var e=function(t,e){if("object"!=Bo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Bo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Bo(e)?e:e+""}function qo(t,e,r){return e=Ko(e),function(t,e){if(e&&("object"==Bo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Vo()?Reflect.construct(e,r||[],Ko(t).constructor):e.apply(t,r))}function Vo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Vo=function(){return!!t})()}function Ko(t){return Ko=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ko(t)}function Zo(t,e){return Zo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Zo(t,e)}var Jo=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=qo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zo(t,e)}(e,t),r=e,n=[{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t&&t instanceof HTMLElement?t.isContentEditable?(null===(i=t.innerText)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null===(e=t.value)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||(null===(n=t.textContent)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":""}catch(t){return this.errorHandler.handle(t,{type:Rt.UI,context:"discord-strategy-extractText"}),""}}},{key:"updateElement",value:(a=Yo($o().mark((function t(e,r){return $o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!document.querySelector(".keyboardShortcutsModal_f061f6")){t.next=4;break}return t.abrupt("return",!1);case 4:if(null==r){t.next=25;break}if(!e.isContentEditable){t.next=16;break}return e.focus(),e.value=r,this.applyVisualFeedback(e),this.clearField(e),t.next=12,$t(200);case 12:this.pasteText(e,r),this.applyTextDirection(e,r),t.next=24;break;case 16:return e.focus(),e.value=r,this.applyVisualFeedback(e),this.clearField(e),t.next=22,$t(200);case 22:this.pasteText(e,r),this.applyTextDirection(e,r);case 24:return t.abrupt("return",!0);case 25:t.next=31;break;case 27:return t.prev=27,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"Discord-strategy-updateElement"}),t.abrupt("return",!1);case 31:case"end":return t.stop()}}),t,this,[[0,27]])}))),function(t,e){return a.apply(this,arguments)})},{key:"clearField",value:function(t){if(t)try{t.focus();var e=window.getSelection();if(!(e.toString().length>0)){var r=document.createRange();r.selectNodeContents(t),e.removeAllRanges(),e.addRange(r)}var n=new DataTransfer;n.setData("text/plain","");var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n});t.dispatchEvent(o)}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"Discord-strategy-clearField"})}}},{key:"pasteText",value:(i=Yo($o().mark((function t(e,r){var n,o,i,a,c,s,u=this;return $o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&r&&"string"==typeof r){t.next=2;break}return t.abrupt("return");case 2:for(t.prev=2,n=r.split("\n");n.length>0&&""===n[n.length-1].trim();)n.pop();if(o=n.join("\n"),!navigator.clipboard||!navigator.clipboard.writeText){t.next=18;break}return i=window.getSelection(),a=i.getRangeAt(0).cloneRange(),t.next=11,navigator.clipboard.writeText(o);case 11:if(e.focus(),i.removeAllRanges(),i.addRange(a),!document.execCommand("paste")){t.next=16;break}return t.abrupt("return");case 16:return this.simulateInputInsertion(e,o),t.abrupt("return");case 18:(c=new DataTransfer).setData("text/plain",o),c.setData("text/html",o.replace(/\n/g,"<br>")),s=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:c}),e.focus(),e.dispatchEvent(s),setTimeout((function(){u.simulateInputInsertion(e,o)}),100),t.next=31;break;case 27:throw t.prev=27,t.t0=t.catch(2),this.errorHandler.handle(t.t0,{type:Rt.UI,context:"Discord-strategy-pasteText"});case 31:case"end":return t.stop()}}),t,this,[[2,27]])}))),function(t,e){return i.apply(this,arguments)})},{key:"simulateInputInsertion",value:function(t,e){try{if(document.execCommand("insertText",!1,e))return}catch(t){}if("INPUT"===t.tagName||"TEXTAREA"===t.tagName){var r=t.selectionStart||0,n=t.selectionEnd||0,o=t.value.substring(0,r),i=t.value.substring(n);return t.value=o+e+i,t.selectionStart=t.selectionEnd=r+e.length,void t.dispatchEvent(new Event("input",{bubbles:!0}))}if(t.isContentEditable){var a=window.getSelection(),c=a.getRangeAt(0);c.deleteContents();var s=document.createTextNode(e);c.insertNode(s),c.setStartAfter(s),c.setEndAfter(s),a.removeAllRanges(),a.addRange(c),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0}))}}}],n&&Xo(r.prototype,n),o&&Xo(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(cn);function Qo(t){return Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qo(t)}function ti(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ei(n.key),n)}}function ei(t){var e=function(t,e){if("object"!=Qo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Qo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Qo(e)?e:e+""}var ri,ni=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errorHandler=e},(r=[{key:"cleanup",value:function(){y.highlightedElement&&(y.highlightedElement.style.outline="",y.highlightedElement.style.opacity="",y.highlightedElement=null),document.querySelectorAll(".AIWritingCompanion-translation-icon-extension").forEach((function(t){t.classList.add("fade-out"),setTimeout((function(){t.remove()}),50)})),y.activeTranslateIcon=null}},{key:"applyTextDirection",value:function(t,e){if(t&&t.style){var r=p.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}},{key:"createTranslateIcon",value:function(t){try{if(null==t||!t.isConnected)return void Xt("المان هدف برای ایجاد آیکون معتبر نیست");var r=document.createElement("button");return r?(r.className="AIWritingCompanion-translation-icon-extension",n="styles/icon.css",(o=document.createElement("link")).rel="stylesheet",o.type="text/css",o.href=e().runtime.getURL(n),document.head.appendChild(o),r.className="AIWritingCompanion-translation-icon-extension",r.textContent=p.ICON_TRANSLATION,r.title=p.TRANSLATION_ICON_TITLE,document.body.appendChild(r),r.classList.add("AIWritingCompanion-translation-icon-extension-fade-in-initial"),requestAnimationFrame((function(){if(t.isConnected&&document.contains(r)){var e=t.getBoundingClientRect();r.style.top="".concat(e.top+window.scrollY+10,"px"),r.style.left="".concat(e.left+window.scrollX+e.width+10,"px"),r.style.display="block",requestAnimationFrame((function(){r.classList.remove("AIWritingCompanion-translation-icon-extension-fade-in-initial"),r.classList.add("AIWritingCompanion-translation-icon-extension-fade-in")}))}})),r):void Xt("[IconManager] آیکون معتبر نیست!")}catch(t){return this.errorHandler.handle(t,{type:Rt.UI,context:"IconManager-createTranslateIcon"}),null}var n,o}}])&&ti(t.prototype,r),n&&ti(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n}();function oi(){oi=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ai(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ai(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ii(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ai(t){return ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ai(t)}function ci(t,e,r){return si.apply(this,arguments)}function si(){var t;return t=oi().mark((function t(e,r,n){var o,i,a,c,s,u,l,f,h,p,y=arguments;return oi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=y.length>3&&void 0!==y[3]?y[3]:d.Field,t.next=3,F();case 3:i=t.sent,a=e,c=!1;try{s=JSON.parse(e),v=s,Array.isArray(v)&&v.length>0&&v.every((function(t){return"object"===ai(t)&&null!==t&&"string"==typeof t.text}))&&(c=!0,a=e)}catch(t){a=e}if(!c){t.next=13;break}return t.next=10,H();case 10:u=t.sent,t.next=37;break;case 13:if(o!==d.Popup_Translate){t.next=19;break}return t.next=16,D();case 16:u=t.sent,t.next=37;break;case 19:return t.next=21,G();case 21:if(t.t0=t.sent,!0!==t.t0){t.next=34;break}if(o!==d.Dictionary_Translation){t.next=29;break}return t.next=26,M();case 26:u=t.sent,t.next=32;break;case 29:return t.next=31,U();case 31:u=t.sent;case 32:t.next=37;break;case 34:return t.next=36,U();case 36:u=t.sent;case 37:return l=i.replace(/\$_{SOURCE}/g,r).replace(/\$_{TARGET}/g,n),f=u.replace(/\$_{SOURCE}/g,r).replace(/\$_{TARGET}/g,n),h=f.replace(/\$_{USER_RULES}/g,l),Xt("Prompt : ",h),p=h.includes("$_{TEXT}")?h.replace(/\$_{TEXT}/g,a):"".concat(h,"\n\n ``` ").concat(a,"  ``` \n\n"),t.abrupt("return",p);case 43:case"end":return t.stop()}var v}),t)})),si=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ii(i,n,o,a,c,"next",t)}function c(t){ii(i,n,o,a,c,"throw",t)}a(void 0)}))},si.apply(this,arguments)}function ui(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function li(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ui(Object(r),!0).forEach((function(e){fi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ui(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function fi(t,e,r){return(e=bi(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function hi(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],s=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return pi(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?pi(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function di(){di=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==gi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(gi(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function yi(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function vi(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){yi(i,n,o,a,c,"next",t)}function c(t){yi(i,n,o,a,c,"throw",t)}a(void 0)}))}}function gi(t){return gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gi(t)}function mi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,bi(n.key),n)}}function bi(t){var e=function(t,e){if("object"!=gi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=gi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==gi(e)?e:e+""}function wi(t,e,r,n,o){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(t,e,i),null):i}var xi=(ri=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errorHandler=new Ht,this.sessionContext=null},r=[{key:"_isSpecificTextJsonFormat",value:function(t){return Array.isArray(t)&&t.length>0&&t.every((function(t){return"object"===gi(t)&&null!==t&&"string"==typeof t.text}))}},{key:"_buildMessagePayload",value:function(t){var e="";try{var r=JSON.parse(t.fetchOptions.body);r.contents&&Array.isArray(r.contents)&&r.contents[0].parts?e=r.contents[0].parts[0].text:r.message?e=r.message:r.messages&&Array.isArray(r.messages)&&r.messages[0].content&&(e=r.messages[0].content)}catch(t){}return{promptText:e,sourceLanguage:t.sourceLanguage||oe,targetLanguage:t.targetLanguage||oe,translationMode:t.translationMode||""}}},{key:"_executeApiCall",value:(u=vi(di().mark((function t(e){var r,n,o,i,a,c,s,u;return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e.url,e.fetchOptions);case 3:if((r=t.sent).ok){t.next=14;break}return t.next=7,r.json().catch((function(){return{}}));case 7:throw o=t.sent,i=o.detail||(null===(n=o.error)||void 0===n?void 0:n.message)||r.statusText,(a=new Error(i)).statusCode=r.status,a.type=Rt.API,a.sessionConflict=409===r.status,a;case 14:return t.next=16,r.json();case 16:if(c=t.sent,void 0!==(s=e.extractResponse(c,r.status))){t.next=23;break}throw(u=new Error("Invalid response format")).type=Rt.API,u.statusCode=r.status||500,u;case 23:return t.abrupt("return",s);case 26:return t.prev=26,t.t0=t.catch(0),t.next=30,Ht.processError(t.t0);case 30:throw t.sent;case 32:case"end":return t.stop()}}),t,null,[[0,26]])}))),function(t){return u.apply(this,arguments)})},{key:"handleGeminiTranslation",value:(s=vi(di().mark((function t(e,r,n,o){var i,a,c,s,u,l,p,d,y;return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r!==n){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,Promise.all([P(),I()]);case 4:if(i=t.sent,a=hi(i,2),c=a[0],s=a[1],c){t.next=13;break}return u=new Error(f),t.next=12,this.errorHandler.handle(u,{type:Rt.API,statusCode:601,context:"api-gemini-translation-apikey"});case 12:case 17:case 25:return t.abrupt("return",t.sent);case 13:if(s){t.next=18;break}return l=new Error(h),t.next=17,this.errorHandler.handle(l,{type:Rt.API,statusCode:602,context:"api-gemini-translation-apiurl"});case 18:return t.next=20,ci(e,r,n,o);case 20:return p=t.sent,d="".concat(s,"?key=").concat(c),y={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:p}]}]})},t.next=25,this._executeApiCall({url:d,fetchOptions:y,context:"api-gemini-translation",extractResponse:function(t){var e;return null==t||null===(e=t.candidates)||void 0===e||null===(e=e[0])||void 0===e||null===(e=e.content)||void 0===e||null===(e=e.parts)||void 0===e||null===(e=e[0])||void 0===e?void 0:e.text}});case 26:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n){return s.apply(this,arguments)})},{key:"handleWebAITranslation",value:(c=vi(di().mark((function t(e,r,n){var o,i,a,c,s,u,l,f,h,p=arguments;return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=p.length>4?p[4]:void 0,t.next=4,Promise.all([$(),z()]);case 4:return i=t.sent,a=hi(i,2),c=a[0],s=a[1],t.next=10,ci(e,r,n,o);case 10:return u=t.sent,l=c,f={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:u,model:s,images:[],reset_session:this.shouldResetSession()})},t.next=15,this._executeApiCall({url:l,fetchOptions:f,context:"api-webai-translation",extractResponse:function(t){return"string"==typeof t.response?t.response:void 0}});case 15:return(h=t.sent)&&this.storeSessionContext({model:s,lastUsed:Date.now()}),t.abrupt("return",h);case 18:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return c.apply(this,arguments)})},{key:"handleOpenAITranslation",value:(a=vi(di().mark((function t(e,r,n,o){var i,a,c,s,u,l,f,p,d,y;return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([Y(),X(),W()]);case 2:if(i=t.sent,a=hi(i,3),c=a[0],s=a[1],u=a[2],c){t.next=12;break}return l=new Error("OpenAI API key is missing"),t.next=11,this.errorHandler.handle(l,{type:Rt.API,statusCode:601,context:"api-openai-translation-apikey"});case 11:case 16:return t.abrupt("return");case 12:if(s){t.next=17;break}return f=new Error(h),t.next=16,this.errorHandler.handle(f,{type:Rt.API,statusCode:602,context:"api-openai-translation-apiurl"});case 17:return t.next=19,ci(e,r,n,o);case 19:return p=t.sent,d=s,y={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c)},body:JSON.stringify({model:u||"gpt-3.5-turbo",messages:[{role:"user",content:p}]})},t.next=24,this._executeApiCall({url:d,fetchOptions:y,context:"api-openai-translation",extractResponse:function(t){var e;return null==t||null===(e=t.choices)||void 0===e||null===(e=e[0])||void 0===e||null===(e=e.message)||void 0===e?void 0:e.content}});case 24:return t.abrupt("return",t.sent);case 25:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n){return a.apply(this,arguments)})},{key:"handleOpenRouterTranslation",value:(i=vi(di().mark((function t(r,n,o,i){var a,c,s,u,l,h,d,y;return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([q(),V()]);case 2:if(a=t.sent,c=hi(a,2),s=c[0],u=c[1],s){t.next=11;break}return l=new Error(f),t.next=10,this.errorHandler.handle(l,{type:Rt.API,statusCode:601,context:"api-openrouter-translation-apikey"});case 10:return t.abrupt("return");case 11:return t.next=13,ci(r,n,o,i);case 13:return h=t.sent,d=p.OPENROUTER_API_URL,y={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s),"HTTP-Referer":window.location.origin,"X-Title":e().runtime.getManifest().name},body:JSON.stringify({model:u||"openai/gpt-3.5-turbo",messages:[{role:"user",content:h}]})},t.next=18,this._executeApiCall({url:d,fetchOptions:y,context:"api-openrouter-translation",extractResponse:function(t){var e;return null==t||null===(e=t.choices)||void 0===e||null===(e=e[0])||void 0===e||null===(e=e.message)||void 0===e?void 0:e.content}});case 18:return t.abrupt("return",t.sent);case 19:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n){return i.apply(this,arguments)})},{key:"storeSessionContext",value:function(t){this.sessionContext=li(li({},t),{},{timestamp:Date.now()})}},{key:"resetSessionContext",value:function(){this.sessionContext=null}},{key:"shouldResetSession",value:function(){return this.sessionContext&&Date.now()-this.sessionContext.lastUsed>3e5}},{key:"translateText",value:(o=vi(di().mark((function t(e,r,n,o){var i,a,c,s,u,f;return di().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O();case 2:if(!t.sent){t.next=7;break}return t.next=5,$t(500);case 5:return i=e.substring(0,50),t.abrupt("return",it(i)?p.DEBUG_TRANSLATED_ENGLISH:p.DEBUG_TRANSLATED_PERSIAN);case 7:if(e&&"string"==typeof e||Xt("[API] translateText: Received potentially invalid input type after createPrompt:",gi(e)),qt()){t.next=12;break}return t.next=11,this.errorHandler.handle(new Error(l),{type:Rt.CONTEXT,context:"api-translateText-context",code:"context-invalid",statusCode:"context-invalid"});case 11:case 48:return t.abrupt("return");case 12:return t.prev=12,t.next=15,B();case 15:return a=t.sent,t.next=18,Promise.all([n||C(),o||R()]);case 18:if(c=t.sent,s=hi(c,2),u=s[0],f=s[1],"webai"!==a||this.sessionContext||this.resetSessionContext(),u!==f){t.next=31;break}if(r!==d.Popup_Translate){t.next=30;break}return t.next=27,R();case 27:u=t.sent,t.next=31;break;case 30:return t.abrupt("return",null);case 31:t.t0=a,t.next="gemini"===t.t0?34:"webai"===t.t0?37:"openai"===t.t0?40:"openrouter"===t.t0?43:46;break;case 34:return t.next=36,this.handleGeminiTranslation(e,u,f,r);case 36:case 39:case 42:case 45:case 59:return t.abrupt("return",t.sent);case 37:return t.next=39,this.handleWebAITranslation(e,u,f);case 40:return t.next=42,this.handleOpenAITranslation(e,u,f);case 43:return t.next=45,this.handleOpenRouterTranslation(e,u,f);case 46:return t.next=48,this.errorHandler.handle(new Error("Invalid translation API selected"),{type:Rt.VALIDATIONMODEL,statusCode:400,context:"api-translateText-api-model"});case 49:t.next=63;break;case 51:if(t.prev=51,t.t1=t.catch(12),"string"!=typeof t.t1){t.next=55;break}throw t.t1;case 55:if(!(t.t1.sessionConflict&&n&&o)){t.next=60;break}return this.resetSessionContext(),t.next=59,this.handleWebAITranslation(e,n,o,!0);case 60:return t.next=62,this.errorHandler.handle(t.t1,{type:t.t1.type||Rt.NETWORK,statusCode:t.t1.statusCode||500,context:"api-translateText-translation-service"});case 62:throw t.t1.message||"Unknown translation error";case 63:case"end":return t.stop()}}),t,this,[[12,51]])}))),function(t,e,r,n){return o.apply(this,arguments)})}],r&&mi(t.prototype,r),n&&mi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i,a,c,s,u}(),wi(ri.prototype,"handleGeminiTranslation",[zt],Object.getOwnPropertyDescriptor(ri.prototype,"handleGeminiTranslation"),ri.prototype),wi(ri.prototype,"handleWebAITranslation",[zt],Object.getOwnPropertyDescriptor(ri.prototype,"handleWebAITranslation"),ri.prototype),wi(ri.prototype,"handleOpenAITranslation",[zt],Object.getOwnPropertyDescriptor(ri.prototype,"handleOpenAITranslation"),ri.prototype),wi(ri.prototype,"handleOpenRouterTranslation",[zt],Object.getOwnPropertyDescriptor(ri.prototype,"handleOpenRouterTranslation"),ri.prototype),wi(ri.prototype,"translateText",[zt],Object.getOwnPropertyDescriptor(ri.prototype,"translateText"),ri.prototype),ri),Ei=new xi,Li=(Ei.translateText.bind(Ei),"default"),ki="whatsapp",Ti="telegram",_i="instagram",Oi="twitter",Si="medium",Ai="chatgpt",Pi="youtube",Ii="discrod";function Ni(){var t=window.location.hostname.toLowerCase();return{"web.whatsapp.com":ki,"web.telegram.org":Ti,"www.instagram.com":_i,"twitter.com":Oi,"x.com":Oi,"medium.com":Si,"chat.openai.com":Ai,"chat.com":Ai,"chatgpt.com":Ai,"www.youtube.com":Pi,"discord.com":Ii}[t]||Li}function ji(t){return ji="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ji(t)}function Ci(){Ci=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ji(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ji(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ri(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}var Gi=new Map;function Fi(t){var e=[],r=new Map;return Array.from(t.keys()).forEach((function(t){Gi.has(t)?r.set(t,Gi.get(t)):e.push(t)})),{textsToTranslate:e,cachedTranslations:r}}function Mi(t){for(var e,r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),n=[],o=new Map;e=r.nextNode();){var i=e.textContent.trim();n.push(e),i&&(o.has(i)?o.get(i).push(e):o.set(i,[e]))}return{textNodes:n,originalTextsMap:o}}function Di(t,e,r){t.forEach((function(t){if(t.parentNode&&t.nodeType===Node.TEXT_NODE){var n=t.textContent,o=n.trim(),i=e.get(o);if(i&&o){var a=t.parentNode;!function(t){t.dataset.aiwcOriginalDirection||(t.dataset.aiwcOriginalDirection=t.style.direction||"");t.dataset.aiwcOriginalTextAlign||(t.dataset.aiwcOriginalTextAlign=t.style.textAlign||"")}(a);var c=document.createElement("span"),s="aiwc-".concat(Math.random().toString(36).substring(2,15));c.setAttribute("data-aiwc-original-id",s),c.setAttribute("data-aiwc-original-text",n);var u=n.split("\n"),l=i.split("\n");u.forEach((function(t,e){var n=void 0!==l[e]?l[e]:"",o=document.createElement("span");if(o.textContent=n,r.state.originalTexts.set(s,{originalText:t,wrapperElement:o}),c.appendChild(o),e<u.length-1){var i=document.createElement("br");i.setAttribute("data-aiwc-br","true"),c.appendChild(i)}})),function(t,e){if(t&&t.style){var r=at(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}(a,!0),st(a,l);try{a.replaceChild(c,t)}catch(e){Xt("AIWC Error replacing text node with container:",e,{textNode:t,containerSpan:c,parentElement:a}),r.state.originalTexts.delete(s),e=Ht.processError(e),r.errorHandler.handle(e,{type:Rt.PARSE_SELECT_ELEMENT,context:"textExtraction-apply-translations-replace",elementId:"multiple"})}}}}))}function Hi(){var t;return t=Ci().mark((function t(e){var r,n;return Ci().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=0,document.querySelectorAll("span[data-aiwc-original-text]").forEach((function(t){var r=t.getAttribute("data-aiwc-original-text");if(null!==r)try{var o=t.parentNode;zi(o);var i=document.createTextNode(r);o.replaceChild(i,t),n++;for(var a=i.nextSibling;a&&"BR"===a.nodeName&&"true"===a.getAttribute("data-aiwc-br");){var c=a;a=a.nextSibling,c.parentNode.removeChild(c)}}catch(r){e.errorHandler.handle(r,{type:Rt.PARSE_SELECT_ELEMENT,context:"revert-translations-replace",elementId:t.getAttribute("data-aiwc-original-id")}),Xt("Failed to revert container with original text.",r)}})),!(n>0)){t.next=7;break}e.notifier.show("".concat(n," مورد بازگردانی شد"),"revert"),t.next=11;break;case 7:return t.next=9,A();case 9:if(!t.sent){t.next=11;break}e.notifier.show("هیچ متنی برای بازگردانی یافت نشد","warning");case 11:return null===(r=e.IconManager)||void 0===r||r.cleanup(),e.state.originalTexts.clear(),t.abrupt("return",n);case 14:case"end":return t.stop()}}),t)})),Hi=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ri(i,n,o,a,c,"next",t)}function c(t){Ri(i,n,o,a,c,"throw",t)}a(void 0)}))},Hi.apply(this,arguments)}function Ui(t,e){var r=t.trim().match(/(\[(?:[^]|\n|\r)*\]|\{(?:[^]|\n|\r)*\})/);if(!r||!r[1]){Xt("No JSON structure (array or object) found in the response string.");var n=new Error("هیچ ساختار JSON معتبری در پاسخ یافت نشد.");return e.errorHandler.handle(n,{type:Rt.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-NoJsonFound"}),[]}var o=r[1].trim();try{return JSON.parse(o)}catch(t){if(Xt("Initial JSON.parse failed. Attempting repair by removing the last element.",t.message),!(o.startsWith("[")&&t instanceof SyntaxError)){Xt("Initial parse failed, and repair condition not met (not array or not SyntaxError).");var i=Ht.processError(t);return e.errorHandler.handle(i,{type:Rt.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-InitialErrorNotRepaired"}),Xt("Original problematic string:",o),[]}var a=o.lastIndexOf(",",o.length-2);if(-1===a){Xt("Could not repair JSON: No comma found to separate the last element.");var c=Ht.processError(t);return e.errorHandler.handle(c,{type:Rt.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-NoCommaForRepair"}),Xt("Original problematic string:",o),[]}var s=o.substring(0,a);s=s.trimEnd()+"]",Xt("Attempting to parse repaired JSON string:",s);try{var u=JSON.parse(s);return Xt("Successfully parsed JSON after removing the potentially corrupted last element.","warning"),u}catch(r){Xt("Repair attempt also failed.",r.message);var l=Ht.processError(t);return e.errorHandler.handle(l,{type:Rt.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-RepairFailed"}),Xt("Original problematic string:",o),[]}}}function Bi(t){var e=[],r=[],n=new Map;return t.forEach((function(t,o){var i=t.split("\n"),a=[];i.forEach((function(t,n){e.push(t),r.push({originalIndex:o,segmentIndex:n}),a.push(e.length-1)})),n.set(o,a)})),{expandedTexts:e,originMapping:r,originalToExpandedIndices:n}}function $i(t,e){return Array.isArray(t)?t.length===e.length||(Xt("عدم تطابق طول.","طول مورد انتظار (بر اساس متن‌های گسترش‌یافته): ".concat(e.length),"طول دریافت شده: ".concat(t.length),"علت احتمالی: تقسیم/ادغام متفاوت متن توسط API یا افزودن/حذف آیتم‌ها.","تلاش برای پردازش با داده‌های موجود ادامه می‌یابد..."),Math.abs(t.length-e.length)<3/7*e.length):(Xt("پاسخ ترجمه یک آرایه نیست.","داده پارس شده:",t),!1)}function zi(t){void 0!==t.dataset.aiwcOriginalDirection&&(t.style.direction=t.dataset.aiwcOriginalDirection,delete t.dataset.aiwcOriginalDirection),void 0!==t.dataset.aiwcOriginalTextAlign&&(t.style.textAlign=t.dataset.aiwcOriginalTextAlign,delete t.dataset.aiwcOriginalTextAlign)}function Yi(t,e,r,n,o){for(var i=new Map,a=new Map,c=Math.min(e.length,t.length),s=0;s<c;s++){var u=t[s],l=r[s];if(u&&"string"==typeof u.text&&l){var f=l.originalIndex;a.has(f)||a.set(f,[]),a.get(f).push(u.text)}else if(console.warn("داده ترجمه نامعتبر یا گمشده برای آیتم در اندیس ".concat(s,"."),"آیتم دریافتی:",u,"اطلاعات نگاشت:",l),l){var h=l.originalIndex;a.has(h)||a.set(h,[]),a.get(h).push(e[s])}}return n.forEach((function(t,e){if(a.has(e)){var r=a.get(e).join("\n");i.set(t,r),Gi.set(t,r)}else o.has(t)||i.set(t,t)})),i}function Xi(t){return Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xi(t)}function Wi(){Wi=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Xi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Xi(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function qi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Vi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?qi(Object(r),!0).forEach((function(e){Ki(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ki(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=Xi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Xi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Xi(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Zi(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Ji(){if(!document.getElementById("__AI_WRITING_BRIDGE")){var t=document.createElement("script");t.src=e().runtime.getURL("./pageBridge.js"),t.id="__AI_WRITING_BRIDGE",(document.head||document.documentElement).appendChild(t)}}function Qi(t){return ta.apply(this,arguments)}function ta(){var t;return t=Wi().mark((function t(r){var n,o,i,a=arguments;return Wi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"Popup_Translate",t.prev=1,t.next=4,e().runtime.sendMessage({action:"fetchTranslation",payload:{promptText:r,translationMode:n}});case 4:return o=t.sent,t.abrupt("return",Vi(Vi({},o),{},{viaBridge:!1}));case 8:return t.prev=8,t.t0=t.catch(1),Xt("[BridgeIntegration] Normal translate failed. Falling back to bridge."),t.next=13,ea(r,n);case 13:return i=t.sent,t.abrupt("return",i);case 15:case"end":return t.stop()}}),t,null,[[1,8]])})),ta=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Zi(i,n,o,a,c,"next",t)}function c(t){Zi(i,n,o,a,c,"throw",t)}a(void 0)}))},ta.apply(this,arguments)}function ea(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Popup_Translate";return new Promise((function(r,n){var o="".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),i=function(t){var e,a;t.source===window&&"AI_WRITING_TRANSLATE_RESPONSE"===(null===(e=t.data)||void 0===e?void 0:e.type)&&(null===(a=t.data)||void 0===a||null===(a=a.original)||void 0===a?void 0:a.__requestId)===o&&(window.removeEventListener("message",i),t.data.error?n(new Error(t.data.error)):r(Vi(Vi({},t.data.result),{},{viaBridge:!0})))};window.addEventListener("message",i),window.postMessage({type:"AI_WRITING_TRANSLATE_REQUEST",text:t,translateMode:e,__requestId:o},"*")}))}function ra(){ra=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==na(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(na(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function na(t){return na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},na(t)}function oa(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ia(t){return aa.apply(this,arguments)}function aa(){var t;return t=ra().mark((function t(r){var n,o,i,a,c,s,u,l,f,h,p,y,v,g,m,b,w,x,E,L,k,T,_,O,S,A,P;return ra().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.text,a=r.translationHandler,c=r.target,s=r.selectionRange,u=void 0===s?null:s,i&&a){t.next=3;break}return t.abrupt("return");case 3:return l=u?d.SelectElement:d.Field,f=null!==(n=null===(o=a.detectPlatform)||void 0===o?void 0:o.call(a,c))&&void 0!==n?n:Ni(),h="",t.prev=6,Ji(),t.next=10,Qi(i,l);case 10:if(!1!==(null==(T=t.sent)?void 0:T.success)){t.next=16;break}return _=new Error((null==T?void 0:T.error)||"(خطایی رخ داد)"),t.next=15,a.errorHandler.handle(_,{type:Rt.API,context:"smartTranslate-response-handler",statusCode:(null==T?void 0:T.statusCode)||400,isPrimary:!0});case 15:return t.abrupt("return");case 16:if((h=null!==(p=null!==(y=null!==(v=null==T||null===(g=T.data)||void 0===g?void 0:g.translatedText)&&void 0!==v?v:null==T?void 0:T.translatedText)&&void 0!==y?y:null==T||null===(m=T.result)||void 0===m||null===(m=m.data)||void 0===m?void 0:m.translatedText)&&void 0!==p?p:null==T||null===(b=T.result)||void 0===b?void 0:b.translatedText)&&"string"==typeof h){t.next=21;break}return t.next=20,a.errorHandler.handle(new Error("(Translation not found)"),{type:Rt.API,context:"smartTranslate-handler-main",isPrimary:!0});case 20:return t.abrupt("return");case 21:if(h=h.trim(),O=null!=c&&c.isContentEditable?null===(w=c.innerText)||void 0===w?void 0:w.trim():c&&"value"in c?null===(x=c.value)||void 0===x?void 0:x.trim():null,Xt("[SmartTranslateHandler] Initial value:",O),S=!1,!u||null===(E=a.strategies[f])||void 0===E||!E.updateElement){t.next=31;break}return t.next=28,a.strategies[f].updateElement(u,h);case 28:S=t.sent,t.next=35;break;case 31:if(!c){t.next=35;break}return t.next=34,a.updateTargetElement(c,h);case 34:S=t.sent;case 35:if(Xt("[SmartTranslateHandler] updateElement result:",S),!0!==S){t.next=39;break}return Xt("[SmartTranslateHandler] Strategy applied successfully"),t.abrupt("return");case 39:if(A=null!=c&&c.isContentEditable?null===(L=c.innerText)||void 0===L?void 0:L.trim():"object"===na(c)&&null!==c&&"value"in c?null===(k=c.value)||void 0===k?void 0:k.trim():null,Xt("[SmartTranslateHandler] Initial value:",A),Xt("[SmartTranslateHandler] Direct DOM check:",{before:O,after:A,expected:h}),A!==h){t.next=45;break}return Xt("[SmartTranslateHandler] DOM updated correctly. No fallback needed."),t.abrupt("return");case 45:return Xt("[SmartTranslateHandler] ❗ Fallback required"),t.next=48,e().runtime.sendMessage({action:"applyTranslationToActiveElement",payload:{translatedText:h}});case 48:if(!0===(P=t.sent)||"object"===na(P)&&!0===P.success){t.next=62;break}if(t.t0=Error,t.t2=null==P?void 0:P.error,t.t2){t.next=57;break}return t.next=56,mt("ERRORS_SMARTTRANSLATE_APPLY_FAILED");case 56:t.t2=t.sent;case 57:if(t.t1=t.t2,t.t1){t.next=60;break}t.t1="(خطایی در جایگذاری.)";case 60:throw t.t3=t.t1,new t.t0(t.t3);case 62:return Xt("[SmartTranslateHandler] Fallback applied successfully"),t.prev=63,t.next=66,navigator.clipboard.writeText(h);case 66:return t.t4=a.notifier,t.next=69,mt("STATUS_SMARTTRANSLATE_COPIED");case 69:if(t.t5=t.sent,t.t5){t.next=72;break}t.t5="ترجمه در حافظه کپی شد. (Ctrl+V)";case 72:t.t6=t.t5,t.t4.show.call(t.t4,t.t6,"success",!0,3e3),t.next=80;break;case 76:return t.prev=76,t.t7=t.catch(63),t.next=80,a.errorHandler.handle(t.t7,{type:Rt.UI,context:"smartTranslation-clipboard"});case 80:t.next=86;break;case 82:return t.prev=82,t.t8=t.catch(6),t.next=86,a.errorHandler.handle(t.t8,{type:Rt.API,context:"smartTranslate-handler-main-second"});case 86:case"end":return t.stop()}}),t,null,[[6,82],[63,76]])})),aa=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){oa(i,n,o,a,c,"next",t)}function c(t){oa(i,n,o,a,c,"throw",t)}a(void 0)}))},aa.apply(this,arguments)}function ca(t){return ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ca(t)}function sa(){sa=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ca(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ca(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ua(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function la(t,e,r,n,o){if(t&&e){var i,a,c=!1,s=new Set,u=function(){if(!c){c=!0;try{var n,o;s.forEach((function(t){return cancelAnimationFrame(t)})),s.clear(),null===(n=i)||void 0===n||n.disconnect(),null===(o=a)||void 0===o||o.disconnect(),t.removeEventListener("click",l),t.removeEventListener("blur",f),e.removeEventListener("blur",f),t&&t.isConnected&&(t.classList.add("fade-out"),setTimeout((function(){t&&t.isConnected&&t.remove()}),50)),y.activeTranslateIcon=null}catch(t){r.errorHandler.handle(t,{type:Rt.UI,context:"icon-cleanup"})}}},l=function(){var t,i=(t=sa().mark((function t(i){var a,c,s;return sa().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i.preventDefault(),i.stopPropagation(),a=null,t.prev=3,c=Ni(),s=o[c].extractText(e)){t.next=9;break}return Xt("[IconBehavior] متن انتخاب شده خالی است."),t.abrupt("return");case 9:return t.t0=n,t.next=12,mt("STATUS_TRANSLATING_ICON");case 12:if(t.t1=t.sent,t.t1){t.next=15;break}t.t1="در حال ترجمه...";case 15:return t.t2=t.t1,a=t.t0.show.call(t.t0,t.t2,"status",!1),t.next=19,ia({text:s,target:e,translationHandler:r});case 19:a&&n.dismiss(a),t.next=25;break;case 22:t.prev=22,t.t3=t.catch(3),Xt("[IconBehavior] خطا در فراخوانی ترجمه:",t.t3);case 25:return t.prev=25,a&&n.dismiss(a),u(),t.finish(25);case 29:case"end":return t.stop()}}),t,null,[[3,22,25,29]])})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ua(i,n,o,a,c,"next",t)}function c(t){ua(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return i.apply(this,arguments)}}(),f=function(e){e.relatedTarget&&(e.relatedTarget===t||t.contains(e.relatedTarget))||setTimeout(u,50)},h=function(){if(e.isConnected&&t.isConnected){var n=requestAnimationFrame((function(){try{var n=e.getBoundingClientRect();!n||n.width+n.height===0||n.top<0||n.left,t.classList.add("fade-in-initial"),t.style.display="block",t.style.top="".concat(Math.round(n.bottom+window.scrollY+5),"px"),t.style.left="".concat(Math.round(n.left+window.scrollX),"px"),requestAnimationFrame((function(){t.classList.remove("fade-in-initial"),t.classList.add("fade-in")}))}catch(t){r.errorHandler.handle(t,{type:Rt.UI,context:"icon-positioning"}),u()}}));s.add(n)}else u()};try{t instanceof HTMLElement&&t.isConnected||Xt("[IconBehavior] آیکون معتبر نیست"),e.isConnected&&document.contains(e)||Xt("[IconBehavior] المان هدف در DOM وجود ندارد"),t.style.display="none",document.body.appendChild(t),(i=new ResizeObserver((function(){return h()}))).observe(e),t.addEventListener("click",l),e.addEventListener("blur",f),t.addEventListener("blur",f),(a=new MutationObserver((function(r){document.contains(e)&&document.contains(t)||u()}))).observe(document.body,{childList:!0,subtree:!0}),h(),y.activeTranslateIcon=t}catch(t){u(),r.errorHandler.handle(t,{type:Rt.UI,context:"setup-icon-behavior",element:null==e?void 0:e.tagName})}}}function fa(t){return fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fa(t)}function ha(){ha=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==fa(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(fa(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function pa(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function da(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){pa(i,n,o,a,c,"next",t)}function c(t){pa(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ya(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,va(n.key),n)}}function va(t){var e=function(t,e){if("object"!=fa(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=fa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==fa(e)?e:e+""}var ga,ma=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fadeInDuration=e.fadeInDuration||50,this.fadeOutDuration=e.fadeOutDuration||125,this.isVisible=!1,this.currentText=null,this.displayElement=null,this.removeMouseDownListener=null,this.translationHandler=e.translationHandler,this.translatedText=null,this.isTranslationCancelled=!1,this.originalText=null,this.notifier=e.notifier,this.show=this.show.bind(this),this.cancelCurrentTranslation=this.cancelCurrentTranslation.bind(this)},r=[{key:"show",value:(i=da(ha().mark((function t(r,n){var o,i,a,c,s,u,f,h,p,y,v=this;return ha().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(qt()){t.next=4;break}return t.next=3,this.translationHandler.errorHandler.handle(new Error(l),{type:Rt.CONTEXT,context:"SelectionWindows-show-context",code:"context-invalid",statusCode:"context-invalid"});case 3:return t.abrupt("return");case 4:if(r&&(!this.isVisible||r!==this.currentText)){t.next=6;break}return t.abrupt("return");case 6:this.dismiss(!1),this.isTranslationCancelled=!1,this.originalText=r,o=d.Field,(i=document.createElement("div")).style.position="absolute",i.style.left="".concat(n.x,"px"),i.style.top="".concat(n.y,"px"),i.style.zIndex="2147483637",a=i.attachShadow({mode:"open"}),this.displayElement=document.createElement("div"),this.displayElement.classList.add("aiwc-selection-display-temp"),this.displayElement.style.opacity="0.6",this.displayElement.style.transform="scale(0.1)",this.displayElement.style.transition="transform 0.1s ease-out, opacity ".concat(this.fadeInDuration,"ms ease-in-out"),c=this.createLoadingDots(),this.displayElement.appendChild(c),a.appendChild(this.displayElement),this.applyInitialStyles(n),(s=document.createElement("style")).textContent="\n      .aiwc-selection-display-temp {\n        background-color: #f8f8f8;\n        color: #333;\n        border: 1px solid #ddd;\n        padding: 8px 12px;\n        border-radius: 4px;\n        font-size: 14px;\n        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n        /* سایر استایل‌های شما */\n      }\n      /* سایر کلاس‌های مربوط به داخل پنجره */\n      .aiwc-loading-container {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        opacity: 1;\n        transition: opacity 0.9s ease-in-out;\n      }\n      @keyframes blink {\n        0% { opacity: 0.3; }\n        50% { opacity: 0.8; }\n        100% { opacity: 0.3; }\n      }\n      .aiwc-loading-dot {\n        font-size: 1.2em;\n        opacity: 0.3;\n        margin: 0 0.2em;\n        animation: blink 0.7s infinite;\n        color: black;\n      }\n    ",a.appendChild(s),document.body.appendChild(this.displayElement),this.isVisible=!0,this.animatePopupSize(c),u=["the","a","an","is","are","was","were","in","on","at","to","of","for","with","by","from"],(f=r.trim().split(/\s+/)).length<=3&&r.length<=30&&(1===f.length?(h=f[0].toLowerCase(),u.includes(h)||(o=d.Dictionary_Translation)):f.length>1&&(o=d.Dictionary_Translation)),p=r,this.originalText=p,this.isTranslationCancelled=!1,e().runtime.sendMessage({action:"fetchTranslationBackground",payload:{promptText:p,translationMode:o}}).then((function(t){try{if(v.isTranslationCancelled||v.originalText!==p)return void v.cancelCurrentTranslation();if(t&&!0===t.success){var e,r=null==t||null===(e=t.data)||void 0===e?void 0:e.translatedText,n="string"==typeof r?r.trim():"";if(!n){var i="string"==typeof r&&r?r:"(⚠️ خطایی در ترجمه رخ داد.)";return void v.handleTranslationError(i,c)}v.transitionToTranslatedText(n,c,p,o)}else{var a,s="string"==typeof(null==t?void 0:t.error)?t.error:(null==t||null===(a=t.error)||void 0===a?void 0:a.message)||"(⚠️ خطایی در ترجمه رخ داد.)";v.handleTranslationError(s,c)}}catch(t){Xt("[SelectionWindow] Error in .then block:",t),v.handleTranslationError(t,c)}})).catch((function(t){Xt("[SelectionWindow] Error fetching translation:",t),v.handleTranslationError(t,c)})),y=function(t){if(v.isVisible&&v.displayElement){var e=t.target;v.displayElement.contains(e)?t.stopPropagation():v.cancelCurrentTranslation()}},this.removeMouseDownListener&&document.removeEventListener("mousedown",this.removeMouseDownListener),document.addEventListener("mousedown",y),this.removeMouseDownListener=y;case 44:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"cancelCurrentTranslation",value:function(){this.dismiss(),this.isTranslationCancelled=!0,this.originalText=null,this.translatedText=null,this.stoptts_playing()}},{key:"stoptts_playing",value:function(){e().runtime.sendMessage({action:"stopTTS"})}},{key:"applyInitialStyles",value:function(t){this.displayElement.style.position="absolute",this.displayElement.style.zIndex="1000",this.displayElement.style.maxWidth="300px",this.displayElement.style.overflowWrap="break-word",this.displayElement.style.fontFamily="sans-serif",this.displayElement.style.opacity="0.6",this.displayElement.style.transform="scale(0.1)",this.displayElement.style.transformOrigin="top left",this.displayElement.style.transition="transform 0.1s ease-out, opacity ".concat(this.fadeInDuration,"ms ease-in-out"),this.displayElement.style.left="".concat(t.x,"px"),this.displayElement.style.top="".concat(t.y,"px"),this.displayElement.dataset.aiwcSelectionPopup="true"}},{key:"createLoadingDots",value:function(){var t=document.createElement("div");t.classList.add("aiwc-loading-container");for(var e=0;e<3;e++){var r=document.createElement("span");r.classList.add("aiwc-loading-dot"),r.innerText=".",t.appendChild(r)}return t}},{key:"animatePopupSize",value:function(t){var e=this;requestAnimationFrame((function(){e.displayElement.style.transform="scale(1)",setTimeout((function(){t.style.opacity="1"}),150)}))}},{key:"transitionToTranslatedText",value:function(t,e,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.SelectionWindows,i="string"==typeof t?t.trim():"";e.style.opacity="0",setTimeout((function(){if(n.displayElement&&n.isVisible){n.displayElement.style.opacity="0.6",n.displayElement.innerHTML="";var t=document.createElement("div");if(t.classList.add("aiwc-first-line"),!i)return void(n.notifier&&n.notifier.dismiss());var e=n.createTTSIcon(r);if(t.appendChild(e),o===d.Dictionary_Translation){var a=document.createElement("span");a.classList.add("aiwc-original-text"),a.textContent=r,t.appendChild(a)}t.childNodes.length>0&&n.displayElement.appendChild(t);var c=document.createElement("div");c.classList.add("aiwc-second-line");var s=document.createElement("span");s.classList.add("aiwc-text-content"),s.innerHTML=zr.parse(i||"(ترجمه یافت نشد)"),c.appendChild(s),n.applyTextDirection(c,i),n.displayElement.appendChild(c),requestAnimationFrame((function(){n.displayElement.style.transition="opacity 0.15s ease-in-out",n.displayElement.style.opacity="0.9"}))}}),150)}},{key:"createTTSIcon",value:function(t){var r=document.createElement("img");return r.src=e().runtime.getURL("icons/speaker.png"),r.alt="خواندن متن",r.title="خواندن متن",r.classList.add("aiwc-tts-icon"),r.addEventListener("click",(function(r){r.stopPropagation(),Xt("[SelectionWindows]: TTS icon clicked."),e().runtime.sendMessage({action:"speak",text:t,lang:oe}).then((function(t){t.success?Xt("[SelectionWindows]: TTS playback initiated."):Xt("[SelectionWindows]: TTS playback failed:",t.error)})).catch((function(t){Xt("[SelectionWindows]: Error sending TTS message:",t)}))})),r}},{key:"handleEmptyTranslation",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";t&&(t.style.opacity="0");var n=r&&"string"==typeof r?r:"(⚠️ هیچ متنی از سرویس ترجمه دریافت نشد.)";setTimeout((function(){e.displayElement&&(e.notifier?e.notifier.show(n,"warning",!0,2500):Xt("[SelectionWindow] "+n),e.dismiss(!1))}),300)}},{key:"handleTranslationError",value:(o=da(ha().mark((function t(e,r){var n,o,i;return ha().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&(r.style.opacity="0"),o="string"==typeof e?new Error(e):e,null===(n=this.translationHandler)||void 0===n||!n.errorHandler){t.next=7;break}return t.next=5,this.translationHandler.errorHandler.handle(o,{type:Rt.API,context:"selection-window-translate"});case 5:t.next=17;break;case 7:if(t.t1=null==o?void 0:o.message,t.t1){t.next=12;break}return t.next=11,mt("popup_string_translate_error_response");case 11:t.t1=t.sent;case 12:if(t.t0=t.t1,t.t0){t.next=15;break}t.t0="(خطای ناشناخته هنگام ترجمه).";case 15:i=t.t0,Xt("[SelectionWindow] "+i);case 17:this.dismiss(!1);case 18:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"dismiss",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.displayElement&&this.isVisible&&(this.removeMouseDownListener&&(document.removeEventListener("mousedown",this.removeMouseDownListener),this.removeMouseDownListener=null),this.isVisible=!1,t&&this.fadeOutDuration>0?(this.displayElement.style.transition="opacity ".concat(this.fadeOutDuration,"ms ease-in-out"),this.displayElement.style.opacity="0",this.displayElement.addEventListener("transitionend",this.removeElement.bind(this),{once:!0})):this.removeElement())}},{key:"removeElement",value:function(){this.removeMouseDownListener&&(document.removeEventListener("mousedown",this.removeMouseDownListener),this.removeMouseDownListener=null),this.displayElement&&this.displayElement.parentNode&&this.displayElement.remove(),this.displayElement=null,this.isVisible=!1,this.currentText=null,this.translatedText=null,this.isTranslationCancelled=!1,this.originalText=null}},{key:"applyTextDirection",value:function(t,e){if(t&&t.style){var r=p.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}}],r&&ya(t.prototype,r),n&&ya(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i}();function ba(t){return ba="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ba(t)}function wa(t){return function(t){if(Array.isArray(t))return xa(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return xa(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xa(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xa(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Ea(){Ea=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==ba(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ba(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function La(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function ka(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){La(i,n,o,a,c,"next",t)}function c(t){La(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Ta(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_a(n.key),n)}}function _a(t){var e=function(t,e){if("object"!=ba(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=ba(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ba(e)?e:e+""}function Oa(t,e,r,n,o){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(t,e,i),null):i}var Sa=(ga=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.translationHandler=e,this.featureManager=r,this.IconManager=e.IconManager,this.notifier=e.notifier,this.strategies=e.strategies,this.isProcessing=e.isProcessing,this.SelectionWindows=new ma({translationHandler:e,notifier:e.notifier}),this.select_Element_ModeActive=e.select_Element_ModeActive,this.handleEvent=this.handleEvent.bind(this),this.handleSelect_ElementModeClick=this.handleSelect_ElementClick.bind(this),this.handleEscape=this.handleEscape.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.selectionTimeoutId=null,this.cancelSelectionTranslation=this.cancelSelectionTranslation.bind(this)},r=[{key:"setFeatureManager",value:function(t){this.featureManager=t}},{key:"handleEvent",value:(l=ka(Ea().mark((function t(e){var r;return Ea().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isEscapeEvent(e)){t.next=4;break}return this.handleEscape(e),t.abrupt("return");case 4:if(!this.select_Element_ModeActive||"click"!==e.type){t.next=8;break}return t.next=7,this.handleSelect_ElementClick(e);case 7:return t.abrupt("return");case 8:if(!this.isCtrlSlashEvent(e)){t.next=12;break}return t.next=11,this.handleCtrlSlash(e);case 11:return t.abrupt("return");case 12:if(!this.isEditableTarget(e.target)||null===(r=this.featureManager)||void 0===r||!r.isOn("TEXT_FIELDS")){t.next=16;break}return t.next=15,this.handleEditableElement(e);case 15:return t.abrupt("return");case 16:if(!this.isMouseUp(e)){t.next=24;break}return t.next=19,Z();case 19:if(!t.sent||this.isMouseUpCtrl(e)){t.next=22;break}return t.abrupt("return");case 22:return t.next=24,this.handleMouseUp(e);case 24:t.next=32;break;case 26:return t.prev=26,t.t0=t.catch(0),t.next=30,Ht.processError(t.t0);case 30:t.t0=t.sent,this.translationHandler.errorHandler.handle(t.t0,{type:Rt.UI,context:"event-handling"});case 32:case"end":return t.stop()}}),t,this,[[0,26]])}))),function(t){return l.apply(this,arguments)})},{key:"isMouseUpCtrl",value:function(t){return"mouseup"===t.type&&(t.ctrlKey||t.metaKey)}},{key:"isMouseUp",value:function(t){return"mouseup"===t.type}},{key:"isCtrlSlashEvent",value:function(t){return(t.ctrlKey||t.metaKey)&&"/"===t.key&&!t.repeat}},{key:"isEscapeEvent",value:function(t){return"Escape"===t.key&&!t.repeat}},{key:"_getSelectedTextWithDash",value:function(){var t=window.getSelection(),e="";if(t.rangeCount>1)for(var r=0;r<t.rangeCount;r++)e+=t.getRangeAt(r).toString().trim(),r<t.rangeCount-1&&(e+=" - \n");else e=t.toString().trim();return e.trim()}},{key:"_getEventPath",value:function(t){var e=t.composedPath?t.composedPath():[];if(!e||0===e.length){var r=t.target;for(e=[];r;)e.push(r),r=r.parentNode}return e}},{key:"handleMouseUp",value:(u=ka(Ea().mark((function t(e){var r,n,o,i,a,c=this;return Ea().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=this._getSelectedTextWithDash(),i=this._getEventPath(e),null===(r=this.SelectionWindows)||void 0===r||!r.isVisible||!i.includes(null===(n=this.SelectionWindows)||void 0===n?void 0:n.displayElement)){t.next=4;break}return t.abrupt("return");case 4:o?this.selectionTimeoutId||(this.selectionTimeoutId=setTimeout((function(){c.selectionTimeoutId=null,c.processSelectedText(o,e)}),250),document.addEventListener("mousedown",this.cancelSelectionTranslation)):(this.selectionTimeoutId&&(clearTimeout(this.selectionTimeoutId),this.selectionTimeoutId=null,document.removeEventListener("mousedown",this.cancelSelectionTranslation)),null!==(a=this.SelectionWindows)&&void 0!==a&&a.isVisible&&this.SelectionWindows.dismiss());case 5:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"cancelSelectionTranslation",value:function(){if(this.selectionTimeoutId){clearTimeout(this.selectionTimeoutId),this.selectionTimeoutId=null;try{document.removeEventListener("mousedown",this.cancelSelectionTranslation)}catch(t){}}}},{key:"processSelectedText",value:(s=ka(Ea().mark((function t(e,r){var n,o,i,a,c,s;return Ea().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=window.getSelection(),i={x:0,y:0},o.rangeCount>0&&(a=o.getRangeAt(0),c=a.getBoundingClientRect(),i={x:c.left+window.scrollX,y:c.bottom+window.scrollY+15},s=window.innerWidth,i.x<10?i.x=10:i.x+300>s-10&&(i.x=s-300-10)),null===(n=this.SelectionWindows)||void 0===n||n.show(e,i),document.removeEventListener("mousedown",this.cancelSelectionTranslation);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return s.apply(this,arguments)})},{key:"isEditableTarget",value:function(t){return(null==t?void 0:t.isContentEditable)||["INPUT","TEXTAREA"].includes(null==t?void 0:t.tagName)||(null==t?void 0:t.closest)&&t.closest('[contenteditable="true"]')}},{key:"_processEditableElement",value:function(t){if(!this.IconManager||!this.featureManager.isOn("EXTENSION_ENABLED"))return null;if(!this.IconManager)return null;if(this.IconManager.cleanup(),Ni()===Pi){var e,r=this.strategies.youtube;if(null!=r&&null!==(e=r.isYoutube_ExtraField)&&void 0!==e&&e.call(r,t))return null}var n=this.IconManager.createTranslateIcon(t);return n?(la(n,t,this.translationHandler,this.notifier,this.strategies),n):null}},{key:"handleEditableFocus",value:function(t){var e;y.activeTranslateIcon||null!==(e=this.featureManager)&&void 0!==e&&e.isOn("TEXT_FIELDS")&&this._processEditableElement(t)}},{key:"handleEditableElement",value:(c=ka(Ea().mark((function t(e){var r,n;return Ea().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!y.activeTranslateIcon){t.next=2;break}return t.abrupt("return");case 2:e.stopPropagation(),n=e.target,null!==(r=this.featureManager)&&void 0!==r&&r.isOn("TEXT_FIELDS")&&this._processEditableElement(n);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"handleEditableBlur",value:function(){var t=this;setTimeout((function(){var e,r;null!==(e=document.activeElement)&&void 0!==e&&e.isConnected&&(document.activeElement===y.activeTranslateIcon||document.activeElement.closest(".AIWritingCompanion-translation-icon-extension"))||null===(r=t.IconManager)||void 0===r||r.cleanup()}),100)}},{key:"cleanCache",value:(a=ka(Ea().mark((function t(){return Ea().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={state:y},Gi.clear(),e&&e.state&&e.state.originalTexts&&e.state.originalTexts.clear(),t.t0=this.notifier,t.next=4,mt("STATUS_REMOVE_MEMORY");case 4:if(t.t1=t.sent,t.t1){t.next=7;break}t.t1="حافظه پاک شد";case 7:t.t2=t.t1,t.t0.show.call(t.t0,t.t2,"info",!0,2e3),Xt("حافظه پاک شد.");case 10:case"end":return t.stop()}var e}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"handleSelect_ElementClick",value:(i=ka(Ea().mark((function t(r){var n,o,i,a,c,s,u,l,f,h,p,v,g,m,b,w,x,E,L,k,T,_,O,S,A,P=this;return Ea().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Ni(),Xt("Select‑Element on «".concat(n,"»")),Kt(!1),this.translationHandler.select_Element_ModeActive=!1,y.selectElementActive=!1,this.IconManager&&this.IconManager.cleanup(),o=r.target,i=Mi(o),a=i.textNodes,(c=i.originalTextsMap).size){t.next=10;break}return t.abrupt("return",{status:"empty",reason:"no_text_found"});case 10:if(s=Fi(c),u=s.textsToTranslate,l=s.cachedTranslations,u.length||!l.size){t.next=23;break}return Di(a,l,{state:y,IconManager:this.IconManager}),t.t0=this.notifier,t.next=16,mt("STATUS_FROM_MEMORY");case 16:if(t.t1=t.sent,t.t1){t.next=19;break}t.t1="از حافظه";case 19:return t.t2=t.t1,t.t3=function(){return P.cleanCache()},t.t0.show.call(t.t0,t.t2,"info",!0,2e3,t.t3),t.abrupt("return",{status:"success",source:"cache",translatedCount:l.size});case 23:if(u.length){t.next=25;break}return t.abrupt("return",{status:"skip",reason:"no_new_texts"});case 25:return t.t4=this.notifier,t.next=28,mt("STATUS_TRANSLATING_SELECT_ELEMENT");case 28:if(t.t5=t.sent,t.t5){t.next=31;break}t.t5="در حال ترجمه…";case 31:if(t.t6=t.t5,f=t.t4.show.call(t.t4,t.t6,"status",!1),y.translateMode=d.SelectElement,t.prev=34,p=Bi(u),v=p.expandedTexts,g=p.originMapping,!((m=JSON.stringify(v.map((function(t){return{text:t}})))).length>2e4)){t.next=41;break}return b="متن انتخابی بسیار بزرگ است (".concat(m.length," بایت)"),this.notifier.show(b,"warning",!0,3e3),t.abrupt("return",{status:"error",reason:"payload_large",message:b});case 41:return t.next=43,e().runtime.sendMessage({action:"fetchTranslationBackground",payload:{promptText:m,translationMode:d.SelectElement}});case 43:if(null!=(w=t.sent)&&w.success){t.next=49;break}return x=(null==w?void 0:w.error)||"(⚠️ خطایی در ترجمه رخ داد.)",t.next=48,this.translationHandler.errorHandler.handle(new Error(x),{type:Rt.API,statusCode:(null==w?void 0:w.statusCode)||401,context:"select-element-response"});case 48:return t.abrupt("return",{status:"error",reason:"backend_error",message:x});case 49:if(!w||!1!==w.success){t.next=54;break}return L="string"==typeof w.error?w.error:(null===(E=w.error)||void 0===E?void 0:E.message)||"(⚠️ خطایی در ترجمه رخ داد.)",t.next=53,this.translationHandler.errorHandler.handle(new Error(L),{type:Rt.API,context:"select-element-response"});case 53:return t.abrupt("return",{status:"error",reason:"api_error",message:L});case 54:if("string"==typeof(k=null==w||null===(h=w.data)||void 0===h?void 0:h.translatedText)&&k.trim()){t.next=59;break}return T="(⚠️ ترجمه‌ای دریافت نشد.)",this.notifier.show(T,"warning",!0,3e3),t.abrupt("return",{status:"error",reason:"empty_translation",message:T});case 59:if(_=Ui(k,this.translationHandler)){t.next=65;break}return t.next=64,this.translationHandler.errorHandler.handle(new Error(err),{type:Rt.API,context:"select-element-response-format"});case 64:return t.abrupt("return",{status:"error",reason:"api_error",message:err});case 65:return $i(_,v)||this.notifier.show("(طول پاسخ ناهمخوان؛ مجدداً امتحان کنید.)","info",!0,1500),O=Yi(_,v,g,u,l),S=new Map([].concat(wa(l),wa(O))),Di(a,S,{state:y,IconManager:this.IconManager}),t.abrupt("return",{status:"success",source:"translated",translatedCount:O.size,fromCache:l.size});case 72:return t.prev=72,t.t7=t.catch(34),t.next=76,Ht.processError(t.t7);case 76:return A=t.sent,t.next=79,this.translationHandler.errorHandler.handle(A,{type:A.type||Rt.SERVICE,context:"EventHandler-handleSelect_ElementClick"});case 79:return t.abrupt("return",{status:"error",reason:"exception",message:A.message});case 80:return t.prev=80,f&&this.notifier.dismiss(f),t.finish(80);case 83:case"end":return t.stop()}}),t,this,[[34,72,80,83]])}))),function(t){return i.apply(this,arguments)})},{key:"handleEscape",value:function(t){Kt(!1),this.cancelSelectionTranslation(),this.SelectionWindows.cancelCurrentTranslation(),this.translationHandler.select_Element_ModeActive=!1,y.selectElementActive=!1,y.translateMode===d.SelectElement&&function(t){Hi.apply(this,arguments)}({state:y,errorHandler:this.translationHandler.errorHandler,notifier:this.notifier,IconManager:this.IconManager}),this.IconManager&&this.IconManager.cleanup()}},{key:"handleCtrlSlash",value:(o=ka(Ea().mark((function t(e){var r,n,o,i,a,c;return Ea().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Xt("[EventHandler] Handling Ctrl+/ event"),e.preventDefault(),e.stopPropagation(),!this.isProcessing){t.next=5;break}return t.abrupt("return");case 5:if(this.isProcessing=!0,t.prev=6,(r=this.translationHandler.getSelectElementContext()).select_element,n=r.activeElement,Wt(n)){t.next=10;break}return t.abrupt("return");case 10:if(o=this.translationHandler.extractFromActiveElement(n)){t.next=13;break}return t.abrupt("return");case 13:return t.next=15,this.translationHandler.processTranslation_with_CtrlSlash({text:o,originalText:o,target:n,selectionRange:null});case 15:t.next=26;break;case 17:return t.prev=17,t.t0=t.catch(6),t.next=21,Ht.processError(t.t0);case 21:if(t.t0=t.sent,Xt("[EventHandler] Ctrl+/ Error: ",t.t0),!t.t0.isFinal){t.next=25;break}return t.abrupt("return");case 25:null!==(i=t.t0.originalError)&&void 0!==i&&i.isPrimary||(a=t.t0.type||Rt.API,c=t.t0.statusCode||500,this.translationHandler.errorHandler.handle(t.t0,{type:a,statusCode:c,context:"ctrl-slash",suppressSecondary:!0}));case 26:return t.prev=26,this.isProcessing=!1,t.finish(26);case 29:case"end":return t.stop()}}),t,this,[[6,17,26,29]])}))),function(t){return o.apply(this,arguments)})}],r&&Ta(t.prototype,r),n&&Ta(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i,a,c,s,u,l}(),Oa(ga.prototype,"handleEvent",[zt],Object.getOwnPropertyDescriptor(ga.prototype,"handleEvent"),ga.prototype),Oa(ga.prototype,"handleMouseUp",[zt],Object.getOwnPropertyDescriptor(ga.prototype,"handleMouseUp"),ga.prototype),Oa(ga.prototype,"handleSelect_ElementClick",[zt],Object.getOwnPropertyDescriptor(ga.prototype,"handleSelect_ElementClick"),ga.prototype),ga);function Aa(t){return Aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Aa(t)}function Pa(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],s=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ia(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ia(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ia(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Na(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ja(n.key),n)}}function ja(t){var e=function(t,e){if("object"!=Aa(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Aa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Aa(e)?e:e+""}var Ca=function(){return t=function t(){var r,n,o,i,a,c,s=this,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.keyMap={EXTENSION_ENABLED:"EXTENSION_ENABLED",TRANSLATE_ON_TEXT_FIELDS:"TEXT_FIELDS",ENABLE_SHORTCUT_FOR_TEXT_FIELDS:"SHORTCUT_TEXT_FIELDS",TRANSLATE_WITH_SELECT_ELEMENT:"SELECT_ELEMENT",TRANSLATE_ON_TEXT_SELECTION:"TEXT_SELECTION",ENABLE_DICTIONARY:"DICTIONARY"},this.flags={EXTENSION_ENABLED:null===(r=u.EXTENSION_ENABLED)||void 0===r||r,TEXT_FIELDS:null!==(n=u.TEXT_FIELDS)&&void 0!==n?n:p.TRANSLATE_ON_TEXT_FIELDS,SHORTCUT_TEXT_FIELDS:null!==(o=u.SHORTCUT_TEXT_FIELDS)&&void 0!==o?o:p.ENABLE_SHORTCUT_FOR_TEXT_FIELDS,SELECT_ELEMENT:null!==(i=u.SELECT_ELEMENT)&&void 0!==i?i:p.TRANSLATE_WITH_SELECT_ELEMENT,TEXT_SELECTION:null!==(a=u.TEXT_SELECTION)&&void 0!==a?a:p.TRANSLATE_ON_TEXT_SELECTION,DICTIONARY:null!==(c=u.DICTIONARY)&&void 0!==c?c:p.ENABLE_DICTIONARY},this._subscribers={},e().storage.local.get(Object.keys(this.keyMap)).then((function(t){Object.entries(t).forEach((function(t){var e,r=Pa(t,2),n=r[0],o=r[1],i=s.keyMap[n];i&&void 0!==o&&(s.flags[i]=o,null===(e=s._subscribers[i])||void 0===e||e.forEach((function(t){return t()})))}))})).catch((function(t){console.warn("[FeatureManager] failed to load initial flags",t)})),e().storage.onChanged.addListener(this._onStorageChanged.bind(this))},(r=[{key:"isOn",value:function(t){return this.flags[t]}},{key:"on",value:function(t,e){var r,n;(null!==(n=(r=this._subscribers)[t])&&void 0!==n?n:r[t]=[]).push(e)}},{key:"_onStorageChanged",value:function(t){var e=this;Object.entries(t).forEach((function(t){var r=Pa(t,2),n=r[0],o=r[1].newValue,i=e.keyMap[n];if(i){var a,c=null!=o?o:e.flags[i];e.flags[i]!==c&&(e.flags[i]=c,null===(a=e._subscribers[i])||void 0===a||a.forEach((function(t){return t()})))}}))}}])&&Na(t.prototype,r),n&&Na(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n}();function Ra(t){return Ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ra(t)}function Ga(){Ga=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Ra(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ra(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Fa(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Ma(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Fa(i,n,o,a,c,"next",t)}function c(t){Fa(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Da(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ha(n.key),n)}}function Ha(t){var e=function(t,e){if("object"!=Ra(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ra(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ra(e)?e:e+""}var Ua,Ba=function(){return t=function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.translationHandler=e,this.errorHandler=e.errorHandler;var o=function(t){return function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];try{return t.apply(n,r)}catch(t){var i;!function(t){Ut.apply(this,arguments)}(t,{type:Rt.UI,context:"event-router",eventType:null===(i=r[0])||void 0===i?void 0:i.type})}}};this.handleFocus=o(this.handleFocusMethod),this.handleBlur=o(this.handleBlurMethod),this.handleClick=o(this.handleClickMethod),this.handleKeyDown=o(this.handleKeyDownMethod),this.handleMouseOver=o(this.handleMouseOverMethod),this.handleMouseUp=o(this.handleMouseUpMethod),this.featureManager=r,this._attached=new Set,this.featureEventMap={TEXT_FIELDS:[{target:document,type:"focus",listener:this.handleFocus,options:!0},{target:document,type:"blur",listener:this.handleBlur,options:!0}],SHORTCUT_TEXT_FIELDS:[{target:document,type:"keydown",listener:this.handleKeyDown}],SELECT_ELEMENT:[{target:document,type:"mouseover",listener:this.handleMouseOver},{target:document,type:"click",listener:this.handleClick}],TEXT_SELECTION:[{target:document,type:"mouseup",listener:this.handleMouseUp}]},this.initEventListeners(),this.featureManager.on("EXTENSION_ENABLED",(function(){return n.initEventListeners()})),Object.keys(this.featureEventMap).forEach((function(t){n.featureManager.on(t,(function(){return n.updateListeners(t)}))}))},e=[{key:"initEventListeners",value:function(){var t=this,e=this.featureManager.isOn("EXTENSION_ENABLED");Object.keys(this.featureEventMap).forEach((function(r){e?t.updateListeners(r):t.removeListeners(r)}))}},{key:"updateListeners",value:function(t){var e=this,r=this.featureManager.isOn(t)&&this.featureManager.isOn("EXTENSION_ENABLED");this.featureEventMap[t].forEach((function(n){var o=n.target,i=n.type,a=n.listener,c=n.options,s="".concat(i,"_").concat(t);r&&!e._attached.has(s)?(o.addEventListener(i,a,c),e._attached.add(s)):!r&&e._attached.has(s)&&(o.removeEventListener(i,a,c),e._attached.delete(s))}))}},{key:"removeListeners",value:function(t){var e=this;this.featureEventMap[t].forEach((function(r){var n=r.target,o=r.type,i=r.listener,a=r.options,c="".concat(o,"_").concat(t);e._attached.has(c)&&(n.removeEventListener(o,i,a),e._attached.delete(c))}))}},{key:"handleFocusMethod",value:(u=Ma(Ga().mark((function t(e){return Ga().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.featureManager.isOn("TEXT_FIELDS")&&e.target.isContentEditable&&this.translationHandler.handleEditableFocus(e.target);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"handleBlurMethod",value:(s=Ma(Ga().mark((function t(e){return Ga().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.featureManager.isOn("TEXT_FIELDS")&&e.target.isContentEditable&&this.translationHandler.handleEditableBlur(e.target);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"handleClickMethod",value:(c=Ma(Ga().mark((function t(e){return Ga().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(y.selectElementActive){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.translationHandler.eventHandler.handleSelect_ElementClick(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"handleKeyDownMethod",value:(a=Ma(Ga().mark((function t(e){return Ga().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.translationHandler.handleEvent(e);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"handleMouseOverMethod",value:(i=Ma(Ga().mark((function t(e){var r,n,o,i;return Ga().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(y.selectElementActive){t.next=2;break}return t.abrupt("return");case 2:if(null!=(i=(null===(r=e.composedPath)||void 0===r?void 0:r.call(e)[0])||e.target)&&null!==(n=i.innerText)&&void 0!==n&&n.trim()){t.next=5;break}return t.abrupt("return");case 5:(null===(o=y.highlightedElement)||void 0===o||null===(o=o.style)||void 0===o?void 0:o.outline)&&(y.highlightedElement.style.outline=""),y.highlightedElement=i,i.style.outline=p.HIGHLIGHT_STYLE;case 8:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})},{key:"handleMouseUpMethod",value:(o=Ma(Ga().mark((function t(e){return Ga().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.translationHandler.handleEvent(e);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"dispose",value:(n=Ma(Ga().mark((function t(){var e=this;return Ga().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Object.keys(this.featureEventMap).forEach((function(t){return e.removeListeners(t)}));case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],e&&Da(t.prototype,e),r&&Da(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,s,u}();function $a(t){return $a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$a(t)}function za(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],s=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);s=!0);}catch(t){u=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ya(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ya(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ya(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Xa(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Wa(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xa(Object(r),!0).forEach((function(e){qa(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xa(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function qa(t,e,r){return(e=Ka(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Va(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ka(n.key),n)}}function Ka(t){var e=function(t,e){if("object"!=$a(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=$a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==$a(e)?e:e+""}function Za(t,e,r,n,o){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(t,e,i),null):i}function Ja(){Ja=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==$a(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError($a(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Qa(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function tc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Qa(i,n,o,a,c,"next",t)}function c(t){Qa(i,n,o,a,c,"throw",t)}a(void 0)}))}}var ec=(Ua=function(){return t=function t(){var e,r,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=new nt,this.errorHandler=new Ht(this.notifier),this.ErrorTypes=Rt,this.handleEvent=(e=this.handleEvent.bind(this),r=300,function(){for(var t=this,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];clearTimeout(n),n=setTimeout((function(){clearTimeout(n),e.apply(t,i)}),r)}),this.strategies=qa(qa(qa(qa(qa(qa(qa(qa(qa({},ki,new mn(this.notifier,this.errorHandler)),_i,new An(this.notifier,this.errorHandler)),Si,new so(this.notifier,this.errorHandler)),Ti,new Zn(this.notifier,this.errorHandler)),Oi,new Hn(this.notifier,this.errorHandler)),Ai,new wo(this.notifier,this.errorHandler)),Pi,new Io(this.notifier,this.errorHandler)),Li,new Uo(this.notifier,this.errorHandler)),Ii,new Jo(this.notifier,this.errorHandler)),this.validateStrategies(),this.IconManager=new ni(this.errorHandler),this.displayedErrors=new Set,this.isProcessing=!1,this.select_Element_ModeActive=!1,this.featureManager=new Ca({TEXT_FIELDS:p.TRANSLATE_ON_TEXT_FIELDS,SHORTCUT_TEXT_FIELDS:p.ENABLE_SHORTCUT_FOR_TEXT_FIELDS,SELECT_ELEMENT:p.TRANSLATE_WITH_SELECT_ELEMENT,TEXT_SELECTION:p.TRANSLATE_ON_TEXT_SELECTION,DICTIONARY:p.ENABLE_DICTIONARY}),this.eventHandler=new Sa(this,this.featureManager),this.eventRouter=new Ba(this,this.featureManager)},e=[{key:"reinitialize",value:function(){Xt("[TranslationHandler] Reinitializing TranslationHandler state after update..."),this.isProcessing=!1,this.select_Element_ModeActive=!1}},{key:"handleEvent",value:(u=tc(Ja().mark((function t(e){return Ja().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.eventHandler.handleEvent(e);case 3:t.next=10;break;case 5:return t.prev=5,t.t0=t.catch(0),t.next=9,this.errorHandler.handle(t.t0,{type:t.t0.type||Rt.UI,context:"handleEvent",eventType:e.type});case 9:throw t.sent;case 10:case"end":return t.stop()}}),t,this,[[0,5]])}))),function(t){return u.apply(this,arguments)})},{key:"handleError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var r=t instanceof Error?t:new Error(String(t));this.errorHandler.handle(r,Wa(Wa({},e),{},{origin:"TranslationHandler"}))}catch(t){throw Xt("[TranslationHandler] Error handling failed:",t),this.errorHandler.handle(t,{type:Rt.UI,context:"TranslationHandler-handleError"})}}},{key:"handleEditableFocus",value:function(t){this.eventHandler.handleEditableFocus(t)}},{key:"handleEditableBlur",value:function(){this.eventHandler.handleEditableBlur()}},{key:"handleEscape",value:function(t){this.eventHandler.handleEscape(t)}},{key:"handleCtrlSlash",value:(s=tc(Ja().mark((function t(e){return Ja().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.eventHandler.handleCtrlSlash(e);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"handleEditableElement",value:(c=tc(Ja().mark((function t(e){return Ja().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.eventHandler.handleEditableElement(e);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"processTranslation_with_CtrlSlash",value:(a=tc(Ja().mark((function t(e){var r,n,o,i;return Ja().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=this.notifier,t.next=3,mt("STATUS_TRANSLATING_CTRLSLASH");case 3:if(t.t1=t.sent,t.t1){t.next=6;break}t.t1="(translating...)";case 6:if(t.t2=t.t1,r=t.t0.show.call(t.t0,t.t2,"status"),t.prev=8,qt()){t.next=13;break}if(e.target){t.next=13;break}return this.errorHandler.handle(new Error(Rt.CONTEXT),{type:Rt.CONTEXT,context:"TranslationHandler-processTranslation-context",code:"context-invalid",statusCode:"context-invalid"}),t.abrupt("return");case 13:return y.translateMode=e.selectionRange?d.SelectElement:d.Field,t.next=16,ia({text:e.text,translationHandler:this,target:e.target,selectionRange:e.selectionRange});case 16:t.next=31;break;case 18:return t.prev=18,t.t3=t.catch(8),t.next=22,Ht.processError(t.t3);case 22:return n=t.sent,t.next=25,this.errorHandler.handle(n,{type:n.type||Rt.CONTEXT,context:"TranslationHandler-processTranslation",translationParams:e,isPrimary:!0});case 25:if(!(o=t.sent).isFinal&&!o.suppressSecondary){t.next=28;break}return t.abrupt("return");case 28:throw i=new Error(o.message),Object.assign(i,{type:o.type,statusCode:o.statusCode,isFinal:!0,originalError:t.t3}),i;case 31:return t.prev=31,r&&this.notifier.dismiss(r),t.finish(31);case 34:case"end":return t.stop()}}),t,this,[[8,18,31,34]])}))),function(t){return a.apply(this,arguments)})},{key:"validateStrategies",value:(i=tc(Ja().mark((function t(){return Ja().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{Object.entries(this.strategies).forEach((function(t){var e=za(t,2),r=e[0];if("function"!=typeof e[1].extractText)throw new Error("استراتژی ".concat(r," متد extractText را پیاده‌سازی نکرده است"))}))}catch(t){this.errorHandler.handle(t,{type:Rt.INTEGRATION,context:"strategy-validation"})}case 1:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"handleSelect_ElementTranslation",value:(o=tc(Ja().mark((function t(e,r,n){var o;return Ja().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"string"==typeof n||n){t.next=3;break}return t.abrupt("return");case 3:if(null===(o=this.strategies[e])||void 0===o||!o.updateElement){t.next=8;break}return t.next=6,this.strategies[e].updateElement(r.selectionRange,n);case 6:t.next=9;break;case 8:this.errorHandler.handle(new Error("متد updateElement برای ".concat(e," تعریف نشده")),{type:Rt.UI,context:"select-element-translation-updateElement",platform:e});case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.SERVICE,context:"select-element-translation",platform:e});case 14:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(t,e,r){return o.apply(this,arguments)})},{key:"updateTargetElement",value:(n=tc(Ja().mark((function t(e,r){var n,o;return Ja().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,"string"!=typeof r||!r){t.next=7;break}if(o=Ni(),null===(n=this.strategies[o])||void 0===n||!n.updateElement||"function"!=typeof this.strategies[o].updateElement){t.next=7;break}return t.next=6,this.strategies[o].updateElement(e,r);case 6:return t.abrupt("return",t.sent);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),this.errorHandler.handle(t.t0,{type:Rt.SERVICE,context:"update-target-element",platform:Ni()});case 12:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(t,e){return n.apply(this,arguments)})},{key:"getSelectElementContext",value:function(){return{select_element:window.getSelection(),activeElement:document.activeElement}}},{key:"extractFromActiveElement",value:function(t){var e=Ni(),r=this.strategies[e];return r&&"function"==typeof r.extractText?r.extractText(t):(this.errorHandler.handle(new Error("extractText method not implemented for this platform"),{type:Rt.SERVICE,context:"TranslationHandler-extractFromActiveElement-".concat(e)}),"")}},{key:"pasteContent",value:function(t,e){try{var r=Ni();this.strategies[r].pasteContent(t,e)}catch(t){this.errorHandler.handle(t,{type:Rt.UI,context:"paste-content",platform:Ni()})}}}],e&&Va(t.prototype,e),r&&Va(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,s,u}(),Za(Ua.prototype,"reinitialize",[zt],Object.getOwnPropertyDescriptor(Ua.prototype,"reinitialize"),Ua.prototype),Za(Ua.prototype,"handleEvent",[zt],Object.getOwnPropertyDescriptor(Ua.prototype,"handleEvent"),Ua.prototype),Za(Ua.prototype,"handleError",[zt],Object.getOwnPropertyDescriptor(Ua.prototype,"handleError"),Ua.prototype),Za(Ua.prototype,"processTranslation_with_CtrlSlash",[zt],Object.getOwnPropertyDescriptor(Ua.prototype,"processTranslation_with_CtrlSlash"),Ua.prototype),Za(Ua.prototype,"handleSelect_ElementTranslation",[zt],Object.getOwnPropertyDescriptor(Ua.prototype,"handleSelect_ElementTranslation"),Ua.prototype),Za(Ua.prototype,"updateTargetElement",[zt],Object.getOwnPropertyDescriptor(Ua.prototype,"updateTargetElement"),Ua.prototype),Za(Ua.prototype,"pasteContent",[zt],Object.getOwnPropertyDescriptor(Ua.prototype,"pasteContent"),Ua.prototype),Ua),rc=null,nc=null;function oc(t){return oc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oc(t)}function ic(){ic=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==oc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(oc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ac(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function cc(){return sc.apply(this,arguments)}function sc(){var t;return t=ic().mark((function t(){var r,n,o,i,a,c,s,u=arguments;return ic().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=u.length>0&&void 0!==u[0]?u[0]:null,n=u.length>1&&void 0!==u[1]&&u[1],o=u.length>2&&void 0!==u[2]&&u[2],t.prev=3,t.next=6,e().tabs.query({active:!0,currentWindow:!0});case 6:if(0!==(i=t.sent).length){t.next=9;break}return t.abrupt("return");case 9:return i[0].id,a=!1,t.next=13,e().storage.local.get(["selectElementState"]);case 13:if(c=t.sent,a=c.selectElementState,null===r&&(r=!a),!o&&r===a){t.next=23;break}return t.next=19,e().storage.local.set({selectElementState:r});case 19:return t.next=21,e().runtime.sendMessage({action:"activateSelectElementMode",data:r});case 21:s=t.sent,Xt("Select Mode Updated:",s);case 23:n&&window.close(),t.next=29;break;case 26:t.prev=26,t.t0=t.catch(3),Xt("Error in Active_SelectElement:",t.t0);case 29:case"end":return t.stop()}}),t,null,[[3,26]])})),sc=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ac(i,n,o,a,c,"next",t)}function c(t){ac(i,n,o,a,c,"throw",t)}a(void 0)}))},sc.apply(this,arguments)}function uc(t){return uc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uc(t)}function lc(){lc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==uc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(uc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function fc(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function hc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){fc(i,n,o,a,c,"next",t)}function c(t){fc(i,n,o,a,c,"throw",t)}a(void 0)}))}}!function(){if(!nc){var t=(rc||(rc=new ec),rc);e=t,r=t.featureManager,nc=new Ba(e,r)}var e,r}();function pc(){var t,r,n,o,i;null===(t=te.clearStorageBtn)||void 0===t||t.addEventListener("click",(function(){e().storage.local.remove("lastTranslation").then(hc(lc().mark((function t(){var e;return lc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return te.sourceText.value="",te.translationResult.textContent="",re(te.sourceText),re(te.translationResult),te.sourceLanguageInput.value=oe,t.prev=5,t.next=8,R();case 8:e=t.sent,te.targetLanguageInput.value=fe(e),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),te.targetLanguageInput.value=fe("en");case 15:return t.prev=15,ee(te.targetLanguageInput,te.clearTargetLanguage),t.finish(15);case 18:ee(te.sourceLanguageInput,te.clearSourceLanguage),te.sourceText.focus(),Xt("[HeaderActions]: Translation history and fields cleared."),Te();case 22:case"end":return t.stop()}}),t,null,[[5,12,15,18]])})))).catch((function(t){Xt("[HeaderActions]: Error removing last translation:",t)}))})),null===(r=te.translatePageLink)||void 0===r||r.addEventListener("click",(function(){Xt("[HeaderActions]: Translate page icon clicked - using Google Translate tab.");var t=te.targetLanguageInput.value,r=ie(t);r&&r!==oe||(Xt("[HeaderActions]: Invalid target language for page translation: '".concat(t,"'. Defaulting to 'en'.")),r="en"),e().tabs.query({active:!0,currentWindow:!0}).then((function(t){var n;if(t.length>0&&null!==(n=t[0])&&void 0!==n&&n.url){var o=t[0].url;if(!o.startsWith("http"))return Xt("[HeaderActions]: Cannot translate non-HTTP(S) URL: ".concat(o)),void window.close();var i=encodeURIComponent(o),a="https://translate.google.com/translate?sl=auto&tl=".concat(r,"&u=").concat(i);Xt("[HeaderActions]: Opening Google Translate for page: ".concat(a)),e().tabs.create({url:a}),window.close()}else Xt("[HeaderActions]: No active tab found or URL is missing."),window.close()})).catch((function(t){Xt("[HeaderActions]: Error querying active tab:",t),window.close()}))})),null===(n=te.settingsIcon)||void 0===n||n.addEventListener("click",(function(){Xt("[Popup]: Opening options page."),Vt(),window.close()})),null===(o=te.selectElementIcon)||void 0===o||o.addEventListener("click",(function(){Xt("[HeaderActions]: Select element icon clicked."),cc(!0,!0)})),null===(i=te.revertIcon)||void 0===i||i.addEventListener("click",(function(){e().runtime.sendMessage({action:"revertTranslation"}).catch((function(t){Xt("[Popup-Header] Could not send revert message:",t)})),window.close()})),Xt("[HeaderActions]: Initialized.")}function dc(t){return dc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dc(t)}function yc(){yc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==dc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(dc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function vc(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function gc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){vc(i,n,o,a,c,"next",t)}function c(t){vc(i,n,o,a,c,"throw",t)}a(void 0)}))}}function mc(){return bc.apply(this,arguments)}function bc(){return bc=gc(yc().mark((function t(){var r,n=arguments;return yc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=!(n.length>0&&void 0!==n[0])||n[0],t.abrupt("return",new Promise(function(){var t=gc(yc().mark((function t(n){var o,i,a;return yc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e().storage.local.get(["lastTranslation"]);case 3:if(o=t.sent,i="",o.lastTranslation?(Xt("[InitManager]: Loading last translation from storage."),te.sourceText.value=o.lastTranslation.sourceText||"",st(te.sourceText,o.lastTranslation.sourceText),te.translationResult.innerHTML=zr.parse(o.lastTranslation.translatedText||""),st(te.translationResult,o.lastTranslation.translatedText),te.sourceLanguageInput.value=fe(o.lastTranslation.sourceLanguage)||oe,i=fe(o.lastTranslation.targetLanguage)):(Xt("[InitManager]: No last translation found in storage."),te.sourceText.value="",te.translationResult.textContent="",te.sourceLanguageInput.value=oe),(!r||i)&&i!==oe){t.next=18;break}return t.prev=7,t.next=10,R();case 10:a=t.sent,i=fe(a)||fe("en"),t.next=18;break;case 14:t.prev=14,t.t0=t.catch(7),Xt("[InitManager]: Error getting default target language:",t.t0),i=fe("en");case 18:i&&(te.targetLanguageInput.value=i),ee(te.sourceLanguageInput,te.clearSourceLanguage),ee(te.targetLanguageInput,te.clearTargetLanguage),re(te.sourceText),re(te.translationResult),n(),t.next=30;break;case 26:t.prev=26,t.t1=t.catch(0),Xt("[InitManager]: Error loading last translation:",t.t1),n();case 30:case"end":return t.stop()}}),t,null,[[0,26],[7,14]])})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)}))),bc.apply(this,arguments)}function wc(){return xc.apply(this,arguments)}function xc(){return xc=gc(yc().mark((function t(){return yc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=gc(yc().mark((function t(r){var n,o,i,a;return yc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e().tabs.query({active:!0,currentWindow:!0});case 3:if(!((n=t.sent).length>0&&null!=n[0].id)){t.next=40;break}return o=n[0].id,t.prev=6,a={},t.prev=8,t.next=11,e().tabs.sendMessage(o,{action:"getSelectedText"});case 11:a=t.sent,t.next=17;break;case 14:t.prev=14,t.t0=t.catch(8),Xt("[InitManager]: Failed to sendMessage to content script: ".concat(t.t0.message));case 17:if(null===(i=a)||void 0===i||!i.selectedText){t.next=28;break}Xt("[InitManager]: Received selected text from content script."),te.sourceText.value=a.selectedText,te.translationResult.textContent="",te.sourceLanguageInput.value=oe,ee(te.sourceLanguageInput,te.clearSourceLanguage),ee(te.targetLanguageInput,te.clearTargetLanguage),re(te.sourceText),re(te.translationResult),t.next=31;break;case 28:return Xt("[InitManager]: No selected text received. Loading from storage."),t.next=31,mc();case 31:t.next=38;break;case 33:return t.prev=33,t.t1=t.catch(6),Xt("[InitManager]: Error getting selected text (Tab ".concat(o,"): ").concat(t.t1.message,". Loading from storage.")),t.next=38,mc();case 38:t.next=43;break;case 40:return Xt("[InitManager]: No active/valid tab. Loading from storage."),t.next=43,mc();case 43:r(),t.next=50;break;case 46:t.prev=46,t.t2=t.catch(0),Xt("[InitManager]: Error loading initial state:",t.t2),r();case 50:case"end":return t.stop()}}),t,null,[[0,46],[6,33],[8,14]])})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)}))),xc.apply(this,arguments)}function Ec(){return Lc.apply(this,arguments)}function Lc(){return(Lc=gc(yc().mark((function t(){return yc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,wc();case 2:Xt("[InitManager]: Initialized.");case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function kc(t){return kc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kc(t)}function Tc(){Tc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==kc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(kc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function _c(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function Oc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){_c(i,n,o,a,c,"next",t)}function c(t){_c(i,n,o,a,c,"throw",t)}a(void 0)}))}}var Sc=!1,Ac=null,Pc=null,Ic=null,Nc=!1;function jc(){Pc&&(clearTimeout(Pc),Pc=null)}function Cc(){Ac&&(clearTimeout(Ac),Ac=null)}function Rc(){Ic&&(clearTimeout(Ic),Ic=null)}function Gc(){return Fc.apply(this,arguments)}function Fc(){return(Fc=Oc(Tc().mark((function t(){var e,r;return Tc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j();case 2:return e=t.sent,t.next=5,K();case 5:if(r=t.sent,!e||!r){t.next=11;break}return setTimeout((function(){cc(!0,!1,!0)}),100),t.abrupt("return",!0);case 11:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Mc(){return Dc.apply(this,arguments)}function Dc(){return(Dc=Oc(Tc().mark((function t(){return Tc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=3,Gc();case 3:t.sent&&(e=void 0,r=void 0,n=void 0,null===(e=te.popupContainer)||void 0===e||e.addEventListener("mouseenter",(function(){Sc=!0,jc("mouseenter"),Rc(),Nc||(Ac=setTimeout((function(){Nc=!0,cc(!1)}),1e3))})),null===(r=te.popupContainer)||void 0===r||r.addEventListener("mouseleave",(function(){Sc=!1,Cc(),Nc||(Pc=setTimeout((function(){cc(!0,!0)}),800))})),null===(n=te.popupContainer)||void 0===n||n.addEventListener("mousedown",(function(){Nc||(Nc=!0,Cc(),jc("mousedown"),Rc(),cc(!1))})),Ic=setTimeout((function(){Sc||Nc||cc(!0,!0)}),800));case 6:case"end":return t.stop()}var e,r,n}),t)})))).apply(this,arguments)}function Hc(t){return Hc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hc(t)}function Uc(){Uc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new P(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};u(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(I([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function r(o,i,a,c){var s=f(t[o],t,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==Hc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var s=O(c,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?y:p,u.arg===v)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function I(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Hc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=u(b,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,s,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},k(T.prototype),u(T.prototype,c,(function(){return this})),e.AsyncIterator=T,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new T(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(L),u(L,s,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=I,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Bc(t,e,r,n,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(n,o)}function $c(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Bc(i,n,o,a,c,"next",t)}function c(t){Bc(i,n,o,a,c,"throw",t)}a(void 0)}))}}document.addEventListener("DOMContentLoaded",$c(Uc().mark((function t(){return Uc().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Xt("[Popup Main]: DOMContentLoaded event fired."),t.prev=1,t.next=4,ve();case 4:return t.next=6,Oe();case 6:return je(),tn(),pc(),t.next=11,Ec();case 11:return t.next=13,Mc();case 13:try{browser.runtime.connect({name:"popup"}).postMessage({action:"popupOpened"})}catch(t){Xt("[Popup Main]: Failed to connect popup port:",t.message)}Xt("[Popup Main]: All modules initialized successfully."),t.next=22;break;case 17:t.prev=17,t.t0=t.catch(1),Xt("[Popup Main]: Error during initialization:",t.t0),Xt("Popup initialization failed:",t.t0),document.body.innerHTML='<div style="padding: 10px; color: red;">[AIWC] Failed to initialize extension popup. Please try reloading.</div>';case 22:return t.prev=22,xt(p.APPLICATION_LOCALIZE),t.finish(22);case 25:case"end":return t.stop()}}),t,null,[[1,17,22,25]])}))))})()})();