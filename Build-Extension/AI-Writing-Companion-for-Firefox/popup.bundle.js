/*! For license information please see popup.bundle.js.LICENSE.txt */
(()=>{var t={63675:function(t,e){var r,n,o;!function(){if(1)n=[t],r=function(t){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const e="The message port closed before a response was received.",r=t=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class n extends WeakMap{constructor(t,e=void 0){super(e),this.createItem=t}get(t){return this.has(t)||this.set(t,this.createItem(t)),super.get(t)}}const o=t=>t&&"object"==typeof t&&"function"==typeof t.then,i=(e,r)=>(...n)=>{t.runtime.lastError?e.reject(new Error(t.runtime.lastError.message)):r.singleCallbackArg||n.length<=1&&!1!==r.singleCallbackArg?e.resolve(n[0]):e.resolve(n)},a=t=>1==t?"argument":"arguments",c=(t,e)=>function(r,...n){if(n.length<e.minArgs)throw new Error(`Expected at least ${e.minArgs} ${a(e.minArgs)} for ${t}(), got ${n.length}`);if(n.length>e.maxArgs)throw new Error(`Expected at most ${e.maxArgs} ${a(e.maxArgs)} for ${t}(), got ${n.length}`);return new Promise(((o,a)=>{if(e.fallbackToNoCallback)try{r[t](...n,i({resolve:o,reject:a},e))}catch(i){console.warn(`${t} API method doesn't seem to support the callback parameter, `+"falling back to call it without a callback: ",i),r[t](...n),e.fallbackToNoCallback=!1,e.noCallback=!0,o()}else e.noCallback?(r[t](...n),o()):r[t](...n,i({resolve:o,reject:a},e))}))},u=(t,e,r)=>new Proxy(e,{apply:(e,n,o)=>r.call(n,t,...o)});let s=Function.call.bind(Object.prototype.hasOwnProperty);const l=(t,e={},r={})=>{let n=Object.create(null),o={has:(e,r)=>r in t||r in n,get(o,i,a){if(i in n)return n[i];if(!(i in t))return;let f=t[i];if("function"==typeof f)if("function"==typeof e[i])f=u(t,t[i],e[i]);else if(s(r,i)){let e=c(i,r[i]);f=u(t,t[i],e)}else f=f.bind(t);else if("object"==typeof f&&null!==f&&(s(e,i)||s(r,i)))f=l(f,e[i],r[i]);else{if(!s(r,"*"))return Object.defineProperty(n,i,{configurable:!0,enumerable:!0,get:()=>t[i],set(e){t[i]=e}}),f;f=l(f,e[i],r["*"])}return n[i]=f,f},set:(e,r,o,i)=>(r in n?n[r]=o:t[r]=o,!0),defineProperty:(t,e,r)=>Reflect.defineProperty(n,e,r),deleteProperty:(t,e)=>Reflect.deleteProperty(n,e)},i=Object.create(t);return new Proxy(i,o)},f=t=>({addListener(e,r,...n){e.addListener(t.get(r),...n)},hasListener:(e,r)=>e.hasListener(t.get(r)),removeListener(e,r){e.removeListener(t.get(r))}}),h=new n((t=>"function"!=typeof t?t:function(e){const r=l(e,{},{getContent:{minArgs:0,maxArgs:0}});t(r)})),p=new n((t=>"function"!=typeof t?t:function(e,r,n){let i,a,c=!1,u=new Promise((t=>{i=function(e){c=!0,t(e)}}));try{a=t(e,r,i)}catch(t){a=Promise.reject(t)}const s=!0!==a&&o(a);if(!0!==a&&!s&&!c)return!1;const l=t=>{t.then((t=>{n(t)}),(t=>{let e;e=t&&(t instanceof Error||"string"==typeof t.message)?t.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:e})})).catch((t=>{console.error("Failed to send onMessage rejected reply",t)}))};return l(s?a:u),!0})),d=({reject:r,resolve:n},o)=>{t.runtime.lastError?t.runtime.lastError.message===e?n():r(new Error(t.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?r(new Error(o.message)):n(o)},y=(t,e,r,...n)=>{if(n.length<e.minArgs)throw new Error(`Expected at least ${e.minArgs} ${a(e.minArgs)} for ${t}(), got ${n.length}`);if(n.length>e.maxArgs)throw new Error(`Expected at most ${e.maxArgs} ${a(e.maxArgs)} for ${t}(), got ${n.length}`);return new Promise(((t,e)=>{const o=d.bind(null,{resolve:t,reject:e});n.push(o),r.sendMessage(...n)}))},v={devtools:{network:{onRequestFinished:f(h)}},runtime:{onMessage:f(p),onMessageExternal:f(p),sendMessage:y.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:y.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},g={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":g},services:{"*":g},websites:{"*":g}},l(t,v,r)};t.exports=r(chrome)}},void 0===(o="function"==typeof r?r.apply(e,n):r)||(t.exports=o);else;}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self)}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t["default"]:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=r(63675),e=r.n(t);function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(){o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function h(t,e,r,n){var o=e&&e.prototype instanceof b?e:b,i=Object.create(o.prototype),c=new P(n||[]);return a(i,"_invoke",{value:S(t,r,c)}),i}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var d="suspendedStart",y="suspendedYield",v="executing",g="completed",m={};function b(){}function w(){}function x(){}var E={};f(E,u,(function(){return this}));var L=Object.getPrototypeOf,T=L&&L(L(j([])));T&&T!==r&&i.call(T,u)&&(E=T);var k=x.prototype=b.prototype=Object.create(E);function _(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,a,c,u){var s=p(t[o],t,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==n(f)&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var o;a(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}})}function S(e,r,n){var o=d;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=A(c,n);if(u){if(u===m)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var s=p(e,r,n);if("normal"===s.type){if(o=n.done?g:y,s.arg===m)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=g,n.method="throw",n.arg=s.arg)}}}function A(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function j(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(i.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=x,a(k,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,f(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},_(O.prototype),f(O.prototype,s,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new O(h(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},_(k),f(k,l,"Generator"),f(k,u,(function(){return this})),f(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=j,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),s=i.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:j(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function s(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){u(i,n,o,a,c,"next",t)}function c(t){u(i,n,o,a,c,"throw",t)}a(void 0)}))}}var l={APP_NAME:"AI Writing Companion",USE_MOCK:!1,DEBUG_MODE:!1,EXTENSION_ENABLED:!0,APPLICATION_LOCALIZE:"Farsi",SOURCE_LANGUAGE:"English",TARGET_LANGUAGE:"Farsi",TRANSLATION_API:"gemini",API_URL:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",API_KEY:"",WEBAI_API_URL:"http://localhost:6969/translate",WEBAI_API_MODEL:"gemini-2.0-flash",OPENAI_API_KEY:"",OPENAI_API_URL:"https://api.openai.com/v1/chat/completions",OPENAI_API_MODEL:"gpt-3.5-turbo",OPENROUTER_API_KEY:"",OPENROUTER_API_URL:"https://openrouter.ai/api/v1/chat/completions",OPENROUTER_API_MODEL:"openai/gpt-3.5-turbo",TRANSLATE_ON_TEXT_FIELDS:!0,ENABLE_SHORTCUT_FOR_TEXT_FIELDS:!0,TRANSLATE_WITH_SELECT_ELEMENT:!0,TRANSLATE_ON_TEXT_SELECTION:!0,REQUIRE_CTRL_FOR_TEXT_SELECTION:!1,ENABLE_DICTIONARY:!0,HIGHTLIH_NEW_ELEMETN_RED:"2px solid red",TRANSLATION_ICON_TITLE:"Translate Text",HIGHLIGHT_STYLE:"2px solid red",ICON_TRANSLATION:"🌐",ICON_SUCCESS:"✅ ",ICON_WARNING:"⚠️ ",ICON_STATUS:"⏳ ",ICON_ERROR:"❌ ",ICON_INFO:"🔵 ",ICON_REVERT:"↩️",NOTIFICATION_ALIGNMENT:"right",NOTIFICATION_TEXT_DIRECTION:"rtl",NOTIFICATION_TEXT_ALIGNMENT:"right",RTL_REGEX:/[\u0591-\u07FF\u0600-\u06FF]/,PERSIAN_REGEX:/^(?=.*[\u0600-\u06FF])[\u0600-\u06FF\u0660-\u0669\u06F0-\u06F9\u0041-\u005A\u0061-\u007A\u0030-\u0039\s.,:;؟!()«»@#\n\t\u200C]+$/,PROMPT_BASE_FIELD:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n  - If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n  - If the input is in any other language, translate it to $_{TARGET}.\n  - If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_BASE_SELECT:'Act as an automated JSON translation service. The input is a JSON array where each object contains a "text" property.\n\n  1. Translate each "text" value according to the given rules: $_{USER_RULES}\n  2. Preserve all input elements. **Do not omit, modify, or skip any entry.**\n  3. If translation is not needed for a specific item (e.g., numbers, hashtags, URLs), **return the original value unchanged.**\n  4. Maintain the internal structure, formatting, and line breaks exactly.\n  5. Output **only** the translated JSON array, with no extra text, explanations, or markdown.\n\n  ```json input\n  $_{TEXT}\n  ```\n    ',PROMPT_BASE_DICTIONARY:'You are a $_{TARGET} dictionary service. Your task is to provide in detailed dictionary definitions while strictly preserving the input structure and formatting. Follow these rules:\n\n  - Provide the translation of the input word or phrase.\n  - Include synonyms, word type (noun, verb, adjective, etc.), and a brief definition.\n  - If applicable, provide example sentences using the word or phrase in context.\n  - If the input is ambiguous, return the most common meanings.\n  - If no definition is found, return "No definition available."\n\n  Return in $_{TARGET} language, and **ONLY** the dictionary entry without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ',PROMPT_BASE_POPUP_TRANSLATE:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in any language, translate it to $_{TARGET}.\n\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_TEMPLATE:"- If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n- If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n- If the input is in any other language, translate it to $_{TARGET}.\n- If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.",DEBUG_TRANSLATED_ENGLISH:"This is a mock translation to English.",DEBUG_TRANSLATED_PERSIAN:"این یک ترجمه آزمایشی به فارسی است.",DEBUG_TRANSLATED_ENGLISH_With_NewLine:"This is a mock \ntranslation to English with \nnew lines.",DEBUG_TRANSLATED_PERSIAN_With_NewLine:"این یک ترجمه آزمایشی \nبرای ترجمه به فارسی \nبا خطوط جدید است."},f="field",h="select_element",p="dictionary",d="popup_translate",y={selectElementActive:!1,highlightedElement:null,activeTranslateIcon:null,originalTexts:new Map,translateMode:null},v=null,g=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(null===v){t.next=2;break}return t.abrupt("return",v);case 2:return t.abrupt("return",e().storage.local.get(null).then((function(t){return v=a(a({},l),t)}))["catch"]((function(t){return oe("Error fetching settings:",t),v=a({},l)})));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();e()&&e().storage&&e().storage.onChanged?e().storage.onChanged.addListener((function(t,e){if("local"===e&&v){Object.keys(t).forEach((function(e){if(l.hasOwnProperty(e)||v&&v.hasOwnProperty(e)){var r=t[e].newValue;v[e]!==r&&(v[e]=r,!0)}}))}})):oe("Browser.storage.onChanged not available. Settings cache might become stale.");var m,b,w,x,E,L,T,k,_,O,S,A,I,N,P,j,C,R,G,F,M,D=function(){var t=s(o().mark((function t(e,r){var n,i;return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,g();case 2:return i=t.sent,t.abrupt("return",null!==(n=null==i?void 0:i[e])&&void 0!==n?n:r);case 4:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),U=(null&&(m=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("USE_MOCK",l.USE_MOCK));case 1:case"end":return t.stop()}}),t)})))),function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("DEBUG_MODE",l.DEBUG_MODE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()),H=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(!v||void 0===v.DEBUG_MODE){t.next=2;break}return t.abrupt("return",v.DEBUG_MODE);case 2:return t.abrupt("return",U());case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),B=(null&&(b=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("API_KEY",l.API_KEY));case 1:case"end":return t.stop()}}),t)})))),null&&(w=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("API_URL",l.API_URL));case 1:case"end":return t.stop()}}),t)})))),function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("APPLICATION_LOCALIZE",l.APPLICATION_LOCALIZE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()),$=(null&&(x=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("APP_NAME",l.APP_NAME));case 1:case"end":return t.stop()}}),t)})))),function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("EXTENSION_ENABLED",l.EXTENSION_ENABLED));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()),z=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("SOURCE_LANGUAGE",l.SOURCE_LANGUAGE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Y=function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("TARGET_LANGUAGE",l.TARGET_LANGUAGE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),X=(null&&(E=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("ENABLE_DICTIONARY",l.ENABLE_DICTIONARY));case 1:case"end":return t.stop()}}),t)})))),null&&(L=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("PROMPT_TEMPLATE",l.PROMPT_TEMPLATE));case 1:case"end":return t.stop()}}),t)})))),null&&(T=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("PROMPT_BASE_DICTIONARY",l.PROMPT_BASE_DICTIONARY));case 1:case"end":return t.stop()}}),t)})))),null&&(k=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("PROMPT_BASE_POPUP_TRANSLATE",l.PROMPT_BASE_POPUP_TRANSLATE));case 1:case"end":return t.stop()}}),t)})))),null&&(_=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("PROMPT_BASE_SELECT",l.PROMPT_BASE_SELECT));case 1:case"end":return t.stop()}}),t)})))),null&&(O=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("PROMPT_BASE_FIELD",l.PROMPT_BASE_FIELD));case 1:case"end":return t.stop()}}),t)})))),null&&(S=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("TRANSLATION_API",l.TRANSLATION_API));case 1:case"end":return t.stop()}}),t)})))),null&&(A=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("WEBAI_API_URL",l.WEBAI_API_URL));case 1:case"end":return t.stop()}}),t)})))),null&&(I=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("WEBAI_API_MODEL",l.WEBAI_API_MODEL));case 1:case"end":return t.stop()}}),t)})))),null&&(N=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("OPENAI_API_KEY",l.OPENAI_API_KEY));case 1:case"end":return t.stop()}}),t)})))),null&&(P=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",l.OPENAI_API_URL);case 1:case"end":return t.stop()}}),t)})))),null&&(j=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("OPENAI_API_MODEL",l.OPENAI_API_MODEL));case 1:case"end":return t.stop()}}),t)})))),null&&(C=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("OPENROUTER_API_KEY",l.OPENROUTER_API_KEY));case 1:case"end":return t.stop()}}),t)})))),null&&(R=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("OPENROUTER_API_MODEL",l.OPENROUTER_API_MODEL));case 1:case"end":return t.stop()}}),t)})))),null&&(G=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("TRANSLATE_ON_TEXT_FIELDS",l.TRANSLATE_ON_TEXT_FIELDS));case 1:case"end":return t.stop()}}),t)})))),null&&(F=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("ENABLE_SHORTCUT_FOR_TEXT_FIELDS",l.ENABLE_SHORTCUT_FOR_TEXT_FIELDS));case 1:case"end":return t.stop()}}),t)})))),function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("TRANSLATE_WITH_SELECT_ELEMENT",l.TRANSLATE_WITH_SELECT_ELEMENT));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()),q=(null&&(M=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("TRANSLATE_ON_TEXT_SELECTION",l.TRANSLATE_ON_TEXT_SELECTION));case 1:case"end":return t.stop()}}),t)})))),function(){var t=s(o().mark((function t(){return o().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",D("REQUIRE_CTRL_FOR_TEXT_SELECTION",l.REQUIRE_CTRL_FOR_TEXT_SELECTION));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}());function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function W(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Q(n.key),n)}}function K(t,e,r){return e&&W(t.prototype,e),r&&W(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Z(t,e,r){return(e=Q(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Q(t){var e=function(t,e){if("object"!=V(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==V(e)?e:e+""}var J=K((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));Z(J,"API","API"),Z(J,"HTTP_ERROR","HTTP_ERROR"),Z(J,"NETWORK_ERROR","NETWORK_ERROR"),Z(J,"API_RESPONSE_INVALID","API_RESPONSE_INVALID"),Z(J,"SERVICE","SERVICE"),Z(J,"VALIDATION","VALIDATION"),Z(J,"TAB_AVAILABILITY","TAB"),Z(J,"CONTEXT","CONTEXT"),Z(J,"UI","UI"),Z(J,"INTEGRATION","INTEGRATION"),Z(J,"UNKNOWN","UNKNOWN"),Z(J,"PROMPT_INVALID","PROMPT_INVALID"),Z(J,"TEXT_EMPTY","TEXT_EMPTY"),Z(J,"TEXT_TOO_LONG","TEXT_TOO_LONG"),Z(J,"TRANSLATION_NOT_FOUND","TRANSLATION_NOT_FOUND"),Z(J,"TRANSLATION_FAILED","TRANSLATION_FAILED"),Z(J,"API_KEY_MISSING","API_KEY_MISSING"),Z(J,"API_KEY_INVALID","API_KEY_INVALID"),Z(J,"API_URL_MISSING","API_URL_MISSING"),Z(J,"MODEL_MISSING","MODEL_MISSING"),Z(J,"MODEL_OVERLOADED","MODEL_OVERLOADED"),Z(J,"QUOTA_EXCEEDED","QUOTA_EXCEEDED"),Z(J,"GEMINI_QUOTA_REGION","GEMINI_QUOTA_REGION");var tt=[{name:"English",voiceCode:"en-US",promptName:"English",code:"en",locale:"en",flag:"🇬🇧"},{name:"Farsi",voiceCode:"fa-IR",promptName:"Farsi",code:"fa",locale:"fa",flag:"🇮🇷"},{name:"German",voiceCode:"de-DE",promptName:"German",code:"de"},{name:"French",voiceCode:"fr-FR",promptName:"French",code:"fr"},{name:"Chinese (Simplified)",voiceCode:"zh-CN",promptName:"Chinese (Simplified)",code:"zh"},{name:"Spanish",voiceCode:"es-ES",promptName:"Spanish",code:"es"},{name:"Hindi",voiceCode:"hi-IN",promptName:"Hindi",code:"hi"},{name:"Arabic",voiceCode:"ar-SA",promptName:"Arabic",code:"ar"},{name:"Bengali",voiceCode:"bn-BD",promptName:"Bengali",code:"bn"},{name:"Portuguese",voiceCode:"pt-PT",promptName:"Portuguese",code:"pt"},{name:"Russian",voiceCode:"ru-RU",promptName:"Russian",code:"ru"},{name:"Japanese",voiceCode:"ja-JP",promptName:"Japanese",code:"ja"},{name:"Urdu",voiceCode:"ur-PK",promptName:"Urdu",code:"ur"},{name:"Indonesian",voiceCode:"id-ID",promptName:"Indonesian",code:"id"},{name:"Italian",voiceCode:"it-IT",promptName:"Italian",code:"it"},{name:"Swahili",voiceCode:"sw-KE",promptName:"Swahili",code:"sw"},{name:"Marathi",voiceCode:"mr-IN",promptName:"Marathi",code:"mr"},{name:"Telugu",voiceCode:"te-IN",promptName:"Telugu",code:"te"},{name:"Tamil",voiceCode:"ta-IN",promptName:"Tamil",code:"ta"},{name:"Turkish",voiceCode:"tr-TR",promptName:"Turkish",code:"tr"},{name:"Vietnamese",voiceCode:"vi-VN",promptName:"Vietnamese",code:"vi"},{name:"Korean",voiceCode:"ko-KR",promptName:"Korean",code:"ko"},{name:"Thai",voiceCode:"th-TH",promptName:"Thai",code:"th"},{name:"Malay",voiceCode:"ms-MY",promptName:"Malay",code:"ms"},{name:"Polish",voiceCode:"pl-PL",promptName:"Polish",code:"pl"},{name:"Dutch",voiceCode:"nl-NL",promptName:"Dutch",code:"nl"},{name:"Filipino",voiceCode:"fil-PH",promptName:"Filipino",code:"fi"},{name:"Ukrainian",voiceCode:"uk-UA",promptName:"Ukrainian",code:"uk"},{name:"Romanian",voiceCode:"ro-RO",promptName:"Romanian",code:"ro"},{name:"Greek",voiceCode:"el-GR",promptName:"Greek",code:"el"},{name:"Czech",voiceCode:"cs-CZ",promptName:"Czech",code:"cs"},{name:"Hungarian",voiceCode:"hu-HU",promptName:"Hungarian",code:"hu"},{name:"Swedish",voiceCode:"sv-SE",promptName:"Swedish",code:"sv"},{name:"Norwegian",voiceCode:"no-NO",promptName:"Norwegian",code:"no"},{name:"Danish",voiceCode:"da-DK",promptName:"Danish",code:"da"},{name:"Finnish",voiceCode:"fi-FI",promptName:"Finnish",code:"fi"},{name:"Hebrew",voiceCode:"he-IL",promptName:"Hebrew",code:"he"},{name:"Afrikaans",voiceCode:"af-ZA",promptName:"Afrikaans",code:"af"},{name:"Albanian",voiceCode:"sq-AL",promptName:"Albanian",code:"sq"},{name:"Bulgarian",voiceCode:"bg-BG",promptName:"Bulgarian",code:"bg"},{name:"Catalan",voiceCode:"ca-ES",promptName:"Catalan",code:"ca"},{name:"Croatian",voiceCode:"hr-HR",promptName:"Croatian",code:"hr"},{name:"Estonian",voiceCode:"et-EE",promptName:"Estonian",code:"et"},{name:"Latvian",voiceCode:"lv-LV",promptName:"Latvian",code:"lv"},{name:"Lithuanian",voiceCode:"lt-LT",promptName:"Lithuanian",code:"lt"},{name:"Slovak",voiceCode:"sk-SK",promptName:"Slovak",code:"sk"},{name:"Slovenian",voiceCode:"sl-SI",promptName:"Slovenian",code:"sl"},{name:"Serbian",voiceCode:"sr-RS",promptName:"Serbian",code:"sr"},{name:"Malayalam",voiceCode:"ml-IN",promptName:"Malayalam",code:"ml"},{name:"Kannada",voiceCode:"kn-IN",promptName:"Kannada",code:"kn"},{name:"Odia",voiceCode:"or-IN",promptName:"Odia",code:"or"},{name:"Punjabi",voiceCode:"pa-IN",promptName:"Punjabi",code:"pa"},{name:"Sinhala",voiceCode:"si-LK",promptName:"Sinhala",code:"si"},{name:"Nepali",voiceCode:"ne-NP",promptName:"Nepali",code:"ne"},{name:"Azerbaijani",voiceCode:"az-AZ",promptName:"Azerbaijani",code:"az"},{name:"Belarusian",voiceCode:"be-BY",promptName:"Belarusian",code:"be"},{name:"Kazakh",voiceCode:"kk-KZ",promptName:"Kazakh",code:"kk"},{name:"Uzbek",voiceCode:"uz-UZ",promptName:"Uzbek",code:"uz"},{name:"Pashto",voiceCode:"ps-AF",promptName:"Pashto",code:"ps"},{name:"Tagalog",voiceCode:"tl-PH",promptName:"Tagalog",code:"tl"},{name:"Cebuano",voiceCode:"en-US",promptName:"Cebuano",code:"en"}];var et=function(t){return l.RTL_REGEX.test(t)},rt=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t&&t.style){var r=e;t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}},nt=function(t,e){if(t){var r=function(t){return function(t){return/[\u0600-\u06FF]/.test(t)}(t)||et(t)}(e),n=r?"rtl":"ltr",o=r?"right":"left";t.style?(t.style.direction=n,t.style.textAlign=o):t.setAttribute("style","direction: ".concat(n,"; text-align: ").concat(o,";"))}};function ot(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;t.style.opacity="0",t.style.transform="scale(0.95)",t.style.transition="opacity ".concat(e,"ms ease-out, transform ").concat(e,"ms ease-out"),t.getBoundingClientRect(),t.style.opacity="1",t.style.transform="scale(1)"}function it(t){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},it(t)}function at(){at=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==it(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(it(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ct(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ut(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ct(i,n,o,a,c,"next",t)}function c(t){ct(i,n,o,a,c,"throw",t)}a(void 0)}))}}function st(t){return"true"===String(t).trim().toLowerCase()}var lt,ft,ht,pt,dt,yt,vt,gt=new Map;function mt(t){return bt.apply(this,arguments)}function bt(){return(bt=ut(at().mark((function t(r){var n,o,i;return at().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(!gt.has(r)){t.next=2;break}return t.abrupt("return",gt.get(r));case 2:return t.prev=2,n=e().runtime.getURL("_locales/".concat(r,"/messages.json")),t.next=6,fetch(n);case 6:if((o=t.sent).ok){t.next=9;break}return t.abrupt("return",null);case 9:return t.next=11,o.json();case 11:return i=t.sent,gt.set(r,i),t.abrupt("return",i);case 16:return t.prev=16,t.t0=t["catch"](2),t.abrupt("return",null);case 19:case"end":return t.stop()}}),t,null,[[2,16]])})))).apply(this,arguments)}function wt(t,e){return xt.apply(this,arguments)}function xt(){return(xt=ut(at().mark((function t(e,r){var n,o,i,a,c;return at().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if((o=r)&&2===o.length){t.next=7;break}return t.next=4,B();case 4:i=t.sent,a=tt.find((function(t){return t.name===i||t.locale===i})),o=(null==a?void 0:a.code)||(2===(null==i?void 0:i.length)?i:"en");case 7:return t.next=9,mt(o);case 9:if(!(c=t.sent)||null===(n=c[e])||void 0===n||!n.message){t.next=12;break}return t.abrupt("return",c[e].message);case 12:return t.abrupt("return",null);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Et(t,r){t.querySelectorAll("[data-i18n]").forEach((function(t){var n=t.getAttribute("data-i18n"),o="";o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n),t.matches("input, textarea")?t.value=o:t.matches("img")?t.setAttribute("alt",o):t.textContent=o})),t.querySelectorAll("[data-i18n-title]").forEach((function(t){var n=t.getAttribute("data-i18n-title"),o="";o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n),t.setAttribute("title",o)})),t.querySelectorAll("[data-i18n-placeholder]").forEach((function(t){var n=t.getAttribute("data-i18n-placeholder"),o="";(o=r&&r[n]&&r[n].message?r[n].message:e().i18n.getMessage(n))&&(t.placeholder=o)}))}function Lt(t){return Tt.apply(this,arguments)}function Tt(){return(Tt=ut(at().mark((function t(e){var r,n,o,i,a,c;return at().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return n=null,t.next=3,B();case 3:if(o=t.sent,(!(i=e)||(null===(r=i)||void 0===r?void 0:r.length)>2)&&tt.forEach((function(t){t.name!==o&&t.locale!==o||(i=t.locale)})),!i){t.next=10;break}return t.next=9,mt(i);case 9:n=t.sent;case 10:a=document.body,c=document.head,Et(a,n),c&&Et(c,n),ot(a,300);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function _t(){_t=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==kt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(kt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ot(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function St(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,At(n.key),n)}}function At(t){var e=function(t,e){if("object"!=kt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==kt(e)?e:e+""}var It,Nt={ICON_TRANSLATION:null!==(lt=null==l?void 0:l.ICON_TRANSLATION)&&void 0!==lt?lt:"🌐",ICON_SUCCESS:null!==(ft=null==l?void 0:l.ICON_SUCCESS)&&void 0!==ft?ft:"✅",ICON_WARNING:null!==(ht=null==l?void 0:l.ICON_WARNING)&&void 0!==ht?ht:"⚠️",ICON_STATUS:null!==(pt=null==l?void 0:l.ICON_STATUS)&&void 0!==pt?pt:"⏳",ICON_ERROR:null!==(dt=null==l?void 0:l.ICON_ERROR)&&void 0!==dt?dt:"❌",ICON_INFO:null!==(yt=null==l?void 0:l.ICON_INFO)&&void 0!==yt?yt:"🔵",ICON_REVERT:null!==(vt=null==l?void 0:l.ICON_REVERT)&&void 0!==vt?vt:"↩️"},Pt=function(){return t=function t(r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errorHandler=r||{handle:function(){}},this.map={error:{title:"AI Writing Companion - Error",icon:Nt.ICON_ERROR,cls:"AIWC-error",dur:5e3},warning:{title:"AI Writing Companion - Warning",icon:Nt.ICON_WARNING,cls:"AIWC-warning",dur:4e3},success:{title:"AI Writing Companion - Success",icon:Nt.ICON_SUCCESS,cls:"AIWC-success",dur:3e3},info:{title:"AI Writing Companion - Info",icon:Nt.ICON_INFO,cls:"AIWC-info",dur:3e3},status:{title:"AI Writing Companion - Status",icon:Nt.ICON_STATUS,cls:"AIWC-status",dur:2e3},revert:{title:"AI Writing Companion - Revert",icon:Nt.ICON_REVERT,cls:"AIWC-revert",dur:800}},this.container=null,"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){return n._makeContainer()}),{once:!0}):this._makeContainer()),e().storage&&e().storage.onChanged&&e().storage.onChanged.addListener((function(t,e){"local"===e&&t.APPLICATION_LOCALIZE&&n._applyAlignment()}))},r=[{key:"_applyAlignment",value:(o=_t().mark((function t(){var e,r;return _t().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(this.container){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,wt("IsRTL");case 5:e=t.sent,(r=st(e))?(this.container.style.right="20px",this.container.style.left=""):(this.container.style.left="20px",this.container.style.right=""),this.container.style.direction=r?"rtl":"ltr",this.container.style.textAlign=r?"right":"left",t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](2),oe("[NotificationManager] _applyAlignment failed:",t.t0);case 15:case"end":return t.stop()}}),t,this,[[2,12]])})),i=function(){var t=this,e=arguments;return new Promise((function(r,n){var i=o.apply(t,e);function a(t){Ot(i,r,n,a,c,"next",t)}function c(t){Ot(i,r,n,a,c,"throw",t)}a(void 0)}))},function(){return i.apply(this,arguments)})},{key:"_makeContainer",value:function(){var t=null;try{var e="AIWritingCompanion-notifications";return(t=document.getElementById(e))?(this.container=t,this._applyAlignment(),t):document.body?(t=document.createElement("div"))?(t.id=e,Object.assign(t.style,{position:"fixed",top:"20px",zIndex:"2147483646",display:"flex",flexDirection:"column",gap:"10px"}),document.body.appendChild(t),this.container=t,this._applyAlignment(),t):(oe("[NotificationManager] createElement failed."),null):(oe("[NotificationManager] document.body not available."),null)}catch(e){return oe("[NotificationManager] _makeContainer error:",e),t&&t.remove&&t.remove(),null}}},{key:"show",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0,i=this.map[e]||this.map.info,a=null!=n?n:i.dur;if(this.container&&document.body.contains(this.container))try{return this._toastInPage(t,i,r,a,o)}catch(t){var c,u;return null===(c=(u=this.errorHandler).handle)||void 0===c||c.call(u,t,{type:J.UI,context:"NotificationManager-show"}),null}return this._sendToActiveTab(t,e,r,a,o),null}},{key:"dismiss",value:function(t){t&&"function"==typeof t.remove&&(t.style.opacity="0",setTimeout((function(){return t.remove()}),500))}},{key:"_toastInPage",value:function(t,e,r,n,o){var i=this,a=document.createElement("div");return a.className="AIWC-notification ".concat(e.cls),a.style.cssText="\n      background:#fff;color:#333;padding:10px 15px;\n      border-radius:6px;font-size:14px;border:1px solid #ddd;\n      box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;\n      align-items:center;cursor:pointer;opacity:1;\n      transition:opacity .5s",a.innerHTML='<span style="margin-inline-end:6px;">'.concat(e.icon,"</span><span>").concat(t,"</span>"),a.addEventListener("click",(function(){try{null==o||o()}catch(t){oe(t)}i.dismiss(a)})),this.container.appendChild(a),r&&"AIWC-status"!==e.cls&&setTimeout((function(){return i.dismiss(a)}),n),a}},{key:"_sendToActiveTab",value:function(t,r,n,o,i){var a=this;return e().tabs.query({active:!0,currentWindow:!0}).then((function(i){var a;return null!=i&&null!==(a=i[0])&&void 0!==a&&a.id&&ae()?e().tabs.sendMessage(i[0].id,{action:"show_notification",payload:{message:t,type:r,autoDismiss:n,duration:o}}):null})).then((function(t){if(i&&void 0!==t){var r=function(t){"notification_clicked"===(null==t?void 0:t.action)&&(i(),e().runtime.onMessage.removeListener(r))};e().runtime.onMessage.addListener(r)}}))["catch"]((function(){return a._osNotification(t,r,i)}))}},{key:"_osNotification",value:function(t,r,n){var o=this.map[r]||this.map.info;e().notifications.create({type:"basic",iconUrl:e().runtime.getURL("icons/extension_icon.png"),title:o.title,message:t}).then((function(t){if(n){var r=function(o){o===t&&(n(),e().notifications.clear(t),e().notifications.onClicked.removeListener(r))};e().notifications.onClicked.addListener(r)}}))["catch"]((function(){}))}}],r&&St(t.prototype,r),n&&St(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i}();function jt(t){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jt(t)}function Ct(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("string"==typeof t){var e=t.trim();if(Object.values(J).includes(e))return e}if(t&&"object"===jt(t)){if(t.type)return t.type;var r=t.statusCode;if("number"==typeof r&&r>=400&&r<600)return J.HTTP_ERROR}var n=String(t).toLowerCase().trim();return/\b(403|404|500|502|503|504)\b/.test(n)?J.HTTP_ERROR:n.includes("text is empty")?J.TEXT_EMPTY:n.includes("prompt is invalid")?J.PROMPT_INVALID:n.includes("text is too long")||n.includes("too long")?J.TEXT_TOO_LONG:n.includes("translation not found")?J.TRANSLATION_NOT_FOUND:n.includes("translation failed")?J.TRANSLATION_FAILED:n.includes("wrong api key")||n.includes("api key not valid")||n.includes("no auth credentials")||n.includes("incorrect api key provided")?J.API_KEY_INVALID:n.includes("api key is missing")||n.includes("key missing")?J.API_KEY_MISSING:n.includes("api url")&&n.includes("missing")?J.API_URL_MISSING:n.includes("not a valid model id")||n.includes("invalid model")||n.includes("model not found")||n.includes("model is missing")||n.includes("model not available")||n.includes("the model `")&&n.includes("does not exist or you do not have access to it")?J.MODEL_MISSING:n.includes("the model is overloaded")||n.includes("overloaded")?J.MODEL_OVERLOADED:n.includes("quota exceeded")&&n.includes("region")?(oe("[ErrorMatcher] Quota exceeded with region, indicating Gemini-specific quota."),J.GEMINI_QUOTA_REGION):n.includes("quota exceeded")||n.includes("gemini quota")?J.QUOTA_EXCEEDED:n.includes("failed to fetch")||n.includes("network failure")||n.includes("connection failed")||n.includes("networkerror")||n.includes("networkerror when attempting to fetch resource")?J.NETWORK_ERROR:n.includes("http error")||n.includes("http status")||n.includes("http response")||n.includes("operation was aborted")||n.includes("the operation was aborted.")?J.HTTP_ERROR:n.includes("context")||n.includes("context invalid")||n.includes("extension context")||n.includes("context invalidated")||n.includes("extension context invalidated")?J.CONTEXT:J.UNKNOWN}function Rt(){Rt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Gt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Gt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Gt(t){return Gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gt(t)}function Ft(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Mt(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=Gt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Gt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Gt(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Dt=(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(It={},J.TEXT_EMPTY,"Text is empty"),J.PROMPT_INVALID,"Prompt is invalid"),J.TEXT_TOO_LONG,"Text is too long"),J.TRANSLATION_NOT_FOUND,"Translation not found"),J.TRANSLATION_FAILED,"Translation failed"),J.API,"API error"),J.API_KEY_MISSING,"API Key is missing"),J.API_KEY_INVALID,"API Key is wrong or invalid"),J.API_URL_MISSING,"API URL is missing"),J.MODEL_MISSING,"AI Model is missing or invalid"),Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(Mt(It,J.MODEL_OVERLOADED,"The Model is overloaded"),J.QUOTA_EXCEEDED,"You exceeded your current quota"),J.GEMINI_QUOTA_REGION,"You reached the Gemini quota. (Region issue)"),J.NETWORK_ERROR,"Connection to server failed"),J.HTTP_ERROR,"HTTP error"),J.CONTEXT,"Extension context lost"),J.UNKNOWN,"An unknown error occurred"),J.TAB_AVAILABILITY,"Tab not available"),J.UI,"User Interface error"),J.INTEGRATION,"Integration error"),Mt(Mt(It,J.SERVICE,"Service error"),J.VALIDATION,"Validation error"));function Ut(t){return Ht.apply(this,arguments)}function Ht(){var t;return t=Rt().mark((function t(e){var r,n;return Rt().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return r=e.startsWith("ERRORS_")?e:"ERRORS_".concat(e),t.next=3,wt(r);case 3:return(n=t.sent)&&n.trim()||(n=Dt[e]||Dt[J.UNKNOWN]),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})),Ht=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ft(i,n,o,a,c,"next",t)}function c(t){Ft(i,n,o,a,c,"throw",t)}a(void 0)}))},Ht.apply(this,arguments)}function Bt(t){return Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bt(t)}function $t(t,e,r){return(e=Vt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function zt(){zt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Bt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Bt(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Yt(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Xt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Yt(i,n,o,a,c,"next",t)}function c(t){Yt(i,n,o,a,c,"throw",t)}a(void 0)}))}}function qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Vt(n.key),n)}}function Vt(t){var e=function(t,e){if("object"!=Bt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Bt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Bt(e)?e:e+""}var Wt=new Set([J.CONTEXT]),Kt=new Set([J.CONTEXT,J.API,J.API_KEY_INVALID,J.API_KEY_MISSING,J.API_URL_MISSING,J.MODEL_MISSING,J.MODEL_OVERLOADED,J.QUOTA_EXCEEDED,J.GEMINI_QUOTA_REGION,J.NETWORK_ERROR,J.HTTP_ERROR,J.INTEGRATION,J.SERVICE,J.VALIDATION,J.UI,J.PROMPT_INVALID,J.TEXT_EMPTY,J.TEXT_TOO_LONG,J.TRANSLATION_NOT_FOUND,J.TRANSLATION_FAILED,J.TAB_AVAILABILITY]),Zt=new Set([J.API_KEY_INVALID,J.API_KEY_MISSING,J.MODEL_OVERLOADED,J.MODEL_MISSING,J.API_URL_MISSING,J.QUOTA_EXCEEDED,J.HTTP_ERROR,J.GEMINI_QUOTA_REGION]),Qt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=new Pt,this.displayedErrors=new Set,this.handling=!1},e=[{key:"handle",value:(i=Xt(zt().mark((function t(e){var r,n,o,i,a,c=arguments;return zt().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:{},!this.handling){t.next=3;break}return t.abrupt("return",e);case 3:return this.handling=!0,t.prev=4,n=e instanceof Error?e.message:String(e),o=Ct(n),t.next=9,Ut(o);case 9:return i=t.sent,t.next=12,U()["catch"]((function(){return l.DEBUG_MODE}));case 12:if(t.sent&&!Kt.has(o)&&console.error("[".concat(o,"] ").concat(n),e.stack),!Wt.has(o)){t.next=16;break}return t.abrupt("return",e);case 16:return a=Zt.has(o)?ce:void 0,this._notifyUser(i,r.type||J.SERVICE,a),t.abrupt("return",e);case 19:return t.prev=19,this.handling=!1,t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[4,,19,22]])}))),function(t){return i.apply(this,arguments)})},{key:"handle_OLD",value:(o=Xt(zt().mark((function t(e){var r,n,o,i,a,c,u=arguments;return zt().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:{},null==e||!e._isHandled){t.next=3;break}return t.abrupt("return",e);case 3:if(!this.isHandling){t.next=5;break}return t.abrupt("return",e);case 5:return this.isHandling=!0,t.prev=6,t.next=9,extractError(e);case 9:return n=t.sent,o=n._errorKey,i=o.toUpperCase(),t.next=14,U()["catch"]((function(){return l.DEBUG_MODE}));case 14:if(t.sent&&!SUPPRESS_CONSOLE_LOG_ERRORS.has(i)&&this._logError(n,r),!SILENT_ERRORS.has(i)){t.next=20;break}return n._isHandled=!0,t.abrupt("return",n);case 20:return t.next=22,getErrorMessageByKey(o);case 22:return a=t.sent,OPEN_SETTINGS_ERRORS.has(i)&&(c=function(){return ce()}),this._notifyUser(a,r.type||J.SERVICE,c),n._isHandled=!0,t.abrupt("return",n);case 29:return t.prev=29,t.t0=t["catch"](6),oe("[ErrorService] Fatal error in handler:",t.t0),t.abrupt("return",t.t0);case 33:return t.prev=33,this.isHandling=!1,t.finish(33);case 36:case"end":return t.stop()}}),t,this,[[6,29,33,36]])}))),function(t){return o.apply(this,arguments)})},{key:"_logError",value:function(t,e){console.error("[ErrorService] ".concat(t.name,": ").concat(t.message,"\nContext: ").concat(e.context,"\nType: ").concat(e.type,"\nStack: ").concat(t.stack))}},{key:"_notifyUser",value:function(t,e,r){var n,o=this;if(!this.displayedErrors.has(t)){var i=($t($t($t($t($t($t($t($t($t($t(n={},J.API,"error"),J.UI,"error"),J.NETWORK_ERROR,"warning"),J.HTTP_ERROR,"warning"),J.SERVICE,"error"),J.CONTEXT,"warning"),J.VALIDATION,"warning"),J.INTEGRATION,"warning"),J.API_KEY_INVALID,"error"),J.API_KEY_MISSING,"error"),$t($t($t($t($t(n,J.API_URL_MISSING,"error"),J.MODEL_MISSING,"error"),J.MODEL_OVERLOADED,"warning"),J.QUOTA_EXCEEDED,"warning"),J.GEMINI_QUOTA_REGION,"warning"))[e]||"error";this.notifier.show(t,i,!0,4e3,r),this.displayedErrors.add(t),setTimeout((function(){return o.displayedErrors["delete"](t)}),4500)}}}],r=[{key:"processError",value:(n=Xt(zt().mark((function t(e){return zt().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(null==e||!e.then){t.next=6;break}return t.next=3,e;case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=e;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})}],e&&qt(t.prototype,e),r&&qt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i}();function Jt(){return Jt=Xt(zt().mark((function t(e){var r,n,o=arguments;return zt().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:"",n=new Qt,t.abrupt("return",n.handle(e,{type:J.UI,context:r}));case 3:case"end":return t.stop()}}),t)}))),Jt.apply(this,arguments)}var te=new Qt,ee=function(t){return new Promise((function(e){return setTimeout(e,t)}))};function re(t,e,r){}var ne,oe=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];H().then((function(t){var r;t&&(r=console).debug.apply(r,e)}))},ie=function(t){if(null!=t&&t.isContentEditable)return!0;if("TEXTAREA"===(null==t?void 0:t.tagName))return!0;if("INPUT"===(null==t?void 0:t.tagName)){var e,r=(null===(e=t.getAttribute("type"))||void 0===e?void 0:e.toLowerCase())||"text";return["text","search"].includes(r)}return!(null==t||!t.closest||!t.closest('[contenteditable="true"]'))},ae=function(){try{var t,r;return!(null===e()||void 0===e()||null===(t=e().runtime)||void 0===t||!t.id||null===e()||void 0===e()||null===(r=e().storage)||void 0===r||!r.local)}catch(t){return!1}},ce=function(){e().runtime.openOptionsPage?e().runtime.openOptionsPage():window.open(e().runtime.getURL("html/options.html"))};ne=null;function ue(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{var e;if(null===(e=document)||void 0===e||!e.body)return;document.documentElement.classList.toggle("AIWritingCompanion-disable-links",t)}catch(t){throw te.handle(t,{type:J.CONTEXT,context:"taggleLinks",details:{errorType:t.message.includes("context invalidated")?"CONTEXT_INVALIDATED":"UNKNOWN_ERROR"}})}}var se,le;function fe(t){return document.getElementById(t)}const he={translationForm:fe("translationForm"),sourceText:fe("sourceText"),translationResult:fe("translationResult"),sourceContainer:null===(se=fe("sourceText"))||void 0===se?void 0:se.parentElement,resultContainer:null===(le=fe("translationResult"))||void 0===le?void 0:le.parentElement,sourceLanguageInput:fe("sourceLanguageInput"),targetLanguageInput:fe("targetLanguageInput"),sourceLanguagesList:fe("sourceLanguagesList"),targetLanguagesList:fe("targetLanguagesList"),clearSourceLanguage:fe("clearSourceLanguage"),clearTargetLanguage:fe("clearTargetLanguage"),swapLanguagesBtn:fe("swapLanguagesBtn"),translateBtn:fe("translateBtn"),copySourceBtn:fe("copySourceBtn"),pasteSourceBtn:fe("pasteSourceBtn"),voiceSourceIcon:fe("voiceSourceIcon"),copyTargetBtn:fe("copyTargetBtn"),voiceTargetIcon:fe("voiceTargetIcon"),translatePageLink:fe("translatePageLink"),selectElementIcon:fe("selectElementIcon"),clearStorageBtn:fe("clearStorageBtn"),revertIcon:fe("revertActionIcon"),settingsIcon:fe("settingsIcon"),popupContainer:document.body,$:fe};function pe(t,e){var r=null==t?void 0:t.parentElement;r&&e&&r.classList.toggle("has-value",!!t.value)}function de(t){var e=null==t?void 0:t.parentElement;if(e){var r=(t.value||t.textContent||"").trim();e.classList.toggle("has-content",r&&r!==wt("popup_string_during_translate")||"در حال ترجمه...")}}function ye(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(t){var r="feedback-".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success");t.classList.add(r),setTimeout((function(){t.classList.remove(r)}),e)}}var ve="Auto Detect";function ge(t){if(!t)return null;var e=t.trim();if(e===ve)return ve;var r=tt.find((function(t){return t.name===e||t.promptName===e||t.voiceCode===e}));return r?r.voiceCode:null}function me(t){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},me(t)}function be(){be=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==me(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(me(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function we(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function xe(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){we(i,n,o,a,c,"next",t)}function c(t){we(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Ee(t){if(!t)return null;var e=t.trim();if(e===ve)return ve;var r=tt.find((function(t){return t.name===e||t.promptName===e}));return r?r.promptName||r.name:null}function Le(t){if(!t||t===ve)return ve;var e=tt.find((function(e){return e.code===t||e.name===t||e.promptName===t}));return e?e.promptName||e.name:""}function Te(){if(tt.forEach((function(t){var e,r=document.createElement("option");if(r.value=t.promptName||t.name,null===(e=he.sourceLanguagesList)||void 0===e||e.appendChild(r),t.code!==ve){var n,o=document.createElement("option");o.value=t.promptName||t.name,null===(n=he.targetLanguagesList)||void 0===n||n.appendChild(o)}})),!tt.some((function(t){return t.name===ve||t.promptName===ve}))){var t,e=document.createElement("option");e.value=ve,null===(t=he.sourceLanguagesList)||void 0===t||t.prepend(e)}}function ke(){return _e.apply(this,arguments)}function _e(){return(_e=xe(be().mark((function t(){var e;return be().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return he.sourceLanguageInput.value=ve,pe(he.sourceLanguageInput,he.clearSourceLanguage),t.prev=2,t.next=5,Y();case 5:e=t.sent,he.targetLanguageInput.value=Le(e)||Le("en"),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](2),oe("[LangManager]: Error getting target language:",t.t0),he.targetLanguageInput.value=Le("en");case 13:return t.prev=13,pe(he.targetLanguageInput,he.clearTargetLanguage),t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[2,9,13,16]])})))).apply(this,arguments)}function Oe(t){null==t||t.focus()}function Se(){return Ae.apply(this,arguments)}function Ae(){return(Ae=xe(be().mark((function t(){return be().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return Te(),t.next=3,ke();case 3:e=void 0,r=void 0,n=void 0,o=void 0,i=void 0,a=void 0,c=void 0,null===(e=he.sourceLanguageInput)||void 0===e||e.addEventListener("click",(function(){return Oe(he.sourceLanguageInput)})),null===(r=he.targetLanguageInput)||void 0===r||r.addEventListener("click",(function(){return Oe(he.targetLanguageInput)})),null===(n=he.clearSourceLanguage)||void 0===n||n.addEventListener("click",(function(){he.sourceLanguageInput.value="",pe(he.sourceLanguageInput,he.clearSourceLanguage),he.sourceLanguageInput.focus()})),null===(o=he.clearTargetLanguage)||void 0===o||o.addEventListener("click",(function(){he.targetLanguageInput.value="",pe(he.targetLanguageInput,he.clearTargetLanguage),he.targetLanguageInput.focus()})),null===(i=he.sourceLanguageInput)||void 0===i||i.addEventListener("input",(function(){return pe(he.sourceLanguageInput,he.clearSourceLanguage)})),null===(a=he.targetLanguageInput)||void 0===a||a.addEventListener("input",(function(){return pe(he.targetLanguageInput,he.clearTargetLanguage)})),null===(c=he.swapLanguagesBtn)||void 0===c||c.addEventListener("click",xe(be().mark((function t(){var e,r,n,o,i,a,c,u,s,l;return be().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e=he.sourceLanguageInput.value,r=he.targetLanguageInput.value,n=ge(e),o=ge(r),i=n,a=o,n!==ve){t.next=16;break}return t.prev=7,t.next=10,z();case 10:i=t.sent,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](7),oe("[LangManager]: Failed to load source language from settings",t.t0);case 16:if(o!==ve){t.next=26;break}return t.prev=17,t.next=20,Y();case 20:a=t.sent,t.next=26;break;case 23:t.prev=23,t.t1=t["catch"](17),oe("[LangManager]: Failed to load target language from settings",t.t1);case 26:if(!i||!a){t.next=52;break}if(c=Le(a),u=Le(i),he.sourceLanguageInput.value=c||r,he.targetLanguageInput.value=u||e,pe(he.sourceLanguageInput,he.clearSourceLanguage),pe(he.targetLanguageInput,he.clearTargetLanguage),s=he.sourceText.value,l=he.translationResult.textContent,t.t2=l,!t.t2){t.next=42;break}return t.t3=l,t.next=40,wt("popup_string_during_translate");case 40:t.t4=t.sent,t.t2=t.t3!==t.t4;case 42:if(!t.t2){t.next=50;break}he.sourceText.value=l,he.translationResult.textContent=s,nt(he.sourceText,l),nt(he.translationResult,s),de(he.sourceText),de(he.translationResult),document.dispatchEvent(new CustomEvent("translationSwapped"));case 50:t.next=54;break;case 52:oe("[LangManager]: Cannot swap - invalid language selection.",{sourceCode:n,targetCode:o}),he.swapLanguagesBtn&&ye(he.swapLanguagesBtn,"error",500);case 54:case"end":return t.stop()}}),t,null,[[7,13],[17,23]])})))),oe("[LangManager]: Initialized.");case 5:case"end":return t.stop()}var e,r,n,o,i,a,c}),t)})))).apply(this,arguments)}function Ie(t){return Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ie(t)}function Ne(){Ne=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ie(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ie(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Pe(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function je(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Pe(i,n,o,a,c,"next",t)}function c(t){Pe(i,n,o,a,c,"throw",t)}a(void 0)}))}}var Ce=!1;function Re(){return Ge.apply(this,arguments)}function Ge(){return(Ge=je(Ne().mark((function t(){return Ne().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.readText();case 3:return t.abrupt("return",!0);case 6:return t.prev=6,t.t0=t["catch"](0),oe("[Clipboard]: Clipboard read permission denied.",t.t0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,null,[[0,6]])})))).apply(this,arguments)}function Fe(){return Me.apply(this,arguments)}function Me(){return(Me=je(Ne().mark((function t(){var e,r;return Ne().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e=he.pasteSourceBtn){t.next=3;break}return t.abrupt("return");case 3:if(e.classList.add("hidden-by-clipboard"),!Ce||document.hasFocus()){t.next=7;break}return oe("[Clipboard]: Visibility check deferred until window focus."),t.abrupt("return");case 7:if(navigator.clipboard&&navigator.clipboard.readText){t.next=10;break}return oe("[Clipboard]: Clipboard API unavailable."),t.abrupt("return");case 10:return t.prev=10,t.next=13,navigator.clipboard.readText();case 13:r=t.sent,Ce=!1,null!=r&&r.trim()?(e.classList.remove("hidden-by-clipboard"),oe("[Clipboard]: Clipboard has text, showing Paste button.")):oe("[Clipboard]: Clipboard empty or no text, hiding Paste button."),t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](10),"NotAllowedError"!==t.t0.name||document.hasFocus()||Ce?(oe("[Clipboard]: Error reading clipboard.",t.t0),Ce=!1):(Ce=!0,oe("[Clipboard]: Permission error; deferring until focus."),window.addEventListener("focus",Fe,{once:!0}));case 21:case"end":return t.stop()}}),t,null,[[10,18]])})))).apply(this,arguments)}function De(){return Ue.apply(this,arguments)}function Ue(){return(Ue=je(Ne().mark((function t(){return Ne().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return e=void 0,r=void 0,n=void 0,null===(e=he.copySourceBtn)||void 0===e||e.addEventListener("click",je(Ne().mark((function t(){var e,r;return Ne().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e=he.sourceText.value){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,navigator.clipboard.writeText(e);case 6:oe("[Clipboard]: Source text copied successfully."),null===(r=he.pasteSourceBtn)||void 0===r||r.classList.remove("hidden-by-clipboard"),ye(he.copySourceBtn),t.next=15;break;case 11:t.prev=11,t.t0=t["catch"](3),oe("[Clipboard]: Failed to copy source text.",t.t0),ye(he.copySourceBtn,"error");case 15:case"end":return t.stop()}}),t,null,[[3,11]])})))),null===(r=he.pasteSourceBtn)||void 0===r||r.addEventListener("click",je(Ne().mark((function t(){var e;return Ne().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,Re();case 2:if(t.sent){t.next=6;break}return ye(he.pasteSourceBtn,"error"),he.pasteSourceBtn.classList.add("hidden-by-clipboard"),t.abrupt("return");case 6:return t.prev=6,t.next=9,navigator.clipboard.readText();case 9:return(e=t.sent)&&(he.sourceText.value=e,he.sourceText.dispatchEvent(new Event("input",{bubbles:!0})),he.sourceText.focus()),t.next=13,Fe();case 13:t.next=20;break;case 15:t.prev=15,t.t0=t["catch"](6),oe("[Clipboard]: Error pasting text.",t.t0),ye(he.pasteSourceBtn,"error"),he.pasteSourceBtn.classList.add("hidden-by-clipboard");case 20:case"end":return t.stop()}}),t,null,[[6,15]])})))),null===(n=he.copyTargetBtn)||void 0===n||n.addEventListener("click",je(Ne().mark((function t(){var e,r;return Ne().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e=he.translationResult.textContent,t.t0=!e,t.t0){t.next=8;break}return t.t1=e,t.next=6,wt("popup_string_during_translate");case 6:t.t2=t.sent,t.t0=t.t1===t.t2;case 8:if(!t.t0){t.next=10;break}return t.abrupt("return");case 10:return t.prev=10,t.next=13,navigator.clipboard.writeText(e);case 13:oe("[Clipboard]: Translation copied successfully."),null===(r=he.pasteSourceBtn)||void 0===r||r.classList.remove("hidden-by-clipboard"),ye(he.copyTargetBtn),t.next=22;break;case 18:t.prev=18,t.t3=t["catch"](10),oe("[Clipboard]: Failed to copy translation.",t.t3),ye(he.copyTargetBtn,"error");case 22:case"end":return t.stop()}}),t,null,[[10,18]])})))),document.addEventListener("translationSwapped",Fe),t.next=3,Fe();case 3:oe("[Clipboard]: Clipboard manager initialized.");case 4:case"end":return t.stop()}var e,r,n}),t)})))).apply(this,arguments)}function He(t){return He="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},He(t)}function Be(){Be=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==He(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(He(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function $e(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ze(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){$e(i,n,o,a,c,"next",t)}function c(t){$e(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Ye(){var t,r,n,o,i,a;t=document.querySelector("#sourceLanguageInput"),r=document.querySelector("#targetLanguageInput"),n=document.querySelector("#voiceSourceIcon"),o=document.querySelector("#voiceTargetIcon"),i=document.querySelector("#sourceText"),a=document.querySelector("#translationResult"),null==n||n.addEventListener("click",ze(Be().mark((function r(){var n,o,a;return Be().wrap((function(r){for(;1;)switch(r.prev=r.next){case 0:if(n=null==i?void 0:i.value.trim()){r.next=4;break}return i.focus(),r.abrupt("return");case 4:return r.prev=4,o=(null==t?void 0:t.value)||ve,r.next=8,e().runtime.sendMessage({action:"speak",text:n,lang:o});case 8:(a=r.sent)?a.success?oe("[Popup TTS]: TTS playback started."):oe("[Popup TTS]: TTS error:",a.error):oe("[Popup TTS]: No response from background."),r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](4),oe("[Popup TTS]: Error sending message:",r.t0);case 15:case"end":return r.stop()}}),r,null,[[4,12]])})))),null==o||o.addEventListener("click",ze(Be().mark((function t(){var n,o,i,c;return Be().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(o=null==a||null===(n=a.textContent)||void 0===n?void 0:n.trim()){t.next=4;break}return a.scrollIntoView({behavior:"smooth",block:"center"}),t.abrupt("return");case 4:return t.prev=4,i=(null==r?void 0:r.value)||ve,t.next=8,e().runtime.sendMessage({action:"speak",text:o,lang:i});case 8:(c=t.sent)?c.success?oe("[Popup TTS]: TTS playback started for target text."):oe("[Popup TTS]: TTS error (target):",c.error):oe("[Popup TTS]: No response from background."),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](4),oe("[Popup TTS]: Error sending message (target):",t.t0);case 15:case"end":return t.stop()}}),t,null,[[4,12]])})))),oe("[Popup TTS]: Initialized.")}function Xe(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let qe={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function Ve(t){qe=t}const We={exec:()=>null};function Ke(t,e=""){let r="string"==typeof t?t:t.source;const n={replace:(t,e)=>{let o="string"==typeof e?e:e.source;return o=o.replace(Ze.caret,"$1"),r=r.replace(t,o),n},getRegex:()=>new RegExp(r,e)};return n}const Ze={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},Qe=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Je=/(?:[*+-]|\d{1,9}[.)])/,tr=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,er=Ke(tr).replace(/bull/g,Je).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),rr=Ke(tr).replace(/bull/g,Je).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),nr=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,or=/(?!\s*\])(?:\\.|[^\[\]\\])+/,ir=Ke(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",or).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),ar=Ke(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Je).getRegex(),cr="address|article|aside|base|basefont|blockquote|body|caption"+"|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption"+"|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe"+"|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option"+"|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title"+"|tr|track|ul",ur=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,sr=Ke("^ {0,3}(?:"+"<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)"+"|comment[^\\n]*(\\n+|$)"+"|<\\?[\\s\\S]*?(?:\\?>\\n*|$)"+"|<![A-Z][\\s\\S]*?(?:>\\n*|$)"+"|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)"+"|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)"+"|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)"+"|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)"+")","i").replace("comment",ur).replace("tag",cr).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),lr=Ke(nr).replace("hr",Qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",cr).getRegex(),fr={blockquote:Ke(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",lr).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:ir,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:Qe,html:sr,lheading:er,list:ar,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:lr,table:We,text:/^[^\n]+/},hr=Ke("^ *([^\\n ].*)\\n"+" {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)"+"(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",cr).getRegex(),pr={...fr,lheading:rr,table:hr,paragraph:Ke(nr).replace("hr",Qe).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",hr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",cr).getRegex()},dr={...fr,html:Ke("^ *(?:comment *(?:\\n|\\s*$)"+"|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)"+"|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",ur).replace(/tag/g,"(?!(?:"+"a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub"+"|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)"+"\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:We,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Ke(nr).replace("hr",Qe).replace("heading"," *#{1,6} *[^\n]").replace("lheading",er).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},yr=/^( {2,}|\\)\n(?!\s*$)/,vr=/[\p{P}\p{S}]/u,gr=/[\s\p{P}\p{S}]/u,mr=/[^\s\p{P}\p{S}]/u,br=Ke(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,gr).getRegex(),wr=/(?!~)[\p{P}\p{S}]/u,xr=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Er=Ke(xr,"u").replace(/punct/g,vr).getRegex(),Lr=Ke(xr,"u").replace(/punct/g,wr).getRegex(),Tr="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)"+"|[^*]+(?=[^*])"+"|(?!\\*)punct(\\*+)(?=[\\s]|$)"+"|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)"+"|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)"+"|[\\s](\\*+)(?!\\*)(?=punct)"+"|(?!\\*)punct(\\*+)(?!\\*)(?=punct)"+"|notPunctSpace(\\*+)(?=notPunctSpace)",kr=Ke(Tr,"gu").replace(/notPunctSpace/g,mr).replace(/punctSpace/g,gr).replace(/punct/g,vr).getRegex(),_r=Ke(Tr,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,wr).getRegex(),Or=Ke("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)"+"|[^_]+(?=[^_])"+"|(?!_)punct(_+)(?=[\\s]|$)"+"|notPunctSpace(_+)(?!_)(?=punctSpace|$)"+"|(?!_)punctSpace(_+)(?=notPunctSpace)"+"|[\\s](_+)(?!_)(?=punct)"+"|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,mr).replace(/punctSpace/g,gr).replace(/punct/g,vr).getRegex(),Sr=Ke(/\\(punct)/,"gu").replace(/punct/g,vr).getRegex(),Ar=Ke(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ir=Ke(ur).replace("(?:--\x3e|$)","--\x3e").getRegex(),Nr=Ke("^comment"+"|^</[a-zA-Z][\\w:-]*\\s*>"+"|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>"+"|^<\\?[\\s\\S]*?\\?>"+"|^<![a-zA-Z]+\\s[\\s\\S]*?>"+"|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ir).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Pr=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,jr=Ke(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Pr).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Cr=Ke(/^!?\[(label)\]\[(ref)\]/).replace("label",Pr).replace("ref",or).getRegex(),Rr=Ke(/^!?\[(ref)\](?:\[\])?/).replace("ref",or).getRegex(),Gr={_backpedal:We,anyPunctuation:Sr,autolink:Ar,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:yr,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:We,emStrongLDelim:Er,emStrongRDelimAst:kr,emStrongRDelimUnd:Or,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:jr,nolink:Rr,punctuation:br,reflink:Cr,reflinkSearch:Ke("reflink|nolink(?!\\()","g").replace("reflink",Cr).replace("nolink",Rr).getRegex(),tag:Nr,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:We},Fr={...Gr,link:Ke(/^!?\[(label)\]\((.*?)\)/).replace("label",Pr).getRegex(),reflink:Ke(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Pr).getRegex()},Mr={...Gr,emStrongRDelimAst:_r,emStrongLDelim:Lr,url:Ke(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Dr={...Mr,br:Ke(yr).replace("{2,}","*").getRegex(),text:Ke(Mr.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ur={normal:fr,gfm:pr,pedantic:dr},Hr={normal:Gr,gfm:Mr,breaks:Dr,pedantic:Fr},Br={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},$r=t=>Br[t];function zr(t,e){if(e){if(Ze.escapeTest.test(t))return t.replace(Ze.escapeReplace,$r)}else if(Ze.escapeTestNoEncode.test(t))return t.replace(Ze.escapeReplaceNoEncode,$r);return t}function Yr(t){try{t=encodeURI(t).replace(Ze.percentDecode,"%")}catch{return null}return t}function Xr(t,e){const r=t.replace(Ze.findPipe,((t,e,r)=>{let n=!1,o=e;for(;--o>=0&&"\\"===r[o];)n=!n;return n?"|":" |"})).split(Ze.splitPipe);let n=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;n<r.length;n++)r[n]=r[n].trim().replace(Ze.slashPipe,"|");return r}function qr(t,e,r){const n=t.length;if(0===n)return"";let o=0;for(;o<n;){if(t.charAt(n-o-1)!==e||!1)break;o++}return t.slice(0,n-o)}function Vr(t,e,r,n,o){const i=e.href,a=e.title||null,c=t[1].replace(o.other.outputLinkReplace,"$1");if("!"!==t[0].charAt(0)){n.state.inLink=!0;const t={type:"link",raw:r,href:i,title:a,text:c,tokens:n.inlineTokens(c)};return n.state.inLink=!1,t}return{type:"image",raw:r,href:i,title:a,text:c}}class Wr{options;rules;lexer;constructor(t){this.options=t||qe}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:qr(t,"\n")}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const t=e[0],r=function(t,e,r){const n=t.match(r.other.indentCodeCompensation);if(null===n)return e;const o=n[1];return e.split("\n").map((t=>{const e=t.match(r.other.beginningSpace);if(null===e)return t;const[n]=e;return n.length>=o.length?t.slice(o.length):t})).join("\n")}(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){const e=qr(t,"#");this.options.pedantic?t=e.trim():e&&!this.rules.other.endingSpaceChar.test(e)||(t=e.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:qr(e[0],"\n")}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let t=qr(e[0],"\n").split("\n"),r="",n="";const o=[];for(;t.length>0;){let e=!1;const i=[];let a;for(a=0;a<t.length;a++)if(this.rules.other.blockquoteStart.test(t[a]))i.push(t[a]),e=!0;else{if(e)break;i.push(t[a])}t=t.slice(a);const c=i.join("\n"),u=c.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}\n${c}`:c,n=n?`${n}\n${u}`:u;const s=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,o,!0),this.lexer.state.top=s,0===t.length)break;const l=o.at(-1);if("code"===l?.type)break;if("blockquote"===l?.type){const e=l,i=e.raw+"\n"+t.join("\n"),a=this.blockquote(i);o[o.length-1]=a,r=r.substring(0,r.length-e.raw.length)+a.raw,n=n.substring(0,n.length-e.text.length)+a.text;break}if("list"!==l?.type);else{const e=l,i=e.raw+"\n"+t.join("\n"),a=this.list(i);o[o.length-1]=a,r=r.substring(0,r.length-l.raw.length)+a.raw,n=n.substring(0,n.length-e.raw.length)+a.raw,t=i.substring(o.at(-1).raw.length).split("\n")}}return{type:"blockquote",raw:r,tokens:o,text:n}}}list(t){let e=this.rules.block.list.exec(t);if(e){let r=e[1].trim();const n=r.length>1,o={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");const i=this.rules.other.listItemRegex(r);let a=!1;for(;t;){let r=!1,n="",c="";if(!(e=i.exec(t)))break;if(this.rules.block.hr.test(t))break;n=e[0],t=t.substring(n.length);let u=e[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,(t=>" ".repeat(3*t.length))),s=t.split("\n",1)[0],l=!u.trim(),f=0;if(this.options.pedantic?(f=2,c=u.trimStart()):l?f=e[1].length+1:(f=e[2].search(this.rules.other.nonSpaceChar),f=f>4?1:f,c=u.slice(f),f+=e[1].length),l&&this.rules.other.blankLine.test(s)&&(n+=s+"\n",t=t.substring(s.length+1),r=!0),!r){const e=this.rules.other.nextBulletRegex(f),r=this.rules.other.hrRegex(f),o=this.rules.other.fencesBeginRegex(f),i=this.rules.other.headingBeginRegex(f),a=this.rules.other.htmlBeginRegex(f);for(;t;){const h=t.split("\n",1)[0];let p;if(s=h,this.options.pedantic?(s=s.replace(this.rules.other.listReplaceNesting,"  "),p=s):p=s.replace(this.rules.other.tabCharGlobal,"    "),o.test(s))break;if(i.test(s))break;if(a.test(s))break;if(e.test(s))break;if(r.test(s))break;if(p.search(this.rules.other.nonSpaceChar)>=f||!s.trim())c+="\n"+p.slice(f);else{if(l)break;if(u.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(o.test(u))break;if(i.test(u))break;if(r.test(u))break;c+="\n"+s}l||s.trim()||(l=!0),n+=h+"\n",t=t.substring(h.length+1),u=p.slice(f)}}o.loose||(a?o.loose=!0:this.rules.other.doubleBlankLine.test(n)&&(a=!0));let h,p=null;this.options.gfm&&(p=this.rules.other.listIsTask.exec(c),p&&(h="[ ] "!==p[0],c=c.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:n,task:!!p,checked:h,loose:!1,text:c,tokens:[]}),o.raw+=n}const c=o.items.at(-1);if(!c)return;c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd(),o.raw=o.raw.trimEnd();for(let t=0;t<o.items.length;t++)if(this.lexer.state.top=!1,o.items[t].tokens=this.lexer.blockTokens(o.items[t].text,[]),!o.loose){const e=o.items[t].tokens.filter((t=>"space"===t.type)),r=e.length>0&&e.some((t=>this.rules.other.anyLine.test(t.raw)));o.loose=r}if(o.loose)for(let t=0;t<o.items.length;t++)o.items[t].loose=!0;return o}}html(t){const e=this.rules.block.html.exec(t);if(e){return{type:"html",block:!0,raw:e[0],pre:"pre"===e[1]||"script"===e[1]||"style"===e[1],text:e[0]}}}def(t){const e=this.rules.block.def.exec(t);if(e){const t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:r,title:n}}}table(t){const e=this.rules.block.table.exec(t);if(!e)return;if(!this.rules.other.tableDelimiter.test(e[2]))return;const r=Xr(e[1]),n=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],i={type:"table",raw:e[0],header:[],align:[],rows:[]};if(r.length===n.length){for(const t of n)this.rules.other.tableAlignRight.test(t)?i.align.push("right"):this.rules.other.tableAlignCenter.test(t)?i.align.push("center"):this.rules.other.tableAlignLeft.test(t)?i.align.push("left"):i.align.push(null);for(let t=0;t<r.length;t++)i.header.push({text:r[t],tokens:this.lexer.inline(r[t]),header:!0,align:i.align[t]});for(const t of o)i.rows.push(Xr(t,i.header.length).map(((t,e)=>({text:t,tokens:this.lexer.inline(t),header:!1,align:i.align[e]}))));return i}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:"="===e[2].charAt(0)?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const t="\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;const e=qr(t.slice(0,-1),"\\");if((t.length-e.length)%2==0)return}else{const t=function(t,e){if(-1===t.indexOf(e[1]))return-1;let r=0;for(let n=0;n<t.length;n++)if("\\"===t[n])n++;else if(t[n]===e[0])r++;else if(t[n]===e[1]&&(r--,r<0))return n;return-1}(e[2],"()");if(t>-1){const r=(0===e[0].indexOf("!")?5:4)+e[1].length+t;e[2]=e[2].substring(0,t),e[0]=e[0].substring(0,r).trim(),e[3]=""}}let r=e[2],n="";if(this.options.pedantic){const t=this.rules.other.pedanticHrefTitle.exec(r);t&&(r=t[1],n=t[3])}else n=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(r=this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?r.slice(1):r.slice(1,-1)),Vr(e,{href:r?r.replace(this.rules.inline.anyPunctuation,"$1"):r,title:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n},e[0],this.lexer,this.rules)}}reflink(t,e){let r;if((r=this.rules.inline.reflink.exec(t))||(r=this.rules.inline.nolink.exec(t))){const t=e[(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!t){const t=r[0].charAt(0);return{type:"text",raw:t,text:t}}return Vr(r,t,r[0],this.lexer,this.rules)}}emStrong(t,e,r=""){let n=this.rules.inline.emStrongLDelim.exec(t);if(!n)return;if(n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))return;if(!(n[1]||n[2]||"")||!r||this.rules.inline.punctuation.exec(r)){const r=[...n[0]].length-1;let o,i,a=r,c=0;const u="*"===n[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(u.lastIndex=0,e=e.slice(-1*t.length+r);null!=(n=u.exec(e));){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(i=[...o].length,n[3]||n[4]){a+=i;continue}if((n[5]||n[6])&&r%3&&!((r+i)%3)){c+=i;continue}if(a-=i,a>0)continue;i=Math.min(i,i+a+c);const e=[...n[0]][0].length,u=t.slice(0,r+n.index+e+i);if(Math.min(r,i)%2){const t=u.slice(1,-1);return{type:"em",raw:u,text:t,tokens:this.lexer.inlineTokens(t)}}const s=u.slice(2,-2);return{type:"strong",raw:u,text:s,tokens:this.lexer.inlineTokens(s)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," ");const r=this.rules.other.nonSpaceChar.test(t),n=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return r&&n&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let t,r;return"@"===e[2]?(t=e[1],r="mailto:"+t):(t=e[1],r=t),{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let t,r;if("@"===e[2])t=e[0],r="mailto:"+t;else{let n;do{n=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??""}while(n!==e[0]);t=e[0],r="www."===e[1]?"http://"+e[0]:e[0]}return{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){const t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}}class Kr{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||qe,this.options.tokenizer=this.options.tokenizer||new Wr,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={other:Ze,block:Ur.normal,inline:Hr.normal};this.options.pedantic?(e.block=Ur.pedantic,e.inline=Hr.pedantic):this.options.gfm&&(e.block=Ur.gfm,this.options.breaks?e.inline=Hr.breaks:e.inline=Hr.gfm),this.tokenizer.rules=e}static get rules(){return{block:Ur,inline:Hr}}static lex(t,e){return new Kr(e).lex(t)}static lexInline(t,e){return new Kr(e).inlineTokens(t)}lex(t){t=t.replace(Ze.carriageReturn,"\n"),this.blockTokens(t,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const e=this.inlineQueue[t];this.inlineTokens(e.src,e.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],r=!1){for(this.options.pedantic&&(t=t.replace(Ze.tabCharGlobal,"    ").replace(Ze.spaceLine,""));t;){let n;if(this.options.extensions?.block?.some((r=>!!(n=r.call({lexer:this},t,e))&&(t=t.substring(n.raw.length),e.push(n),!0))))continue;if(n=this.tokenizer.space(t)){t=t.substring(n.raw.length);const r=e.at(-1);1===n.raw.length&&void 0!==r?r.raw+="\n":e.push(n);continue}if(n=this.tokenizer.code(t)){t=t.substring(n.raw.length);const r=e.at(-1);"paragraph"===r?.type||"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.at(-1).src=r.text):e.push(n);continue}if(n=this.tokenizer.fences(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.heading(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.hr(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.blockquote(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.list(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.html(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.def(t)){t=t.substring(n.raw.length);const r=e.at(-1);"paragraph"===r?.type||"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.raw,this.inlineQueue.at(-1).src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.lheading(t)){t=t.substring(n.raw.length),e.push(n);continue}let o=t;if(this.options.extensions?.startBlock){let e=1/0;const r=t.slice(1);let n;this.options.extensions.startBlock.forEach((t=>{n=t.call({lexer:this},r),"number"==typeof n&&n>=0&&(e=Math.min(e,n))})),e<1/0&&e>=0&&(o=t.substring(0,e+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o))){const i=e.at(-1);r&&"paragraph"===i?.type?(i.raw+="\n"+n.raw,i.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):e.push(n),r=o.length!==t.length,t=t.substring(n.raw.length)}else if(n=this.tokenizer.text(t)){t=t.substring(n.raw.length);const r=e.at(-1);"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):e.push(n)}else if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(e);break}throw new Error(e)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){let r=t,n=null;if(this.tokens.links){const t=Object.keys(this.tokens.links);if(t.length>0)for(;null!=(n=this.tokenizer.rules.inline.reflinkSearch.exec(r));)t.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(n=this.tokenizer.rules.inline.blockSkip.exec(r));)r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(n=this.tokenizer.rules.inline.anyPunctuation.exec(r));)r=r.slice(0,n.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o=!1,i="";for(;t;){let n;if(o||(i=""),o=!1,this.options.extensions?.inline?.some((r=>!!(n=r.call({lexer:this},t,e))&&(t=t.substring(n.raw.length),e.push(n),!0))))continue;if(n=this.tokenizer.escape(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.tag(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.link(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(n.raw.length);const r=e.at(-1);"text"===n.type&&"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):e.push(n);continue}if(n=this.tokenizer.emStrong(t,r,i)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.codespan(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.br(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.del(t)){t=t.substring(n.raw.length),e.push(n);continue}if(n=this.tokenizer.autolink(t)){t=t.substring(n.raw.length),e.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(t))){t=t.substring(n.raw.length),e.push(n);continue}let a=t;if(this.options.extensions?.startInline){let e=1/0;const r=t.slice(1);let n;this.options.extensions.startInline.forEach((t=>{n=t.call({lexer:this},r),"number"==typeof n&&n>=0&&(e=Math.min(e,n))})),e<1/0&&e>=0&&(a=t.substring(0,e+1))}if(n=this.tokenizer.inlineText(a)){t=t.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(i=n.raw.slice(-1)),o=!0;const r=e.at(-1);"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):e.push(n)}else if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(e);break}throw new Error(e)}}return e}}class Zr{options;parser;constructor(t){this.options=t||qe}space(t){return""}code({text:t,lang:e,escaped:r}){const n=(e||"").match(Ze.notSpaceStart)?.[0],o=t.replace(Ze.endingNewline,"")+"\n";return n?'<pre><code class="language-'+zr(n)+'">'+(r?o:zr(o,!0))+"</code></pre>\n":"<pre><code>"+(r?o:zr(o,!0))+"</code></pre>\n"}blockquote({tokens:t}){return`<blockquote>\n${this.parser.parse(t)}</blockquote>\n`}html({text:t}){return t}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>\n`}hr(t){return"<hr>\n"}list(t){const e=t.ordered,r=t.start;let n="";for(let e=0;e<t.items.length;e++){const r=t.items[e];n+=this.listitem(r)}const o=e?"ol":"ul";return"<"+o+(e&&1!==r?' start="'+r+'"':"")+">\n"+n+"</"+o+">\n"}listitem(t){let e="";if(t.task){const r=this.checkbox({checked:!!t.checked});t.loose?"paragraph"===t.tokens[0]?.type?(t.tokens[0].text=r+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&"text"===t.tokens[0].tokens[0].type&&(t.tokens[0].tokens[0].text=r+" "+zr(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):e+=r+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>\n`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>\n`}table(t){let e="",r="";for(let e=0;e<t.header.length;e++)r+=this.tablecell(t.header[e]);e+=this.tablerow({text:r});let n="";for(let e=0;e<t.rows.length;e++){const o=t.rows[e];r="";for(let t=0;t<o.length;t++)r+=this.tablecell(o[t]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),"<table>\n"+"<thead>\n"+e+"</thead>\n"+n+"</table>\n"}tablerow({text:t}){return`<tr>\n${t}</tr>\n`}tablecell(t){const e=this.parser.parseInline(t.tokens),r=t.header?"th":"td";return(t.align?`<${r} align="${t.align}">`:`<${r}>`)+e+`</${r}>\n`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${zr(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:r}){const n=this.parser.parseInline(r),o=Yr(t);if(null===o)return n;let i='<a href="'+(t=o)+'"';return e&&(i+=' title="'+zr(e)+'"'),i+=">"+n+"</a>",i}image({href:t,title:e,text:r}){const n=Yr(t);if(null===n)return zr(r);let o=`<img src="${t=n}" alt="${r}"`;return e&&(o+=` title="${zr(e)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:zr(t.text)}}class Qr{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}}class Jr{options;renderer;textRenderer;constructor(t){this.options=t||qe,this.options.renderer=this.options.renderer||new Zr,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Qr}static parse(t,e){return new Jr(e).parse(t)}static parseInline(t,e){return new Jr(e).parseInline(t)}parse(t,e=!0){let r="";for(let n=0;n<t.length;n++){const o=t[n];if(this.options.extensions?.renderers?.[o.type]){const t=o,e=this.options.extensions.renderers[t.type].call({parser:this},t);if(!1!==e||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(t.type)){r+=e||"";continue}}const i=o;switch(i.type){case"space":r+=this.renderer.space(i);continue;case"hr":r+=this.renderer.hr(i);continue;case"heading":r+=this.renderer.heading(i);continue;case"code":r+=this.renderer.code(i);continue;case"table":r+=this.renderer.table(i);continue;case"blockquote":r+=this.renderer.blockquote(i);continue;case"list":r+=this.renderer.list(i);continue;case"html":r+=this.renderer.html(i);continue;case"paragraph":r+=this.renderer.paragraph(i);continue;case"text":{let o=i,a=this.renderer.text(o);for(;n+1<t.length&&"text"===t[n+1].type;)o=t[++n],a+="\n"+this.renderer.text(o);r+=e?this.renderer.paragraph({type:"paragraph",raw:a,text:a,tokens:[{type:"text",raw:a,text:a,escaped:!0}]}):a;continue}default:{const t='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(t),"";throw new Error(t)}}}return r}parseInline(t,e=this.renderer){let r="";for(let n=0;n<t.length;n++){const o=t[n];if(this.options.extensions?.renderers?.[o.type]){const t=this.options.extensions.renderers[o.type].call({parser:this},o);if(!1!==t||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){r+=t||"";continue}}const i=o;switch(i.type){case"escape":case"text":r+=e.text(i);break;case"html":r+=e.html(i);break;case"link":r+=e.link(i);break;case"image":r+=e.image(i);break;case"strong":r+=e.strong(i);break;case"em":r+=e.em(i);break;case"codespan":r+=e.codespan(i);break;case"br":r+=e.br(i);break;case"del":r+=e.del(i);break;default:{const t='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(t),"";throw new Error(t)}}}return r}}class tn{options;block;constructor(t){this.options=t||qe}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?Kr.lex:Kr.lexInline}provideParser(){return this.block?Jr.parse:Jr.parseInline}}const en=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Jr;Renderer=Zr;TextRenderer=Qr;Lexer=Kr;Tokenizer=Wr;Hooks=tn;constructor(...t){this.use(...t)}walkTokens(t,e){let r=[];for(const n of t)switch(r=r.concat(e.call(this,n)),n.type){case"table":{const t=n;for(const n of t.header)r=r.concat(this.walkTokens(n.tokens,e));for(const n of t.rows)for(const t of n)r=r.concat(this.walkTokens(t.tokens,e));break}case"list":{const t=n;r=r.concat(this.walkTokens(t.items,e));break}default:{const t=n;this.defaults.extensions?.childTokens?.[t.type]?this.defaults.extensions.childTokens[t.type].forEach((n=>{const o=t[n].flat(1/0);r=r.concat(this.walkTokens(o,e))})):t.tokens&&(r=r.concat(this.walkTokens(t.tokens,e)))}}return r}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach((t=>{const r={...t};if(r.async=this.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach((t=>{if(!t.name)throw new Error("extension name required");if("renderer"in t){const r=e.renderers[t.name];e.renderers[t.name]=r?function(...e){let n=t.renderer.apply(this,e);return!1===n&&(n=r.apply(this,e)),n}:t.renderer}if("tokenizer"in t){if(!t.level||"block"!==t.level&&"inline"!==t.level)throw new Error("extension level must be 'block' or 'inline'");const r=e[t.level];r?r.unshift(t.tokenizer):e[t.level]=[t.tokenizer],t.start&&("block"===t.level?e.startBlock?e.startBlock.push(t.start):e.startBlock=[t.start]:"inline"===t.level&&(e.startInline?e.startInline.push(t.start):e.startInline=[t.start]))}"childTokens"in t&&t.childTokens&&(e.childTokens[t.name]=t.childTokens)})),r.extensions=e),t.renderer){const e=this.defaults.renderer||new Zr(this.defaults);for(const r in t.renderer){if(!(r in e))throw new Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;const n=r,o=t.renderer[n],i=e[n];e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r||""}}r.renderer=e}if(t.tokenizer){const e=this.defaults.tokenizer||new Wr(this.defaults);for(const r in t.tokenizer){if(!(r in e))throw new Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;const n=r,o=t.tokenizer[n],i=e[n];e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r}}r.tokenizer=e}if(t.hooks){const e=this.defaults.hooks||new tn;for(const r in t.hooks){if(!(r in e))throw new Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;const n=r,o=t.hooks[n],i=e[n];tn.passThroughHooks.has(r)?e[n]=t=>{if(this.defaults.async)return Promise.resolve(o.call(e,t)).then((t=>i.call(e,t)));const r=o.call(e,t);return i.call(e,r)}:e[n]=(...t)=>{let r=o.apply(e,t);return!1===r&&(r=i.apply(e,t)),r}}r.hooks=e}if(t.walkTokens){const e=this.defaults.walkTokens,n=t.walkTokens;r.walkTokens=function(t){let r=[];return r.push(n.call(this,t)),e&&(r=r.concat(e.call(this,t))),r}}this.defaults={...this.defaults,...r}})),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return Kr.lex(t,e??this.defaults)}parser(t,e){return Jr.parse(t,e??this.defaults)}parseMarkdown(t){return(e,r)=>{const n={...r},o={...this.defaults,...n},i=this.onError(!!o.silent,!!o.async);if(!0===this.defaults.async&&!1===n.async)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==e)return i(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof e)return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=t);const a=o.hooks?o.hooks.provideLexer():t?Kr.lex:Kr.lexInline,c=o.hooks?o.hooks.provideParser():t?Jr.parse:Jr.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(e):e).then((t=>a(t,o))).then((t=>o.hooks?o.hooks.processAllTokens(t):t)).then((t=>o.walkTokens?Promise.all(this.walkTokens(t,o.walkTokens)).then((()=>t)):t)).then((t=>c(t,o))).then((t=>o.hooks?o.hooks.postprocess(t):t)).catch(i);try{o.hooks&&(e=o.hooks.preprocess(e));let t=a(e,o);o.hooks&&(t=o.hooks.processAllTokens(t)),o.walkTokens&&this.walkTokens(t,o.walkTokens);let r=c(t,o);return o.hooks&&(r=o.hooks.postprocess(r)),r}catch(t){return i(t)}}}onError(t,e){return r=>{if(r.message+="\nPlease report this to https://github.com/markedjs/marked.",t){const t="<p>An error occurred:</p><pre>"+zr(r.message+"",!0)+"</pre>";return e?Promise.resolve(t):t}if(e)return Promise.reject(r);throw r}}};function rn(t,e){return en.parse(t,e)}rn.options=rn.setOptions=function(t){return en.setOptions(t),rn.defaults=en.defaults,Ve(rn.defaults),rn},rn.getDefaults=Xe,rn.defaults=qe,rn.use=function(...t){return en.use(...t),rn.defaults=en.defaults,Ve(rn.defaults),rn},rn.walkTokens=function(t,e){return en.walkTokens(t,e)},rn.parseInline=en.parseInline,rn.Parser=Jr,rn.parser=Jr.parse,rn.Renderer=Zr,rn.TextRenderer=Qr,rn.Lexer=Kr,rn.lexer=Kr.lex,rn.Tokenizer=Wr,rn.Hooks=tn,rn.parse=rn;rn.options,rn.setOptions,rn.use,rn.walkTokens,rn.parseInline,Jr.parse,Kr.lex;var nn=new Set(["the","a","an","is","are","was","were","in","on","at","to","of","for","with","by","from"]),on=30;function an(t,e){return function(t){var e=t.trim(),r=e.split(/\s+/),n=e.length,o=1===r.length&&!nn.has(r[0].toLowerCase())&&n<=on,i=r.length>1&&n<=on;return o||i}(t)?p:e}function cn(t){return cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cn(t)}function un(){un=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==cn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(cn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function sn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ln(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){sn(i,n,o,a,c,"next",t)}function c(t){sn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function fn(t){if(!t)return"";if("string"==typeof t)return t;if(t._originalMessage&&"string"==typeof t._originalMessage)return t._originalMessage;if("string"==typeof t.message)return t.message;try{return JSON.stringify(t)}catch(t){return""}}function hn(t,e,r,n){return pn.apply(this,arguments)}function pn(){return(pn=ln(un().mark((function t(r,n,o,i){var a,c,u,s,l,f,h,p,d;return un().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(!e().runtime.lastError){t.next=6;break}return c=e().runtime.lastError.message,he.translationResult.textContent=c,nt(he.translationResult,c),de(he.translationResult),t.abrupt("return");case 6:if(null==r||!r.success||null===(a=r.data)||void 0===a||!a.translatedText){t.next=19;break}u=r.data.translatedText,he.translationResult.classList.remove("fade-in"),he.translationResult.offsetWidth,he.translationResult.innerHTML=rn.parse(u),he.translationResult.classList.add("fade-in"),nt(he.translationResult,u),s=ge(o),l=ge(i),e().storage.local.set({lastTranslation:{sourceText:n,translatedText:u,sourceLanguage:s||ve,targetLanguage:l}}).then((function(){oe("[Translate]: Last translation saved to storage.")}))["catch"]((function(t){oe("[Translate]: Error saving last translation:",t)})),!r.data.detectedSourceLang||s&&s!==ve||(f=Le(r.data.detectedSourceLang))&&(he.sourceLanguageInput.value=f,pe(he.sourceLanguageInput,he.clearSourceLanguage),oe("[Translate]: Source language updated to detected: ".concat(f))),t.next=32;break;case 19:return t.next=21,wt("popup_string_translate_error_response");case 21:if(t.t0=t.sent,t.t0){t.next=24;break}t.t0="(⚠️ خطایی در ترجمه رخ داد.)";case 24:h=t.t0,p=fn(null==r?void 0:r.error)||h,v=void 0,(d="string"!=typeof(y=p)?null:null!==(v=Dt[y])&&void 0!==v?v:null)&&(p=d),he.translationResult.innerHTML="",he.translationResult.textContent=p,nt(he.translationResult,p),oe("[Translate-Popup] API error:",p);case 32:de(he.translationResult);case 33:case"end":return t.stop()}var y,v}),t)})))).apply(this,arguments)}function dn(){return yn.apply(this,arguments)}function yn(){return(yn=ln(un().mark((function t(){var r,n,o,i,a,c,u,s,l;return un().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(r=he.sourceText.value.trim(),n=he.targetLanguageInput.value.trim(),o=he.sourceLanguageInput.value.trim(),r){t.next=7;break}return he.sourceText.focus(),oe("[Translate-Popup]: No text to translate."),t.abrupt("return");case 7:return nt(he.sourceText,r),t.t0=rt,t.t1=he.translationResult,t.t2=st,t.next=13,wt("IsRTL");case 13:if(t.t3=t.sent,t.t4=(0,t.t2)(t.t3),(0,t.t0)(t.t1,t.t4),n){t.next=21;break}return oe("[Translate-Popup]: Missing target language identifier."),he.targetLanguageInput.focus(),ye(he.targetLanguageInput.parentElement,"error",500),t.abrupt("return");case 21:if((i=Ee(n))&&i!==ve){t.next=27;break}return oe("[Translate-Popup]: Invalid target language selected:",n),he.targetLanguageInput.focus(),ye(he.targetLanguageInput.parentElement,"error",500),t.abrupt("return");case 27:return(a=Ee(o))&&a!==ve||(a=null),he.translationResult.innerHTML='\n<div class="spinner-overlay">\n  <div class="spinner-center">\n    <div class="spinner"></div>\n  </div>\n</div>\n',de(he.translationResult),c=an(r,d),t.prev=32,t.next=35,e().runtime.sendMessage({action:"fetchTranslation",payload:{promptText:r,sourceLanguage:a,targetLanguage:i,translateMode:c}});case 35:return u=t.sent,oe("[Translate-Popup]: Response from background:",u),t.next=39,hn(u,r,o,n);case 39:t.next=55;break;case 41:return t.prev=41,t.t5=t["catch"](32),oe("[Translate-Popup]: Error sending message to background:",t.t5),t.next=46,wt("popup_string_translate_error_trigger");case 46:if(t.t6=t.sent,t.t6){t.next=49;break}t.t6="(⚠️ خطایی در ترجمه پاپ‌آپ رخ داد.)";case 49:s=t.t6,l=fn(t.t5)||s,he.translationResult.innerHTML="",he.translationResult.textContent=l,nt(he.translationResult,l),de(he.translationResult);case 55:case"end":return t.stop()}}),t,null,[[32,41]])})))).apply(this,arguments)}function vn(){var t,e,r;null===(t=he.translationForm)||void 0===t||t.addEventListener("submit",(function(t){t.preventDefault(),oe("[Translate-Popup]: Translation form submitted via button."),dn()})),null===(e=he.sourceText)||void 0===e||e.addEventListener("keydown",(function(t){var e=t.ctrlKey||t.metaKey,r="Enter"===t.key,n="/"===t.key;e&&(r||n)&&(t.preventDefault(),oe("[Translate-Popup]: Shortcut (".concat(t.ctrlKey?"Ctrl":"Cmd","+").concat(t.key,") triggered translation.")),dn())})),null===(r=he.sourceText)||void 0===r||r.addEventListener("input",(function(){de(he.sourceText)})),oe("[Translate-Popup]: Initialized.")}function gn(t){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn(t)}function mn(){mn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==gn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(gn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function bn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function wn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xn(n.key),n)}}function xn(t){var e=function(t,e){if("object"!=gn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=gn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==gn(e)?e:e+""}var En=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=e,this.errorHandler=r},e=[{key:"extractText",value:function(t){try{var e,r,n;return t?t.isContentEditable?(null===(n=t.innerText)||void 0===n?void 0:n.trim())||"":(null===(e=t.value)||void 0===e?void 0:e.trim())||(null===(r=t.textContent)||void 0===r?void 0:r.trim())||"":""}catch(t){var o;return null===(o=this.errorHandler)||void 0===o||o.handle(t,{type:J.UI,context:"platform-strategy-extractText"}),""}}},{key:"findField",value:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=t,o=0;o<r&&n;o++){var i=n.closest(e);if(i)return i;n=n.parentElement}return document.querySelector(e)}},{key:"validateField",value:function(t){return t&&t.isConnected&&(this.isInputElement(t)||t.hasAttribute("contenteditable"))}},{key:"applyVisualFeedback",value:(n=mn().mark((function t(e){var r,n;return mn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:try{r=e.style.backgroundColor,e.style.transition="background-color 0.5s ease",e.style.backgroundColor="#d4f8d4",requestAnimationFrame((function(){setTimeout((function(){e.style.backgroundColor=r}),300)}))}catch(t){null===(n=this.errorHandler)||void 0===n||n.handle(t,{type:J.UI,context:"platform-strategy-animation"})}case 3:case"end":return t.stop()}}),t,this)})),o=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){bn(i,r,o,a,c,"next",t)}function c(t){bn(i,r,o,a,c,"throw",t)}a(void 0)}))},function(t){return o.apply(this,arguments)})},{key:"applyTextDirection",value:function(t,e){try{var r=l.RTL_REGEX.test(e);"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.setAttribute("dir",r?"rtl":"ltr"):(t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left")}catch(t){var n;throw null===(n=this.errorHandler)||void 0===n?void 0:n.handle(t,{type:J.UI,code:"text-direction-error",context:"platform-strategy-TextDirection"})}}},{key:"handleFieldError",value:function(t,e){var r={FIELD_NOT_FOUND:"لطفا روی فیلد متن ".concat(e," کلیک کنید"),CLIPBOARD_ERROR:"خطای دسترسی به کلیپبورد"};if(this.notifier&&this.notifier.show(r[t],"warning"),!this.errorHandler)throw new Error(t);this.errorHandler.handle(new Error(t),{type:J.UI,context:"platform-strategy-field-error"})}}],e&&wn(t.prototype,e),r&&wn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o}();function Ln(t){return Ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ln(t)}function Tn(){Tn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ln(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ln(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function kn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function _n(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){kn(i,n,o,a,c,"next",t)}function c(t){kn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function On(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Sn(n.key),n)}}function Sn(t){var e=function(t,e){if("object"!=Ln(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ln(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ln(e)?e:e+""}function An(t,e,r){return e=Nn(e),function(t,e){if(e&&("object"==Ln(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,In()?Reflect.construct(e,r||[],Nn(t).constructor):e.apply(t,r))}function In(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(In=function(){return!!t})()}function Nn(t){return Nn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Nn(t)}function Pn(t,e){return Pn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pn(t,e)}var jn=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=An(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pn(t,e)}(e,t),r=e,n=[{key:"isWhatsAppElement",value:function(t){return!!t.closest('[aria-label="Type a message"]')}},{key:"updateElement",value:(u=_n(Tn().mark((function t(e,r){var n,o;return Tn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,n='[role="textbox"], .copyable-text.selectable-text',o=this.findField(e,n)){t.next=6;break}return oe("فیلد واتساپ یافت نشد"),t.abrupt("return");case 6:if(("INPUT"===o.tagName||"TEXTAREA"===o.tagName||o.hasAttribute("contenteditable"))&&o.isConnected){t.next=10;break}return oe("فیلد واتساپ نامعتبر است"),t.abrupt("return",!1);case 10:if(this.isWhatsAppElement(e)){t.next=13;break}return t.abrupt("return",!1);case 13:if(document.body.contains(e)){t.next=16;break}return oe("Element removed from DOM"),t.abrupt("return",!1);case 16:return t.next=18,this.safeFocus(e);case 18:return this.applyVisualFeedback(o),t.next=21,this.selectAllContent(o);case 21:return t.next=23,this.simulatePaste(o,r);case 23:return this.triggerStateUpdate(o),t.abrupt("return",!0);case 27:return t.prev=27,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.PARSE_INPUT,context:"whatsapp-strategy-updateElement"}),t.abrupt("return",!1);case 31:case"end":return t.stop()}}),t,this,[[0,27]])}))),function(t,e){return u.apply(this,arguments)})},{key:"extractText",value:function(t){try{if(!t)return"";if(t.isContentEditable)return t.innerText.trim();if(t.value)return t.value.trim();if(t.textContent)return t.textContent.trim()}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"WhatsApp-strategy-extractText-fallback"})}return""}},{key:"safeFocus",value:(c=_n(Tn().mark((function t(e){return Tn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return e.focus({preventScroll:!0}),t.next=3,ee(100);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=_n(Tn().mark((function t(e){var r,n;return Tn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,r=window.getSelection(),(n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n),t.next=8,ee(100);case 8:return t.abrupt("return",e);case 11:t.prev=11,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.PARSE_INPUT,context:"whatsapp-strategy-selectAllContent"});case 14:case"end":return t.stop()}}),t,this,[[0,11]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=_n(Tn().mark((function t(e,r){var n,o,i,a;return Tn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e&&null!=r){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n=(n=r.trim()).replace(/\n{2,}/g,"\n"),o=n.replace(/\n/g,"<br>"),(i=new DataTransfer).setData("text/plain",n),i.setData("text/html",o),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a),t.next=13,ee(50);case 13:t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.PARSE_INPUT,context:"whatsapp-strategy-simulatePaste"});case 18:case"end":return t.stop()}}),t,this,[[2,15]])}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&On(r.prototype,n),o&&On(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,u}(En);function Cn(t){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cn(t)}function Rn(){Rn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Cn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Cn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Gn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Fn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Gn(i,n,o,a,c,"next",t)}function c(t){Gn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Mn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Dn(n.key),n)}}function Dn(t){var e=function(t,e){if("object"!=Cn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Cn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Cn(e)?e:e+""}function Un(t,e,r){return e=Bn(e),function(t,e){if(e&&("object"==Cn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Hn()?Reflect.construct(e,r||[],Bn(t).constructor):e.apply(t,r))}function Hn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Hn=function(){return!!t})()}function Bn(t){return Bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bn(t)}function $n(t,e){return $n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},$n(t,e)}var zn=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Un(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$n(t,e)}(e,t),r=e,n=[{key:"isDirectMessageInputField",value:function(t){return!(!t||!t.matches('div[role="textbox"][contenteditable="true"]'))}},{key:"updateElement",value:(l=Fn(Rn().mark((function t(e,r){return Rn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isDirectMessageInputField(e)){t.next=10;break}return t.next=4,this.clearContent(e);case 4:return t.next=6,this.pasteText(e,r);case 6:this.triggerStateUpdate(e),this.applyVisualFeedback(e),t.next=11;break;case 10:e.isContentEditable?(e.innerHTML=r,this.applyTextDirection(e,r),this.applyVisualFeedback(e)):(e.value=r,this.applyTextDirection(e,r),this.applyVisualFeedback(e));case 11:return t.abrupt("return",!0);case 14:return t.prev=14,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"instagram-strategy-updateElement"}),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t,this,[[0,14]])}))),function(t,e){return l.apply(this,arguments)})},{key:"clearContent",value:(s=Fn(Rn().mark((function t(e){return Rn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.safeFocus(e);case 5:return t.next=7,this.selectAllContent(e);case 7:return t.next=9,this.simulatePaste(e,"");case 9:return t.next=11,ee(50);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.UI,context:"instagram-strategy-clearContent"});case 16:case"end":return t.stop()}}),t,this,[[2,13]])}))),function(t){return s.apply(this,arguments)})},{key:"pasteText",value:(u=Fn(Rn().mark((function t(e,r){var n,o;return Rn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=10,ee(50);case 10:t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.UI,context:"instagram-strategy-pasteText"});case 15:case"end":return t.stop()}}),t,this,[[2,12]])}))),function(t,e){return u.apply(this,arguments)})},{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t?null!=t&&t.isContentEditable?(null==t||null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":"INPUT"===(null==t?void 0:t.tagName)||"TEXTAREA"===(null==t?void 0:t.tagName)?(null==t||null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null==t||null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":""}catch(t){return this.errorHandler.handle(t,{type:J.UI,context:"instagram-strategy-extractText"}),""}}},{key:"safeFocus",value:(c=Fn(Rn().mark((function t(e){return Rn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,e.focus({preventScroll:!0}),t.next=4,ee(100);case 4:return t.abrupt("return",e);case 7:t.prev=7,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"instagram-strategy-safeFocus"});case 10:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=Fn(Rn().mark((function t(e){var r,n;return Rn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,r=window.getSelection(),(n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n),t.next=8,ee(100);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"instagram-strategy-selectAllContent"});case 13:return t.abrupt("return",e);case 14:case"end":return t.stop()}}),t,this,[[0,10]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=Fn(Rn().mark((function t(e,r){var n,o;return Rn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=7,ee(50);case 7:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&Mn(r.prototype,n),o&&Mn(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,u,s,l}(En);function Yn(t){return Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yn(t)}function Xn(){Xn=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Yn(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Yn(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function qn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Vn(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){qn(i,n,o,a,c,"next",t)}function c(t){qn(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Wn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Kn(n.key),n)}}function Kn(t){var e=function(t,e){if("object"!=Yn(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Yn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Yn(e)?e:e+""}function Zn(t,e,r){return e=Jn(e),function(t,e){if(e&&("object"==Yn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Qn()?Reflect.construct(e,r||[],Jn(t).constructor):e.apply(t,r))}function Qn(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Qn=function(){return!!t})()}function Jn(t){return Jn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jn(t)}function to(t,e){return to=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},to(t,e)}var eo=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Zn(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&to(t,e)}(e,t),r=e,n=[{key:"isTwitterElement",value:function(t){if(!(t&&t instanceof Element))return!1;try{return!!t.closest('[data-testid="tweetTextarea_0"], [data-testid="tweetTextarea"]')}catch(t){return!1}}},{key:"isDMElement",value:function(t){if(!(t&&t instanceof Element))return!1;try{return!!t.closest('[data-testid="dmComposerTextInput"], [role="textbox"][aria-label="Text message"]')}catch(t){return!1}}},{key:"clearTweetField",value:function(t){if(t)try{t.focus();var e=window.getSelection();if(!(e.toString().length>0)){var r=document.createRange();r.selectNodeContents(t),e.removeAllRanges(),e.addRange(r)}var n=new DataTransfer;n.setData("text/plain","");var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n});t.dispatchEvent(o)}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"twitter-strategy-clearTweetField"})}}},{key:"pasteText_OLD",value:(c=Vn(Xn().mark((function t(e,r){var n,o,i,a;return Xn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,r&&"string"==typeof r){for(n=r.split("\n");n.length>0&&""===n[n.length-1].trim();)n.pop();o=n.join("\n"),(i=new DataTransfer).setData("text/plain",o),i.setData("text/html",o.replace(/\n/g,"<br>")),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a)}t.next=10;break;case 6:throw t.prev=6,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.UI,context:"twitter-strategy-pasteText"});case 10:case"end":return t.stop()}}),t,this,[[2,6]])}))),function(t,e){return c.apply(this,arguments)})},{key:"pasteText",value:(a=Vn(Xn().mark((function t(e,r){var n,o,i,a,c,u;return Xn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,!r||"string"!=typeof r){t.next=22;break}return n=r.split("\n").filter((function(t){return""!==t.trim()})),o=n.join("\n"),e.focus(),t.next=9,ee(20);case 9:(i=document.createRange()).selectNodeContents(e),i.collapse(!1),(a=window.getSelection()).removeAllRanges(),a.addRange(i),(c=new DataTransfer).setData("text/plain",o),c.setData("text/html",o.replace(/\n/g,"<br>")),u=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:c}),e.dispatchEvent(u)&&""!==e.innerText.trim()||(e.innerText=o,e.dispatchEvent(new Event("beforeinput",{bubbles:!0})),e.dispatchEvent(new Event("input",{bubbles:!0}))),this.setCursorToEnd(e);case 22:t.next=28;break;case 24:throw t.prev=24,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.UI,context:"twitter-strategy-pasteText"});case 28:case"end":return t.stop()}}),t,this,[[2,24]])}))),function(t,e){return a.apply(this,arguments)})},{key:"setCursorToEnd",value:function(t){if(t)try{var e=window.getSelection(),r=document.createRange();r.selectNodeContents(t),r.collapse(!1),e.removeAllRanges(),e.addRange(r)}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"twitter-strategy-setCursorToEnd"})}}},{key:"isInputElement",value:function(t){return!!t&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName)}},{key:"updateElement",value:(i=Vn(Xn().mark((function t(e,r){var n,o,i,a,c,u;return Xn().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,!(n=document.querySelector('[data-testid="SearchBox_Search_Input"]'))){t.next=11;break}o=!1;try{e&&"function"==typeof e.contains&&(o=e.contains(n))}catch(t){}if(!this.validateField(n)||e!==n&&!o&&document.activeElement!==n){t.next=11;break}return this.applyVisualFeedback(n),n.value=r,n.dispatchEvent(new Event("input",{bubbles:!0})),this.applyTextDirection(n,r),t.abrupt("return",!0);case 11:if(i=!1,e&&(i=this.isDMElement(e)),a=this.isDMElement(document.activeElement),!i&&!a){t.next=31;break}if(c=null,!(c=this.findField(e||document.activeElement,'[data-testid="dmComposerTextInput"]'))){t.next=31;break}try{window.getSelection().removeAllRanges()}catch(t){oe("[DEBUG] updateElement - Error removing selection ranges:",t)}return c.focus(),this.applyVisualFeedback(c),this.clearTweetField(c),t.next=25,ee(50);case 25:return this.pasteText(c,r),this.applyTextDirection(c,r),t.next=29,ee(100);case 29:return this.setCursorToEnd(c),t.abrupt("return",!0);case 31:return t.abrupt("return",!1);case 46:return this.pasteText(u,r),this.applyTextDirection(u,r),t.next=50,ee(100);case 50:this.setCursorToEnd(u);case 51:t.next=58;break;case 53:return t.prev=53,t.t0=t["catch"](0),oe("[DEBUG] Critical error in updateElement:",t.t0),this.errorHandler.handle(t.t0,{type:J.UI,context:"twitter-strategy-updateElement"}),t.abrupt("return",!1);case 58:case"end":return t.stop()}}),t,this,[[0,53]])}))),function(t,e){return i.apply(this,arguments)})},{key:"extractText",value:function(t){var e=document.querySelector('[data-testid="SearchBox_Search_Input"]');if(e){var r=!1;if(t&&"function"==typeof t.contains&&(r=t.contains(e)),this.validateField(e)&&(t===e||document.activeElement===e||r))return e.value.trim()}var n,o=!1;if(t&&(o=this.isDMElement(t)),n=this.isDMElement(document.activeElement),o||n){var i=null;if(i=this.findField(t||document.activeElement,'[data-testid="dmComposerTextInput"]')){var a="";if("DIV"===i.tagName){var c=i.querySelector('[data-contents="true"]');a=c?Array.from(c.querySelectorAll(":scope > div")).map((function(t){return t.textContent})).join("\n").trim():i.textContent.trim()}else a=(i.value||"").trim();return a}}var u,s=null;u=this.isTwitterElement(document.activeElement);var l=!1;if(t&&(l=this.isTwitterElement(t)),!(s=u?document.activeElement:l?t:this.findField(t||document.body,'[data-testid="tweetTextarea_0"], [data-testid="tweetTextarea"]')))return"";var f="";if("DIV"===s.tagName){var h=s.querySelector('[data-contents="true"]');f=h?Array.from(h.querySelectorAll(":scope > div")).map((function(t){return t.textContent})).join("\n").trim():s.textContent.trim()}else f=(s.value||"").trim();return f}},{key:"validateField",value:function(t){try{return!!t&&t instanceof Element}catch(t){return!1}}},{key:"findField",value:function(t,e){if(!t)return null;try{return t.matches&&t.matches(e)?t:"function"==typeof t.querySelector?t.querySelector(e):document.querySelector(e)}catch(t){return null}}}],n&&Wn(r.prototype,n),o&&Wn(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c}(En);function ro(t){return ro="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ro(t)}function no(){no=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==ro(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ro(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function oo(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function io(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){oo(i,n,o,a,c,"next",t)}function c(t){oo(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ao(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,co(n.key),n)}}function co(t){var e=function(t,e){if("object"!=ro(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=ro(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ro(e)?e:e+""}function uo(t,e,r){return e=lo(e),function(t,e){if(e&&("object"==ro(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,so()?Reflect.construct(e,r||[],lo(t).constructor):e.apply(t,r))}function so(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(so=function(){return!!t})()}function lo(t){return lo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lo(t)}function fo(t,e){return fo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},fo(t,e)}var ho=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=uo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fo(t,e)}(e,t),r=e,n=[{key:"isInputField",value:function(t){return"INPUT"===t.tagName||"TEXTAREA"===t.tagName}},{key:"isContentEditable",value:function(t){return t.isContentEditable}},{key:"getTelegramField",value:function(t){if(t)try{if(this.isInputField(t)||this.isContentEditable(t))return t;var e=t.closest('[aria-label="Message input"]')||t.closest(".composer_rich_textarea")||t.closest(".public_DraftEditor-content");if(!e){var r=document.querySelectorAll('[contenteditable="true"]');e=1===r.length?r[0]:null}if(e&&!this.isContentEditable(e)){var n=e.querySelector('[contenteditable="true"]');n&&(e=n)}return e}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"telegram-strategy-getTelegramField"})}}},{key:"clearField",value:(s=io(no().mark((function t(e){var r,n,o,i;return no().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}return t.abrupt("return");case 3:if(!this.isInputField(e)){t.next=7;break}e.value="",t.next=18;break;case 7:return(r=window.getSelection())&&((n=document.createRange()).selectNodeContents(e),r.removeAllRanges(),r.addRange(n)),t.next=11,ee(50);case 11:return e.innerHTML="",(o=new DataTransfer).setData("text/plain",""),i=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:o}),t.next=17,ee(50);case 17:e.dispatchEvent(i);case 18:t.next=23;break;case 20:t.prev=20,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"telegram-strategy-Clearfield"});case 23:case"end":return t.stop()}}),t,this,[[0,20]])}))),function(t){return s.apply(this,arguments)})},{key:"pasteText",value:function(t,e){try{if(!t)return;if(null!=e){var r=new DataTransfer;r.setData("text/plain",e);var n=e.replace(/\n/g,"<br>");r.setData("text/html",n);var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:r});t.dispatchEvent(o)}}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"telegram-strategy-pasteText"})}}},{key:"setCursorToEnd",value:function(t){try{if(!t)return;if(this.isInputField(t)){var e=t.value.length;t.setSelectionRange(e,e)}else{var r=window.getSelection(),n=document.createRange();n.selectNodeContents(t),n.collapse(!1),r.removeAllRanges(),r.addRange(n)}}catch(t){this.errorHandler.handle(t,{type:J.SERVICE,context:"telegram-strategy-setCursorToEnd"})}}},{key:"updateElement",value:(u=io(no().mark((function t(e,r){var n,o;return no().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return",!1);case 2:if(e){t.next=4;break}return t.abrupt("return",!1);case 4:return n='[aria-label="Message input"], .composer_rich_textarea, .public_DraftEditor-content, [contenteditable="true"]',t.prev=5,t.next=8,ee(100);case 8:if(o=this.findField(e,n)||this.getTelegramField(e)||document.querySelector(n),this.validateField(o)){t.next=12;break}return oe("فیلد تلگرام یافت نشد"),t.abrupt("return",!1);case 12:if(e===o||o.contains(e)){t.next=14;break}return t.abrupt("return",!1);case 14:return t.next=16,this.safeFocus(o);case 16:if(this.applyVisualFeedback(document.getElementById("message-input-text")),!this.isInputField(o)){t.next=23;break}o.value=r,o.setAttribute("dir",l.RTL_REGEX.test(r)?"rtl":"ltr"),o.dispatchEvent(new Event("input",{bubbles:!0})),t.next=26;break;case 23:return t.next=25,this.clearField(o);case 25:this.pasteText(o,r);case 26:return this.setCursorToEnd(o),t.abrupt("return",!0);case 30:return t.prev=30,t.t0=t["catch"](5),this.errorHandler.handle(t.t0,{type:J.SERVICE,context:"telegram-strategy-updateElement"}),t.abrupt("return",!1);case 34:case"end":return t.stop()}}),t,this,[[5,30]])}))),function(t,e){return u.apply(this,arguments)})},{key:"extractText",value:function(t){try{if(!t)return"";if(t.isContentEditable)return t.innerText.trim();if(t.value)return t.value.trim();if(t.textContent)return t.textContent.trim()}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"Telegram-strategy-extractText-fallback"})}return""}},{key:"validateField",value:function(t){var e=null==t?void 0:t.querySelector('[contenteditable="true"]');return t&&t.isConnected&&(this.isInputField(t)||this.isContentEditable(t)||e)}},{key:"safeFocus",value:(c=io(no().mark((function t(e){return no().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.focus({preventScroll:!0}),t.next=6,ee(100);case 6:return t.abrupt("return",e);case 9:t.prev=9,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.UI,context:"telegram-strategy-safeFocus"});case 12:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=io(no().mark((function t(e){return no().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,document.execCommand("selectAll"),t.next=6,ee(100);case 6:return t.abrupt("return",e);case 9:t.prev=9,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.UI,context:"telegram-strategy-SelectAllContent"});case 12:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=io(no().mark((function t(e,r){var n,o,i,a;return no().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e&&null!=r){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n=(n=r.trim()).replace(/\n{2,}/g,"\n"),o=n.replace(/\n/g,"<br>"),(i=new DataTransfer).setData("text/plain",n),i.setData("text/html",o),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(a),t.next=13,ee(50);case 13:t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.UI,context:"telegram-strategy-simulatePaste"});case 18:case"end":return t.stop()}}),t,this,[[2,15]])}))),function(t,e){return i.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&ao(r.prototype,n),o&&ao(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,u,s}(En);function po(t){return po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},po(t)}function yo(){yo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==po(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(po(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function vo(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function go(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){vo(i,n,o,a,c,"next",t)}function c(t){vo(i,n,o,a,c,"throw",t)}a(void 0)}))}}function mo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,bo(n.key),n)}}function bo(t){var e=function(t,e){if("object"!=po(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=po(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==po(e)?e:e+""}function wo(t,e,r){return e=Eo(e),function(t,e){if(e&&("object"==po(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xo()?Reflect.construct(e,r||[],Eo(t).constructor):e.apply(t,r))}function xo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xo=function(){return!!t})()}function Eo(t){return Eo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Eo(t)}function Lo(t,e){return Lo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Lo(t,e)}var To=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=wo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lo(t,e)}(e,t),r=e,n=[{key:"shouldShowDefaultIcon",value:function(){return!0}},{key:"isMediumElement",value:function(t){return!(!t.closest('[role="textbox"]')&&!t.closest('[data-testid="editor-container"]'))}},{key:"updateElement",value:(u=go(yo().mark((function t(e,r){var n;return yo().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if("INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName){t.next=5;break}return e.value=r,e.dispatchEvent(new Event("input",{bubbles:!0})),this.applyVisualFeedback(e),t.abrupt("return",!0);case 5:return t.abrupt("return",!1);case 9:return this.safeFocus(n),t.prev=10,t.next=13,navigator.clipboard.writeText(r);case 13:oe("MediumStrategy: clipboard write SUCCESS for:",r.substring(0,20)+"..."),this.notifier.show("✅ ترجمه در حافظه کپی شد. (Ctrl+V)","success",!0,3e3),this.applyVisualFeedback(n),t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](10),this.errorHandler.handle(t.t0,{type:J.UI,context:"medium-strategy-updateElement"});case 21:case"end":return t.stop()}}),t,this,[[10,18]])}))),function(t,e){return u.apply(this,arguments)})},{key:"extractText",value:function(t){try{var e,r,n,o;if(!t)return"";if("INPUT"===t.tagName||"TEXTAREA"===t.tagName)return(null==t||null===(n=t.value)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"";var i=this.findMediumTextField(t);return(null==i||null===(e=i.innerText)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||""}catch(t){return this.errorHandler.handle(t,{type:J.UI,context:"medium-strategy-extractText"}),""}}},{key:"safeFocus",value:(c=go(yo().mark((function t(e){return yo().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,e.isConnected){t.next=3;break}return t.abrupt("return",null);case 3:return e.focus({preventScroll:!0}),t.next=6,ee(150);case 6:if(document.activeElement===e){t.next=10;break}return e.focus({preventScroll:!0}),t.next=10,ee(100);case 10:return t.abrupt("return",e);case 13:t.prev=13,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"medium-strategy-safeFocus"});case 16:case"end":return t.stop()}}),t,this,[[0,13]])}))),function(t){return c.apply(this,arguments)})},{key:"selectAllContent",value:(a=go(yo().mark((function t(e){return yo().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return document.execCommand("selectAll"),t.next=3,ee(100);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t)}))),function(t){return a.apply(this,arguments)})},{key:"simulatePaste",value:(i=go(yo().mark((function t(e,r){var n,o;return yo().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return(n=new DataTransfer).setData("text/plain",r),n.setData("text/html",r.replace(/\n/g,"<br>")),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),e.dispatchEvent(o),t.next=7,ee(50);case 7:case"end":return t.stop()}}),t)}))),function(t,e){return i.apply(this,arguments)})},{key:"findMediumTextField",value:function(t){for(var e=t,r=0;r<5&&e;r++){var n=e.closest('[role="textbox"][contenteditable="true"], [data-testid="editor-container"]');if(n)return n;e=e.parentElement}return document.querySelector('[role="textbox"][contenteditable="true"], [data-testid="editor-container"]')}},{key:"triggerStateUpdate",value:function(t){t.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&mo(r.prototype,n),o&&mo(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a,c,u}(En),ko=function(t){try{if(null==t||!t.isConnected)return;if(t.focus(),"INPUT"===t.tagName||"TEXTAREA"===t.tagName)t.selectionStart=t.selectionEnd=t.value.length;else if(t.isContentEditable){var e=document.createRange(),r=window.getSelection();e.selectNodeContents(t),e.collapse(!1),r.removeAllRanges(),r.addRange(e)}t.scrollTop=t.scrollHeight}catch(t){throw errorHandler.handle(t,{type:J.UI,context:"helpers-setCursorToEnd"})}};function _o(t){return _o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_o(t)}function Oo(){Oo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==_o(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(_o(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function So(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ao(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Io(n.key),n)}}function Io(t){var e=function(t,e){if("object"!=_o(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=_o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==_o(e)?e:e+""}function No(t,e,r){return e=jo(e),function(t,e){if(e&&("object"==_o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Po()?Reflect.construct(e,r||[],jo(t).constructor):e.apply(t,r))}function Po(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Po=function(){return!!t})()}function jo(t){return jo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},jo(t)}function Co(t,e){return Co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Co(t,e)}var Ro=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=No(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Co(t,e)}(e,t),r=e,n=[{key:"isChatGPTElement",value:function(t){return"prompt-textarea"===t.id}},{key:"extractText",value:function(t){try{if(document.querySelector(".absolute .inset-0"))return"";var e=t;if(e&&this.isChatGPTElement(e)||(e=document.querySelector("#prompt-textarea")),!e)throw new Error("عنصر ChatGPT برای استخراج متن شناسایی نشد.");return Array.from(e.querySelectorAll("p")).map((function(t){return t.textContent.trim()})).join("\n")}catch(t){return this.errorHandler.handle(t,{type:J.UI,context:"chatgpt-strategy-extractText"}),""}}},{key:"updateElement",value:(i=Oo().mark((function t(e,r){return Oo().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,!document.querySelector(".absolute .inset-0")){t.next=4;break}return t.abrupt("return",!1);case 4:return e.innerHTML=r.replace(/\n/g,"<br>"),this.applyBaseStyling(e,r),ko(e),this.applyVisualFeedback(e),t.abrupt("return",!0);case 11:return t.prev=11,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"chatgpt-strategy-updateElement"}),t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,this,[[0,11]])})),a=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=i.apply(t,e);function a(t){So(o,r,n,a,c,"next",t)}function c(t){So(o,r,n,a,c,"throw",t)}a(void 0)}))},function(t,e){return a.apply(this,arguments)})},{key:"applyBaseStyling",value:function(t,e){var r=l.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}],n&&Ao(r.prototype,n),o&&Ao(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(En);function Go(t){return Go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Go(t)}function Fo(){Fo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Go(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Go(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Mo(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Do(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Mo(i,n,o,a,c,"next",t)}function c(t){Mo(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Uo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ho(n.key),n)}}function Ho(t){var e=function(t,e){if("object"!=Go(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Go(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Go(e)?e:e+""}function Bo(t,e,r){return e=zo(e),function(t,e){if(e&&("object"==Go(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,$o()?Reflect.construct(e,r||[],zo(t).constructor):e.apply(t,r))}function $o(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return($o=function(){return!!t})()}function zo(t){return zo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zo(t)}function Yo(t,e){return Yo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Yo(t,e)}var Xo=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Bo(this,e,[t,r])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Yo(t,e)}(e,t),r=e,n=[{key:"isYoutube_ExtraField",value:function(t){return!(!t||"INPUT"!==t.tagName||"search_query"!==t.getAttribute("name")&&"end"!==t.getAttribute("id"))}},{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t?null!=t&&t.isContentEditable?(null==t||null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":null==t||!t.tagName||"TEXTAREA"!==t.tagName&&"INPUT"!==t.tagName?(null==t||null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":(null==t||null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":""}catch(t){return this.errorHandler.handle(t,{type:J.UI,context:"youtube-strategy-extractText"}),""}try{var c,u,s,l;return t&&t.isConnected?t.isContentEditable?(null===(s=t.innerText)||void 0===s||null===(l=s.trim)||void 0===l?void 0:l.call(s))||"":t.value||(null===(c=t.textContent)||void 0===c||null===(u=c.trim)||void 0===u?void 0:u.call(c))||"":""}catch(e){return this.errorHandler.handle(e,{type:J.UI,context:"youtube-strategy-extractText",element:null==t?void 0:t.tagName}),""}}},{key:"updateElement",value:(a=Do(Fo().mark((function t(e,r){var n;return Fo().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.isConnected){t.next=4;break}return oe("عنصر معتبر برای به‌روزرسانی وجود ندارد"),t.abrupt("return",!1);case 4:return null!=r&&(e.isContentEditable?(n=r.replace(/\n/g,"<br>"),e.innerHTML=n,this.applyVisualFeedback(e),this.applyTextDirection(e,n)):(e.value=r,this.applyVisualFeedback(e),this.applyTextDirection(e,r))),t.abrupt("return",!0);case 8:return t.prev=8,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"youtube-strategy-updateElement",element:null==e?void 0:e.tagName}),t.abrupt("return",!1);case 12:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(t,e){return a.apply(this,arguments)})},{key:"clearContent",value:(i=Do(Fo().mark((function t(e){return Fo().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.isConnected){t.next=3;break}return t.abrupt("return");case 3:"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value="":e.innerHTML="",this.applyVisualFeedback(e),t.next=11;break;case 7:throw t.prev=7,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"youtube-strategy-clearContent",element:null==e?void 0:e.tagName});case 11:case"end":return t.stop()}}),t,this,[[0,7]])}))),function(t){return i.apply(this,arguments)})}],n&&Uo(r.prototype,n),o&&Uo(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(En);function qo(t){return qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qo(t)}function Vo(){Vo=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==qo(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(qo(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Wo(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ko(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Zo(n.key),n)}}function Zo(t){var e=function(t,e){if("object"!=qo(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=qo(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==qo(e)?e:e+""}function Qo(t,e,r){return e=ti(e),function(t,e){if(e&&("object"==qo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Jo()?Reflect.construct(e,r||[],ti(t).constructor):e.apply(t,r))}function Jo(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Jo=function(){return!!t})()}function ti(t){return ti=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ti(t)}function ei(t,e){return ei=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ei(t,e)}var ri=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Qo(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ei(t,e)}(e,t),r=e,n=[{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t&&t instanceof Element?t.isContentEditable?(null===(n=t.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":["TEXTAREA","INPUT"].includes(t.tagName)?(null===(i=t.value)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null===(e=t.textContent)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||"":""}catch(t){return this.errorHandler.handle(t,{type:J.UI,context:"default-strategy-extractText"}),""}}},{key:"updateElement",value:(i=Vo().mark((function t(e,r){var n;return Vo().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,null==r){t.next=7;break}return this.applyVisualFeedback(e),e.isContentEditable?(n=r.replace(/\n/g,"<br>"),e.innerHTML=n,this.applyTextDirection(e,n)):(e.value=r,this.applyTextDirection(e,r)),t.next=6,ee(500);case 6:return t.abrupt("return",!0);case 7:t.next=13;break;case 9:return t.prev=9,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"default-strategy-updateElement"}),t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t,this,[[0,9]])})),a=function(){var t=this,e=arguments;return new Promise((function(r,n){var o=i.apply(t,e);function a(t){Wo(o,r,n,a,c,"next",t)}function c(t){Wo(o,r,n,a,c,"throw",t)}a(void 0)}))},function(t,e){return a.apply(this,arguments)})},{key:"clearContent",value:function(t){if(t)try{"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value="":t.innerHTML=""}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"default-strategy-clearContent"})}}}],n&&Ko(r.prototype,n),o&&Ko(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(En);function ni(t){return ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ni(t)}function oi(){oi=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==ni(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ni(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ii(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ai(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ii(i,n,o,a,c,"next",t)}function c(t){ii(i,n,o,a,c,"throw",t)}a(void 0)}))}}function ci(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ui(n.key),n)}}function ui(t){var e=function(t,e){if("object"!=ni(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=ni(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ni(e)?e:e+""}function si(t,e,r){return e=fi(e),function(t,e){if(e&&("object"==ni(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,li()?Reflect.construct(e,r||[],fi(t).constructor):e.apply(t,r))}function li(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(li=function(){return!!t})()}function fi(t){return fi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fi(t)}function hi(t,e){return hi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},hi(t,e)}var pi=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=si(this,e,[t])).errorHandler=r,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hi(t,e)}(e,t),r=e,n=[{key:"extractText",value:function(t){try{var e,r,n,o,i,a;return t&&t instanceof HTMLElement?t.isContentEditable?(null===(i=t.innerText)||void 0===i||null===(a=i.trim)||void 0===a?void 0:a.call(i))||"":(null===(e=t.value)||void 0===e||null===(r=e.trim)||void 0===r?void 0:r.call(e))||(null===(n=t.textContent)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":""}catch(t){return this.errorHandler.handle(t,{type:J.UI,context:"discord-strategy-extractText"}),""}}},{key:"updateElement",value:(a=ai(oi().mark((function t(e,r){return oi().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,!document.querySelector(".keyboardShortcutsModal_f061f6")){t.next=4;break}return t.abrupt("return",!1);case 4:if(null==r){t.next=25;break}if(!e.isContentEditable){t.next=16;break}return e.focus(),e.value=r,this.applyVisualFeedback(e),this.clearField(e),t.next=12,ee(200);case 12:this.pasteText(e,r),this.applyTextDirection(e,r),t.next=24;break;case 16:return e.focus(),e.value=r,this.applyVisualFeedback(e),this.clearField(e),t.next=22,ee(200);case 22:this.pasteText(e,r),this.applyTextDirection(e,r);case 24:return t.abrupt("return",!0);case 25:t.next=31;break;case 27:return t.prev=27,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.UI,context:"Discord-strategy-updateElement"}),t.abrupt("return",!1);case 31:case"end":return t.stop()}}),t,this,[[0,27]])}))),function(t,e){return a.apply(this,arguments)})},{key:"clearField",value:function(t){if(t)try{t.focus();var e=window.getSelection();if(!(e.toString().length>0)){var r=document.createRange();r.selectNodeContents(t),e.removeAllRanges(),e.addRange(r)}var n=new DataTransfer;n.setData("text/plain","");var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n});t.dispatchEvent(o)}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"Discord-strategy-clearField"})}}},{key:"pasteText",value:(i=ai(oi().mark((function t(e,r){var n,o,i,a,c,u,s=this;return oi().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e&&r&&"string"==typeof r){t.next=2;break}return t.abrupt("return");case 2:for(t.prev=2,n=r.split("\n");n.length>0&&""===n[n.length-1].trim();)n.pop();if(o=n.join("\n"),!navigator.clipboard||!navigator.clipboard.writeText){t.next=18;break}return i=window.getSelection(),a=i.getRangeAt(0).cloneRange(),t.next=11,navigator.clipboard.writeText(o);case 11:if(e.focus(),i.removeAllRanges(),i.addRange(a),!document.execCommand("paste")){t.next=16;break}return t.abrupt("return");case 16:return this.simulateInputInsertion(e,o),t.abrupt("return");case 18:(c=new DataTransfer).setData("text/plain",o),c.setData("text/html",o.replace(/\n/g,"<br>")),u=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:c}),e.focus(),e.dispatchEvent(u),setTimeout((function(){s.simulateInputInsertion(e,o)}),100),t.next=31;break;case 27:throw t.prev=27,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:J.UI,context:"Discord-strategy-pasteText"});case 31:case"end":return t.stop()}}),t,this,[[2,27]])}))),function(t,e){return i.apply(this,arguments)})},{key:"simulateInputInsertion",value:function(t,e){try{if(document.execCommand("insertText",!1,e))return}catch(t){}if("INPUT"===t.tagName||"TEXTAREA"===t.tagName){var r=t.selectionStart||0,n=t.selectionEnd||0,o=t.value.substring(0,r),i=t.value.substring(n);return t.value=o+e+i,t.selectionStart=t.selectionEnd=r+e.length,void t.dispatchEvent(new Event("input",{bubbles:!0}))}if(t.isContentEditable){var a=window.getSelection(),c=a.getRangeAt(0);c.deleteContents();var u=document.createTextNode(e);c.insertNode(u),c.setStartAfter(u),c.setEndAfter(u),a.removeAllRanges(),a.addRange(c),t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0}))}}}],n&&ci(r.prototype,n),o&&ci(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o,i,a}(En);function di(t){return di="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},di(t)}function yi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vi(n.key),n)}}function vi(t){var e=function(t,e){if("object"!=di(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=di(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==di(e)?e:e+""}var gi=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.errorHandler=e},(r=[{key:"cleanup",value:function(){y.highlightedElement&&(y.highlightedElement.style.outline="",y.highlightedElement=null),document.querySelectorAll(".AIWritingCompanion-translation-icon-extension").forEach((function(t){t.classList.add("fade-out"),setTimeout((function(){return t.remove()}),50)})),y.activeTranslateIcon=null}},{key:"applyTextDirection",value:function(t,e){if(null!=t&&t.style){var r=l.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}},{key:"createTranslateIcon",value:function(t){try{if(null==t||!t.isConnected)return null;n="styles/icon.css",(o=document.createElement("link")).rel="stylesheet",o.type="text/css",o.href=e().runtime.getURL(n),document.head.appendChild(o);var r=document.createElement("button");return r.className="AIWritingCompanion-translation-icon-extension",r.textContent=l.ICON_TRANSLATION,r.title=l.TRANSLATION_ICON_TITLE,r.style.display="none",document.body.appendChild(r),requestAnimationFrame((function(){if(t.isConnected){var e=t.getBoundingClientRect();r.style.top="".concat(e.top+window.scrollY+10,"px"),r.style.left="".concat(e.left+window.scrollX+e.width+10,"px"),r.style.display="block",r.classList.add("AIWritingCompanion-translation-icon-extension-fade-in")}})),r}catch(t){return this.errorHandler.handle(t,{type:J.UI,context:"IconManager-createTranslateIcon"}),null}var n,o}}])&&yi(t.prototype,r),n&&yi(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n}();var mi="default",bi="whatsapp",wi="telegram",xi="instagram",Ei="twitter",Li="medium",Ti="chatgpt",ki="youtube",_i="discrod";function Oi(){var t=window.location.hostname.toLowerCase();return{"web.whatsapp.com":bi,"web.telegram.org":wi,"www.instagram.com":xi,"twitter.com":Ei,"x.com":Ei,"medium.com":Li,"chat.openai.com":Ti,"chat.com":Ti,"chatgpt.com":Ti,"www.youtube.com":ki,"discord.com":_i}[t]||mi}function Si(t){return Si="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Si(t)}function Ai(){Ai=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Si(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Si(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ii(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}var Ni=new Map;function Pi(t){var e=[],r=new Map;return Array.from(t.keys()).forEach((function(t){Ni.has(t)?r.set(t,Ni.get(t)):e.push(t)})),{textsToTranslate:e,cachedTranslations:r}}function ji(t){for(var e,r=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,!1),n=[],o=new Map;e=r.nextNode();){var i=e.textContent.trim();n.push(e),i&&(o.has(i)?o.get(i).push(e):o.set(i,[e]))}return{textNodes:n,originalTextsMap:o}}function Ci(t,e,r){t.forEach((function(t){if(t.parentNode&&t.nodeType===Node.TEXT_NODE){var n=t.textContent,o=n.trim(),i=e.get(o);if(i&&o){var a=t.parentNode;!function(t){t.dataset.aiwcOriginalDirection||(t.dataset.aiwcOriginalDirection=t.style.direction||"");t.dataset.aiwcOriginalTextAlign||(t.dataset.aiwcOriginalTextAlign=t.style.textAlign||"")}(a);var c=document.createElement("span"),u="aiwc-".concat(Math.random().toString(36).substring(2,15));c.setAttribute("data-aiwc-original-id",u),c.setAttribute("data-aiwc-original-text",n);var s=n.split("\n"),l=i.split("\n");s.forEach((function(t,e){var n=void 0!==l[e]?l[e]:"",o=document.createElement("span");if(o.textContent=n,r.state.originalTexts.set(u,{originalText:t,wrapperElement:o}),c.appendChild(o),e<s.length-1){var i=document.createElement("br");i.setAttribute("data-aiwc-br","true"),c.appendChild(i)}})),function(t,e){if(t&&t.style){var r=et(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}(a,!0),nt(a,l);try{a.replaceChild(c,t)}catch(e){oe("AIWC Error replacing text node with container:",e,{textNode:t,containerSpan:c,parentElement:a}),r.state.originalTexts["delete"](u),e=Qt.processError(e),r.errorHandler.handle(e,{type:J.PARSE_SELECT_ELEMENT,context:"textExtraction-apply-translations-replace",elementId:"multiple"})}}}}))}function Ri(){var t;return t=Ai().mark((function t(e){var r,n;return Ai().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(n=0,document.querySelectorAll("span[data-aiwc-original-text]").forEach((function(t){var r=t.getAttribute("data-aiwc-original-text");if(null!==r)try{var o=t.parentNode;Di(o);var i=document.createTextNode(r);o.replaceChild(i,t),n++;for(var a=i.nextSibling;a&&"BR"===a.nodeName&&"true"===a.getAttribute("data-aiwc-br");){var c=a;a=a.nextSibling,c.parentNode.removeChild(c)}}catch(r){e.errorHandler.handle(r,{type:J.PARSE_SELECT_ELEMENT,context:"revert-translations-replace",elementId:t.getAttribute("data-aiwc-original-id")}),oe("Failed to revert container with original text.",r)}})),!(n>0)){t.next=16;break}return t.t0=e.notifier,t.t1="".concat(n," "),t.next=8,wt("STATUS_Revert_Number");case 8:if(t.t2=t.sent,t.t2){t.next=11;break}t.t2="(مورد بازگردانی شد)";case 11:t.t3=t.t2,t.t4=t.t1.concat.call(t.t1,t.t3),t.t0.show.call(t.t0,t.t4,"revert"),t.next=27;break;case 16:return t.next=18,H();case 18:if(!t.sent){t.next=27;break}return t.t5=e.notifier,t.next=22,wt("STATUS_REVERT_NOT_FOUND");case 22:if(t.t6=t.sent,t.t6){t.next=25;break}t.t6="(هیچ متنی برای بازگردانی یافت نشد)";case 25:t.t7=t.t6,t.t5.show.call(t.t5,t.t7,"warning");case 27:return null===(r=e.IconManager)||void 0===r||r.cleanup(),e.state.originalTexts.clear(),t.abrupt("return",n);case 30:case"end":return t.stop()}}),t)})),Ri=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ii(i,n,o,a,c,"next",t)}function c(t){Ii(i,n,o,a,c,"throw",t)}a(void 0)}))},Ri.apply(this,arguments)}function Gi(t,e){var r=t.trim().match(/(\[(?:[^]|\n|\r)*\]|\{(?:[^]|\n|\r)*\})/);if(!r||!r[1]){oe("No JSON structure (array or object) found in the response string.");var n=new Error("هیچ ساختار JSON معتبری در پاسخ یافت نشد.");return e.errorHandler.handle(n,{type:J.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-NoJsonFound"}),[]}var o=r[1].trim();try{return JSON.parse(o)}catch(t){if(oe("Initial JSON.parse failed. Attempting repair by removing the last element.",t.message),!(o.startsWith("[")&&t instanceof SyntaxError)){oe("Initial parse failed, and repair condition not met (not array or not SyntaxError).");var i=Qt.processError(t);return e.errorHandler.handle(i,{type:J.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-InitialErrorNotRepaired"}),oe("Original problematic string:",o),[]}var a=o.lastIndexOf(",",o.length-2);if(-1===a){oe("Could not repair JSON: No comma found to separate the last element.");var c=Qt.processError(t);return e.errorHandler.handle(c,{type:J.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-NoCommaForRepair"}),oe("Original problematic string:",o),[]}var u=o.substring(0,a);u=u.trimEnd()+"]",oe("Attempting to parse repaired JSON string:",u);try{var s=JSON.parse(u);return oe("Successfully parsed JSON after removing the potentially corrupted last element.","warning"),s}catch(r){oe("Repair attempt also failed.",r.message);var l=Qt.processError(t);return e.errorHandler.handle(l,{type:J.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-RepairFailed"}),oe("Original problematic string:",o),[]}}}function Fi(t){var e=[],r=[],n=new Map;return t.forEach((function(t,o){var i=t.split("\n"),a=[];i.forEach((function(t,n){e.push(t),r.push({originalIndex:o,segmentIndex:n}),a.push(e.length-1)})),n.set(o,a)})),{expandedTexts:e,originMapping:r,originalToExpandedIndices:n}}function Mi(t,e){return Array.isArray(t)?t.length===e.length||(oe("عدم تطابق طول.","طول مورد انتظار (بر اساس متن‌های گسترش‌یافته): ".concat(e.length),"طول دریافت شده: ".concat(t.length),"علت احتمالی: تقسیم/ادغام متفاوت متن توسط API یا افزودن/حذف آیتم‌ها.","تلاش برای پردازش با داده‌های موجود ادامه می‌یابد..."),Math.abs(t.length-e.length)<3/7*e.length):(oe("پاسخ ترجمه یک آرایه نیست.","داده پارس شده:",t),!1)}function Di(t){void 0!==t.dataset.aiwcOriginalDirection&&(t.style.direction=t.dataset.aiwcOriginalDirection,delete t.dataset.aiwcOriginalDirection),void 0!==t.dataset.aiwcOriginalTextAlign&&(t.style.textAlign=t.dataset.aiwcOriginalTextAlign,delete t.dataset.aiwcOriginalTextAlign)}function Ui(t,e,r,n,o){for(var i=new Map,a=new Map,c=Math.min(e.length,t.length),u=0;u<c;u++){var s=t[u],l=r[u];if(s&&"string"==typeof s.text&&l){var f=l.originalIndex;a.has(f)||a.set(f,[]),a.get(f).push(s.text)}else if(oe("داده ترجمه نامعتبر یا گمشده برای آیتم در اندیس ".concat(u,"."),"آیتم دریافتی:",s,"اطلاعات نگاشت:",l),l){var h=l.originalIndex;a.has(h)||a.set(h,[]),a.get(h).push(e[u])}}return n.forEach((function(t,e){if(a.has(e)){var r=a.get(e).join("\n");i.set(t,r),Ni.set(t,r)}else o.has(t)||i.set(t,t)})),i}function Hi(t){return Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hi(t)}function Bi(){Bi=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Hi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Hi(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function $i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function zi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?$i(Object(r),!0).forEach((function(e){Yi(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Yi(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=Hi(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Hi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Hi(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Xi(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function qi(){if(!document.getElementById("__AI_WRITING_BRIDGE")){var t=document.createElement("script");t.src=e().runtime.getURL("./pageBridge.js"),t.id="__AI_WRITING_BRIDGE",(document.head||document.documentElement).appendChild(t)}}function Vi(t){return Wi.apply(this,arguments)}function Wi(){var t;return t=Bi().mark((function t(r){var n,o,i,a=arguments;return Bi().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"Popup_Translate",t.prev=1,t.next=4,e().runtime.sendMessage({action:"fetchTranslation",payload:{promptText:r,translationMode:n}});case 4:return o=t.sent,t.abrupt("return",zi(zi({},o),{},{viaBridge:!1}));case 8:return t.prev=8,t.t0=t["catch"](1),oe("[BridgeIntegration] Normal translate failed. Falling back to bridge."),t.next=13,Ki(r,n);case 13:return i=t.sent,t.abrupt("return",i);case 15:case"end":return t.stop()}}),t,null,[[1,8]])})),Wi=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Xi(i,n,o,a,c,"next",t)}function c(t){Xi(i,n,o,a,c,"throw",t)}a(void 0)}))},Wi.apply(this,arguments)}function Ki(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Popup_Translate";return new Promise((function(r,n){var o="".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),i=function(t){var e,a;t.source===window&&"AI_WRITING_TRANSLATE_RESPONSE"===(null===(e=t.data)||void 0===e?void 0:e.type)&&(null===(a=t.data)||void 0===a||null===(a=a.original)||void 0===a?void 0:a.__requestId)===o&&(window.removeEventListener("message",i),t.data.error?n(new Error(t.data.error)):r(zi(zi({},t.data.result),{},{viaBridge:!0})))};window.addEventListener("message",i),window.postMessage({type:"AI_WRITING_TRANSLATE_REQUEST",text:t,translateMode:e,__requestId:o},"*")}))}function Zi(t){return Zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zi(t)}function Qi(){Qi=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Zi(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Zi(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Ji(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ta(t){return ea.apply(this,arguments)}function ea(){var t;return t=Qi().mark((function t(r){var n,o,i,a,c,u,s,l,p,d,y,v,g,m,b,w,x,E,L,T,k,_,O,S,A,I;return Qi().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(i=r.text,a=r.translationHandler,c=r.target,u=r.selectionRange,s=void 0===u?null:u,i&&a){t.next=3;break}return t.abrupt("return");case 3:return l=s?h:f,p=null!==(n=null===(o=a.detectPlatform)||void 0===o?void 0:o.call(a,c))&&void 0!==n?n:Oi(),t.prev=5,qi(),t.next=9,Vi(i,l);case 9:if(!1!==(null==(E=t.sent)?void 0:E.success)){t.next=16;break}return(L=new Error(E.error||J.API)).type=J.API,t.next=15,a.errorHandler.handle(L,{type:J.API,context:"smartTranslate-response-handler",statusCode:E.statusCode||400,isPrimary:!0});case 15:return t.abrupt("return");case 16:if(T=(null!==(d=null!==(y=null!==(v=null!==(g=null===(m=E.data)||void 0===m?void 0:m.translatedText)&&void 0!==g?g:E.translatedText)&&void 0!==v?v:null===(b=E.result)||void 0===b||null===(b=b.data)||void 0===b?void 0:b.translatedText)&&void 0!==y?y:null===(w=E.result)||void 0===w?void 0:w.translatedText)&&void 0!==d?d:"").trim()){t.next=23;break}return(k=new Error(J.TRANSLATION_NOT_FOUND)).type=J.API,t.next=22,a.errorHandler.handle(k,{type:J.API,context:"smartTranslate-handler-main",isPrimary:!0});case 22:return t.abrupt("return");case 23:if(_=null!=c&&c.isContentEditable?c.innerText.trim():c&&"value"in c?c.value.trim():null,oe("[SmartTranslateHandler] Initial value:",_),O=!1,!s||null===(x=a.strategies[p])||void 0===x||!x.updateElement){t.next=32;break}return t.next=29,a.strategies[p].updateElement(s,T);case 29:O=t.sent,t.next=36;break;case 32:if(!c){t.next=36;break}return t.next=35,a.updateTargetElement(c,T);case 35:O=t.sent;case 36:if(oe("[SmartTranslateHandler] updateElement result:",O),S=null!=c&&c.isContentEditable?c.innerText.trim():c&&"value"in c?c.value.trim():null,!O||_===S){t.next=41;break}return oe("[SmartTranslateHandler] Strategy applied successfully"),t.abrupt("return");case 41:if(S!==T){t.next=44;break}return oe("[SmartTranslateHandler] DOM already updated"),t.abrupt("return");case 44:return oe("[SmartTranslateHandler] ❗ Fallback to manual apply"),t.next=47,e().runtime.sendMessage({action:"applyTranslationToActiveElement",payload:{translatedText:T}});case 47:if(!0===(A=t.sent)||A&&!0===A.success){t.next=53;break}throw(I=new Error((null==A?void 0:A.error)||J.API_SERVICE)).type=J.API,I;case 53:return oe("[SmartTranslateHandler] Fallback applied successfully"),t.prev=54,t.next=57,navigator.clipboard.writeText(T);case 57:return t.t0=a.notifier,t.next=60,wt("STATUS_SMARTTRANSLATE_COPIED");case 60:if(t.t1=t.sent,t.t1){t.next=63;break}t.t1="ترجمه در حافظه کپی شد. (Ctrl+V)";case 63:t.t2=t.t1,t.t0.show.call(t.t0,t.t2,"success",!0,3e3),t.next=71;break;case 67:return t.prev=67,t.t3=t["catch"](54),t.next=71,a.errorHandler.handle(t.t3,{type:J.UI,context:"smartTranslation-clipboard"});case 71:t.next=77;break;case 73:return t.prev=73,t.t4=t["catch"](5),t.next=77,a.errorHandler.handle(t.t4,{type:t.t4.type||J.API,context:"smartTranslate-handler-main-second"});case 77:case"end":return t.stop()}}),t,null,[[5,73],[54,67]])})),ea=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Ji(i,n,o,a,c,"next",t)}function c(t){Ji(i,n,o,a,c,"throw",t)}a(void 0)}))},ea.apply(this,arguments)}function ra(t){return ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ra(t)}function na(){na=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==ra(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ra(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function oa(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ia(t,e,r,n,o){if(t&&e){var i,a=!1,c=new Set,u=function(){var r;a||(a=!0,c.forEach((function(t){return cancelAnimationFrame(t)})),null===(r=i)||void 0===r||r.disconnect(),t.removeEventListener("click",s),t.removeEventListener("blur",l),e.removeEventListener("blur",l),t.classList.add("fade-out"),setTimeout((function(){return t.remove()}),50),y.activeTranslateIcon=null)},s=function(){var t,i=(t=na().mark((function t(i){var a,c,s,l;return na().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(i.preventDefault(),i.stopPropagation(),ae()){t.next=7;break}throw(a=new Error(J.CONTEXT)).type=J.CONTEXT,a.context="iconbehavior-click-context",a;case 7:if(c=null,t.prev=8,s=Oi(),l=o[s].extractText(e)){t.next=13;break}return t.abrupt("return");case 13:return t.t0=n,t.next=16,wt("STATUS_TRANSLATING_ICON");case 16:if(t.t1=t.sent,t.t1){t.next=19;break}t.t1="در حال ترجمه...";case 19:return t.t2=t.t1,c=t.t0.show.call(t.t0,t.t2,"status",!1),t.next=23,ta({text:l,target:e,translationHandler:r});case 23:t.next=28;break;case 25:t.prev=25,t.t3=t["catch"](8),oe("[IconBehavior] ",t.t3);case 28:return t.prev=28,c&&n.dismiss(c),u(),t.finish(28);case 32:case"end":return t.stop()}}),t,null,[[8,25,28,32]])})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){oa(i,n,o,a,c,"next",t)}function c(t){oa(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t){return i.apply(this,arguments)}}(),l=function(e){e.relatedTarget&&t.contains(e.relatedTarget)||setTimeout(u,50)},f=function(){if(e.isConnected&&t.isConnected){var r=requestAnimationFrame((function(){var r=e.getBoundingClientRect();t.style.top="".concat(r.bottom+window.scrollY+5,"px"),t.style.left="".concat(r.left+window.scrollX,"px"),t.style.display="block",t.classList.add("fade-in")}));c.add(r)}else u()};try{t instanceof HTMLElement&&t.isConnected||oe("[IconBehavior] آیکون معتبر نیست"),e.isConnected&&document.contains(e)||oe("[IconBehavior] المان هدف در DOM وجود ندارد"),t.style.display="none",document.body.appendChild(t),(i=new ResizeObserver(f)).observe(e),t.addEventListener("click",s),t.addEventListener("blur",l),e.addEventListener("blur",l),f(),y.activeTranslateIcon=t}catch(t){u(),r.errorHandler.handle(t,{type:J.UI,context:"IconBehavior-setup"})}}}function aa(t){return aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aa(t)}function ca(){ca=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==aa(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(aa(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ua(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function sa(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ua(i,n,o,a,c,"next",t)}function c(t){ua(i,n,o,a,c,"throw",t)}a(void 0)}))}}function la(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,fa(n.key),n)}}function fa(t){var e=function(t,e){if("object"!=aa(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=aa(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==aa(e)?e:e+""}var ha,pa=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fadeInDuration=e.fadeInDuration||50,this.fadeOutDuration=e.fadeOutDuration||125,this.isVisible=!1,this.displayElement=null,this.innerContainer=null,this.removeMouseDownListener=null,this.translationHandler=e.translationHandler,this.notifier=e.notifier,this.originalText=null,this.isTranslationCancelled=!1,this.show=this.show.bind(this),this.cancelCurrentTranslation=this.cancelCurrentTranslation.bind(this)},r=[{key:"show",value:(i=sa(ca().mark((function t(r,n){var o,i,a,c,u,s,l=this;return ca().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(ae()){t.next=6;break}return(o=new Error(J.CONTEXT)).type=J.CONTEXT,t.next=5,this.translationHandler.errorHandler.handle(o,{type:J.CONTEXT,context:"SelectionWindows-show-context",statusCode:"context-invalid"});case 5:return t.abrupt("return",t.sent);case 6:if(r&&(!this.isVisible||r!==this.originalText)){t.next=8;break}return t.abrupt("return");case 8:if(this.dismiss(!1),this.originalText=r,this.isTranslationCancelled=!1,i=an(r,f),this.displayElement=document.createElement("div"),this.displayElement.classList.add("aiwc-selection-popup-host"),this.applyInitialStyles(n),this.displayElement){t.next=17;break}return t.abrupt("return");case 17:a=this.displayElement.attachShadow({mode:"open"}),(c=document.createElement("style"))&&(c.textContent="\n        .popup-container {\n          background-color: #f8f8f8;\n          color: #333;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          padding: 8px 12px;\n          font-size: 14px;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n          max-width: 300px;\n          overflow-wrap: break-word;\n        }\n        .loading-container {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n        @keyframes blink {\n          0% { opacity: 0.3; }\n          50% { opacity: 0.8; }\n          100% { opacity: 0.3; }\n        }\n        .loading-dot {\n          font-size: 1.2em;\n          margin: 0 2px;\n          animation: blink 0.7s infinite;\n        }\n        .first-line { margin-bottom: 6px; display: flex; align-items: center; }\n        .original-text { font-weight: bold; margin-left: 6px; }\n        .second-line { margin-top: 4px; }\n        .tts-icon { width: 16px; height: 16px; cursor: pointer; margin-right: 6px; }\n      ",a.appendChild(c)),this.innerContainer=document.createElement("div"),this.innerContainer.classList.add("popup-container"),a.appendChild(this.innerContainer),u=this.createLoadingDots(),this.innerContainer.appendChild(u),document.body.appendChild(this.displayElement),this.isVisible=!0,requestAnimationFrame((function(){l.displayElement.style.opacity="0.9",l.displayElement.style.transform="scale(1)"})),e().runtime.sendMessage({action:"fetchTranslationBackground",payload:{promptText:r,translationMode:i}}).then((function(t){if(!l.isTranslationCancelled&&l.originalText===r){if(null==t||!t.success)throw new Error(t.error||J.SERVICE);var e=(t.data.translatedText||"").trim();if(!e)throw new Error(J.TRANSLATION_NOT_FOUND);l.transitionToTranslatedText(e,u,r,i)}}))["catch"](function(){var t=sa(ca().mark((function t(e){return ca().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,l.handleTranslationError(e,u);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),ae()&&(s=function(t){l.displayElement.contains(t.target)||l.cancelCurrentTranslation()},document.addEventListener("mousedown",s),this.removeMouseDownListener=s);case 30:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"cancelCurrentTranslation",value:function(){this.dismiss(),this.isTranslationCancelled=!0,this.originalText=null,this.translatedText=null,this.stoptts_playing()}},{key:"stoptts_playing",value:function(){ae()&&e().runtime.sendMessage({action:"stopTTS"})}},{key:"applyInitialStyles",value:function(t){Object.assign(this.displayElement.style,{position:"absolute",zIndex:"2147483637",left:"".concat(t.x,"px"),top:"".concat(t.y,"px"),transform:"scale(0.1)",transformOrigin:"top left",opacity:"0.6",transition:"transform 0.1s ease-out, opacity ".concat(this.fadeInDuration,"ms ease-in-out")})}},{key:"createLoadingDots",value:function(){var t=document.createElement("div");return t.classList.add("loading-container"),[0,1,2].forEach((function(){var e=document.createElement("span");e.classList.add("loading-dot"),e.textContent=".",t.appendChild(e)})),t}},{key:"transitionToTranslatedText",value:function(t,e,r,n){var o=this;e.remove(),this.innerContainer.innerHTML="";var i=document.createElement("div");i.classList.add("first-line");var a=this.createTTSIcon(r);if(i.appendChild(a),n===p){var c=document.createElement("span");c.classList.add("original-text"),c.textContent=r,i.appendChild(c)}this.innerContainer.appendChild(i);var u=document.createElement("div");u.classList.add("second-line");var s=document.createElement("span");s.classList.add("text-content"),s.innerHTML=rn.parse(t),u.appendChild(s),this.applyTextDirection(u,t),this.innerContainer.appendChild(u),requestAnimationFrame((function(){o.displayElement.style.transition="opacity 0.15s ease-in-out",o.displayElement.style.opacity="0.9"}))}},{key:"createTTSIcon",value:function(t){var r=document.createElement("img");return r.src=e().runtime.getURL("icons/speaker.png"),r.classList.add("tts-icon"),r.addEventListener("click",(function(r){r.stopPropagation(),ae()&&e().runtime.sendMessage({action:"speak",text:t,lang:ve})})),r}},{key:"handleTranslationError",value:(o=sa(ca().mark((function t(e,r){var n;return ca().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return r.remove(),n=e instanceof Error?e:new Error(String(e)),t.next=4,this.translationHandler.errorHandler.handle(n,{type:n.type||J.API,context:"selection-window-translate"});case 4:this.dismiss(!1);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"dismiss",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.displayElement&&this.isVisible&&(this.removeMouseDownListener&&(document.removeEventListener("mousedown",this.removeMouseDownListener),this.removeMouseDownListener=null),this.isVisible=!1,e&&this.fadeOutDuration>0?(this.displayElement.style.transition="opacity ".concat(this.fadeOutDuration,"ms ease-in-out"),this.displayElement.style.opacity="0",this.displayElement.addEventListener("transitionend",(function(){return t.removeElement()}),{once:!0})):this.removeElement())}},{key:"removeElement",value:function(){this.displayElement&&this.displayElement.parentNode&&this.displayElement.remove(),this.displayElement=null,this.innerContainer=null,this.isVisible=!1,this.originalText=null,this.isTranslationCancelled=!1}},{key:"applyTextDirection",value:function(t,e){if(t){var r=l.RTL_REGEX.test(e);t.style.direction=r?"rtl":"ltr",t.style.textAlign=r?"right":"left"}}}],r&&la(t.prototype,r),n&&la(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i}();function da(t){return da="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},da(t)}function ya(t){return function(t){if(Array.isArray(t))return va(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return va(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?va(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function va(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function ga(){ga=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==da(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(da(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ma(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ba(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ma(i,n,o,a,c,"next",t)}function c(t){ma(i,n,o,a,c,"throw",t)}a(void 0)}))}}function wa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xa(n.key),n)}}function xa(t){var e=function(t,e){if("object"!=da(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=da(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==da(e)?e:e+""}function Ea(t,e,r,n,o){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(t,e,i),null):i}var La=(ha=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.translationHandler=e,this.featureManager=r,this.IconManager=e.IconManager,this.notifier=e.notifier,this.strategies=e.strategies,this.isProcessing=e.isProcessing,this.SelectionWindows=new pa({translationHandler:e,notifier:e.notifier}),this.select_Element_ModeActive=e.select_Element_ModeActive,this.handleEvent=this.handleEvent.bind(this),this.handleSelect_ElementModeClick=this.handleSelect_ElementClick.bind(this),this.handleEscape=this.handleEscape.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.selectionTimeoutId=null,this.cancelSelectionTranslation=this.cancelSelectionTranslation.bind(this)},r=[{key:"setFeatureManager",value:function(t){this.featureManager=t}},{key:"handleEvent",value:(l=ba(ga().mark((function t(e){var r,n;return ga().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.isEscapeEvent(e)){t.next=4;break}return this.handleEscape(e),t.abrupt("return");case 4:if(!this.select_Element_ModeActive||"click"!==e.type){t.next=8;break}return t.next=7,this.handleSelect_ElementClick(e);case 7:case 11:case 15:return t.abrupt("return");case 8:if(!this.isCtrlSlashEvent(e)){t.next=12;break}return t.next=11,this.handleCtrlSlash(e);case 12:if(!this.isEditableTarget(e.target)||null===(r=this.featureManager)||void 0===r||!r.isOn("TEXT_FIELDS")){t.next=16;break}return t.next=15,this.handleEditableElement(e);case 16:if(!this.isMouseUp(e)){t.next=24;break}return t.next=19,q();case 19:if(!t.sent||this.isMouseUpCtrl(e)){t.next=22;break}return t.abrupt("return");case 22:return t.next=24,this.handleMouseUp(e);case 24:t.next=33;break;case 26:return t.prev=26,t.t0=t["catch"](0),t.next=30,ProcessError.processError(t.t0);case 30:return n=t.sent,t.next=33,this.translationHandler.errorHandler.handle(n,{type:J.UI,context:"event-handling",eventType:e.type});case 33:case"end":return t.stop()}}),t,this,[[0,26]])}))),function(t){return l.apply(this,arguments)})},{key:"isMouseUpCtrl",value:function(t){return"mouseup"===t.type&&(t.ctrlKey||t.metaKey)}},{key:"isMouseUp",value:function(t){return"mouseup"===t.type}},{key:"isCtrlSlashEvent",value:function(t){return(t.ctrlKey||t.metaKey)&&"/"===t.key&&!t.repeat}},{key:"isEscapeEvent",value:function(t){return"Escape"===t.key&&!t.repeat}},{key:"_getSelectedTextWithDash",value:function(){var t=window.getSelection(),e="";if(t.rangeCount>1)for(var r=0;r<t.rangeCount;r++)e+=t.getRangeAt(r).toString().trim(),r<t.rangeCount-1&&(e+=" - \n");else e=t.toString().trim();return e.trim()}},{key:"_getEventPath",value:function(t){var e=t.composedPath?t.composedPath():[];if(!e||0===e.length){var r=t.target;for(e=[];r;)e.push(r),r=r.parentNode}return e}},{key:"handleMouseUp",value:(s=ba(ga().mark((function t(e){var r,n,o,i,a,c=this;return ga().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(o=this._getSelectedTextWithDash(),i=this._getEventPath(e),null===(r=this.SelectionWindows)||void 0===r||!r.isVisible||!i.includes(null===(n=this.SelectionWindows)||void 0===n?void 0:n.displayElement)){t.next=4;break}return t.abrupt("return");case 4:o?this.selectionTimeoutId||(this.selectionTimeoutId=setTimeout((function(){c.selectionTimeoutId=null,c.processSelectedText(o,e)}),250),document.addEventListener("mousedown",this.cancelSelectionTranslation)):(this.selectionTimeoutId&&(clearTimeout(this.selectionTimeoutId),this.selectionTimeoutId=null,document.removeEventListener("mousedown",this.cancelSelectionTranslation)),null!==(a=this.SelectionWindows)&&void 0!==a&&a.isVisible&&this.SelectionWindows.dismiss());case 5:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"cancelSelectionTranslation",value:function(){if(this.selectionTimeoutId){clearTimeout(this.selectionTimeoutId),this.selectionTimeoutId=null;try{document.removeEventListener("mousedown",this.cancelSelectionTranslation)}catch(t){}}}},{key:"processSelectedText",value:(u=ba(ga().mark((function t(e,r){var n,o,i,a,c,u,s;return ga().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:o=window.getSelection(),i={x:0,y:0},o.rangeCount>0&&(a=o.getRangeAt(0),c=a.getBoundingClientRect(),i={x:c.left+window.scrollX,y:c.bottom+window.scrollY+15},u=300,s=window.innerWidth,i.x<10?i.x=10:i.x+u>s-10&&(i.x=s-u-10)),null===(n=this.SelectionWindows)||void 0===n||n.show(e,i),document.removeEventListener("mousedown",this.cancelSelectionTranslation);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"isEditableTarget",value:function(t){return(null==t?void 0:t.isContentEditable)||["INPUT","TEXTAREA"].includes(null==t?void 0:t.tagName)||(null==t?void 0:t.closest)&&t.closest('[contenteditable="true"]')}},{key:"_processEditableElement",value:function(t){if(!this.IconManager||!this.featureManager.isOn("EXTENSION_ENABLED"))return null;if(!this.IconManager)return null;if(this.IconManager.cleanup(),Oi()===ki){var e,r=this.strategies["youtube"];if(null!=r&&null!==(e=r.isYoutube_ExtraField)&&void 0!==e&&e.call(r,t))return null}var n=this.IconManager.createTranslateIcon(t);return n?(ia(n,t,this.translationHandler,this.notifier,this.strategies),n):null}},{key:"handleEditableFocus",value:function(t){var e;y.activeTranslateIcon||null!==(e=this.featureManager)&&void 0!==e&&e.isOn("TEXT_FIELDS")&&this._processEditableElement(t)}},{key:"handleEditableElement",value:(c=ba(ga().mark((function t(e){var r,n;return ga().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(!y.activeTranslateIcon){t.next=2;break}return t.abrupt("return");case 2:e.stopPropagation(),n=e.target,null!==(r=this.featureManager)&&void 0!==r&&r.isOn("TEXT_FIELDS")&&this._processEditableElement(n);case 5:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"handleEditableBlur",value:function(){var t=this;setTimeout((function(){var e,r;null!==(e=document.activeElement)&&void 0!==e&&e.isConnected&&(document.activeElement===y.activeTranslateIcon||document.activeElement.closest(".AIWritingCompanion-translation-icon-extension"))||null===(r=t.IconManager)||void 0===r||r.cleanup()}),100)}},{key:"cleanCache",value:(a=ba(ga().mark((function t(){return ga().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return e={state:y},Ni.clear(),e&&e.state&&e.state.originalTexts&&e.state.originalTexts.clear(),t.t0=this.notifier,t.next=4,wt("STATUS_REMOVE_MEMORY");case 4:if(t.t1=t.sent,t.t1){t.next=7;break}t.t1="Memory Cleared";case 7:t.t2=t.t1,t.t0.show.call(t.t0,t.t2,"info",!0,2e3);case 9:case"end":return t.stop()}var e}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"handleSelect_ElementClick",value:(i=ba(ga().mark((function t(r){var n,o,i,a,c,u,s,l,f,p,d,v,g,m,b,w,x,E,L,T,k,_,O,S,A=this;return ga().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(ue(!1),this.translationHandler.select_Element_ModeActive=!1,y.selectElementActive=!1,this.IconManager&&this.IconManager.cleanup(),n=r.target,o=ji(n),i=o.textNodes,(a=o.originalTextsMap).size){t.next=8;break}return t.abrupt("return",{status:"empty",reason:"no_text_found"});case 8:if(c=Pi(a),u=c.textsToTranslate,s=c.cachedTranslations,u.length||!s.size){t.next=21;break}return Ci(i,s,{state:y,IconManager:this.IconManager}),t.t0=this.notifier,t.next=14,wt("STATUS_FROM_MEMORY");case 14:if(t.t1=t.sent,t.t1){t.next=17;break}t.t1="از حافظه";case 17:return t.t2=t.t1,t.t3=function(){return A.cleanCache()},t.t0.show.call(t.t0,t.t2,"info",!0,2e3,t.t3),t.abrupt("return",{status:"success",source:"cache",translatedCount:s.size});case 21:if(u.length){t.next=23;break}return t.abrupt("return",{status:"skip",reason:"no_new_texts"});case 23:return t.t4=this.notifier,t.next=26,wt("STATUS_TRANSLATING_SELECT_ELEMENT");case 26:if(t.t5=t.sent,t.t5){t.next=29;break}t.t5="در حال ترجمه…";case 29:if(t.t6=t.t5,l=t.t4.show.call(t.t4,t.t6,"status",!1),y.translateMode=h,t.prev=32,p=Fi(u),d=p.expandedTexts,v=p.originMapping,!((g=JSON.stringify(d.map((function(t){return{text:t}})))).length>2e4)){t.next=39;break}return m="متن انتخابی بسیار بزرگ است (".concat(g.length," بایت)"),this.notifier.show(m,"warning",!0,3e3),t.abrupt("return",{status:"error",reason:"payload_large",message:m});case 39:return t.next=41,e().runtime.sendMessage({action:"fetchTranslationBackground",payload:{promptText:g,translationMode:h}});case 41:if(null!=(b=t.sent)&&b.success){t.next=47;break}return w=(null==b?void 0:b.error)||"(⚠️ خطایی در ترجمه رخ داد.)",t.next=46,this.translationHandler.errorHandler.handle(new Error(w),{type:J.API,statusCode:(null==b?void 0:b.statusCode)||401,context:"select-element-response"});case 46:return t.abrupt("return",{status:"error",reason:"backend_error",message:w});case 47:if(!b||!1!==b.success){t.next=52;break}return E="string"==typeof b.error?b.error:(null===(x=b.error)||void 0===x?void 0:x.message)||"(⚠️ خطایی در ترجمه رخ داد.)",t.next=51,this.translationHandler.errorHandler.handle(new Error(E),{type:J.API,context:"select-element-response"});case 51:return t.abrupt("return",{status:"error",reason:"api_error",message:E});case 52:if("string"==typeof(L=null==b||null===(f=b.data)||void 0===f?void 0:f.translatedText)&&L.trim()){t.next=57;break}return T="(⚠️ ترجمه‌ای دریافت نشد.)",this.notifier.show(T,"warning",!0,3e3),t.abrupt("return",{status:"error",reason:"empty_translation",message:T});case 57:if(k=Gi(L,this.translationHandler)){t.next=63;break}return t.next=62,this.translationHandler.errorHandler.handle(new Error(err),{type:J.API,context:"select-element-response-format"});case 62:return t.abrupt("return",{status:"error",reason:"api_error",message:err});case 63:return Mi(k,d)||this.notifier.show("(طول پاسخ ناهمخوان؛ مجدداً امتحان کنید.)","info",!0,1500),_=Ui(k,d,v,u,s),O=new Map([].concat(ya(s),ya(_))),Ci(i,O,{state:y,IconManager:this.IconManager}),l&&this.notifier.dismiss(l),t.abrupt("return",{status:"success",source:"translated",translatedCount:_.size,fromCache:s.size});case 71:return t.prev=71,t.t7=t["catch"](32),t.next=75,Qt.processError(t.t7);case 75:return S=t.sent,t.next=78,this.translationHandler.errorHandler.handle(S,{type:S.type||J.SERVICE,context:"EventHandler-handleSelect_ElementClick"});case 78:return t.abrupt("return",{status:"error",reason:"exception",message:S.message});case 79:return t.prev=79,l&&this.notifier.dismiss(l),t.finish(79);case 82:case"end":return t.stop()}}),t,this,[[32,71,79,82]])}))),function(t){return i.apply(this,arguments)})},{key:"handleEscape",value:function(t){ue(!1),this.cancelSelectionTranslation(),this.SelectionWindows.cancelCurrentTranslation(),this.translationHandler.select_Element_ModeActive=!1,y.selectElementActive=!1,y.translateMode===h&&function(t){Ri.apply(this,arguments)}({state:y,errorHandler:this.translationHandler.errorHandler,notifier:this.notifier,IconManager:this.IconManager}),this.IconManager&&this.IconManager.cleanup()}},{key:"handleCtrlSlash",value:(o=ba(ga().mark((function t(e){var r,n,o,i,a,c;return ga().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e.preventDefault(),e.stopPropagation(),!this.isProcessing){t.next=4;break}return t.abrupt("return");case 4:if(this.isProcessing=!0,t.prev=5,(r=this.translationHandler.getSelectElementContext()).select_element,n=r.activeElement,ie(n)){t.next=9;break}return t.abrupt("return");case 9:if(o=this.translationHandler.extractFromActiveElement(n)){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,this.translationHandler.processTranslation_with_CtrlSlash({text:o,originalText:o,target:n,selectionRange:null});case 14:t.next=25;break;case 16:return t.prev=16,t.t0=t["catch"](5),t.next=20,Qt.processError(t.t0);case 20:if(t.t0=t.sent,oe("[EventHandler] Ctrl+/ Error: ",t.t0),!t.t0.isFinal){t.next=24;break}return t.abrupt("return");case 24:null!==(i=t.t0.originalError)&&void 0!==i&&i.isPrimary||(a=t.t0.type||J.API,c=t.t0.statusCode||500,this.translationHandler.errorHandler.handle(t.t0,{type:a,statusCode:c,context:"ctrl-slash",suppressSecondary:!0}));case 25:return t.prev=25,this.isProcessing=!1,t.finish(25);case 28:case"end":return t.stop()}}),t,this,[[5,16,25,28]])}))),function(t){return o.apply(this,arguments)})}],r&&wa(t.prototype,r),n&&wa(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,i,a,c,u,s,l}(),Ea(ha.prototype,"handleEvent",[re],Object.getOwnPropertyDescriptor(ha.prototype,"handleEvent"),ha.prototype),Ea(ha.prototype,"handleMouseUp",[re],Object.getOwnPropertyDescriptor(ha.prototype,"handleMouseUp"),ha.prototype),Ea(ha.prototype,"handleSelect_ElementClick",[re],Object.getOwnPropertyDescriptor(ha.prototype,"handleSelect_ElementClick"),ha.prototype),ha);function Ta(t){return Ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ta(t)}function ka(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r["return"]&&(a=r["return"](),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return _a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_a(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Oa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Sa(n.key),n)}}function Sa(t){var e=function(t,e){if("object"!=Ta(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ta(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ta(e)?e:e+""}var Aa=function(){return t=function t(){var r,n,o,i,a,c,u=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.keyMap={EXTENSION_ENABLED:"EXTENSION_ENABLED",TRANSLATE_ON_TEXT_FIELDS:"TEXT_FIELDS",ENABLE_SHORTCUT_FOR_TEXT_FIELDS:"SHORTCUT_TEXT_FIELDS",TRANSLATE_WITH_SELECT_ELEMENT:"SELECT_ELEMENT",TRANSLATE_ON_TEXT_SELECTION:"TEXT_SELECTION",ENABLE_DICTIONARY:"DICTIONARY"},this.flags={EXTENSION_ENABLED:null===(r=s.EXTENSION_ENABLED)||void 0===r||r,TEXT_FIELDS:null!==(n=s.TEXT_FIELDS)&&void 0!==n?n:l.TRANSLATE_ON_TEXT_FIELDS,SHORTCUT_TEXT_FIELDS:null!==(o=s.SHORTCUT_TEXT_FIELDS)&&void 0!==o?o:l.ENABLE_SHORTCUT_FOR_TEXT_FIELDS,SELECT_ELEMENT:null!==(i=s.SELECT_ELEMENT)&&void 0!==i?i:l.TRANSLATE_WITH_SELECT_ELEMENT,TEXT_SELECTION:null!==(a=s.TEXT_SELECTION)&&void 0!==a?a:l.TRANSLATE_ON_TEXT_SELECTION,DICTIONARY:null!==(c=s.DICTIONARY)&&void 0!==c?c:l.ENABLE_DICTIONARY},this._subscribers={},e().storage.local.get(Object.keys(this.keyMap)).then((function(t){Object.entries(t).forEach((function(t){var e,r=ka(t,2),n=r[0],o=r[1],i=u.keyMap[n];i&&void 0!==o&&(u.flags[i]=o,null===(e=u._subscribers[i])||void 0===e||e.forEach((function(t){return t()})))}))}))["catch"]((function(t){oe("[FeatureManager] failed to load initial flags",t)})),e().storage.onChanged.addListener(this._onStorageChanged.bind(this))},r=[{key:"isOn",value:function(t){return this.flags[t]}},{key:"on",value:function(t,e){var r,n;(null!==(n=(r=this._subscribers)[t])&&void 0!==n?n:r[t]=[]).push(e)}},{key:"_onStorageChanged",value:function(t){var e=this;Object.entries(t).forEach((function(t){var r=ka(t,2),n=r[0],o=r[1].newValue,i=e.keyMap[n];if(i){var a,c=null!=o?o:e.flags[i];e.flags[i]!==c&&(e.flags[i]=c,null===(a=e._subscribers[i])||void 0===a||a.forEach((function(t){return t()})))}}))}}],r&&Oa(t.prototype,r),n&&Oa(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n}();function Ia(t){return Ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ia(t)}function Na(){Na=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ia(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ia(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Pa(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function ja(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Pa(i,n,o,a,c,"next",t)}function c(t){Pa(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Ca(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ra(n.key),n)}}function Ra(t){var e=function(t,e){if("object"!=Ia(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ia(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ia(e)?e:e+""}var Ga,Fa=function(){return t=function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.translationHandler=e,this.errorHandler=e.errorHandler;var o=function(t){return function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];try{return t.apply(n,r)}catch(t){var i;!function(t){Jt.apply(this,arguments)}(t,{type:J.UI,context:"event-router",eventType:null===(i=r[0])||void 0===i?void 0:i.type})}}};this.handleFocus=o(this.handleFocusMethod),this.handleBlur=o(this.handleBlurMethod),this.handleClick=o(this.handleClickMethod),this.handleKeyDown=o(this.handleKeyDownMethod),this.handleMouseOver=o(this.handleMouseOverMethod),this.handleMouseUp=o(this.handleMouseUpMethod),this.featureManager=r,this._attached=new Set,this.featureEventMap={TEXT_FIELDS:[{target:document,type:"focus",listener:this.handleFocus,options:!0},{target:document,type:"blur",listener:this.handleBlur,options:!0}],SHORTCUT_TEXT_FIELDS:[{target:document,type:"keydown",listener:this.handleKeyDown}],SELECT_ELEMENT:[{target:document,type:"mouseover",listener:this.handleMouseOver},{target:document,type:"click",listener:this.handleClick}],TEXT_SELECTION:[{target:document,type:"mouseup",listener:this.handleMouseUp}]},this.initEventListeners(),this.featureManager.on("EXTENSION_ENABLED",(function(){return n.initEventListeners()})),Object.keys(this.featureEventMap).forEach((function(t){n.featureManager.on(t,(function(){return n.updateListeners(t)}))}))},e=[{key:"initEventListeners",value:function(){var t=this,e=this.featureManager.isOn("EXTENSION_ENABLED");Object.keys(this.featureEventMap).forEach((function(r){e?t.updateListeners(r):t.removeListeners(r)}))}},{key:"updateListeners",value:function(t){var e=this,r=this.featureManager.isOn(t)&&this.featureManager.isOn("EXTENSION_ENABLED");this.featureEventMap[t].forEach((function(n){var o=n.target,i=n.type,a=n.listener,c=n.options,u="".concat(i,"_").concat(t);r&&!e._attached.has(u)?(o.addEventListener(i,a,c),e._attached.add(u)):!r&&e._attached.has(u)&&(o.removeEventListener(i,a,c),e._attached["delete"](u))}))}},{key:"removeListeners",value:function(t){var e=this;this.featureEventMap[t].forEach((function(r){var n=r.target,o=r.type,i=r.listener,a=r.options,c="".concat(o,"_").concat(t);e._attached.has(c)&&(n.removeEventListener(o,i,a),e._attached["delete"](c))}))}},{key:"handleFocusMethod",value:(s=ja(Na().mark((function t(e){return Na().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:this.featureManager.isOn("TEXT_FIELDS")&&e.target.isContentEditable&&this.translationHandler.handleEditableFocus(e.target);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"handleBlurMethod",value:(u=ja(Na().mark((function t(e){return Na().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:this.featureManager.isOn("TEXT_FIELDS")&&e.target.isContentEditable&&this.translationHandler.handleEditableBlur(e.target);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"handleClickMethod",value:(c=ja(Na().mark((function t(e){return Na().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(y.selectElementActive){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.translationHandler.eventHandler.handleSelect_ElementClick(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"handleKeyDownMethod",value:(a=ja(Na().mark((function t(e){return Na().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:this.translationHandler.handleEvent(e);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"handleMouseOverMethod",value:(i=ja(Na().mark((function t(e){var r,n,o,i;return Na().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(y.selectElementActive){t.next=2;break}return t.abrupt("return");case 2:if(null!=(i=(null===(r=e.composedPath)||void 0===r?void 0:r.call(e)[0])||e.target)&&null!==(n=i.innerText)&&void 0!==n&&n.trim()){t.next=5;break}return t.abrupt("return");case 5:(null===(o=y.highlightedElement)||void 0===o||null===(o=o.style)||void 0===o?void 0:o.outline)&&(y.highlightedElement.style.outline=""),y.highlightedElement=i,i.style.outline=l.HIGHLIGHT_STYLE;case 8:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})},{key:"handleMouseUpMethod",value:(o=ja(Na().mark((function t(e){return Na().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:this.translationHandler.handleEvent(e);case 1:case"end":return t.stop()}}),t,this)}))),function(t){return o.apply(this,arguments)})},{key:"dispose",value:(n=ja(Na().mark((function t(){var e=this;return Na().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:Object.keys(this.featureEventMap).forEach((function(t){return e.removeListeners(t)}));case 1:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})}],e&&Ca(t.prototype,e),r&&Ca(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,u,s}();function Ma(t){return Ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ma(t)}function Da(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r["return"]&&(a=r["return"](),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Ua(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ua(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ua(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Ha(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ba(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ha(Object(r),!0).forEach((function(e){$a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ha(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function $a(t,e,r){return(e=Ya(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function za(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ya(n.key),n)}}function Ya(t){var e=function(t,e){if("object"!=Ma(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ma(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ma(e)?e:e+""}function Xa(t,e,r,n,o){var i={};return Object.keys(n).forEach((function(t){i[t]=n[t]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=r.slice().reverse().reduce((function(r,n){return n(t,e,r)||r}),i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer?(Object.defineProperty(t,e,i),null):i}function qa(){qa=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ma(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ma(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Va(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Wa(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Va(i,n,o,a,c,"next",t)}function c(t){Va(i,n,o,a,c,"throw",t)}a(void 0)}))}}var Ka=(Ga=function(){return t=function t(){var e,r,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.notifier=new Pt,this.errorHandler=new Qt(this.notifier),this.ErrorTypes=J,this.handleEvent=(e=this.handleEvent.bind(this),r=300,function(){for(var t=this,o=arguments.length,i=new Array(o),a=0;a<o;a++)i[a]=arguments[a];clearTimeout(n),n=setTimeout((function(){clearTimeout(n),e.apply(t,i)}),r)}),this.strategies=$a($a($a($a($a($a($a($a($a({},bi,new jn(this.notifier,this.errorHandler)),xi,new zn(this.notifier,this.errorHandler)),Li,new To(this.notifier,this.errorHandler)),wi,new ho(this.notifier,this.errorHandler)),Ei,new eo(this.notifier,this.errorHandler)),Ti,new Ro(this.notifier,this.errorHandler)),ki,new Xo(this.notifier,this.errorHandler)),mi,new ri(this.notifier,this.errorHandler)),_i,new pi(this.notifier,this.errorHandler)),this.validateStrategies(),this.IconManager=new gi(this.errorHandler),this.displayedErrors=new Set,this.isProcessing=!1,this.select_Element_ModeActive=!1,this.featureManager=new Aa({TEXT_FIELDS:l.TRANSLATE_ON_TEXT_FIELDS,SHORTCUT_TEXT_FIELDS:l.ENABLE_SHORTCUT_FOR_TEXT_FIELDS,SELECT_ELEMENT:l.TRANSLATE_WITH_SELECT_ELEMENT,TEXT_SELECTION:l.TRANSLATE_ON_TEXT_SELECTION,DICTIONARY:l.ENABLE_DICTIONARY}),this.eventHandler=new La(this,this.featureManager),this.eventRouter=new Fa(this,this.featureManager)},e=[{key:"reinitialize",value:function(){oe("[TranslationHandler] Reinitializing state after update..."),this.isProcessing=!1,this.select_Element_ModeActive=!1}},{key:"handleEvent",value:(u=Wa(qa().mark((function t(e){return qa().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.eventHandler.handleEvent(e);case 3:t.next=10;break;case 5:return t.prev=5,t.t0=t["catch"](0),t.next=9,this.errorHandler.handle(t.t0,{type:t.t0.type||J.UI,context:"handleEvent",eventType:e.type});case 9:throw t.sent;case 10:case"end":return t.stop()}}),t,this,[[0,5]])}))),function(t){return u.apply(this,arguments)})},{key:"handleError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t instanceof Error?t:new Error(String(t));this.errorHandler.handle(r,Ba(Ba({},e),{},{origin:"TranslationHandler"}))}},{key:"handleError_OLD",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var r=t instanceof Error?t:new Error(String(t));this.errorHandler.handle(r,Ba(Ba({},e),{},{origin:"TranslationHandler"}))}catch(t){throw oe("[TranslationHandler] Error handling failed:",t),this.errorHandler.handle(t,{type:J.UI,context:"TranslationHandler-handleError"})}}},{key:"handleEditableFocus",value:function(t){this.eventHandler.handleEditableFocus(t)}},{key:"handleEditableBlur",value:function(){this.eventHandler.handleEditableBlur()}},{key:"handleEscape",value:function(t){this.eventHandler.handleEscape(t)}},{key:"handleCtrlSlash",value:(c=Wa(qa().mark((function t(e){return qa().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,this.eventHandler.handleCtrlSlash(e);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return c.apply(this,arguments)})},{key:"handleEditableElement",value:(a=Wa(qa().mark((function t(e){return qa().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,this.eventHandler.handleEditableElement(e);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"processTranslation_with_CtrlSlash",value:(i=Wa(qa().mark((function t(e){var r,n,o,i;return qa().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(r=null,t.prev=1,ae()){t.next=6;break}if(e.target){t.next=6;break}return this.errorHandler.handle(new Error(J.CONTEXT),{type:J.CONTEXT,context:"TranslationHandler-processTranslation-context",code:"context-invalid",statusCode:"context-invalid"}),t.abrupt("return");case 6:return t.t0=this.notifier,t.next=9,wt("STATUS_TRANSLATING_CTRLSLASH");case 9:if(t.t1=t.sent,t.t1){t.next=12;break}t.t1="(translating...)";case 12:return t.t2=t.t1,r=t.t0.show.call(t.t0,t.t2,"status"),y.translateMode=e.selectionRange?h:f,t.next=17,ta({text:e.text,translationHandler:this,target:e.target,selectionRange:e.selectionRange});case 17:t.next=33;break;case 19:return t.prev=19,t.t3=t["catch"](1),t.next=23,Qt.processError(t.t3);case 23:return n=t.sent,t.next=26,this.errorHandler.handle(n,{type:n.type||J.CONTEXT,context:"TranslationHandler-processTranslation",translationParams:e,isPrimary:!0});case 26:if(o=t.sent,r&&this.notifier.dismiss(r),!o.isFinal&&!o.suppressSecondary){t.next=30;break}return t.abrupt("return");case 30:throw i=new Error(o.message),Object.assign(i,{type:o.type,statusCode:o.statusCode,isFinal:!0,originalError:t.t3}),i;case 33:return t.prev=33,r&&this.notifier.dismiss(r),t.finish(33);case 36:case"end":return t.stop()}}),t,this,[[1,19,33,36]])}))),function(t){return i.apply(this,arguments)})},{key:"validateStrategies",value:(o=Wa(qa().mark((function t(){return qa().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:try{Object.entries(this.strategies).forEach((function(t){var e=Da(t,2),r=e[0];if("function"!=typeof e[1].extractText)throw new Error("استراتژی ".concat(r," متد extractText را پیاده‌سازی نکرده است"))}))}catch(t){this.errorHandler.handle(t,{type:J.INTEGRATION,context:"strategy-validation"})}case 1:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"updateTargetElement",value:(n=Wa(qa().mark((function t(e,r){var n,o;return qa().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,"string"!=typeof r||!r){t.next=7;break}if(o=Oi(),null===(n=this.strategies[o])||void 0===n||!n.updateElement||"function"!=typeof this.strategies[o].updateElement){t.next=7;break}return t.next=6,this.strategies[o].updateElement(e,r);case 6:return t.abrupt("return",t.sent);case 7:t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:J.SERVICE,context:"update-target-element",platform:Oi()});case 12:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t,this,[[0,9]])}))),function(t,e){return n.apply(this,arguments)})},{key:"getSelectElementContext",value:function(){return{select_element:window.getSelection(),activeElement:document.activeElement}}},{key:"extractFromActiveElement",value:function(t){var e=Oi(),r=this.strategies[e];return r&&"function"==typeof r.extractText?r.extractText(t):(this.errorHandler.handle(new Error("extractText method not implemented for this platform"),{type:J.SERVICE,context:"TranslationHandler-extractFromActiveElement-".concat(e)}),"")}},{key:"pasteContent",value:function(t,e){try{var r=Oi();this.strategies[r].pasteContent(t,e)}catch(t){this.errorHandler.handle(t,{type:J.UI,context:"paste-content",platform:Oi()})}}}],e&&za(t.prototype,e),r&&za(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,c,u}(),Xa(Ga.prototype,"reinitialize",[re],Object.getOwnPropertyDescriptor(Ga.prototype,"reinitialize"),Ga.prototype),Xa(Ga.prototype,"handleEvent",[re],Object.getOwnPropertyDescriptor(Ga.prototype,"handleEvent"),Ga.prototype),Xa(Ga.prototype,"handleError",[re],Object.getOwnPropertyDescriptor(Ga.prototype,"handleError"),Ga.prototype),Xa(Ga.prototype,"handleError_OLD",[re],Object.getOwnPropertyDescriptor(Ga.prototype,"handleError_OLD"),Ga.prototype),Xa(Ga.prototype,"processTranslation_with_CtrlSlash",[re],Object.getOwnPropertyDescriptor(Ga.prototype,"processTranslation_with_CtrlSlash"),Ga.prototype),Xa(Ga.prototype,"updateTargetElement",[re],Object.getOwnPropertyDescriptor(Ga.prototype,"updateTargetElement"),Ga.prototype),Xa(Ga.prototype,"pasteContent",[re],Object.getOwnPropertyDescriptor(Ga.prototype,"pasteContent"),Ga.prototype),Ga),Za=null,Qa=null;function Ja(t){return Ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ja(t)}function tc(){tc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Ja(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Ja(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ec(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function rc(){return nc.apply(this,arguments)}function nc(){var t;return t=tc().mark((function t(){var r,n,o,i,a,c,u,s=arguments;return tc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return r=s.length>0&&void 0!==s[0]?s[0]:null,n=s.length>1&&void 0!==s[1]&&s[1],o=s.length>2&&void 0!==s[2]&&s[2],t.prev=3,t.next=6,e().tabs.query({active:!0,currentWindow:!0});case 6:if(0!==(i=t.sent).length){t.next=9;break}return t.abrupt("return");case 9:if(ae()){t.next=11;break}return t.abrupt("return");case 11:return i[0].id,a=!1,t.next=15,e().storage.local.get(["selectElementState"]);case 15:if(c=t.sent,a=c.selectElementState,null===r&&(r=!a),!o&&r===a){t.next=25;break}return t.next=21,e().storage.local.set({selectElementState:r});case 21:return t.next=23,e().runtime.sendMessage({action:"activateSelectElementMode",data:r});case 23:u=t.sent,oe("Select Mode Updated:",u);case 25:n&&window.close(),t.next=31;break;case 28:t.prev=28,t.t0=t["catch"](3),oe("Error in Active_SelectElement:",t.t0);case 31:case"end":return t.stop()}}),t,null,[[3,28]])})),nc=function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ec(i,n,o,a,c,"next",t)}function c(t){ec(i,n,o,a,c,"throw",t)}a(void 0)}))},nc.apply(this,arguments)}function oc(t){return oc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oc(t)}function ic(){ic=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==oc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(oc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function ac(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function cc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){ac(i,n,o,a,c,"next",t)}function c(t){ac(i,n,o,a,c,"throw",t)}a(void 0)}))}}!function(){if(!Qa){var t=(Za||(Za=new Ka),Za);e=t,r=t.featureManager,Qa=new Fa(e,r)}var e,r}();function uc(){var t,r,n,o,i;null===(t=he.clearStorageBtn)||void 0===t||t.addEventListener("click",(function(){e().storage.local.remove("lastTranslation").then(cc(ic().mark((function t(){var e;return ic().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return he.sourceText.value="",he.translationResult.textContent="",de(he.sourceText),de(he.translationResult),he.sourceLanguageInput.value=ve,t.prev=5,t.next=8,Y();case 8:e=t.sent,he.targetLanguageInput.value=Le(e),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](5),he.targetLanguageInput.value=Le("en");case 15:return t.prev=15,pe(he.targetLanguageInput,he.clearTargetLanguage),t.finish(15);case 18:pe(he.sourceLanguageInput,he.clearSourceLanguage),he.sourceText.focus(),oe("[HeaderActions]: Translation history and fields cleared."),Fe();case 22:case"end":return t.stop()}}),t,null,[[5,12,15,18]])}))))["catch"]((function(t){oe("[HeaderActions]: Error removing last translation:",t)}))})),null===(r=he.translatePageLink)||void 0===r||r.addEventListener("click",(function(){oe("[HeaderActions]: Translate page icon clicked - using Google Translate tab.");var t=he.targetLanguageInput.value,r=ge(t);r&&r!==ve||(oe("[HeaderActions]: Invalid target language for page translation: '".concat(t,"'. Defaulting to 'en'.")),r="en"),e().tabs.query({active:!0,currentWindow:!0}).then((function(t){var n;if(t.length>0&&null!==(n=t[0])&&void 0!==n&&n.url){var o=t[0].url;if(!o.startsWith("http"))return oe("[HeaderActions]: Cannot translate non-HTTP(S) URL: ".concat(o)),void window.close();var i=encodeURIComponent(o),a="https://translate.google.com/translate?sl=auto&tl=".concat(r,"&u=").concat(i);oe("[HeaderActions]: Opening Google Translate for page: ".concat(a)),e().tabs.create({url:a}),window.close()}else oe("[HeaderActions]: No active tab found or URL is missing."),window.close()}))["catch"]((function(t){oe("[HeaderActions]: Error querying active tab:",t),window.close()}))})),null===(n=he.settingsIcon)||void 0===n||n.addEventListener("click",(function(){oe("[Popup]: Opening options page."),ce(),window.close()})),null===(o=he.selectElementIcon)||void 0===o||o.addEventListener("click",(function(){oe("[HeaderActions]: Select element icon clicked."),rc(!0,!0)})),null===(i=he.revertIcon)||void 0===i||i.addEventListener("click",(function(){e().runtime.sendMessage({action:"revertTranslation"})["catch"]((function(t){oe("[Popup-Header] Could not send revert message:",t)})),window.close()})),oe("[HeaderActions]: Initialized.")}function sc(t){return sc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sc(t)}function lc(){lc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==sc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(sc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function fc(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function hc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){fc(i,n,o,a,c,"next",t)}function c(t){fc(i,n,o,a,c,"throw",t)}a(void 0)}))}}function pc(){return dc.apply(this,arguments)}function dc(){return dc=hc(lc().mark((function t(){var r,n=arguments;return lc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return r=!(n.length>0&&void 0!==n[0])||n[0],t.abrupt("return",new Promise(function(){var t=hc(lc().mark((function t(n){var o,i,a;return lc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e().storage.local.get(["lastTranslation"]);case 3:if(o=t.sent,i="",o.lastTranslation?(oe("[InitManager]: Loading last translation from storage."),he.sourceText.value=o.lastTranslation.sourceText||"",nt(he.sourceText,o.lastTranslation.sourceText),he.translationResult.innerHTML=rn.parse(o.lastTranslation.translatedText||""),nt(he.translationResult,o.lastTranslation.translatedText),he.sourceLanguageInput.value=Le(o.lastTranslation.sourceLanguage)||ve,i=Le(o.lastTranslation.targetLanguage)):(oe("[InitManager]: No last translation found in storage."),he.sourceText.value="",he.translationResult.textContent="",he.sourceLanguageInput.value=ve),(!r||i)&&i!==ve){t.next=18;break}return t.prev=7,t.next=10,Y();case 10:a=t.sent,i=Le(a)||Le("en"),t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](7),oe("[InitManager]: Error getting default target language:",t.t0),i=Le("en");case 18:i&&(he.targetLanguageInput.value=i),pe(he.sourceLanguageInput,he.clearSourceLanguage),pe(he.targetLanguageInput,he.clearTargetLanguage),de(he.sourceText),de(he.translationResult),n(),t.next=30;break;case 26:t.prev=26,t.t1=t["catch"](0),oe("[InitManager]: Error loading last translation:",t.t1),n();case 30:case"end":return t.stop()}}),t,null,[[0,26],[7,14]])})));return function(e){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)}))),dc.apply(this,arguments)}function yc(){return vc.apply(this,arguments)}function vc(){return vc=hc(lc().mark((function t(){return lc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=hc(lc().mark((function t(r){var n,o,i,a;return lc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e().tabs.query({active:!0,currentWindow:!0});case 3:if(!((n=t.sent).length>0&&null!=n[0].id)){t.next=40;break}return o=n[0].id,t.prev=6,a={},t.prev=8,t.next=11,e().tabs.sendMessage(o,{action:"getSelectedText"});case 11:a=t.sent,t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](8),oe("[InitManager]: Failed to sendMessage to content script: ".concat(t.t0.message));case 17:if(null===(i=a)||void 0===i||!i.selectedText){t.next=28;break}oe("[InitManager]: Received selected text from content script."),he.sourceText.value=a.selectedText,he.translationResult.textContent="",he.sourceLanguageInput.value=ve,pe(he.sourceLanguageInput,he.clearSourceLanguage),pe(he.targetLanguageInput,he.clearTargetLanguage),de(he.sourceText),de(he.translationResult),t.next=31;break;case 28:return oe("[InitManager]: No selected text received. Loading from storage."),t.next=31,pc();case 31:t.next=38;break;case 33:return t.prev=33,t.t1=t["catch"](6),oe("[InitManager]: Error getting selected text (Tab ".concat(o,"): ").concat(t.t1.message,". Loading from storage.")),t.next=38,pc();case 38:t.next=43;break;case 40:return oe("[InitManager]: No active/valid tab. Loading from storage."),t.next=43,pc();case 43:r(),t.next=50;break;case 46:t.prev=46,t.t2=t["catch"](0),oe("[InitManager]: Error loading initial state:",t.t2),r();case 50:case"end":return t.stop()}}),t,null,[[0,46],[6,33],[8,14]])})));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)}))),vc.apply(this,arguments)}function gc(){return mc.apply(this,arguments)}function mc(){return(mc=hc(lc().mark((function t(){return lc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,yc();case 2:oe("[InitManager]: Initialized.");case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function bc(t){return bc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bc(t)}function wc(){wc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==bc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(bc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function xc(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Ec(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){xc(i,n,o,a,c,"next",t)}function c(t){xc(i,n,o,a,c,"throw",t)}a(void 0)}))}}var Lc=1e3,Tc=800,kc=!1,_c=null,Oc=null,Sc=null,Ac=!1;function Ic(){Oc&&(clearTimeout(Oc),Oc=null)}function Nc(){_c&&(clearTimeout(_c),_c=null)}function Pc(){Sc&&(clearTimeout(Sc),Sc=null)}function jc(){return Cc.apply(this,arguments)}function Cc(){return(Cc=Ec(wc().mark((function t(){var e,r;return wc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,$();case 2:return e=t.sent,t.next=5,X();case 5:if(r=t.sent,!e||!r){t.next=11;break}return setTimeout((function(){rc(!0,!1,!0)}),100),t.abrupt("return",!0);case 11:return t.abrupt("return",!1);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Rc(){return Gc.apply(this,arguments)}function Gc(){return(Gc=Ec(wc().mark((function t(){return wc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=3,jc();case 3:t.sent&&(e=void 0,r=void 0,n=void 0,null===(e=he.popupContainer)||void 0===e||e.addEventListener("mouseenter",(function(){kc=!0,Ic("mouseenter"),Pc(),Ac||(_c=setTimeout((function(){Ac=!0,rc(!1)}),Lc))})),null===(r=he.popupContainer)||void 0===r||r.addEventListener("mouseleave",(function(){kc=!1,Nc(),Ac||(Oc=setTimeout((function(){rc(!0,!0)}),Tc))})),null===(n=he.popupContainer)||void 0===n||n.addEventListener("mousedown",(function(){Ac||(Ac=!0,Nc(),Ic("mousedown"),Pc(),rc(!1))})),Sc=setTimeout((function(){kc||Ac||rc(!0,!0)}),Tc));case 6:case"end":return t.stop()}var e,r,n}),t)})))).apply(this,arguments)}function Fc(t){return Fc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fc(t)}function Mc(){Mc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==Fc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Fc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Dc(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function Uc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Dc(i,n,o,a,c,"next",t)}function c(t){Dc(i,n,o,a,c,"throw",t)}a(void 0)}))}}function Hc(t){try{return new URL(t).origin}catch(e){return oe("[excludeManager]: Invalid URL for origin extraction:",t),t}}function Bc(){return $c.apply(this,arguments)}function $c(){return $c=Uc(Mc().mark((function t(){var r,n,o,i,a,c,u,s,l;return Mc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(r=document.getElementById("excludeCurrentPageToggle")){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,e().tabs.query({active:!0,currentWindow:!0});case 6:n=t.sent,t.next=12;break;case 9:return t.prev=9,t.t0=t["catch"](3),t.abrupt("return");case 12:o=n[0],i=Hc(o.url);try{a=new URL(o.url).protocol}catch(t){a=null}if(c="http:"===a||"https:"===a,r.disabled=!c,c){t.next=25;break}return r.checked=!1,t.next=21,wt("popup_exclude_toggle_title");case 21:if(t.t1=t.sent,t.t1){t.next=24;break}t.t1="(فعال/غیرفعال در این صفحه)";case 24:r.title=t.t1;case 25:return t.next=27,e().storage.local.get("EXCLUDED_SITES");case 27:u=t.sent,s=u.EXCLUDED_SITES,l=void 0===s?[]:s,r.checked=c&&!l.includes(i),r.addEventListener("change",Uc(Mc().mark((function t(){var n,o,a;return Mc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(!r.disabled){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e().storage.local.get("EXCLUDED_SITES");case 4:return n=t.sent,o=n.EXCLUDED_SITES,a=(a=void 0===o?[]:o).filter((function(t){return t!==i})),r.checked||a.push(i),t.next=11,e().storage.local.set({EXCLUDED_SITES:a});case 11:oe("[excludeManager]: ".concat(i," ").concat(r.checked?"removed from":"added to"," exclude list"));case 12:case"end":return t.stop()}}),t)}))));case 32:case"end":return t.stop()}}),t,null,[[3,9]])}))),$c.apply(this,arguments)}function zc(t){return zc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zc(t)}function Yc(){Yc=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,a=Object.create(i.prototype),c=new I(n||[]);return o(a,"_invoke",{value:_(t,r,c)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",v={};function g(){}function m(){}function b(){}var w={};s(w,a,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(N([])));E&&E!==r&&n.call(E,a)&&(w=E);var L=b.prototype=g.prototype=Object.create(w);function T(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function k(t,e){function r(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==zc(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,c)}),(function(t){r("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return r("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function _(e,r,n){var o=h;return function(i,a){if(o===d)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=O(c,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=d;var s=f(e,r,n);if("normal"===s.type){if(o=n.done?y:p,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(o=y,n.method="throw",n.arg=s.arg)}}}function O(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,O(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function N(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(zc(e)+" is not iterable")}return m.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:m,configurable:!0}),m.displayName=s(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},T(k.prototype),s(k.prototype,c,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new k(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(L),s(L,u,"Generator"),s(L,a,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=N,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return c.type="throw",c.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;A(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function Xc(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function qc(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Xc(i,n,o,a,c,"next",t)}function c(t){Xc(i,n,o,a,c,"throw",t)}a(void 0)}))}}document.addEventListener("DOMContentLoaded",qc(Yc().mark((function t(){return Yc().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return oe("[Popup Main]: DOMContentLoaded event fired."),t.prev=1,t.next=4,Se();case 4:return t.next=6,De();case 6:return Ye(),vn(),uc(),t.next=11,gc();case 11:return t.next=13,Rc();case 13:return t.next=15,Bc();case 15:try{browser.runtime.connect({name:"popup"}).postMessage({action:"popupOpened"})}catch(t){oe("[Popup Main]: Failed to connect popup port:",t.message)}oe("[Popup Main]: All modules initialized successfully."),t.next=24;break;case 19:t.prev=19,t.t0=t["catch"](1),oe("[Popup Main]: Error during initialization:",t.t0),oe("Popup initialization failed:",t.t0),document.body.innerHTML='<div style="padding: 10px; color: red;">[AIWC] Failed to initialize extension popup. Please try reloading.</div>';case 24:return t.prev=24,Lt(l.APPLICATION_LOCALIZE),t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[1,19,24,27]])}))))})()})();