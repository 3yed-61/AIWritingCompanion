/*! For license information please see options.bundle.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return r};var n,r={},o=Object.prototype,i=o.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(n){f=function(t,e,n){return t[e]=n}}function d(t,e,n,r){var o=e&&e.prototype instanceof g?e:g,i=Object.create(o.prototype),c=new R(r||[]);return a(i,"_invoke",{value:L(t,n,c)}),i}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}r.wrap=d;var h="suspendedStart",y="suspendedYield",v="executing",m="completed",E={};function g(){}function _(){}function I(){}var T={};f(T,u,(function(){return this}));var O=Object.getPrototypeOf,A=O&&O(O(C([])));A&&A!==o&&i.call(A,u)&&(T=A);var b=I.prototype=g.prototype=Object.create(T);function w(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function N(e,n){function r(o,a,c,u){var s=p(e[o],e,a);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==t(f)&&i.call(f,"__await")?n.resolve(f.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):n.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var o;a(this,"_invoke",{value:function(t,e){function i(){return new n((function(n,o){r(t,e,n,o)}))}return o=o?o.then(i,i):i()}})}function L(t,e,r){var o=h;return function(i,a){if(o===v)throw Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:n,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var u=S(c,r);if(u){if(u===E)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===h)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var s=p(t,e,r);if("normal"===s.type){if(o=r.done?m:y,s.arg===E)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=m,r.method="throw",r.arg=s.arg)}}}function S(t,e){var r=e.method,o=t.iterator[r];if(o===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=n,S(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),E;var i=p(o,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,E;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,E):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,E)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return a.next=a}}throw new TypeError(t(e)+" is not iterable")}return _.prototype=I,a(b,"constructor",{value:I,configurable:!0}),a(I,"constructor",{value:_,configurable:!0}),_.displayName=f(I,l,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,I):(t.__proto__=I,f(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},r.awrap=function(t){return{__await:t}},w(N.prototype),f(N.prototype,s,(function(){return this})),r.AsyncIterator=N,r.async=function(t,e,n,o,i){void 0===i&&(i=Promise);var a=new N(d(t,e,n,o),i);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),f(b,l,"Generator"),f(b,u,(function(){return this})),f(b,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},r.values=C,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(x),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,o){return c.type="throw",c.arg=t,e.next=r,o&&(e.method="next",e.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),s=i.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,E):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),E},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),E}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:C(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=n),E}},r}function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(e,n,r){return(n=function(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function i(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function c(t){i(a,r,o,c,u,"next",t)}function u(t){i(a,r,o,c,u,"throw",t)}c(void 0)}))}}var c={INVALID_CONTEXT:"Extension context invalid. Please refresh the page to continue.",API_KEY_MISSING:"API Key is missing",API_KEY_WRONG:"API Key is wrong",API_KEY_FORBIDDEN:"API Key is forbidden",API_URL_MISSING:"API URL is missing",AI_MODEL_MISSING:"AI Model is missing",SERVICE_OVERLOADED:"Translation service overloaded, Try later",NETWORK_FAILURE:"Connection to server failed",INVALID_RESPONSE:"Invalid API response format",CONTEXT_LOST:"Extension context lost"},u={USE_MOCK:!1,DEBUG_MODE:!1,SOURCE_LANGUAGE:"English",TARGET_LANGUAGE:"Persian",TRANSLATION_API:"gemini",API_URL:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",API_KEY:"",WEBAI_API_URL:"http://localhost:6969/translate",WEBAI_API_MODEL:"gemini-2.0-flash",OPENAI_API_KEY:"",OPENAI_API_URL:"https://api.openai.com/v1/chat/completions",OPENAI_API_MODEL:"gpt-3.5-turbo",OPENROUTER_API_KEY:"",OPENROUTER_API_URL:"https://openrouter.ai/api/v1/chat/completions",OPENROUTER_API_MODEL:"openai/gpt-3.5-turbo",TRANSLATE_ON_TEXT_FIELDS:!0,ENABLE_SHORTCUT_FOR_TEXT_FIELDS:!0,TRANSLATE_WITH_SELECT_ELEMENT:!0,TRANSLATE_ON_TEXT_SELECTION:!0,REQUIRE_CTRL_FOR_TEXT_SELECTION:!1,ENABLE_DICTIONARY:!0,HIGHTLIH_NEW_ELEMETN_RED:"2px solid red",TRANSLATION_ICON_TITLE:"Translate Text",HIGHLIGHT_STYLE:"2px solid red",ICON_TRANSLATION:"🌐",ICON_SECCESS:"✅ ",ICON_WARNING:"⚠️ ",ICON_STATUS:"⏳ ",ICON_ERROR:"❌ ",ICON_INFO:"🔵 ",ICON_REVERT:"",NOTIFICATION_ALIGNMENT:"right",NOTIFICATION_TEXT_DIRECTION:"rtl",NOTIFICATION_TEXT_ALIGNMENT:"right",RTL_REGEX:/[\u0600-\u06FF]/,PERSIAN_REGEX:/^(?=.*[\u0600-\u06FF])[\u0600-\u06FF\u0660-\u0669\u06F0-\u06F9\u0041-\u005A\u0061-\u007A\u0030-\u0039\s.,:;؟!()«»@#\n\t\u200C]+$/,PROMPT_BASE_FIELD:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n  - If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n  - If the input is in any other language, translate it to $_{TARGET}.\n  - If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_BASE_SELECT:'Act as an automated JSON translation service. The input is a JSON array where each object contains a "text" property.\n\n  1. Translate each "text" value according to the given rules: $_{USER_RULES}\n  2. Preserve all input elements. **Do not omit, modify, or skip any entry.**\n  3. If translation is not needed for a specific item (e.g., numbers, hashtags, URLs), **return the original value unchanged.**\n  4. Maintain the internal structure, formatting, and line breaks exactly.\n  5. Output **only** the translated JSON array, with no extra text, explanations, or markdown.\n\n  ```json input\n  $_{TEXT}\n  ```\n    ',PROMPT_BASE_DICTIONARY:'You are a $_{TARGET} dictionary service. Your task is to provide in detailed dictionary definitions while strictly preserving the input structure and formatting. Follow these rules:\n\n  - Provide the translation of the input word or phrase.\n  - Include synonyms, word type (noun, verb, adjective, etc.), and a brief definition.\n  - If applicable, provide example sentences using the word or phrase in context.\n  - If the input is ambiguous, return the most common meanings.\n  - If no definition is found, return "No definition available."\n\n  Return in $_{TARGET} language, and **ONLY** the dictionary entry without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ',PROMPT_BASE_POPUP_TRANSLATE:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in any language, translate it to $_{TARGET}.\n\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_TEMPLATE:"- If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n- If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n- If the input is in any other language, translate it to $_{TARGET}.\n- If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.",DEBUG_TRANSLATED_ENGLISH:"This is a mock translation to English.",DEBUG_TRANSLATED_PERSIAN:"این یک ترجمه آزمایشی به فارسی است.",DEBUG_TRANSLATED_ENGLISH_With_NewLine:"This is a mock \ntranslation to English with \nnew lines.",DEBUG_TRANSLATED_PERSIAN_With_NewLine:"این یک ترجمه آزمایشی \nبرای ترجمه به فارسی \nبا خطوط جدید است."},s=(new Map,null),l=function(){var t=a(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===s){t.next=2;break}return t.abrupt("return",s);case 2:return t.abrupt("return",new Promise((function(t){try{chrome&&chrome.storage&&chrome.storage.local?chrome.storage.local.get(null,(function(e){chrome.runtime.lastError?(console.error("Error fetching settings:",chrome.runtime.lastError),s=r({},u),t(s)):(s=r(r({},u),e),t(s))})):(console.warn("chrome.storage.local not available, using default CONFIG."),s=r({},u),t(s))}catch(e){console.error("Error accessing storage:",e),s=r({},u),t(s)}})));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();chrome&&chrome.storage&&chrome.storage.onChanged?chrome.storage.onChanged.addListener((function(t,e){if("local"===e&&s){Object.keys(t).forEach((function(e){if(u.hasOwnProperty(e)||s&&s.hasOwnProperty(e)){var n=t[e].newValue;s[e]!==n&&(s[e]=n,!0)}}))}})):console.warn("chrome.storage.onChanged not available. Settings cache might become stale.");var f=function(){var t=a(e().mark((function t(n,r){var o,i;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l();case 2:return i=t.sent,t.abrupt("return",null!==(o=null==i?void 0:i[n])&&void 0!==o?o:r);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),d=function(){var t=a(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",f("DEBUG_MODE",u.DEBUG_MODE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),p=function(){var t=a(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!s||void 0===s.DEBUG_MODE){t.next=2;break}return t.abrupt("return",s.DEBUG_MODE);case 2:return t.abrupt("return",d());case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();var h,y=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];p().then((function(t){var n;t&&(n=console).debug.apply(n,e)}))},v=function(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("html/options.html"))};h=null;function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,g(r.key),r)}}function g(t){var e=function(t,e){if("object"!=m(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==m(e)?e:e+""}var _=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.typeMapping={error:{title:"خطا - ترجمه خودکار",icon:u.ICON_ERROR,priority:2,duration:5e3,className:"AIWritingCompanion-notification-error"},warning:{title:"هشدار - ترجمه خودکار",icon:u.ICON_WARNING,priority:1,duration:4e3,className:"AIWritingCompanion-notification-warning"},success:{title:"موفقیت - ترجمه خودکار",icon:u.ICON_SUCCESS,priority:0,duration:3e3,className:"AIWritingCompanion-notification-success"},info:{title:"اطلاعات - ترجمه خودکار",icon:u.ICON_INFO,priority:0,duration:3e3,className:"AIWritingCompanion-notification-info"},status:{title:"وضعیت - ترجمه خودکار",icon:u.ICON_INFO,priority:0,duration:2e3,className:"AIWritingCompanion-notification-status"},revert:{title:"بازگشت - ترجمه خودکار",icon:u.ICON_REVERT,priority:0,duration:600,className:"AIWritingCompanion-notification-revert"}},"undefined"!=typeof document?this.container=this.createContainer():this.container=null},e=[{key:"createContainer",value:function(){var t="AIWritingCompanion-translation-notifications",e=document.getElementById(t);return e||((e=document.createElement("div")).id=t,Object.assign(e.style,{position:"fixed",top:"20px",zIndex:"10000000000",display:"flex",flexDirection:"column",gap:"8px"}),"right"===u.NOTIFICATION_ALIGNMENT?e.style.right="20px":e.style.left="20px",document.body.appendChild(e)),u.TEXT_DIRECTION&&e.style.setProperty("--text-direction",u.TEXT_DIRECTION),u.TEXT_ALIGNMENT&&e.style.setProperty("--text-alignment",u.TEXT_ALIGNMENT),e}},{key:"showBackgroundNotification",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=arguments.length>2?arguments[2]:void 0,r=this.typeMapping[e]||this.typeMapping.info;chrome.notifications.create({type:"basic",iconUrl:"icons/512.png",title:r.title,message:t,priority:r.priority},(function(t){if(n){var e=function(r){r===t&&(n(),chrome.notifications.clear(t),chrome.notifications.onClicked.removeListener(e))};chrome.notifications.onClicked.addListener(e)}}))}},{key:"show",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4?arguments[4]:void 0;if(!this.container)return this.showBackgroundNotification(t,n,i);var a=this.typeMapping[n]||this.typeMapping.info,c=o||a.duration,s=a.icon||u["ICON_".concat(n.toUpperCase())],l=document.createElement("div");l.className="AIWritingCompanion-translation-notification ".concat(a.className||"");var f="";s&&(f='<span class="AIWritingCompanion-notification-icon">'.concat(s,"</span>")),l.innerHTML="\n      ".concat(f,'\n      <span class="AIWritingCompanion-notification-text">').concat(t,"</span>\n    ");var d=null,p=function(){if(y("Notification clicked: Type=".concat(n,", Message=").concat(t)),"function"==typeof i)try{i()}catch(t){y("NotificationManager: Error executing notification onClick handler:",t)}e.dismiss(l),d&&(clearTimeout(d),d=null),l.removeEventListener("click",p)};return l.addEventListener("click",p),this.container.appendChild(l),r&&"status"!==n&&(d=setTimeout((function(){l.parentNode===e.container&&e.dismiss(l),l.removeEventListener("click",p),d=null}),c)),l}},{key:"dismiss",value:function(t){!function(t){try{t.style.transition="opacity 0.5s",t.style.opacity="0",setTimeout((function(){return t.remove()}),500)}catch(e){throw errorHandler.handle(e,{type:R.UI,context:"helpers-fadeOut",element:null==t?void 0:t.tagName})}}(t)}}],e&&E(t.prototype,e),n&&E(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function T(){T=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new R(r||[]);return o(a,"_invoke",{value:L(t,n,c)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",p="suspendedYield",h="executing",y="completed",v={};function m(){}function E(){}function g(){}var _={};s(_,a,(function(){return this}));var O=Object.getPrototypeOf,A=O&&O(O(C([])));A&&A!==n&&r.call(A,a)&&(_=A);var b=g.prototype=m.prototype=Object.create(_);function w(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function N(t,e){function n(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==I(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function L(e,n,r){var o=d;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var u=S(c,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var s=f(e,n,r);if("normal"===s.type){if(o=r.done?y:p,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=y,r.method="throw",r.arg=s.arg)}}}function S(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var i=f(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function x(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function C(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(I(e)+" is not iterable")}return E.prototype=g,o(b,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:E,configurable:!0}),E.displayName=s(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},w(N.prototype),s(N.prototype,c,(function(){return this})),e.AsyncIterator=N,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new N(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),s(b,u,"Generator"),s(b,a,(function(){return this})),s(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=C,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),x(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;x(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:C(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function O(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?O(Object(n),!0).forEach((function(e){P(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function b(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function w(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){b(i,r,o,a,c,"next",t)}function c(t){b(i,r,o,a,c,"throw",t)}a(void 0)}))}}function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,x(r.key),r)}}function L(t,e,n){return e&&N(t.prototype,e),n&&N(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function S(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function P(t,e,n){return(e=x(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function x(t){var e=function(t,e){if("object"!=I(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==I(e)?e:e+""}var R=L((function t(){S(this,t)}));P(R,"API","API"),P(R,"NETWORK","NETWORK"),P(R,"SERVICE","SERVICE"),P(R,"VALIDATIONMODEL","VALIDATIONMODEL"),P(R,"CONTEXT","CONTEXT"),P(R,"UI","UI"),P(R,"INTEGRATION","INTEGRATION"),P(R,"PARSE_SELECT_ELEMENT","PARSING_RESPONSE"),P(R,"PARSE_INPUT","PARSING_EXTRACT_FIELD");var C=function(){return L((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _;S(this,t),this.notifier=e,this.displayedErrors=new Set,this.isHandling=!1,this.suppressed_Errors=new Set(["invalid-protocol","invalid-tab","text-direction-error","promise-rejection-in-translateText","promise-error-in-translateText","parsing-response-error","context-invalid"]),this.suppressed_ErrorsConsole=new Set(["invalid-protocol","invalid-tab","icon-position-error","icon-creation-error","text-direction-error","promise-rejection-in-translateText","promise-error-in-translateText","context-invalid"])}),[{key:"handle",value:(e=w(T().mark((function t(e){var n,r,o,i,a,c,s,l=arguments;return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},"function"!=typeof e.then){t.next=5;break}return t.next=4,e;case 4:e=t.sent;case 5:if(!this.isHandling){t.next=8;break}return console.debug("[ErrorService] Ignoring duplicate error:",e),t.abrupt("return",e);case 8:return this.isHandling=!0,this.displayedErrors.add(e.message),t.prev=10,r=e instanceof Error?e:new Error(String(e)),(o=A(A(A({},r.meta||{}),n),{},{type:n.type||r.type||R.SERVICE,statusCode:r.statusCode||n.statusCode||500})).type=this._reviewErrorType(r,o.type,o),i=this._getErrorMessage(r,o.type,o.statusCode,o),a=i.message,c=i.code,t.next=17,d().catch((function(){return u.DEBUG_MODE}));case 17:return s=t.sent,this._logError(r,o,c,s),this._notifyUser(a,o.type,c),o.type!==R.CONTEXT||this.reloadScheduled||this._contextInvalidated(),r._isHandled=!0,t.abrupt("return",r);case 25:return t.prev=25,t.t0=t.catch(10),console.error("[ErrorService] Critical Unknown Error:",t.t0),t.abrupt("return",t.t0);case 29:return t.prev=29,this.isHandling=!1,t.finish(29);case 32:case"end":return t.stop()}}),t,this,[[10,25,29,32]])}))),function(t){return e.apply(this,arguments)})},{key:"_contextInvalidated",value:function(){this.reloadScheduled=!0,chrome.runtime&&chrome.runtime.sendMessage?setTimeout((function(){try{chrome.runtime.sendMessage({action:"restart_content_script"})}catch(e){var t;null!==(t=e.message)&&void 0!==t&&t.includes("context invalidated")||console.error("[ErrorService] Cannot send restart message.")}}),2e3):console.warn("[ErrorService] Extension context invalid, cannot send restart message.")}},{key:"_reviewErrorType",value:function(t,e,n){var r=e;return console.debug("[ErrorService] Reviewing error type:",t.message),(t.message.includes("API key")||t.message.includes("API_KEY")||t.message===c.MISSING_API_KEY)&&(r=R.API),(t.message.includes("context invalidated")||t.message.includes("Extension context invalid"))&&(r=R.CONTEXT,t.code="context-invalidated"),t.message.includes("reading 'handle'")&&"ctrl-slash"===n.context&&(r=R.INTEGRATION),t.message.includes("Failed to fetch")&&(r=R.NETWORK),r}},{key:"_getErrorMessage",value:function(t,e,n,r){if(console.debug("[ErrorService] getErrorMessage => ",t),r.suppressSystemError)return{code:"suppressed-error",message:""};if(r.suppressSecondary)return{code:"suppressed",message:""};var o=P(P(P(P(P(P(P(P({},R.API,{400:{code:"api-key-wrong",message:"400: ".concat(c.API_KEY_WRONG)},601:{code:"api-key-missing",message:"401: ".concat(c.API_KEY_MISSING)},403:{code:"api-forbidden",message:"403: ".concat(c.API_KEY_FORBIDDEN)},604:{code:"api-url-missing",message:"604: ".concat(c.API_URL_MISSING)},605:{code:"api-model-missing",message:"605: ".concat(c.API_URL_MISSING)},429:{code:"service-overloaded",message:"429: ".concat(c.SERVICE_OVERLOADED)},500:{code:"internal-server-error",message:"500: خطای داخلی سرور"},600:{code:"internal-server-error",message:"600: خطای سرور API"},default:{code:"api-error",message:"خطای سرویس API"}}),R.NETWORK,{default:{code:"network-failure",message:c.NETWORK_FAILURE}}),R.SERVICE,{503:{code:"service-unavailable",message:"سرویس موقتاً در دسترس نیست"},default:{code:"translation-service-error",message:"خطای سرویس ترجمه"}}),R.CONTEXT,{default:{code:"context-lost",message:"لطفا صفحه را رفرش کنید."}}),R.UI,{"text-direction-error":{code:"text-direction-error",message:"خطا در تنظیم جهت متن"},default:{code:"system-error",message:"خطای سیستمی رخ داده است"}}),R.VALIDATIONMODEL,{default:{code:"model-validation-error",message:"خطا در مدلِ انتخاب شده"}}),R.PARSE_SELECT_ELEMENT,{default:{code:"parsing-response-error",message:"خطا در پردازش پاسخ"}}),R.INTEGRATION,{"ctrl-slash":{code:"shortcut-connection-error",message:"⚠️ خطا در اتصال شورتکات به صفحه"},"invalid-tab":{code:"invalid-tab",message:"⚠️ تب جاری معتبر نیست"},"invalid-protocol":{code:"invalid-protocol",message:"❌ این قابلیت فقط در آدرس‌های وب معمولی (http/https) کار می‌کند"},"content-injection-error":{code:"content-injection-error",message:"⚠️ خطا در تزریق کد به صفحه"},"api-unavailable":{code:"api-unavailable",message:"امکانات ضروری افزونه در دسترس نیستند. لطفا مرورگر را آپدیت کنید."},default:{code:"integration-error",message:"⚠️ خطا در اتصال به این صفحه"}}),i=r.statusCode||n;if(e===R.API)return o[R.API][i]||o[R.API].default;var a={code:"unknown-error",message:"خطای ناشناخته رخ داده است"};if(e&&o[e]){var u=o[e];if(n&&u[n])a=u[n];else if(e===R.INTEGRATION){var s=Object.keys(u).find((function(e){return t.message.includes(e)||r.context===e}));a=s?u[s]:u.default}else a=u.default||a}return a}},{key:"_logError",value:function(t,e,n,r){if(!this.suppressed_ErrorsConsole.has(n)&&e.type!==R.CONTEXT){var o={name:t.name,message:t.message,type:e.type,statusCode:e.statusCode,context:e.context,stack:t.stack};r?(console.error("[ErrorService] ".concat(o.name,": ").concat(o.message,"\nType: ").concat(o.type,"\nStatus: ").concat(o.statusCode,"\nContext: ").concat(o.context)),t.stack&&console.error("[ErrorService] Stack Trace:",t.stack)):(console.error("[ErrorHandler] ".concat(o.name,": ").concat(o.message,"\nType: ").concat(o.type,"\nStatus: ").concat(o.statusCode,"\nContext: ").concat(o.context)),t.stack&&console.error("[ErrorService] Stack Trace:",t.stack))}}},{key:"_notifyUser",value:function(t,e,n){var r=this;if("suppressed"!==n&&"suppressed-error"!==n&&!this.suppressed_Errors.has(n)&&!this.displayedErrors.has(t)){var o=this._getNotificationType(e),i=new Set(["api-key-wrong","api-key-missing","api-url-missing"]);e===R.API&&i.has(n)?this.notifier.show(t,o,!0,5e3,v):this.notifier.show(t,o,!0,5e3),this.displayedErrors.add(t),setTimeout((function(){return r.displayedErrors.delete(t)}),5e3)}}},{key:"_getNotificationType",value:function(t){return P(P(P(P(P(P(P({},R.UI,"error"),R.API,"error"),R.NETWORK,"warning"),R.SERVICE,"error"),R.CONTEXT,"warning"),R.VALIDATIONMODEL,"warning"),R.INTEGRATION,"warning")[t]||"error"}}],[{key:"processError",value:(t=w(T().mark((function t(e){return T().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"!=typeof e.then){t.next=4;break}return t.next=3,e;case 3:e=t.sent;case 4:return t.abrupt("return",e);case 5:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]);var t,e}();function k(t){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k(t)}function G(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,a,c=[],u=!0,s=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return U(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function M(){M=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),c=new P(r||[]);return o(a,"_invoke",{value:w(t,n,c)}),a}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",p="suspendedYield",h="executing",y="completed",v={};function m(){}function E(){}function g(){}var _={};s(_,a,(function(){return this}));var I=Object.getPrototypeOf,T=I&&I(I(x([])));T&&T!==n&&r.call(T,a)&&(_=T);var O=g.prototype=m.prototype=Object.create(_);function A(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function n(o,i,a,c){var u=f(t[o],t,i);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==k(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(l).then((function(t){s.value=t,a(s)}),(function(t){return n("throw",t,a,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return i=i?i.then(o,o):o()}})}function w(e,n,r){var o=d;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var u=N(c,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=h;var s=f(e,n,r);if("normal"===s.type){if(o=r.done?y:p,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=y,r.method="throw",r.arg=s.arg)}}}function N(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,N(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var i=f(o,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function P(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function x(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}throw new TypeError(k(e)+" is not iterable")}return E.prototype=g,o(O,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:E,configurable:!0}),E.displayName=s(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===E||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},A(b.prototype),s(b.prototype,c,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new b(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},A(O),s(O,u,"Generator"),s(O,a,(function(){return this})),s(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=x,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],c=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),s=r.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;S(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:x(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function j(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function D(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){j(i,r,o,a,c,"next",t)}function c(t){j(i,r,o,a,c,"throw",t)}a(void 0)}))}}document.addEventListener("DOMContentLoaded",(function(){var t,e,n=document.querySelectorAll(".tab-button"),r=document.querySelectorAll(".tab-content"),o=new C,i=(document.querySelector('[data-tab="languages"]'),document.querySelector('[data-tab="apiSettings"]'),document.querySelector('[data-tab="importExport"]'),document.getElementById("languages"),document.getElementById("apiSettings"),document.getElementById("importExport"),document.getElementById("translateOnTextFields")),a=document.getElementById("enableShortcutForTextFields"),c=(document.getElementById("textFieldShortcutGroup"),document.getElementById("translateWithSelectElement")),s=document.getElementById("translateOnTextSelection"),f=document.getElementById("requireCtrlForTextSelection"),d=document.getElementById("textSelectionCtrlGroup"),p=document.getElementById("enableDictionrary"),h=document.getElementById("translationApi"),y=document.getElementById("webAIApiSettings"),v=(null===(t=document.getElementById("apiKey"))||void 0===t||t.closest(".setting-group"),null===(e=document.getElementById("apiUrl"))||void 0===e?void 0:e.closest(".setting-group")),m=document.getElementById("useMock"),E=document.getElementById("debugMode"),g=document.getElementById("webAIApiUrl"),_=document.getElementById("webAIApiModel"),I=document.getElementById("apiKey"),T=document.getElementById("apiUrl"),O=document.getElementById("saveSettings"),A=document.getElementById("sourceLanguage"),b=document.getElementById("targetLanguage"),w=document.getElementById("geminiApiSettings"),N=document.getElementById("openAIApiSettings"),L=document.getElementById("openaiApiKey"),S=document.getElementById("openaiApiModel"),P=document.getElementById("openRouterApiSettings"),x=document.getElementById("openrouterApiKey"),k=document.getElementById("openrouterApiModel"),U=document.getElementById("exportSettings"),j=document.getElementById("importFile"),B=(document.getElementById("importSettings"),document.getElementById("status")),F=document.getElementById("MANIFEST_NAME"),K=document.getElementById("MANIFEST_DESCRIPTION"),Y=document.getElementById("MANIFEST_TITLE_OPTION_PAGE"),W=document.getElementById("promptTemplate"),X=document.getElementById("sourceLangName"),$=document.getElementById("targetLangName");function H(){if(s&&f&&d){var t=s.checked;f.disabled=!t,d.style.opacity=t?"1":"0.6",d.style.pointerEvents=t?"auto":"none",t||(f.checked=!1)}}function V(t){n.forEach((function(t){return t.classList.remove("active")})),r.forEach((function(t){return t.classList.remove("active")})),document.getElementById(t).classList.add("active"),document.querySelector('[data-tab="'.concat(t,'"]')).classList.add("active")}function q(t){return J.apply(this,arguments)}function J(){return(J=D(M().mark((function t(e){var n;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{h.disabled=e,A.disabled=e,b.disabled=e,[g,_,I,T,L,S,x,k].forEach((function(t){t&&(t.disabled=e)})),n={webai:y,gemini:w,openai:N,openrouter:P},Object.entries(n).forEach((function(t){var n=G(t,2),r=n[0],o=n[1];o&&(o.style.display=e||h.value!==r?"none":"block")}))}catch(t){o.handle(t,{type:R.UI,context:"updateMockState-options"})}case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Q(){var t=h.value,e="gemini"===t,n="webai"===t,r="openai"===t,o="openrouter"===t;y&&(y.style.display=n?"block":"none"),w&&(w.style.display=e?"block":"none"),N&&(N.style.display=r?"block":"none"),P&&(P.style.display=o?"block":"none"),v&&(v.style.display=e?"block":"none")}function z(){return Z.apply(this,arguments)}function Z(){return(Z=D(M().mark((function t(){var e,n,r;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l();case 2:e=t.sent,n=e.SOURCE_LANGUAGE||"English",r=e.TARGET_LANGUAGE||"Persian",X&&(X.textContent="(".concat(n,")")),$&&($.textContent="(".concat(r,")"));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function tt(){return tt=D(M().mark((function t(){var e,n,r,d,y,v,O,w,N,P,C,G,U,j;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,l();case 3:return r=t.sent,E&&(E.checked=null!==(d=r.DEBUG_MODE)&&void 0!==d?d:u.DEBUG_MODE),m&&(m.checked=null!==(y=r.USE_MOCK)&&void 0!==y?y:u.USE_MOCK),i&&(i.checked=null===(v=r.TRANSLATE_ON_TEXT_FIELDS)||void 0===v||v),a&&(a.checked=null===(O=r.ENABLE_SHORTCUT_FOR_TEXT_FIELDS)||void 0===O||O),c&&(c.checked=null===(w=r.TRANSLATE_WITH_SELECT_ELEMENT)||void 0===w||w),s&&(s.checked=null===(N=r.TRANSLATE_ON_TEXT_SELECTION)||void 0===N||N),f&&(f.checked=null!==(P=r.REQUIRE_CTRL_FOR_TEXT_SELECTION)&&void 0!==P&&P),p&&(p.checked=null===(C=r.ENABLE_DICTIONARY)||void 0===C||C),r.TRANSLATION_API||"gemini",q(G=null!==(e=null!==(n=r.USE_MOCK)&&void 0!==n?n:u.USE_MOCK)&&void 0!==e&&e),I&&(I.value=r.API_KEY||""),T&&(T.value=r.API_URL||u.API_URL),A&&(A.value=r.SOURCE_LANGUAGE||"English"),b&&(b.value=r.TARGET_LANGUAGE||"Persian"),W&&(W.value=r.PROMPT_TEMPLATE||u.PROMPT_TEMPLATE),h&&(h.value=r.TRANSLATION_API||"gemini"),g&&(g.value=r.WEBAI_API_URL||u.WEBAI_API_URL),_&&(_.value=r.WEBAI_API_MODEL||u.WEBAI_API_MODEL),L&&(L.value=r.OPENAI_API_KEY||u.OPENAI_API_KEY),S&&(S.value=r.OPENAI_API_MODEL||u.OPENAI_API_MODEL),x&&(x.value=r.OPENROUTER_API_KEY||u.OPENROUTER_API_KEY),k&&(k.value=r.OPENROUTER_API_MODEL||u.OPENROUTER_API_MODEL),U=chrome.runtime.getManifest(),F&&(F.textContent="".concat(U.name," v").concat(U.version)),K&&(K.textContent=U.description),Y&&(Y.textContent="".concat(U.name," - Settings")),H(),G||(j=r.TRANSLATION_API||"gemini",h&&(h.value=j),Q()),t.next=35,z();case 35:t.next=40;break;case 37:t.prev=37,t.t0=t.catch(0),o.handle(t.t0,{type:R.UI,context:"loadSettings",details:{component:"options-page",action:"initialize-settings"}});case 40:case"end":return t.stop()}}),t,null,[[0,37]])}))),tt.apply(this,arguments)}function et(t,e){B&&(B.textContent=t,B.className="status-".concat(e))}s&&s.addEventListener("change",H),n.forEach((function(t){t.addEventListener("click",(function(t){V(t.target.getAttribute("data-tab"))}))})),Q(),h.addEventListener("change",Q),m.addEventListener("change",(function(){q(m.checked)})),function(){tt.apply(this,arguments)}(),O.addEventListener("click",D(M().mark((function t(){var e,n,r,l,d,y,v,O,w,N,P,C,G,U,j,D,B,F,K,Y,X,$,H,V,q,J,Q,Z,tt,nt,rt,ot,it,at,ct,ut;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return D=null==g||null===(e=g.value)||void 0===e?void 0:e.trim(),B=null==_||null===(n=_.value)||void 0===n?void 0:n.trim(),F=null==I||null===(r=I.value)||void 0===r?void 0:r.trim(),K=null==m?void 0:m.checked,Y=null==E?void 0:E.checked,X=null==T||null===(l=T.value)||void 0===l?void 0:l.trim(),$=null==A?void 0:A.value,H=null==b?void 0:b.value,V=null==W||null===(d=W.value)||void 0===d?void 0:d.trim(),q=h.value,J=null==L||null===(y=L.value)||void 0===y?void 0:y.trim(),Q=null==S||null===(v=S.value)||void 0===v?void 0:v.trim(),Z=null==x||null===(O=x.value)||void 0===O?void 0:O.trim(),tt=null==k||null===(w=k.value)||void 0===w?void 0:w.trim(),nt=null!==(N=null==p?void 0:p.checked)&&void 0!==N?N:u.ENABLE_DICTIONARY,rt=null===(P=null==i?void 0:i.checked)||void 0===P||P,ot=null===(C=null==a?void 0:a.checked)||void 0===C||C,it=null===(G=null==c?void 0:c.checked)||void 0===G||G,at=null===(U=null==s?void 0:s.checked)||void 0===U||U,ct=null!==(j=null==f?void 0:f.checked)&&void 0!==j&&j,t.prev=20,ut={API_KEY:F||"",USE_MOCK:K,DEBUG_MODE:null!=Y?Y:u.DEBUG_MODE,API_URL:X||u.API_URL,SOURCE_LANGUAGE:$||"English",TARGET_LANGUAGE:H||"Persian",PROMPT_TEMPLATE:V||u.PROMPT_TEMPLATE,TRANSLATION_API:q||"gemini",WEBAI_API_URL:D||u.WEBAI_API_URL,WEBAI_API_MODEL:B||u.WEBAI_API_MODEL,OPENAI_API_KEY:J||u.OPENAI_API_KEY,OPENAI_API_MODEL:Q||u.OPENAI_API_MODEL,OPENROUTER_API_KEY:Z||u.OPENROUTER_API_KEY,OPENROUTER_API_MODEL:tt||u.OPENROUTER_API_MODEL,TRANSLATE_ON_TEXT_FIELDS:rt,ENABLE_DICTIONARY:nt,ENABLE_SHORTCUT_FOR_TEXT_FIELDS:ot,TRANSLATE_WITH_SELECT_ELEMENT:it,TRANSLATE_ON_TEXT_SELECTION:at,REQUIRE_CTRL_FOR_TEXT_SELECTION:ct},t.next=24,new Promise((function(t,e){chrome.storage.local.set(ut,(function(){chrome.runtime.lastError?e(chrome.runtime.lastError):t()}))}));case 24:return t.next=26,z();case 26:et("ذخیره شد!","success"),setTimeout((function(){return et("","")}),2e3),t.next=33;break;case 30:t.prev=30,t.t0=t.catch(20),o.handle(t.t0,{type:R.UI,context:"saveSettings"});case 33:case"end":return t.stop()}}),t,null,[[20,30]])})))),U.addEventListener("click",D(M().mark((function t(){var e,n,r,i;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,l();case 3:e=t.sent,n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),r=URL.createObjectURL(n),(i=document.createElement("a")).href=r,i.download="AI_Writing_Companion_Settings.json",document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),URL.revokeObjectURL(r)}),100),et("تنظیمات با موفقیت صادر شدند!","success"),setTimeout((function(){return et("","")}),2e3),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),o.handle(t.t0,{type:R.UI,context:"exportSettings"});case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))),j.addEventListener("change",function(){var t=D(M().mark((function t(e){var n,r;return M().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.target.files[0]){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,new Promise((function(t,e){var r=new FileReader;r.onload=function(e){return t(JSON.parse(e.target.result))},r.onerror=function(t){return e(r.error)},r.readAsText(n)}));case 6:return r=t.sent,t.next=9,new Promise((function(t,e){chrome.storage.local.set(r,(function(){chrome.runtime.lastError?e(chrome.runtime.lastError):t()}))}));case 9:et("تنظیمات وارد شدند! در حال بارگذاری مجدد...","success"),setTimeout((function(){return window.location.reload()}),1500),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(0),o.handle(t.t0,{type:R.UI,context:"importSettings"}),j.value="";case 17:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(e){return t.apply(this,arguments)}}()),V("languages")}))})();