/*! For license information please see popup.bundle.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return r};var n,r={},o=Object.prototype,a=o.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function p(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{p({},"")}catch(n){p=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var o=e&&e.prototype instanceof E?e:E,a=Object.create(o.prototype),c=new k(r||[]);return i(a,"_invoke",{value:I(t,n,c)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}r.wrap=f;var m="suspendedStart",d="suspendedYield",v="executing",g="completed",y={};function E(){}function b(){}function w(){}var T={};p(T,u,(function(){return this}));var L=Object.getPrototypeOf,N=L&&L(L(R([])));N&&N!==o&&a.call(N,u)&&(T=N);var x=w.prototype=E.prototype=Object.create(T);function _(t){["next","throw","return"].forEach((function(e){p(t,e,(function(t){return this._invoke(e,t)}))}))}function P(e,n){function r(o,i,c,u){var s=h(e[o],e,i);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==t(p)&&a.call(p,"__await")?n.resolve(p.__await).then((function(t){r("next",t,c,u)}),(function(t){r("throw",t,c,u)})):n.resolve(p).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,u)}))}u(s.arg)}var o;i(this,"_invoke",{value:function(t,e){function a(){return new n((function(n,o){r(t,e,n,o)}))}return o=o?o.then(a,a):a()}})}function I(t,e,r){var o=m;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:n,done:!0}}for(r.method=a,r.arg=i;;){var c=r.delegate;if(c){var u=S(c,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===m)throw o=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var s=h(t,e,r);if("normal"===s.type){if(o=r.done?g:d,s.arg===y)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=g,r.method="throw",r.arg=s.arg)}}}function S(t,e){var r=e.method,o=t.iterator[r];if(o===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=n,S(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var a=h(o,t.iterator,e.arg);if("throw"===a.type)return e.method="throw",e.arg=a.arg,e.delegate=null,y;var i=a.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=n),e.delegate=null,y):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,y)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(a.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return b.prototype=w,i(x,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:b,configurable:!0}),b.displayName=p(w,l,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,p(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},r.awrap=function(t){return{__await:t}},_(P.prototype),p(P.prototype,s,(function(){return this})),r.AsyncIterator=P,r.async=function(t,e,n,o,a){void 0===a&&(a=Promise);var i=new P(f(t,e,n,o),a);return r.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},_(x),p(x,l,"Generator"),p(x,u,(function(){return this})),p(x,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},r.values=R,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&a.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=n)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,o){return c.type="throw",c.arg=t,e.next=r,o&&(e.method="next",e.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),s=a.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;A(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:R(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=n),y}},r}function n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function r(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(e,n,r){return(n=function(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){a(i,r,o,c,u,"next",t)}function u(t){a(i,r,o,c,u,"throw",t)}c(void 0)}))}}var c={USE_MOCK:!1,DEBUG_MODE:!1,SOURCE_LANGUAGE:"English",TARGET_LANGUAGE:"Persian",TRANSLATION_API:"gemini",API_URL:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",API_KEY:"",WEBAI_API_URL:"http://localhost:6969/translate",WEBAI_API_MODEL:"gemini-2.0-flash",OPENAI_API_KEY:"",OPENAI_API_URL:"https://api.openai.com/v1/chat/completions",OPENAI_API_MODEL:"gpt-3.5-turbo",OPENROUTER_API_KEY:"",OPENROUTER_API_URL:"https://openrouter.ai/api/v1/chat/completions",OPENROUTER_API_MODEL:"openai/gpt-3.5-turbo",TRANSLATE_ON_TEXT_FIELDS:!0,ENABLE_SHORTCUT_FOR_TEXT_FIELDS:!0,TRANSLATE_WITH_SELECT_ELEMENT:!0,TRANSLATE_ON_TEXT_SELECTION:!0,REQUIRE_CTRL_FOR_TEXT_SELECTION:!1,ENABLE_DICTIONARY:!0,HIGHTLIH_NEW_ELEMETN_RED:"2px solid red",TRANSLATION_ICON_TITLE:"Translate Text",HIGHLIGHT_STYLE:"2px solid red",ICON_TRANSLATION:"🌐",ICON_SECCESS:"✅ ",ICON_WARNING:"⚠️ ",ICON_STATUS:"⏳ ",ICON_ERROR:"❌ ",ICON_INFO:"🔵 ",ICON_REVERT:"",NOTIFICATION_ALIGNMENT:"right",NOTIFICATION_TEXT_DIRECTION:"rtl",NOTIFICATION_TEXT_ALIGNMENT:"right",RTL_REGEX:/[\u0600-\u06FF]/,PERSIAN_REGEX:/^(?=.*[\u0600-\u06FF])[\u0600-\u06FF\u0660-\u0669\u06F0-\u06F9\u0041-\u005A\u0061-\u007A\u0030-\u0039\s.,:;؟!()«»@#\n\t\u200C]+$/,PROMPT_BASE_FIELD:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n  - If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n  - If the input is in any other language, translate it to $_{TARGET}.\n  - If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_BASE_SELECT:'Act as an automated JSON translation service. The input is a JSON array where each object contains a "text" property.\n\n  1. Translate each "text" value according to the given rules: $_{USER_RULES}\n  2. Preserve all input elements. **Do not omit, modify, or skip any entry.**\n  3. If translation is not needed for a specific item (e.g., numbers, hashtags, URLs), **return the original value unchanged.**\n  4. Maintain the internal structure, formatting, and line breaks exactly.\n  5. Output **only** the translated JSON array, with no extra text, explanations, or markdown.\n\n  ```json input\n  $_{TEXT}\n  ```\n    ',PROMPT_BASE_DICTIONARY:'You are a $_{TARGET} dictionary service. Your task is to provide in detailed dictionary definitions while strictly preserving the input structure and formatting. Follow these rules:\n\n  - Provide the translation of the input word or phrase.\n  - Include synonyms, word type (noun, verb, adjective, etc.), and a brief definition.\n  - If applicable, provide example sentences using the word or phrase in context.\n  - If the input is ambiguous, return the most common meanings.\n  - If no definition is found, return "No definition available."\n\n  Return in $_{TARGET} language, and **ONLY** the dictionary entry without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ',PROMPT_BASE_POPUP_TRANSLATE:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in any language, translate it to $_{TARGET}.\n\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_TEMPLATE:"- If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n- If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n- If the input is in any other language, translate it to $_{TARGET}.\n- If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.",DEBUG_TRANSLATED_ENGLISH:"This is a mock translation to English.",DEBUG_TRANSLATED_PERSIAN:"این یک ترجمه آزمایشی به فارسی است.",DEBUG_TRANSLATED_ENGLISH_With_NewLine:"This is a mock \ntranslation to English with \nnew lines.",DEBUG_TRANSLATED_PERSIAN_With_NewLine:"این یک ترجمه آزمایشی \nبرای ترجمه به فارسی \nبا خطوط جدید است."},u=(new Map,null),s=function(){var t=i(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===u){t.next=2;break}return t.abrupt("return",u);case 2:return t.abrupt("return",new Promise((function(t){try{chrome&&chrome.storage&&chrome.storage.local?chrome.storage.local.get(null,(function(e){chrome.runtime.lastError?(console.error("Error fetching settings:",chrome.runtime.lastError),u=r({},c),t(u)):(u=r(r({},c),e),t(u))})):(console.warn("chrome.storage.local not available, using default CONFIG."),u=r({},c),t(u))}catch(e){console.error("Error accessing storage:",e),u=r({},c),t(u)}})));case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();chrome&&chrome.storage&&chrome.storage.onChanged?chrome.storage.onChanged.addListener((function(t,e){if("local"===e&&u){Object.keys(t).forEach((function(e){if(c.hasOwnProperty(e)||u&&u.hasOwnProperty(e)){var n=t[e].newValue;u[e]!==n&&(u[e]=n,!0)}}))}})):console.warn("chrome.storage.onChanged not available. Settings cache might become stale.");var l=function(){var t=i(e().mark((function t(n,r){var o,a;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s();case 2:return a=t.sent,t.abrupt("return",null!==(o=null==a?void 0:a[n])&&void 0!==o?o:r);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),p=function(){var t=i(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",l("DEBUG_MODE",c.DEBUG_MODE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),f=function(){var t=i(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!u||void 0===u.DEBUG_MODE){t.next=2;break}return t.abrupt("return",u.DEBUG_MODE);case 2:return t.abrupt("return",p());case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),h=function(){var t=i(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",l("TARGET_LANGUAGE",c.TARGET_LANGUAGE));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,E(r.key),r)}}function v(t,e,n){return e&&d(t.prototype,e),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e,n){return(e=E(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function E(t){var e=function(t,e){if("object"!=m(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==m(e)?e:e+""}var b=v((function t(){g(this,t)}));y(b,"API","API"),y(b,"NETWORK","NETWORK"),y(b,"SERVICE","SERVICE"),y(b,"VALIDATIONMODEL","VALIDATIONMODEL"),y(b,"CONTEXT","CONTEXT"),y(b,"UI","UI"),y(b,"INTEGRATION","INTEGRATION"),y(b,"PARSE_SELECT_ELEMENT","PARSING_RESPONSE"),y(b,"PARSE_INPUT","PARSING_EXTRACT_FIELD");var w,T=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];f().then((function(t){var n;t&&(n=console).debug.apply(n,e)}))};w=null;function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function N(){N=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),c=new k(r||[]);return o(i,"_invoke",{value:I(t,n,c)}),i}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",m="executing",d="completed",v={};function g(){}function y(){}function E(){}var b={};s(b,i,(function(){return this}));var w=Object.getPrototypeOf,T=w&&w(w(R([])));T&&T!==n&&r.call(T,i)&&(b=T);var x=E.prototype=g.prototype=Object.create(b);function _(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function n(o,a,i,c){var u=p(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==L(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,i,c)}),(function(t){n("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return n("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return a=a?a.then(o,o):o()}})}function I(e,n,r){var o=f;return function(a,i){if(o===m)throw Error("Generator is already running");if(o===d){if("throw"===a)throw i;return{value:t,done:!0}}for(r.method=a,r.arg=i;;){var c=r.delegate;if(c){var u=S(c,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var s=p(e,n,r);if("normal"===s.type){if(o=r.done?d:h,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=d,r.method="throw",r.arg=s.arg)}}}function S(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=p(o,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,v;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function R(e){if(e||""===e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(L(e)+" is not iterable")}return y.prototype=E,o(x,"constructor",{value:E,configurable:!0}),o(E,"constructor",{value:y,configurable:!0}),y.displayName=s(E,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,s(t,u,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},_(P.prototype),s(P.prototype,c,(function(){return this})),e.AsyncIterator=P,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new P(l(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},_(x),s(x,u,"Generator"),s(x,i,(function(){return this})),s(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=R,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;A(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:R(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function x(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function _(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];chrome.tabs.query({active:!0,currentWindow:!0},function(){var n,r=(n=N().mark((function n(r){var o;return N().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==r.length){n.next=2;break}return n.abrupt("return");case 2:if(r[0].id,null===t){n.next=8;break}return n.next=6,chrome.storage.local.set({selectElementState:t});case 6:n.next=14;break;case 8:return n.next=10,chrome.storage.local.get(["selectElementState"]);case 10:return o=n.sent,t=!o.selectElementState,n.next=14,chrome.storage.local.set({selectElementState:t});case 14:chrome.runtime.sendMessage({action:"activateSelectElementMode",data:t},(function(t){console.log("Select Mode Updated:",t),e&&window.close()}));case 15:case"end":return n.stop()}}),n)})),function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function i(t){x(a,r,o,i,c,"next",t)}function c(t){x(a,r,o,i,c,"throw",t)}i(void 0)}))});return function(t){return r.apply(this,arguments)}}())}var P=[{name:"English",code:"en-US",promptName:"English"},{name:"Persian",code:"fa-IR",promptName:"Persian"},{name:"German",code:"de-DE",promptName:"German"},{name:"French",code:"fr-FR",promptName:"French"},{name:"Chinese (Simplified)",code:"zh-CN",promptName:"Chinese (Simplified)"},{name:"Spanish",code:"es-ES",promptName:"Spanish"},{name:"Hindi",code:"hi-IN",promptName:"Hindi"},{name:"Arabic",code:"ar-SA",promptName:"Arabic"},{name:"Bengali",code:"bn-BD",promptName:"Bengali"},{name:"Portuguese",code:"pt-PT",promptName:"Portuguese"},{name:"Russian",code:"ru-RU",promptName:"Russian"},{name:"Japanese",code:"ja-JP",promptName:"Japanese"},{name:"Urdu",code:"ur-PK",promptName:"Urdu"},{name:"Indonesian",code:"id-ID",promptName:"Indonesian"},{name:"Italian",code:"it-IT",promptName:"Italian"},{name:"Swahili",code:"sw-KE",promptName:"Swahili"},{name:"Marathi",code:"mr-IN",promptName:"Marathi"},{name:"Telugu",code:"te-IN",promptName:"Telugu"},{name:"Tamil",code:"ta-IN",promptName:"Tamil"},{name:"Turkish",code:"tr-TR",promptName:"Turkish"},{name:"Vietnamese",code:"vi-VN",promptName:"Vietnamese"},{name:"Korean",code:"ko-KR",promptName:"Korean"},{name:"Thai",code:"th-TH",promptName:"Thai"},{name:"Malay",code:"ms-MY",promptName:"Malay"},{name:"Polish",code:"pl-PL",promptName:"Polish"},{name:"Dutch",code:"nl-NL",promptName:"Dutch"},{name:"Filipino",code:"fil-PH",promptName:"Filipino"},{name:"Ukrainian",code:"uk-UA",promptName:"Ukrainian"},{name:"Romanian",code:"ro-RO",promptName:"Romanian"},{name:"Greek",code:"el-GR",promptName:"Greek"},{name:"Czech",code:"cs-CZ",promptName:"Czech"},{name:"Hungarian",code:"hu-HU",promptName:"Hungarian"},{name:"Swedish",code:"sv-SE",promptName:"Swedish"},{name:"Norwegian",code:"no-NO",promptName:"Norwegian"},{name:"Danish",code:"da-DK",promptName:"Danish"},{name:"Finnish",code:"fi-FI",promptName:"Finnish"},{name:"Hebrew",code:"he-IL",promptName:"Hebrew"},{name:"Afrikaans",code:"af-ZA",promptName:"Afrikaans"},{name:"Albanian",code:"sq-AL",promptName:"Albanian"},{name:"Bulgarian",code:"bg-BG",promptName:"Bulgarian"},{name:"Catalan",code:"ca-ES",promptName:"Catalan"},{name:"Croatian",code:"hr-HR",promptName:"Croatian"},{name:"Estonian",code:"et-EE",promptName:"Estonian"},{name:"Latvian",code:"lv-LV",promptName:"Latvian"},{name:"Lithuanian",code:"lt-LT",promptName:"Lithuanian"},{name:"Slovak",code:"sk-SK",promptName:"Slovak"},{name:"Slovenian",code:"sl-SI",promptName:"Slovenian"},{name:"Serbian",code:"sr-RS",promptName:"Serbian"},{name:"Malayalam",code:"ml-IN",promptName:"Malayalam"},{name:"Kannada",code:"kn-IN",promptName:"Kannada"},{name:"Odia",code:"or-IN",promptName:"Odia"},{name:"Punjabi",code:"pa-IN",promptName:"Punjabi"},{name:"Sinhala",code:"si-LK",promptName:"Sinhala"},{name:"Nepali",code:"ne-NP",promptName:"Nepali"},{name:"Azerbaijani",code:"az-AZ",promptName:"Azerbaijani"},{name:"Belarusian",code:"be-BY",promptName:"Belarusian"},{name:"Kazakh",code:"kk-KZ",promptName:"Kazakh"},{name:"Uzbek",code:"uz-UZ",promptName:"Uzbek"},{name:"Pashto",code:"ps-AF",promptName:"Pashto"},{name:"Tagalog",code:"tl-PH",promptName:"Tagalog"},{name:"Cebuano",code:"en-US",promptName:"Cebuano"},{name:"English (UK)",code:"en-GB",promptName:"English"},{name:"German (Austria)",code:"de-AT",promptName:"German"},{name:"French (Canada)",code:"fr-CA",promptName:"French"}];function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function S(){S=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),c=new k(r||[]);return o(i,"_invoke",{value:_(t,n,c)}),i}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f="suspendedStart",h="suspendedYield",m="executing",d="completed",v={};function g(){}function y(){}function E(){}var b={};s(b,i,(function(){return this}));var w=Object.getPrototypeOf,T=w&&w(w(R([])));T&&T!==n&&r.call(T,i)&&(b=T);var L=E.prototype=g.prototype=Object.create(b);function N(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function n(o,a,i,c){var u=p(t[o],t,a);if("throw"!==u.type){var s=u.arg,l=s.value;return l&&"object"==I(l)&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,i,c)}),(function(t){n("throw",t,i,c)})):e.resolve(l).then((function(t){s.value=t,i(s)}),(function(t){return n("throw",t,i,c)}))}c(u.arg)}var a;o(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,o){n(t,r,e,o)}))}return a=a?a.then(o,o):o()}})}function _(e,n,r){var o=f;return function(a,i){if(o===m)throw Error("Generator is already running");if(o===d){if("throw"===a)throw i;return{value:t,done:!0}}for(r.method=a,r.arg=i;;){var c=r.delegate;if(c){var u=P(c,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===f)throw o=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var s=p(e,n,r);if("normal"===s.type){if(o=r.done?d:h,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(o=d,r.method="throw",r.arg=s.arg)}}}function P(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,P(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var a=p(o,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,v;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function R(e){if(e||""===e){var n=e[i];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(I(e)+" is not iterable")}return y.prototype=E,o(L,"constructor",{value:E,configurable:!0}),o(E,"constructor",{value:y,configurable:!0}),y.displayName=s(E,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,s(t,u,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},N(x.prototype),s(x.prototype,c,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new x(l(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},N(L),s(L,u,"Generator"),s(L,i,(function(){return this})),s(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=R,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return c.type="throw",c.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;A(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:R(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function O(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function A(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){O(a,r,o,i,c,"next",t)}function c(t){O(a,r,o,i,c,"throw",t)}i(void 0)}))}}document.addEventListener("DOMContentLoaded",A(S().mark((function t(){var e,n,r,o,a,i,c,u,s,l,p,f,m,d,v,g,y,E,b,w,L,N,x,I,O,k,R,C,G,j,U,D,F,B,M,H,K,$,Y,X;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return X=function(){H||(clearTimeout(Y),Y=setTimeout((function(){T("[Popup]: User interacted with popup (mouseover/mousedown), deactivating select mode."),_(!1)}),e))},M=function(t){t.focus()},B=function(){chrome.storage.local.get(["lastTranslation"],function(){var t=A(S().mark((function t(e){var r,u;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="",e.lastTranslation?(T("[Popup]: Loading last translation from storage."),o.value=e.lastTranslation.sourceText||"",a.textContent=e.lastTranslation.translatedText||"",i.value=R(e.lastTranslation.sourceLanguage)||n,r=R(e.lastTranslation.targetLanguage)):T("[Popup]: No last translation found in storage."),r){t.next=14;break}return t.prev=3,t.next=6,h();case 6:u=t.sent,r=R(u)||R("en"),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(3),T("[Popup]: Error getting default target language for storage load:",t.t0),r=R("en");case 14:c.value=r,x(i,l),x(c,p),I(o),I(a);case 19:case"end":return t.stop()}}),t,null,[[3,10]])})));return function(e){return t.apply(this,arguments)}}())},function(){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){if(t.length>0&&null!=t[0].id){var e=t[0].id;chrome.tabs.sendMessage(e,{action:"getSelectedText"},(function(t){var r=chrome.runtime.lastError;r?(T("[Popup]: Error getting selected text from tab ".concat(e,": ").concat(r.message,". Loading from storage instead.")),B()):t&&t.selectedText?(o.value=t.selectedText,a.textContent="",i.value=n,h().then((function(t){c.value=R(t)||R("en"),x(c,p)})).catch((function(t){T("[Popup]: Error getting target language:",t),c.value=R("en"),x(c,p)})),x(i,l),I(o),I(a)):B()}))}else T("[Popup]: No active tab found or tab ID is invalid. Loading from storage."),B()}))},F=function(){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){if(t.length>0&&null!=t[0].id){var e=t[0].id;chrome.tabs.sendMessage(e,{action:"getSelectedText"},(function(t){var r=chrome.runtime.lastError;r?(T("[Popup]: Error getting selected text from tab ".concat(e,": ").concat(r.message,". Loading from storage instead.")),B()):t&&t.selectedText?(T("[Popup]: Received selected text from content script."),o.value=t.selectedText,a.textContent="",i.value=n,h().then((function(t){c.value=R(t)||R("en"),x(c,p)})).catch((function(t){T("[Popup]: Error getting target language after selection:",t),c.value=R("en"),x(c,p)})),x(i,l),I(o),I(a)):(T("[Popup]: No selected text received. Loading from storage."),B())}))}else T("[Popup]: No active tab found or tab ID is invalid. Loading from storage."),B()}))},D=function(){if(P.forEach((function(t){var e=document.createElement("option");if(e.value=t.promptName||t.name,u.appendChild(e),"auto"!==t.code){var n=document.createElement("option");n.value=t.promptName||t.name,s.appendChild(n)}})),!P.some((function(t){return t.name===n||t.promptName===n}))){var t=document.createElement("option");t.value=n,u.prepend(t)}i.value=n,x(i,l),h().then((function(t){c.value=R(t)||R("en"),x(c,p)})).catch((function(t){T("[Popup]: Error getting target language:",t),c.value=R("en"),x(c,p)}))},U=function(){return(U=A(S().mark((function t(){var e;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(g.classList.add("hidden-by-clipboard"),!G||document.hasFocus()){t.next=4;break}return T("[Popup]: Visibility update already deferred to window focus."),t.abrupt("return");case 4:return t.prev=4,t.next=7,navigator.clipboard.readText();case 7:e=t.sent,G=!1,e&&""!==e.trim()?(g.classList.remove("hidden-by-clipboard"),T("[Popup]: Clipboard has text, showing Paste button.")):T("[Popup]: Clipboard is empty or has no text, hiding Paste button."),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),"NotAllowedError"!==t.t0.name||document.hasFocus()||G?(T("[Popup]: Could not read clipboard (permission denied, empty, non-text, or other error). Hiding Paste button.",t.t0.name,t.t0.message),console.warn("[Popup]: Could not read clipboard. Hiding Paste button.",t.t0.name,t.t0.message),g.classList.add("hidden-by-clipboard"),G=!1):(T("[Popup]: Could not read clipboard due to lack of focus. Deferring check until window gains focus."),G=!0,window.addEventListener("focus",j,{once:!0}));case 15:case"end":return t.stop()}}),t,null,[[4,12]])})))).apply(this,arguments)},j=function(){return U.apply(this,arguments)},C=function(t){if(!t||"auto"===t)return null;var e=P.find((function(e){return e.code===t}));return(null==e?void 0:e.speechCode)||(null==e?void 0:e.code)||null},R=function(t){if(!t||"auto"===t)return n;var e=P.find((function(e){return e.code===t||e.name===t||e.promptName===t}));return e?e.promptName||e.name:""},k=function(t){if(!t)return null;var e=t.trim();if(e===n)return"auto";var r=P.find((function(t){return t.name===e||t.promptName===e}));return r?r.promptName||r.name:null},O=function(t){if(!t)return null;var e=t.trim();if(e===n)return"auto";var r=P.find((function(t){return t.name===e||t.promptName===e||t.code===e}));return r?r.code:null},I=function(t){var e=t.parentElement;if(e){var n=(t.value||t.textContent||"").trim();e.classList.toggle("has-content",n&&"در حال ترجمه..."!==n)}},x=function(t,e){var n=t.parentElement;n&&n.classList.toggle("has-value",!!t.value)},e=1e3,n="Auto Detect",r=document.getElementById("translationForm"),o=document.getElementById("sourceText"),a=document.getElementById("translationResult"),i=document.getElementById("sourceLanguageInput"),c=document.getElementById("targetLanguageInput"),u=document.getElementById("sourceLanguagesList"),s=document.getElementById("targetLanguagesList"),l=document.getElementById("clearSourceLanguage"),p=document.getElementById("clearTargetLanguage"),f=document.getElementById("swapLanguagesBtn"),m=document.getElementById("translateBtn"),o.parentElement,d=a.parentElement,v=document.getElementById("copySourceBtn"),g=document.getElementById("pasteSourceBtn"),y=document.getElementById("voiceSourceIcon"),E=document.getElementById("copyTargetBtn"),b=document.getElementById("voiceTargetIcon"),w=document.getElementById("translatePageIcon"),L=document.getElementById("selectElementIcon"),N=document.getElementById("clearStorageBtn"),G=!1,r.addEventListener("submit",(function(t){t.preventDefault(),T("[Popup]: Translation form submitted.");var e=o.value.trim(),n=c.value.trim(),r=i.value.trim();if(!e)return o.focus(),void T("[Popup]: No text to translate.");if(!n)return T("[Popup]: Missing target language identifier."),void c.focus();var u=k(n);if(!u||"auto"===u)return T("[Popup]: Invalid target language selected: ",n),void c.focus();var s=k(r);s&&"auto"!==s||(s=null),a.textContent="در حال ترجمه...",d.classList.remove("has-content");try{chrome.runtime.sendMessage({action:"fetchTranslation",payload:{promptText:e,sourceLanguage:s,targetLanguage:n}},(function(t){if(T("[Popup]: Received translation response from background:",t),chrome.runtime.lastError)return T("[Popup]: Chrome runtime error during translation response:",chrome.runtime.lastError.message),a.textContent="خطا: ".concat(chrome.runtime.lastError.message),void I(a);if(null!=t&&t.data&&t.data.translatedText){a.textContent=t.data.translatedText;var r=i.value,o=O(r),c=O(n);chrome.storage.local.set({lastTranslation:{sourceText:e,translatedText:t.data.translatedText,sourceLanguage:o||"auto",targetLanguage:c}},(function(){T("[Popup]: Last translation saved to storage.")}))}else a.textContent=(null==t?void 0:t.error)||"ترجمه با خطا مواجه شد.",T("[Popup]: Translation failed:",null==t?void 0:t.error);I(a)}))}catch(t){T("[Popup]: Synchronous error before sending message:",t),a.textContent="خطا در آماده سازی درخواست ترجمه.",I(a)}})),o.addEventListener("keydown",(function(t){var e=t.ctrlKey||t.metaKey,n="Enter"===t.key,r="/"===t.key;e&&(n||r)&&(t.preventDefault(),T("[Popup]: Shortcut pressed (".concat(t.ctrlKey?"Ctrl":"Cmd","+").concat(t.key,"). Triggering translation.")),m?m.click():T("[Popup]: Translate button not found for shortcut."))})),i.addEventListener("click",(function(){return M(i)})),c.addEventListener("click",(function(){return M(c)})),l.addEventListener("click",(function(){i.value="",x(i,l),i.focus()})),p.addEventListener("click",(function(){c.value="",x(c,p),c.focus()})),i.addEventListener("input",(function(){return x(i,l)})),c.addEventListener("input",(function(){return x(c,p)})),f.addEventListener("click",(function(){var t=i.value,e=c.value,n=O(t),r=O(e);if(n&&"auto"!==n&&r&&"auto"!==r){i.value=e,c.value=t,x(i,l),x(c,p);var u=o.value,s=a.textContent;s&&"در حال ترجمه..."!==s&&(o.value=s,a.textContent=u,I(o),I(a),j())}else T("auto"===n?"[Popup]: Cannot swap 'Auto Detect'.":"[Popup]: Cannot swap - invalid language selection.")})),o.addEventListener("input",(function(){return I(o)})),v.addEventListener("click",(function(){o.value&&navigator.clipboard.writeText(o.value).then((function(){T("[Popup]: Source text copied!"),g.classList.remove("hidden-by-clipboard")})).catch((function(t){T("[Popup]: Failed to copy source text: ",t)}))})),g.addEventListener("click",A(S().mark((function t(){var e;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.readText();case 3:return(e=t.sent)&&(o.value=e,o.dispatchEvent(new Event("input",{bubbles:!0})),o.focus()),t.next=7,j();case 7:t.next=13;break;case 9:t.prev=9,t.t0=t.catch(0),T("[Popup]: Failed to paste text: ",t.t0),g.classList.add("hidden-by-clipboard");case 13:case"end":return t.stop()}}),t,null,[[0,9]])})))),E.addEventListener("click",(function(){var t=a.textContent;t&&"در حال ترجمه..."!==t&&navigator.clipboard.writeText(t).then((function(){T("[Popup]: Target text copied!"),g.classList.remove("hidden-by-clipboard")})).catch((function(t){T("[Popup]: Failed to copy target text: ",t)}))})),y.addEventListener("click",(function(){var t=o.value.trim();if(t){var e=new SpeechSynthesisUtterance(t),n=i.value,r=O(n),a=C(r);a&&(e.lang=a),speechSynthesis.cancel(),speechSynthesis.speak(e)}else o.focus()})),b.addEventListener("click",(function(){var t,e=null===(t=a.textContent)||void 0===t?void 0:t.trim();if(e&&"در حال ترجمه..."!==e){var n=new SpeechSynthesisUtterance(e),r=c.value,o=O(r),i=C(o);i?(n.lang=i,speechSynthesis.cancel(),speechSynthesis.speak(n)):T("[Popup]: Cannot speak target: Invalid language ".concat(r," (Code: ").concat(o,")"))}})),N.addEventListener("click",(function(){chrome.storage.local.remove("lastTranslation",(function(){o.value="",a.textContent="",I(o),I(a),i.value=n,h().then((function(t){c.value=R(t)||R("en"),x(c,p)})).catch((function(){c.value=R("en"),x(c,p)})),x(i,l),o.focus(),T("[Popup]: Translation history and fields cleared."),j()}))})),w.addEventListener("click",(function(){chrome.runtime.sendMessage({action:"translateEntirePage"},(function(t){chrome.runtime.lastError?T("[Popup]: Error sending translate page message:",chrome.runtime.lastError.message):T("[Popup]: Translate page message sent.",t)})),window.close()})),H=!1,L.addEventListener("click",(function(){H=!0,_(!0,!0)})),(K=document.body).addEventListener("mouseenter",(function(){clearTimeout($),H=!1})),K.addEventListener("mouseleave",(function(){clearTimeout($),chrome.storage.local.get(["selectElementState"],(function(t){t.selectElementState?(T("[Popup]: Mouse left while select mode active, starting close timer."),$=setTimeout((function(){T("[Popup]: Closing popup due to mouse leave timeout."),window.close()}),800)):T("[Popup]: Mouse left, but select mode not active. Not closing.")}))})),K.addEventListener("mouseover",X),K.addEventListener("mousedown",(function(t){t.target!==L?(clearTimeout(Y),H||(T("[Popup]: Mousedown interaction, deactivating select mode immediately."),_(!1))):T("[Popup]: Mousedown on select icon, preventing immediate deactivation.")})),D(),F(),t.next=67,j();case 67:_(!0,!1);case 68:case"end":return t.stop()}}),t)}))))})();