(()=>{var e={63675:function(e,t){var r,n,o;!function(){if(1)n=[e],r=function(e){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{const t="The message port closed before a response was received.",wrapAPIs=e=>{const r={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(r).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class DefaultWeakMap extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const isThenable=e=>e&&"object"==typeof e&&"function"==typeof e.then,makeCallback=(t,r)=>(...n)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):r.singleCallbackArg||n.length<=1&&!1!==r.singleCallbackArg?t.resolve(n[0]):t.resolve(n)},pluralizeArguments=e=>1==e?"argument":"arguments",wrapAsyncFunction=(e,t)=>function(r,...n){if(n.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${pluralizeArguments(t.minArgs)} for ${e}(), got ${n.length}`);if(n.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${pluralizeArguments(t.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((o,a)=>{if(t.fallbackToNoCallback)try{r[e](...n,makeCallback({resolve:o,reject:a},t))}catch(a){console.warn(`${e} API method doesn't seem to support the callback parameter, `+"falling back to call it without a callback: ",a),r[e](...n),t.fallbackToNoCallback=!1,t.noCallback=!0,o()}else t.noCallback?(r[e](...n),o()):r[e](...n,makeCallback({resolve:o,reject:a},t))}))},wrapMethod=(e,t,r)=>new Proxy(t,{apply:(t,n,o)=>r.call(n,e,...o)});let n=Function.call.bind(Object.prototype.hasOwnProperty);const wrapObject=(e,t={},r={})=>{let o=Object.create(null),a={has:(t,r)=>r in e||r in o,get(a,i,c){if(i in o)return o[i];if(!(i in e))return;let s=e[i];if("function"==typeof s)if("function"==typeof t[i])s=wrapMethod(e,e[i],t[i]);else if(n(r,i)){let t=wrapAsyncFunction(i,r[i]);s=wrapMethod(e,e[i],t)}else s=s.bind(e);else if("object"==typeof s&&null!==s&&(n(t,i)||n(r,i)))s=wrapObject(s,t[i],r[i]);else{if(!n(r,"*"))return Object.defineProperty(o,i,{configurable:!0,enumerable:!0,get:()=>e[i],set(t){e[i]=t}}),s;s=wrapObject(s,t[i],r["*"])}return o[i]=s,s},set:(t,r,n,a)=>(r in o?o[r]=n:e[r]=n,!0),defineProperty:(e,t,r)=>Reflect.defineProperty(o,t,r),deleteProperty:(e,t)=>Reflect.deleteProperty(o,t)},i=Object.create(e);return new Proxy(i,a)},wrapEvent=e=>({addListener(t,r,...n){t.addListener(e.get(r),...n)},hasListener:(t,r)=>t.hasListener(e.get(r)),removeListener(t,r){t.removeListener(e.get(r))}}),o=new DefaultWeakMap((e=>"function"!=typeof e?e:function(t){const r=wrapObject(t,{},{getContent:{minArgs:0,maxArgs:0}});e(r)})),a=new DefaultWeakMap((e=>"function"!=typeof e?e:function(t,r,n){let o,a,i=!1,c=new Promise((e=>{o=function(t){i=!0,e(t)}}));try{a=e(t,r,o)}catch(e){a=Promise.reject(e)}const s=!0!==a&&isThenable(a);if(!0!==a&&!s&&!i)return!1;const sendPromisedResult=e=>{e.then((e=>{n(e)}),(e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",n({__mozWebExtensionPolyfillReject__:!0,message:t})})).catch((e=>{console.error("Failed to send onMessage rejected reply",e)}))};return sendPromisedResult(s?a:c),!0})),wrappedSendMessageCallback=({reject:r,resolve:n},o)=>{e.runtime.lastError?e.runtime.lastError.message===t?n():r(new Error(e.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?r(new Error(o.message)):n(o)},wrappedSendMessage=(e,t,r,...n)=>{if(n.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${pluralizeArguments(t.minArgs)} for ${e}(), got ${n.length}`);if(n.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${pluralizeArguments(t.maxArgs)} for ${e}(), got ${n.length}`);return new Promise(((e,t)=>{const o=wrappedSendMessageCallback.bind(null,{resolve:e,reject:t});n.push(o),r.sendMessage(...n)}))},i={devtools:{network:{onRequestFinished:wrapEvent(o)}},runtime:{onMessage:wrapEvent(a),onMessageExternal:wrapEvent(a),sendMessage:wrappedSendMessage.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:wrappedSendMessage.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},c={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return r.privacy={network:{"*":c},services:{"*":c},websites:{"*":c}},wrapObject(e,i,r)};e.exports=wrapAPIs(chrome)}},void 0===(o="function"==typeof r?r.apply(t,n):r)||(e.exports=o);else;}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self)}},t={};function __webpack_require__(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,__webpack_require__),o.exports}__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=__webpack_require__(63675),t=__webpack_require__.n(e);function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_typeof(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}var r={APP_NAME:"Translate It",USE_MOCK:!1,DEBUG_MODE:!1,EXTENSION_ENABLED:!0,APPLICATION_LOCALIZE:"Farsi",SOURCE_LANGUAGE:"English",TARGET_LANGUAGE:"Farsi",TRANSLATION_API:"gemini",API_URL:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",API_KEY:"",WEBAI_API_URL:"http://localhost:6969/translate",WEBAI_API_MODEL:"gemini-2.0-flash",OPENAI_API_KEY:"",OPENAI_API_URL:"https://api.openai.com/v1/chat/completions",OPENAI_API_MODEL:"gpt-3.5-turbo",OPENROUTER_API_KEY:"",OPENROUTER_API_URL:"https://openrouter.ai/api/v1/chat/completions",OPENROUTER_API_MODEL:"openai/gpt-3.5-turbo",TRANSLATE_ON_TEXT_FIELDS:!0,ENABLE_SHORTCUT_FOR_TEXT_FIELDS:!0,TRANSLATE_WITH_SELECT_ELEMENT:!0,TRANSLATE_ON_TEXT_SELECTION:!0,REQUIRE_CTRL_FOR_TEXT_SELECTION:!1,ENABLE_DICTIONARY:!0,HIGHTLIH_NEW_ELEMETN_RED:"2px solid red",TRANSLATION_ICON_TITLE:"Translate Text",HIGHLIGHT_STYLE:"2px solid red",ICON_TRANSLATION:"🌐",ICON_SUCCESS:"✅ ",ICON_WARNING:"⚠️ ",ICON_STATUS:"⏳ ",ICON_ERROR:"❌ ",ICON_INFO:"🔵 ",ICON_REVERT:"↩️",NOTIFICATION_ALIGNMENT:"right",NOTIFICATION_TEXT_DIRECTION:"rtl",NOTIFICATION_TEXT_ALIGNMENT:"right",RTL_REGEX:/[\u0591-\u07FF\u0600-\u06FF]/,PERSIAN_REGEX:/^(?=.*[\u0600-\u06FF])[\u0600-\u06FF\u0660-\u0669\u06F0-\u06F9\u0041-\u005A\u0061-\u007A\u0030-\u0039\s.,:;؟!()«»@#\n\t\u200C]+$/,PROMPT_BASE_FIELD:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n  - If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n  - If the input is in any other language, translate it to $_{TARGET}.\n  - If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_BASE_SELECT:'Act as an automated JSON translation service. The input is a JSON array where each object contains a "text" property.\n\n  1. Translate each "text" value according to the given rules: $_{USER_RULES}\n  2. Preserve all input elements. **Do not omit, modify, or skip any entry.**\n  3. If translation is not needed for a specific item (e.g., numbers, hashtags, URLs), **return the original value unchanged.**\n  4. Maintain the internal structure, formatting, and line breaks exactly.\n  5. Output **only** the translated JSON array, with no extra text, explanations, or markdown.\n\n  ```json input\n  $_{TEXT}\n  ```\n    ',PROMPT_BASE_DICTIONARY:"You are a $_{TARGET} dictionary service. Your task is to provide in detailed dictionary definitions while strictly preserving the input structure and formatting. Follow these rules:\n\n  - Provide the translation of the input word or phrase.\n  - Include synonyms, word type (noun, verb, adjective, etc.), and a brief definition.\n  - If applicable, provide example sentences using the word or phrase in context.\n  - If the input is ambiguous, return the most common meanings.\n  - If no definition is found, return translation only.\n\n  Return in $_{TARGET} language, and **ONLY** the dictionary entry without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_BASE_POPUP_TRANSLATE:"You are a translation service. Your task is to translate text while strictly preserving its structure, formatting, and line breaks. Follow these rules:\n\n  - If the input is in any language, translate it to $_{TARGET}.\n\n\n  Return **only** the translated text without any extra words, explanations, markdown, or modifications.\n\n  ```text input\n  $_{TEXT}\n  ```\n  ",PROMPT_TEMPLATE:"- If the input is in $_{SOURCE}, translate it to $_{TARGET}.\n- If the input is in $_{TARGET}, translate it to $_{SOURCE}.\n- If the input is in any other language, translate it to $_{TARGET}.\n- If the input has grammar mistakes but is in $_{TARGET}, translate it to $_{SOURCE} while preserving the intended meaning.",DEBUG_TRANSLATED_ENGLISH:"This is a mock translation to English.",DEBUG_TRANSLATED_PERSIAN:"این یک ترجمه آزمایشی به فارسی است.",DEBUG_TRANSLATED_ENGLISH_With_NewLine:"This is a mock \ntranslation to English with \nnew lines.",DEBUG_TRANSLATED_PERSIAN_With_NewLine:"این یک ترجمه آزمایشی \nبرای ترجمه به فارسی \nبا خطوط جدید است."},n="field",o="select_element",a="dictionary",i="popup_translate",c={selectElementActive:!1,highlightedElement:null,activeTranslateIcon:null,originalTexts:new Map,translateMode:null},s=null,l=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:if(null===s){e.next=2;break}return e.abrupt("return",s);case 2:return e.abrupt("return",t().storage.local.get(null).then((function(e){return s=_objectSpread(_objectSpread({},r),e)}))["catch"]((function(e){return helpers_logME("Error fetching settings:",e),s=_objectSpread({},r)})));case 3:case"end":return e.stop()}}),_callee)})));return function(){return e.apply(this,arguments)}}();t()&&t().storage&&t().storage.onChanged?t().storage.onChanged.addListener((function(e,t){if("local"===t&&s){Object.keys(e).forEach((function(t){if(r.hasOwnProperty(t)||s&&s.hasOwnProperty(t)){var n=e[t].newValue;s[t]!==n&&(s[t]=n,!0)}}))}})):helpers_logME("Browser.storage.onChanged not available. Settings cache might become stale.");var u,f,p,h,d,y,g,v,m,_,b,x,w,E,T,k,S,A,I,L,P,O=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee2(e,t){var r,n;return _regeneratorRuntime().wrap((function(o){for(;1;)switch(o.prev=o.next){case 0:return o.next=2,l();case 2:return n=o.sent,o.abrupt("return",null!==(r=null==n?void 0:n[e])&&void 0!==r?r:t);case 4:case"end":return o.stop()}}),_callee2)})));return function(t,r){return e.apply(this,arguments)}}(),G=(null&&(u=_asyncToGenerator(_regeneratorRuntime().mark((function _callee3(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("USE_MOCK",r.USE_MOCK));case 1:case"end":return e.stop()}}),_callee3)})))),function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee4(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("DEBUG_MODE",r.DEBUG_MODE));case 1:case"end":return e.stop()}}),_callee4)})));return function(){return e.apply(this,arguments)}}()),C=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee5(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:if(!s||void 0===s.DEBUG_MODE){e.next=2;break}return e.abrupt("return",s.DEBUG_MODE);case 2:return e.abrupt("return",G());case 3:case"end":return e.stop()}}),_callee5)})));return function(){return e.apply(this,arguments)}}(),R=(null&&(f=_asyncToGenerator(_regeneratorRuntime().mark((function _callee6(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("API_KEY",r.API_KEY));case 1:case"end":return e.stop()}}),_callee6)})))),null&&(p=_asyncToGenerator(_regeneratorRuntime().mark((function _callee7(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("API_URL",r.API_URL));case 1:case"end":return e.stop()}}),_callee7)})))),function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee8(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("APPLICATION_LOCALIZE",r.APPLICATION_LOCALIZE));case 1:case"end":return e.stop()}}),_callee8)})));return function(){return e.apply(this,arguments)}}()),N=(null&&(h=_asyncToGenerator(_regeneratorRuntime().mark((function _callee9(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("APP_NAME",r.APP_NAME));case 1:case"end":return e.stop()}}),_callee9)})))),function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee10(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("EXTENSION_ENABLED",r.EXTENSION_ENABLED));case 1:case"end":return e.stop()}}),_callee10)})));return function(){return e.apply(this,arguments)}}()),M=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee11(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("SOURCE_LANGUAGE",r.SOURCE_LANGUAGE));case 1:case"end":return e.stop()}}),_callee11)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee12(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("TARGET_LANGUAGE",r.TARGET_LANGUAGE));case 1:case"end":return e.stop()}}),_callee12)})));return function(){return e.apply(this,arguments)}}(),j=(null&&(d=_asyncToGenerator(_regeneratorRuntime().mark((function _callee13(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("ENABLE_DICTIONARY",r.ENABLE_DICTIONARY));case 1:case"end":return e.stop()}}),_callee13)})))),null&&(y=_asyncToGenerator(_regeneratorRuntime().mark((function _callee14(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("PROMPT_TEMPLATE",r.PROMPT_TEMPLATE));case 1:case"end":return e.stop()}}),_callee14)})))),null&&(g=_asyncToGenerator(_regeneratorRuntime().mark((function _callee15(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("PROMPT_BASE_DICTIONARY",r.PROMPT_BASE_DICTIONARY));case 1:case"end":return e.stop()}}),_callee15)})))),null&&(v=_asyncToGenerator(_regeneratorRuntime().mark((function _callee16(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("PROMPT_BASE_POPUP_TRANSLATE",r.PROMPT_BASE_POPUP_TRANSLATE));case 1:case"end":return e.stop()}}),_callee16)})))),null&&(m=_asyncToGenerator(_regeneratorRuntime().mark((function _callee17(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("PROMPT_BASE_SELECT",r.PROMPT_BASE_SELECT));case 1:case"end":return e.stop()}}),_callee17)})))),null&&(_=_asyncToGenerator(_regeneratorRuntime().mark((function _callee18(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("PROMPT_BASE_FIELD",r.PROMPT_BASE_FIELD));case 1:case"end":return e.stop()}}),_callee18)})))),null&&(b=_asyncToGenerator(_regeneratorRuntime().mark((function _callee19(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("TRANSLATION_API",r.TRANSLATION_API));case 1:case"end":return e.stop()}}),_callee19)})))),null&&(x=_asyncToGenerator(_regeneratorRuntime().mark((function _callee20(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("WEBAI_API_URL",r.WEBAI_API_URL));case 1:case"end":return e.stop()}}),_callee20)})))),null&&(w=_asyncToGenerator(_regeneratorRuntime().mark((function _callee21(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("WEBAI_API_MODEL",r.WEBAI_API_MODEL));case 1:case"end":return e.stop()}}),_callee21)})))),null&&(E=_asyncToGenerator(_regeneratorRuntime().mark((function _callee22(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("OPENAI_API_KEY",r.OPENAI_API_KEY));case 1:case"end":return e.stop()}}),_callee22)})))),null&&(T=_asyncToGenerator(_regeneratorRuntime().mark((function _callee23(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.OPENAI_API_URL);case 1:case"end":return e.stop()}}),_callee23)})))),null&&(k=_asyncToGenerator(_regeneratorRuntime().mark((function _callee24(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("OPENAI_API_MODEL",r.OPENAI_API_MODEL));case 1:case"end":return e.stop()}}),_callee24)})))),null&&(S=_asyncToGenerator(_regeneratorRuntime().mark((function _callee25(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("OPENROUTER_API_KEY",r.OPENROUTER_API_KEY));case 1:case"end":return e.stop()}}),_callee25)})))),null&&(A=_asyncToGenerator(_regeneratorRuntime().mark((function _callee26(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("OPENROUTER_API_MODEL",r.OPENROUTER_API_MODEL));case 1:case"end":return e.stop()}}),_callee26)})))),null&&(I=_asyncToGenerator(_regeneratorRuntime().mark((function _callee27(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("TRANSLATE_ON_TEXT_FIELDS",r.TRANSLATE_ON_TEXT_FIELDS));case 1:case"end":return e.stop()}}),_callee27)})))),null&&(L=_asyncToGenerator(_regeneratorRuntime().mark((function _callee28(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("ENABLE_SHORTCUT_FOR_TEXT_FIELDS",r.ENABLE_SHORTCUT_FOR_TEXT_FIELDS));case 1:case"end":return e.stop()}}),_callee28)})))),function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee29(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("TRANSLATE_WITH_SELECT_ELEMENT",r.TRANSLATE_WITH_SELECT_ELEMENT));case 1:case"end":return e.stop()}}),_callee29)})));return function(){return e.apply(this,arguments)}}()),D=(null&&(P=_asyncToGenerator(_regeneratorRuntime().mark((function _callee30(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("TRANSLATE_ON_TEXT_SELECTION",r.TRANSLATE_ON_TEXT_SELECTION));case 1:case"end":return e.stop()}}),_callee30)})))),function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function _callee31(){return _regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.abrupt("return",O("REQUIRE_CTRL_FOR_TEXT_SELECTION",r.REQUIRE_CTRL_FOR_TEXT_SELECTION));case 1:case"end":return e.stop()}}),_callee31)})));return function(){return e.apply(this,arguments)}}());function ErrorTypes_typeof(e){return ErrorTypes_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ErrorTypes_typeof(e)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ErrorTypes_toPropertyKey(n.key),n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function ErrorTypes_defineProperty(e,t,r){return(t=ErrorTypes_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ErrorTypes_toPropertyKey(e){var t=function(e,t){if("object"!=ErrorTypes_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ErrorTypes_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ErrorTypes_typeof(t)?t:t+""}var H=_createClass((function ErrorTypes(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ErrorTypes)}));ErrorTypes_defineProperty(H,"API","API"),ErrorTypes_defineProperty(H,"HTTP_ERROR","HTTP_ERROR"),ErrorTypes_defineProperty(H,"NETWORK_ERROR","NETWORK_ERROR"),ErrorTypes_defineProperty(H,"API_RESPONSE_INVALID","API_RESPONSE_INVALID"),ErrorTypes_defineProperty(H,"SERVICE","SERVICE"),ErrorTypes_defineProperty(H,"VALIDATION","VALIDATION"),ErrorTypes_defineProperty(H,"TAB_AVAILABILITY","TAB"),ErrorTypes_defineProperty(H,"CONTEXT","CONTEXT"),ErrorTypes_defineProperty(H,"UI","UI"),ErrorTypes_defineProperty(H,"INTEGRATION","INTEGRATION"),ErrorTypes_defineProperty(H,"UNKNOWN","UNKNOWN"),ErrorTypes_defineProperty(H,"PROMPT_INVALID","PROMPT_INVALID"),ErrorTypes_defineProperty(H,"TEXT_EMPTY","TEXT_EMPTY"),ErrorTypes_defineProperty(H,"TEXT_TOO_LONG","TEXT_TOO_LONG"),ErrorTypes_defineProperty(H,"TRANSLATION_NOT_FOUND","TRANSLATION_NOT_FOUND"),ErrorTypes_defineProperty(H,"TRANSLATION_FAILED","TRANSLATION_FAILED"),ErrorTypes_defineProperty(H,"API_KEY_MISSING","API_KEY_MISSING"),ErrorTypes_defineProperty(H,"API_KEY_INVALID","API_KEY_INVALID"),ErrorTypes_defineProperty(H,"API_URL_MISSING","API_URL_MISSING"),ErrorTypes_defineProperty(H,"MODEL_MISSING","MODEL_MISSING"),ErrorTypes_defineProperty(H,"MODEL_OVERLOADED","MODEL_OVERLOADED"),ErrorTypes_defineProperty(H,"QUOTA_EXCEEDED","QUOTA_EXCEEDED"),ErrorTypes_defineProperty(H,"GEMINI_QUOTA_REGION","GEMINI_QUOTA_REGION");var U=[{name:"English",voiceCode:"en-US",promptName:"English",code:"en",locale:"en",flag:"🇬🇧"},{name:"Farsi",voiceCode:"fa-IR",promptName:"Farsi",code:"fa",locale:"fa",flag:"🇮🇷"},{name:"German",voiceCode:"de-DE",promptName:"German",code:"de"},{name:"French",voiceCode:"fr-FR",promptName:"French",code:"fr"},{name:"Chinese (Simplified)",voiceCode:"zh-CN",promptName:"Chinese (Simplified)",code:"zh"},{name:"Spanish",voiceCode:"es-ES",promptName:"Spanish",code:"es"},{name:"Hindi",voiceCode:"hi-IN",promptName:"Hindi",code:"hi"},{name:"Arabic",voiceCode:"ar-SA",promptName:"Arabic",code:"ar"},{name:"Bengali",voiceCode:"bn-BD",promptName:"Bengali",code:"bn"},{name:"Portuguese",voiceCode:"pt-PT",promptName:"Portuguese",code:"pt"},{name:"Russian",voiceCode:"ru-RU",promptName:"Russian",code:"ru"},{name:"Japanese",voiceCode:"ja-JP",promptName:"Japanese",code:"ja"},{name:"Urdu",voiceCode:"ur-PK",promptName:"Urdu",code:"ur"},{name:"Indonesian",voiceCode:"id-ID",promptName:"Indonesian",code:"id"},{name:"Italian",voiceCode:"it-IT",promptName:"Italian",code:"it"},{name:"Swahili",voiceCode:"sw-KE",promptName:"Swahili",code:"sw"},{name:"Marathi",voiceCode:"mr-IN",promptName:"Marathi",code:"mr"},{name:"Telugu",voiceCode:"te-IN",promptName:"Telugu",code:"te"},{name:"Tamil",voiceCode:"ta-IN",promptName:"Tamil",code:"ta"},{name:"Turkish",voiceCode:"tr-TR",promptName:"Turkish",code:"tr"},{name:"Vietnamese",voiceCode:"vi-VN",promptName:"Vietnamese",code:"vi"},{name:"Korean",voiceCode:"ko-KR",promptName:"Korean",code:"ko"},{name:"Thai",voiceCode:"th-TH",promptName:"Thai",code:"th"},{name:"Malay",voiceCode:"ms-MY",promptName:"Malay",code:"ms"},{name:"Polish",voiceCode:"pl-PL",promptName:"Polish",code:"pl"},{name:"Dutch",voiceCode:"nl-NL",promptName:"Dutch",code:"nl"},{name:"Filipino",voiceCode:"fil-PH",promptName:"Filipino",code:"fi"},{name:"Ukrainian",voiceCode:"uk-UA",promptName:"Ukrainian",code:"uk"},{name:"Romanian",voiceCode:"ro-RO",promptName:"Romanian",code:"ro"},{name:"Greek",voiceCode:"el-GR",promptName:"Greek",code:"el"},{name:"Czech",voiceCode:"cs-CZ",promptName:"Czech",code:"cs"},{name:"Hungarian",voiceCode:"hu-HU",promptName:"Hungarian",code:"hu"},{name:"Swedish",voiceCode:"sv-SE",promptName:"Swedish",code:"sv"},{name:"Norwegian",voiceCode:"no-NO",promptName:"Norwegian",code:"no"},{name:"Danish",voiceCode:"da-DK",promptName:"Danish",code:"da"},{name:"Finnish",voiceCode:"fi-FI",promptName:"Finnish",code:"fi"},{name:"Hebrew",voiceCode:"he-IL",promptName:"Hebrew",code:"he"},{name:"Afrikaans",voiceCode:"af-ZA",promptName:"Afrikaans",code:"af"},{name:"Albanian",voiceCode:"sq-AL",promptName:"Albanian",code:"sq"},{name:"Bulgarian",voiceCode:"bg-BG",promptName:"Bulgarian",code:"bg"},{name:"Catalan",voiceCode:"ca-ES",promptName:"Catalan",code:"ca"},{name:"Croatian",voiceCode:"hr-HR",promptName:"Croatian",code:"hr"},{name:"Estonian",voiceCode:"et-EE",promptName:"Estonian",code:"et"},{name:"Latvian",voiceCode:"lv-LV",promptName:"Latvian",code:"lv"},{name:"Lithuanian",voiceCode:"lt-LT",promptName:"Lithuanian",code:"lt"},{name:"Slovak",voiceCode:"sk-SK",promptName:"Slovak",code:"sk"},{name:"Slovenian",voiceCode:"sl-SI",promptName:"Slovenian",code:"sl"},{name:"Serbian",voiceCode:"sr-RS",promptName:"Serbian",code:"sr"},{name:"Malayalam",voiceCode:"ml-IN",promptName:"Malayalam",code:"ml"},{name:"Kannada",voiceCode:"kn-IN",promptName:"Kannada",code:"kn"},{name:"Odia",voiceCode:"or-IN",promptName:"Odia",code:"or"},{name:"Punjabi",voiceCode:"pa-IN",promptName:"Punjabi",code:"pa"},{name:"Sinhala",voiceCode:"si-LK",promptName:"Sinhala",code:"si"},{name:"Nepali",voiceCode:"ne-NP",promptName:"Nepali",code:"ne"},{name:"Azerbaijani",voiceCode:"az-AZ",promptName:"Azerbaijani",code:"az"},{name:"Belarusian",voiceCode:"be-BY",promptName:"Belarusian",code:"be"},{name:"Kazakh",voiceCode:"kk-KZ",promptName:"Kazakh",code:"kk"},{name:"Uzbek",voiceCode:"uz-UZ",promptName:"Uzbek",code:"uz"},{name:"Pashto",voiceCode:"ps-AF",promptName:"Pashto",code:"ps"},{name:"Tagalog",voiceCode:"tl-PH",promptName:"Tagalog",code:"tl"},{name:"Cebuano",voiceCode:"en-US",promptName:"Cebuano",code:"en"}];var isRtlText=function(e){return r.RTL_REGEX.test(e)},textDetection_applyElementDirection=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.style){var r=t;e.style.direction=r?"rtl":"ltr",e.style.textAlign=r?"right":"left"}},correctTextDirection=function(e,t){if(e){var r=function(e){return function(e){return/[\u0600-\u06FF]/.test(e)}(e)||isRtlText(e)}(t),n=r?"rtl":"ltr",o=r?"right":"left";e.style?(e.style.direction=n,e.style.textAlign=o):e.setAttribute("style","direction: ".concat(n,"; text-align: ").concat(o,";"))}};function animatePopupEffect(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;e.style.opacity="0",e.style.transform="scale(0.95)",e.style.transition="opacity ".concat(t,"ms ease-out, transform ").concat(t,"ms ease-out"),e.getBoundingClientRect(),e.style.opacity="1",e.style.transform="scale(1)"}function i18n_typeof(e){return i18n_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i18n_typeof(e)}function i18n_regeneratorRuntime(){i18n_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==i18n_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(i18n_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function i18n_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function i18n_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){i18n_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){i18n_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function parseBoolean(e){return"true"===String(e).trim().toLowerCase()}var W,B,z,Y,V,X,K,q=new Map;function loadTranslationsForLanguageCached(e){return _loadTranslationsForLanguageCached.apply(this,arguments)}function _loadTranslationsForLanguageCached(){return(_loadTranslationsForLanguageCached=i18n_asyncToGenerator(i18n_regeneratorRuntime().mark((function _callee(e){var r,n,o;return i18n_regeneratorRuntime().wrap((function(a){for(;1;)switch(a.prev=a.next){case 0:if(!q.has(e)){a.next=2;break}return a.abrupt("return",q.get(e));case 2:return a.prev=2,r=t().runtime.getURL("_locales/".concat(e,"/messages.json")),a.next=6,fetch(r);case 6:if((n=a.sent).ok){a.next=9;break}return a.abrupt("return",null);case 9:return a.next=11,n.json();case 11:return o=a.sent,q.set(e,o),a.abrupt("return",o);case 16:return a.prev=16,a.t0=a["catch"](2),a.abrupt("return",null);case 19:case"end":return a.stop()}}),_callee,null,[[2,16]])})))).apply(this,arguments)}function i18n_getTranslationString(e,t){return _getTranslationString.apply(this,arguments)}function _getTranslationString(){return(_getTranslationString=i18n_asyncToGenerator(i18n_regeneratorRuntime().mark((function _callee2(e,t){var r,n,o,a,i;return i18n_regeneratorRuntime().wrap((function(c){for(;1;)switch(c.prev=c.next){case 0:if((n=t)&&2===n.length){c.next=7;break}return c.next=4,R();case 4:o=c.sent,a=U.find((function(e){return e.name===o||e.locale===o})),n=(null==a?void 0:a.code)||(2===(null==o?void 0:o.length)?o:"en");case 7:return c.next=9,loadTranslationsForLanguageCached(n);case 9:if(!(i=c.sent)||null===(r=i[e])||void 0===r||!r.message){c.next=12;break}return c.abrupt("return",i[e].message);case 12:return c.abrupt("return",null);case 13:case"end":return c.stop()}}),_callee2)})))).apply(this,arguments)}function localizeContainer(e,r){e.querySelectorAll("[data-i18n]").forEach((function(e){var n=e.getAttribute("data-i18n"),o="";o=r&&r[n]&&r[n].message?r[n].message:t().i18n.getMessage(n),e.matches("input, textarea")?e.value=o:e.matches("img")?e.setAttribute("alt",o):e.textContent=o})),e.querySelectorAll("[data-i18n-title]").forEach((function(e){var n=e.getAttribute("data-i18n-title"),o="";o=r&&r[n]&&r[n].message?r[n].message:t().i18n.getMessage(n),e.setAttribute("title",o)})),e.querySelectorAll("[data-i18n-placeholder]").forEach((function(e){var n=e.getAttribute("data-i18n-placeholder"),o="";(o=r&&r[n]&&r[n].message?r[n].message:t().i18n.getMessage(n))&&(e.placeholder=o)}))}function app_localize_popup(e){return _app_localize_popup.apply(this,arguments)}function _app_localize_popup(){return(_app_localize_popup=i18n_asyncToGenerator(i18n_regeneratorRuntime().mark((function _callee4(e){var t,r,n,o,a,i;return i18n_regeneratorRuntime().wrap((function(c){for(;1;)switch(c.prev=c.next){case 0:return r=null,c.next=3,R();case 3:if(n=c.sent,(!(o=e)||(null===(t=o)||void 0===t?void 0:t.length)>2)&&U.forEach((function(e){e.name!==n&&e.locale!==n||(o=e.locale)})),!o){c.next=10;break}return c.next=9,loadTranslationsForLanguageCached(o);case 9:r=c.sent;case 10:a=document.body,i=document.head,localizeContainer(a,r),i&&localizeContainer(i,r),animatePopupEffect(a,300);case 15:case"end":return c.stop()}}),_callee4)})))).apply(this,arguments)}function NotificationManager_typeof(e){return NotificationManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},NotificationManager_typeof(e)}function NotificationManager_regeneratorRuntime(){NotificationManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==NotificationManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(NotificationManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function NotificationManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function NotificationManager_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,NotificationManager_toPropertyKey(n.key),n)}}function NotificationManager_toPropertyKey(e){var t=function(e,t){if("object"!=NotificationManager_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=NotificationManager_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==NotificationManager_typeof(t)?t:t+""}var Z,Q={ICON_TRANSLATION:null!==(W=null==r?void 0:r.ICON_TRANSLATION)&&void 0!==W?W:"🌐",ICON_SUCCESS:null!==(B=null==r?void 0:r.ICON_SUCCESS)&&void 0!==B?B:"✅",ICON_WARNING:null!==(z=null==r?void 0:r.ICON_WARNING)&&void 0!==z?z:"⚠️",ICON_STATUS:null!==(Y=null==r?void 0:r.ICON_STATUS)&&void 0!==Y?Y:"⏳",ICON_ERROR:null!==(V=null==r?void 0:r.ICON_ERROR)&&void 0!==V?V:"❌",ICON_INFO:null!==(X=null==r?void 0:r.ICON_INFO)&&void 0!==X?X:"🔵",ICON_REVERT:null!==(K=null==r?void 0:r.ICON_REVERT)&&void 0!==K?K:"↩️"},J=function(){return e=function NotificationManager(e){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,NotificationManager),this.errorHandler=e||{handle:function(){}},this.map={error:{title:"Translate It! - Error",icon:Q.ICON_ERROR,cls:"AIWC-error",dur:5e3},warning:{title:"Translate It! - Warning",icon:Q.ICON_WARNING,cls:"AIWC-warning",dur:4e3},success:{title:"Translate It! - Success",icon:Q.ICON_SUCCESS,cls:"AIWC-success",dur:3e3},info:{title:"Translate It! - Info",icon:Q.ICON_INFO,cls:"AIWC-info",dur:3e3},status:{title:"Translate It! - Status",icon:Q.ICON_STATUS,cls:"AIWC-status",dur:2e3},revert:{title:"Translate It! - Revert",icon:Q.ICON_REVERT,cls:"AIWC-revert",dur:800}},this.container=null,"undefined"!=typeof document&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(function(){return r._makeContainer()}),{once:!0}):this._makeContainer()),t().storage&&t().storage.onChanged&&t().storage.onChanged.addListener((function(e,t){"local"===t&&e.APPLICATION_LOCALIZE&&r._applyAlignment()}))},r=[{key:"_applyAlignment",value:(o=NotificationManager_regeneratorRuntime().mark((function _callee(){var e,t;return NotificationManager_regeneratorRuntime().wrap((function(r){for(;1;)switch(r.prev=r.next){case 0:if(this.container){r.next=2;break}return r.abrupt("return");case 2:return r.prev=2,r.next=5,i18n_getTranslationString("IsRTL");case 5:e=r.sent,(t=parseBoolean(e))?(this.container.style.right="20px",this.container.style.left=""):(this.container.style.left="",this.container.style.right="20px"),this.container.style.direction=t?"rtl":"ltr",this.container.style.textAlign="right",r.next=15;break;case 12:r.prev=12,r.t0=r["catch"](2),helpers_logME("[NotificationManager] _applyAlignment failed:",r.t0);case 15:case"end":return r.stop()}}),_callee,this,[[2,12]])})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function _next(e){NotificationManager_asyncGeneratorStep(a,r,n,_next,_throw,"next",e)}function _throw(e){NotificationManager_asyncGeneratorStep(a,r,n,_next,_throw,"throw",e)}_next(void 0)}))},function(){return a.apply(this,arguments)})},{key:"_makeContainer",value:function(){var e=null;try{var t="AIWritingCompanion-notifications";return(e=document.getElementById(t))?(this.container=e,this._applyAlignment(),e):document.body?(e=document.createElement("div"))?(e.id=t,Object.assign(e.style,{position:"fixed",top:"20px",zIndex:"2147483646",display:"flex",flexDirection:"column",gap:"10px"}),document.body.appendChild(e),this.container=e,this._applyAlignment(),e):(helpers_logME("[NotificationManager] createElement failed."),null):(helpers_logME("[NotificationManager] document.body not available."),null)}catch(t){return helpers_logME("[NotificationManager] _makeContainer error:",t),e&&e.remove&&e.remove(),null}}},{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0,a=this.map[t]||this.map.info,i=null!=n?n:a.dur;if(this.container&&document.body.contains(this.container))try{return this._toastInPage(e,a,r,i,o)}catch(e){var c,s;return null===(c=(s=this.errorHandler).handle)||void 0===c||c.call(s,e,{type:H.UI,context:"NotificationManager-show"}),null}return this._sendToActiveTab(e,t,r,i,o),null}},{key:"dismiss",value:function(e){e&&"function"==typeof e.remove&&(e.style.opacity="0",setTimeout((function(){return e.remove()}),500))}},{key:"_toastInPage",value:function(e,t,r,n,o){var a=this,i=document.createElement("div");i.className="AIWC-notification ".concat(t.cls),i.style.cssText="\n      background:#fff;color:#333;padding:10px 15px;\n      border-radius:6px;font-size:14px;border:1px solid #ddd;\n      box-shadow:0 2px 8px rgba(0,0,0,0.1);display:flex;\n      align-items:center;cursor:pointer;opacity:1;\n      transition:opacity .5s";var c=document.createElement("span");c.textContent=t.icon;var s=document.createElement("span");return s.textContent=e,i.appendChild(c),i.appendChild(s),i.addEventListener("click",(function(){try{null==o||o()}catch(e){helpers_logME(e)}a.dismiss(i)})),this.container.appendChild(i),r&&"AIWC-status"!==t.cls&&setTimeout((function(){return a.dismiss(i)}),n),i}},{key:"_sendToActiveTab",value:function(e,r,n,o,a){var i=this;return t().tabs.query({active:!0,currentWindow:!0}).then((function(a){var i;return null!=a&&null!==(i=a[0])&&void 0!==i&&i.id&&isExtensionContextValid()?t().tabs.sendMessage(a[0].id,{action:"show_notification",payload:{message:e,type:r,autoDismiss:n,duration:o}}):null})).then((function(e){if(a&&void 0!==e){var _listener=function(e){"notification_clicked"===(null==e?void 0:e.action)&&(a(),t().runtime.onMessage.removeListener(_listener))};t().runtime.onMessage.addListener(_listener)}}))["catch"]((function(){return i._osNotification(e,r,a)}))}},{key:"_osNotification",value:function(e,r,n){var o=this.map[r]||this.map.info;t().notifications.create({type:"basic",iconUrl:t().runtime.getURL("icons/extension_icon.png"),title:o.title,message:e}).then((function(e){if(n){var _click=function(r){r===e&&(n(),t().notifications.clear(e),t().notifications.onClicked.removeListener(_click))};t().notifications.onClicked.addListener(_click)}}))["catch"]((function(){}))}}],r&&NotificationManager_defineProperties(e.prototype,r),n&&NotificationManager_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n,o,a}();function ErrorMatcher_typeof(e){return ErrorMatcher_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ErrorMatcher_typeof(e)}function matchErrorToType(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if("string"==typeof e){var t=e.trim();if(Object.values(H).includes(t))return t}if(e&&"object"===ErrorMatcher_typeof(e)){if(e.type)return e.type;var r=e.statusCode;if("number"==typeof r&&r>=400&&r<600)return H.HTTP_ERROR}var n=String(e).toLowerCase().trim();return/\b(403|404|500|502|503|504)\b/.test(n)?H.HTTP_ERROR:n.includes("text is empty")?H.TEXT_EMPTY:n.includes("prompt is invalid")?H.PROMPT_INVALID:n.includes("text is too long")||n.includes("too long")?H.TEXT_TOO_LONG:n.includes("translation not found")?H.TRANSLATION_NOT_FOUND:n.includes("translation failed")?H.TRANSLATION_FAILED:n.includes("wrong api key")||n.includes("api key not valid")||n.includes("no auth credentials")||n.includes("incorrect api key provided")||n.includes("api key expired")||n.includes("renew the api key")||n.includes("API key expired")||n.includes("renew the api key")?H.API_KEY_INVALID:n.includes("api key is missing")||n.includes("key missing")?H.API_KEY_MISSING:n.includes("api url")&&n.includes("missing")?H.API_URL_MISSING:n.includes("not a valid model id")||n.includes("invalid model")||n.includes("model not found")||n.includes("model is missing")||n.includes("model not available")||n.includes("the model `")&&n.includes("does not exist or you do not have access to it")?H.MODEL_MISSING:n.includes("the model is overloaded")||n.includes("overloaded")?H.MODEL_OVERLOADED:n.includes("quota exceeded")&&n.includes("region")?(helpers_logME("[ErrorMatcher] Quota exceeded with region, indicating Gemini-specific quota."),H.GEMINI_QUOTA_REGION):n.includes("quota exceeded")||n.includes("gemini quota")?H.QUOTA_EXCEEDED:n.includes("failed to fetch")||n.includes("network failure")||n.includes("connection failed")||n.includes("networkerror")||n.includes("networkerror when attempting to fetch resource")?H.NETWORK_ERROR:n.includes("http error")||n.includes("http status")||n.includes("http response")||n.includes("operation was aborted")||n.includes("the operation was aborted.")?H.HTTP_ERROR:n.includes("context")||n.includes("context invalid")||n.includes("extension context")||n.includes("context invalidated")||n.includes("extension context invalidated")?H.CONTEXT:H.UNKNOWN}function ErrorMessages_regeneratorRuntime(){ErrorMessages_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==ErrorMessages_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(ErrorMessages_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function ErrorMessages_typeof(e){return ErrorMessages_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ErrorMessages_typeof(e)}function ErrorMessages_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function ErrorMessages_defineProperty(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=ErrorMessages_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ErrorMessages_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ErrorMessages_typeof(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ee=(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(Z={},H.TEXT_EMPTY,"Text is empty"),H.PROMPT_INVALID,"Prompt is invalid"),H.TEXT_TOO_LONG,"Text is too long"),H.TRANSLATION_NOT_FOUND,"Translation not found"),H.TRANSLATION_FAILED,"Translation failed"),H.API,"API error"),H.API_KEY_MISSING,"API Key is missing"),H.API_KEY_INVALID,"API Key is wrong or invalid"),H.API_URL_MISSING,"API URL is missing"),H.MODEL_MISSING,"AI Model is missing or invalid"),ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(ErrorMessages_defineProperty(Z,H.MODEL_OVERLOADED,"The Model is overloaded"),H.QUOTA_EXCEEDED,"You exceeded your current quota"),H.GEMINI_QUOTA_REGION,"You reached the Gemini quota. (Region issue)"),H.NETWORK_ERROR,"Connection to server failed"),H.HTTP_ERROR,"HTTP error"),H.CONTEXT,"Extension context lost"),H.UNKNOWN,"An unknown error occurred"),H.TAB_AVAILABILITY,"Tab not available"),H.UI,"User Interface error"),H.INTEGRATION,"Integration error"),ErrorMessages_defineProperty(ErrorMessages_defineProperty(Z,H.SERVICE,"Service error"),H.VALIDATION,"Validation error"));function getErrorMessage(e){return _getErrorMessage.apply(this,arguments)}function _getErrorMessage(){var e;return e=ErrorMessages_regeneratorRuntime().mark((function _callee(e){var t,r;return ErrorMessages_regeneratorRuntime().wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:return t=e.startsWith("ERRORS_")?e:"ERRORS_".concat(e),n.next=3,i18n_getTranslationString(t);case 3:return(r=n.sent)&&r.trim()||(r=ee[e]||ee[H.UNKNOWN]),n.abrupt("return",r);case 6:case"end":return n.stop()}}),_callee)})),_getErrorMessage=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){ErrorMessages_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){ErrorMessages_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))},_getErrorMessage.apply(this,arguments)}function ErrorService_typeof(e){return ErrorService_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ErrorService_typeof(e)}function ErrorService_defineProperty(e,t,r){return(t=ErrorService_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ErrorService_regeneratorRuntime(){ErrorService_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==ErrorService_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(ErrorService_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function ErrorService_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function ErrorService_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){ErrorService_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){ErrorService_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function ErrorService_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ErrorService_toPropertyKey(n.key),n)}}function ErrorService_toPropertyKey(e){var t=function(e,t){if("object"!=ErrorService_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ErrorService_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ErrorService_typeof(t)?t:t+""}var te=new Set([H.CONTEXT]),re=new Set([H.CONTEXT,H.API,H.API_KEY_INVALID,H.API_KEY_MISSING,H.API_URL_MISSING,H.MODEL_MISSING,H.MODEL_OVERLOADED,H.QUOTA_EXCEEDED,H.GEMINI_QUOTA_REGION,H.NETWORK_ERROR,H.HTTP_ERROR,H.INTEGRATION,H.SERVICE,H.VALIDATION,H.UI,H.PROMPT_INVALID,H.TEXT_EMPTY,H.TEXT_TOO_LONG,H.TRANSLATION_NOT_FOUND,H.TRANSLATION_FAILED,H.TAB_AVAILABILITY]),ne=new Set([H.API_KEY_INVALID,H.API_KEY_MISSING,H.MODEL_OVERLOADED,H.MODEL_MISSING,H.API_URL_MISSING,H.QUOTA_EXCEEDED,H.HTTP_ERROR,H.GEMINI_QUOTA_REGION]),oe=function(){return e=function ErrorHandler(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ErrorHandler),this.notifier=new J,this.displayedErrors=new Set,this.handling=!1},t=[{key:"handle",value:(a=ErrorService_asyncToGenerator(ErrorService_regeneratorRuntime().mark((function _callee(e){var t,n,o,a,i,c=arguments;return ErrorService_regeneratorRuntime().wrap((function(s){for(;1;)switch(s.prev=s.next){case 0:if(t=c.length>1&&void 0!==c[1]?c[1]:{},!this.handling){s.next=3;break}return s.abrupt("return",e);case 3:return this.handling=!0,s.prev=4,n=e instanceof Error?e.message:String(e),o=matchErrorToType(n),s.next=9,getErrorMessage(o);case 9:return a=s.sent,s.next=12,G()["catch"]((function(){return r.DEBUG_MODE}));case 12:if(s.sent&&!re.has(o)&&console.error("[".concat(o,"] ").concat(n),e.stack),!te.has(o)){s.next=16;break}return s.abrupt("return",e);case 16:return i=ne.has(o)?openOptionsPage:void 0,this._notifyUser(a,t.type||H.SERVICE,i),s.abrupt("return",e);case 19:return s.prev=19,this.handling=!1,s.finish(19);case 22:case"end":return s.stop()}}),_callee,this,[[4,,19,22]])}))),function(e){return a.apply(this,arguments)})},{key:"_logError",value:function(e,t){console.error("[ErrorService] ".concat(e.name,": ").concat(e.message,"\nContext: ").concat(t.context,"\nType: ").concat(t.type,"\nStack: ").concat(e.stack))}},{key:"_notifyUser",value:function(e,t,r){var n,o=this;if(!this.displayedErrors.has(e)){var a=(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(n={},H.API,"error"),H.UI,"error"),H.NETWORK_ERROR,"warning"),H.HTTP_ERROR,"warning"),H.SERVICE,"error"),H.CONTEXT,"warning"),H.VALIDATION,"warning"),H.INTEGRATION,"warning"),H.API_KEY_INVALID,"error"),H.API_KEY_MISSING,"error"),ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(ErrorService_defineProperty(n,H.API_URL_MISSING,"error"),H.MODEL_MISSING,"error"),H.MODEL_OVERLOADED,"warning"),H.QUOTA_EXCEEDED,"warning"),H.GEMINI_QUOTA_REGION,"warning"))[t]||"error";this.notifier.show(e,a,!0,4e3,r),this.displayedErrors.add(e),setTimeout((function(){return o.displayedErrors["delete"](e)}),4500)}}}],n=[{key:"processError",value:(o=ErrorService_asyncToGenerator(ErrorService_regeneratorRuntime().mark((function _callee2(e){return ErrorService_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(null==e||!e.then){t.next=6;break}return t.next=3,e;case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0=e;case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),_callee2)}))),function(e){return o.apply(this,arguments)})}],t&&ErrorService_defineProperties(e.prototype,t),n&&ErrorService_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,a}();function _handleUIError(){return _handleUIError=ErrorService_asyncToGenerator(ErrorService_regeneratorRuntime().mark((function _callee3(e){var t,r,n=arguments;return ErrorService_regeneratorRuntime().wrap((function(o){for(;1;)switch(o.prev=o.next){case 0:return t=n.length>1&&void 0!==n[1]?n[1]:"",r=new oe,o.abrupt("return",r.handle(e,{type:H.UI,context:t}));case 3:case"end":return o.stop()}}),_callee3)}))),_handleUIError.apply(this,arguments)}var ae=new oe,delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function logMethod(e,t,r){}var ie,helpers_logME=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];C().then((function(e){var r;e&&(r=console).debug.apply(r,t)}))},isEditable=function(e){if(null!=e&&e.isContentEditable)return!0;if("TEXTAREA"===(null==e?void 0:e.tagName))return!0;if("INPUT"===(null==e?void 0:e.tagName)){var t,r=(null===(t=e.getAttribute("type"))||void 0===t?void 0:t.toLowerCase())||"text";return["text","search"].includes(r)}return!(null==e||!e.closest||!e.closest('[contenteditable="true"]'))},isExtensionContextValid=function(){try{var e,r;return!(null===t()||void 0===t()||null===(e=t().runtime)||void 0===e||!e.id||null===t()||void 0===t()||null===(r=t().storage)||void 0===r||!r.local)}catch(e){return!1}},openOptionsPage=function(){t().runtime.openOptionsPage?t().runtime.openOptionsPage():window.open(t().runtime.getURL("html/options.html"))};ie=null;function taggleLinks(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{var t;if(null===(t=document)||void 0===t||!t.body)return;document.documentElement.classList.toggle("AIWritingCompanion-disable-links",e)}catch(e){throw ae.handle(e,{type:H.CONTEXT,context:"taggleLinks",details:{errorType:e.message.includes("context invalidated")?"CONTEXT_INVALIDATED":"UNKNOWN_ERROR"}})}}const{entries:ce,setPrototypeOf:se,isFrozen:le,getPrototypeOf:ue,getOwnPropertyDescriptor:fe}=Object;let{freeze:pe,seal:he,create:de}=Object,{apply:ye,construct:ge}="undefined"!=typeof Reflect&&Reflect;pe||(pe=function(e){return e}),he||(he=function(e){return e}),ye||(ye=function(e,t,r){return e.apply(t,r)}),ge||(ge=function(e,t){return new e(...t)});const ve=unapply(Array.prototype.forEach),me=unapply(Array.prototype.lastIndexOf),_e=unapply(Array.prototype.pop),be=unapply(Array.prototype.push),xe=unapply(Array.prototype.splice),we=unapply(String.prototype.toLowerCase),Ee=unapply(String.prototype.toString),Te=unapply(String.prototype.match),ke=unapply(String.prototype.replace),Se=unapply(String.prototype.indexOf),Ae=unapply(String.prototype.trim),Ie=unapply(Object.prototype.hasOwnProperty),Le=unapply(RegExp.prototype.test),Pe=(Oe=TypeError,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return ge(Oe,t)});var Oe;function unapply(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return ye(e,t,n)}}function addToSet(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:we;se&&se(e,null);let n=t.length;for(;n--;){let o=t[n];if("string"==typeof o){const e=r(o);e!==o&&(le(t)||(t[n]=e),o=e)}e[o]=!0}return e}function cleanArray(e){for(let t=0;t<e.length;t++){Ie(e,t)||(e[t]=null)}return e}function clone(e){const t=de(null);for(const[r,n]of ce(e)){Ie(e,r)&&(Array.isArray(n)?t[r]=cleanArray(n):n&&"object"==typeof n&&n.constructor===Object?t[r]=clone(n):t[r]=n)}return t}function lookupGetter(e,t){for(;null!==e;){const r=fe(e,t);if(r){if(r.get)return unapply(r.get);if("function"==typeof r.value)return unapply(r.value)}e=ue(e)}return function(){return null}}const Ge=pe(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Ce=pe(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Re=pe(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Ne=pe(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Me=pe(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Fe=pe(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),je=pe(["#text"]),De=pe(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),He=pe(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ue=pe(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),We=pe(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Be=he(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ze=he(/<%[\w\W]*|[\w\W]*%>/gm),Ye=he(/\$\{[\w\W]*/gm),$e=he(/^data-[\-\w.\u00B7-\uFFFF]+$/),Ve=he(/^aria-[\-\w]+$/),Xe=he(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ke=he(/^(?:\w+script|data):/i),qe=he(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ze=he(/^html$/i),Qe=he(/^[a-z][.\w]*(-[.\w]+)+$/i);var Je=Object.freeze({__proto__:null,ARIA_ATTR:Ve,ATTR_WHITESPACE:qe,CUSTOM_ELEMENT:Qe,DATA_ATTR:$e,DOCTYPE_NAME:Ze,ERB_EXPR:ze,IS_ALLOWED_URI:Xe,IS_SCRIPT_OR_DATA:Ke,MUSTACHE_EXPR:Be,TMPLIT_EXPR:Ye});const et=1,tt=3,rt=7,nt=8,ot=9,getGlobal=function(){return"undefined"==typeof window?null:window};var at,it,ct=function createDOMPurify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:getGlobal();const DOMPurify=e=>createDOMPurify(e);if(DOMPurify.version="3.2.5",DOMPurify.removed=[],!e||!e.document||e.document.nodeType!==ot||!e.Element)return DOMPurify.isSupported=!1,DOMPurify;let{document:t}=e;const r=t,n=r.currentScript,{DocumentFragment:o,HTMLTemplateElement:a,Node:i,Element:c,NodeFilter:s,NamedNodeMap:l=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:u,DOMParser:f,trustedTypes:p}=e,h=c.prototype,d=lookupGetter(h,"cloneNode"),y=lookupGetter(h,"remove"),g=lookupGetter(h,"nextSibling"),v=lookupGetter(h,"childNodes"),m=lookupGetter(h,"parentNode");if("function"==typeof a){const e=t.createElement("template");e.content&&e.content.ownerDocument&&(t=e.content.ownerDocument)}let _,b="";const{implementation:x,createNodeIterator:w,createDocumentFragment:E,getElementsByTagName:T}=t,{importNode:k}=r;let S={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};DOMPurify.isSupported="function"==typeof ce&&"function"==typeof m&&x&&void 0!==x.createHTMLDocument;const{MUSTACHE_EXPR:A,ERB_EXPR:I,TMPLIT_EXPR:L,DATA_ATTR:P,ARIA_ATTR:O,IS_SCRIPT_OR_DATA:G,ATTR_WHITESPACE:C,CUSTOM_ELEMENT:R}=Je;let{IS_ALLOWED_URI:N}=Je,M=null;const F=addToSet({},[...Ge,...Ce,...Re,...Me,...je]);let j=null;const D=addToSet({},[...De,...He,...Ue,...We]);let H=Object.seal(de(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),U=null,W=null,B=!0,z=!0,Y=!1,V=!0,X=!1,K=!0,q=!1,Z=!1,Q=!1,J=!1,ee=!1,te=!1,re=!0,ne=!1;const oe="user-content-";let ae=!0,ie=!1,se={},le=null;const ue=addToSet({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let fe=null;const he=addToSet({},["audio","video","img","source","image","track"]);let ye=null;const ge=addToSet({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Oe="http://www.w3.org/1998/Math/MathML",Be="http://www.w3.org/2000/svg",ze="http://www.w3.org/1999/xhtml";let Ye=ze,$e=!1,Ve=null;const Ke=addToSet({},[Oe,Be,ze],Ee);let qe=addToSet({},["mi","mo","mn","ms","mtext"]),Qe=addToSet({},["annotation-xml"]);const at=addToSet({},["title","style","font","a","script"]);let it=null;const ct=["application/xhtml+xml","text/html"],st="text/html";let lt=null,ut=null;const ft=t.createElement("form"),isRegexOrFunction=function(e){return e instanceof RegExp||e instanceof Function},_parseConfig=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ut||ut!==e){if(e&&"object"==typeof e||(e={}),e=clone(e),it=-1===ct.indexOf(e.PARSER_MEDIA_TYPE)?st:e.PARSER_MEDIA_TYPE,lt="application/xhtml+xml"===it?Ee:we,M=Ie(e,"ALLOWED_TAGS")?addToSet({},e.ALLOWED_TAGS,lt):F,j=Ie(e,"ALLOWED_ATTR")?addToSet({},e.ALLOWED_ATTR,lt):D,Ve=Ie(e,"ALLOWED_NAMESPACES")?addToSet({},e.ALLOWED_NAMESPACES,Ee):Ke,ye=Ie(e,"ADD_URI_SAFE_ATTR")?addToSet(clone(ge),e.ADD_URI_SAFE_ATTR,lt):ge,fe=Ie(e,"ADD_DATA_URI_TAGS")?addToSet(clone(he),e.ADD_DATA_URI_TAGS,lt):he,le=Ie(e,"FORBID_CONTENTS")?addToSet({},e.FORBID_CONTENTS,lt):ue,U=Ie(e,"FORBID_TAGS")?addToSet({},e.FORBID_TAGS,lt):{},W=Ie(e,"FORBID_ATTR")?addToSet({},e.FORBID_ATTR,lt):{},se=!!Ie(e,"USE_PROFILES")&&e.USE_PROFILES,B=!1!==e.ALLOW_ARIA_ATTR,z=!1!==e.ALLOW_DATA_ATTR,Y=e.ALLOW_UNKNOWN_PROTOCOLS||!1,V=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,X=e.SAFE_FOR_TEMPLATES||!1,K=!1!==e.SAFE_FOR_XML,q=e.WHOLE_DOCUMENT||!1,J=e.RETURN_DOM||!1,ee=e.RETURN_DOM_FRAGMENT||!1,te=e.RETURN_TRUSTED_TYPE||!1,Q=e.FORCE_BODY||!1,re=!1!==e.SANITIZE_DOM,ne=e.SANITIZE_NAMED_PROPS||!1,ae=!1!==e.KEEP_CONTENT,ie=e.IN_PLACE||!1,N=e.ALLOWED_URI_REGEXP||Xe,Ye=e.NAMESPACE||ze,qe=e.MATHML_TEXT_INTEGRATION_POINTS||qe,Qe=e.HTML_INTEGRATION_POINTS||Qe,H=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(H.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&isRegexOrFunction(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(H.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(H.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),X&&(z=!1),ee&&(J=!0),se&&(M=addToSet({},je),j=[],!0===se.html&&(addToSet(M,Ge),addToSet(j,De)),!0===se.svg&&(addToSet(M,Ce),addToSet(j,He),addToSet(j,We)),!0===se.svgFilters&&(addToSet(M,Re),addToSet(j,He),addToSet(j,We)),!0===se.mathMl&&(addToSet(M,Me),addToSet(j,Ue),addToSet(j,We))),e.ADD_TAGS&&(M===F&&(M=clone(M)),addToSet(M,e.ADD_TAGS,lt)),e.ADD_ATTR&&(j===D&&(j=clone(j)),addToSet(j,e.ADD_ATTR,lt)),e.ADD_URI_SAFE_ATTR&&addToSet(ye,e.ADD_URI_SAFE_ATTR,lt),e.FORBID_CONTENTS&&(le===ue&&(le=clone(le)),addToSet(le,e.FORBID_CONTENTS,lt)),ae&&(M["#text"]=!0),q&&addToSet(M,["html","head","body"]),M.table&&(addToSet(M,["tbody"]),delete U.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Pe('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Pe('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');_=e.TRUSTED_TYPES_POLICY,b=_.createHTML("")}else void 0===_&&(_=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let r=null;const n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(r=t.getAttribute(n));const o="dompurify"+(r?"#"+r:"");try{return e.createPolicy(o,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+o+" could not be created."),null}}(p,n)),null!==_&&"string"==typeof b&&(b=_.createHTML(""));pe&&pe(e),ut=e}},pt=addToSet({},[...Ce,...Re,...Ne]),ht=addToSet({},[...Me,...Fe]),_forceRemove=function(e){be(DOMPurify.removed,{element:e});try{m(e).removeChild(e)}catch(t){y(e)}},_removeAttribute=function(e,t){try{be(DOMPurify.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){be(DOMPurify.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(J||ee)try{_forceRemove(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},_initDocument=function(e){let r=null,n=null;if(Q)e="<remove></remove>"+e;else{const t=Te(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===it&&Ye===ze&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const o=_?_.createHTML(e):e;if(Ye===ze)try{r=(new f).parseFromString(o,it)}catch(e){}if(!r||!r.documentElement){r=x.createDocument(Ye,"template",null);try{r.documentElement.innerHTML=$e?b:o}catch(e){}}const a=r.body||r.documentElement;return e&&n&&a.insertBefore(t.createTextNode(n),a.childNodes[0]||null),Ye===ze?T.call(r,q?"html":"body")[0]:q?r.documentElement:a},_createNodeIterator=function(e){return w.call(e.ownerDocument||e,e,s.SHOW_ELEMENT|s.SHOW_COMMENT|s.SHOW_TEXT|s.SHOW_PROCESSING_INSTRUCTION|s.SHOW_CDATA_SECTION,null)},_isClobbered=function(e){return e instanceof u&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof l)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},_isNode=function(e){return"function"==typeof i&&e instanceof i};function _executeHooks(e,t,r){ve(e,(e=>{e.call(DOMPurify,t,r,ut)}))}const _sanitizeElements=function(e){let t=null;if(_executeHooks(S.beforeSanitizeElements,e,null),_isClobbered(e))return _forceRemove(e),!0;const r=lt(e.nodeName);if(_executeHooks(S.uponSanitizeElement,e,{tagName:r,allowedTags:M}),e.hasChildNodes()&&!_isNode(e.firstElementChild)&&Le(/<[/\w!]/g,e.innerHTML)&&Le(/<[/\w!]/g,e.textContent))return _forceRemove(e),!0;if(e.nodeType===rt)return _forceRemove(e),!0;if(K&&e.nodeType===nt&&Le(/<[/\w]/g,e.data))return _forceRemove(e),!0;if(!M[r]||U[r]){if(!U[r]&&_isBasicCustomElement(r)){if(H.tagNameCheck instanceof RegExp&&Le(H.tagNameCheck,r))return!1;if(H.tagNameCheck instanceof Function&&H.tagNameCheck(r))return!1}if(ae&&!le[r]){const t=m(e)||e.parentNode,r=v(e)||e.childNodes;if(r&&t){for(let n=r.length-1;n>=0;--n){const o=d(r[n],!0);o.__removalCount=(e.__removalCount||0)+1,t.insertBefore(o,g(e))}}}return _forceRemove(e),!0}return e instanceof c&&!function(e){let t=m(e);t&&t.tagName||(t={namespaceURI:Ye,tagName:"template"});const r=we(e.tagName),n=we(t.tagName);return!!Ve[e.namespaceURI]&&(e.namespaceURI===Be?t.namespaceURI===ze?"svg"===r:t.namespaceURI===Oe?"svg"===r&&("annotation-xml"===n||qe[n]):Boolean(pt[r]):e.namespaceURI===Oe?t.namespaceURI===ze?"math"===r:t.namespaceURI===Be?"math"===r&&Qe[n]:Boolean(ht[r]):e.namespaceURI===ze?!(t.namespaceURI===Be&&!Qe[n])&&!(t.namespaceURI===Oe&&!qe[n])&&!ht[r]&&(at[r]||!pt[r]):!("application/xhtml+xml"!==it||!Ve[e.namespaceURI]))}(e)?(_forceRemove(e),!0):"noscript"!==r&&"noembed"!==r&&"noframes"!==r||!Le(/<\/no(script|embed|frames)/i,e.innerHTML)?(X&&e.nodeType===tt&&(t=e.textContent,ve([A,I,L],(e=>{t=ke(t,e," ")})),e.textContent!==t&&(be(DOMPurify.removed,{element:e.cloneNode()}),e.textContent=t)),_executeHooks(S.afterSanitizeElements,e,null),!1):(_forceRemove(e),!0)},_isValidAttribute=function(e,r,n){if(re&&("id"===r||"name"===r)&&(n in t||n in ft))return!1;if(z&&!W[r]&&Le(P,r));else if(B&&Le(O,r));else if(!j[r]||W[r]){if(!(_isBasicCustomElement(e)&&(H.tagNameCheck instanceof RegExp&&Le(H.tagNameCheck,e)||H.tagNameCheck instanceof Function&&H.tagNameCheck(e))&&(H.attributeNameCheck instanceof RegExp&&Le(H.attributeNameCheck,r)||H.attributeNameCheck instanceof Function&&H.attributeNameCheck(r))||"is"===r&&H.allowCustomizedBuiltInElements&&(H.tagNameCheck instanceof RegExp&&Le(H.tagNameCheck,n)||H.tagNameCheck instanceof Function&&H.tagNameCheck(n))))return!1}else if(ye[r]);else if(Le(N,ke(n,C,"")));else if("src"!==r&&"xlink:href"!==r&&"href"!==r||"script"===e||0!==Se(n,"data:")||!fe[e]){if(Y&&!Le(G,ke(n,C,"")));else if(n)return!1}else;return!0},_isBasicCustomElement=function(e){return"annotation-xml"!==e&&Te(e,R)},_sanitizeAttributes=function(e){_executeHooks(S.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||_isClobbered(e))return;const r={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:j,forceKeepAttr:void 0};let n=t.length;for(;n--;){const o=t[n],{name:a,namespaceURI:i,value:c}=o,s=lt(a);let l="value"===a?c:Ae(c);if(r.attrName=s,r.attrValue=l,r.keepAttr=!0,r.forceKeepAttr=void 0,_executeHooks(S.uponSanitizeAttribute,e,r),l=r.attrValue,!ne||"id"!==s&&"name"!==s||(_removeAttribute(a,e),l=oe+l),K&&Le(/((--!?|])>)|<\/(style|title)/i,l)){_removeAttribute(a,e);continue}if(r.forceKeepAttr)continue;if(_removeAttribute(a,e),!r.keepAttr)continue;if(!V&&Le(/\/>/i,l)){_removeAttribute(a,e);continue}X&&ve([A,I,L],(e=>{l=ke(l,e," ")}));const u=lt(e.nodeName);if(_isValidAttribute(u,s,l)){if(_&&"object"==typeof p&&"function"==typeof p.getAttributeType)if(i);else switch(p.getAttributeType(u,s)){case"TrustedHTML":l=_.createHTML(l);break;case"TrustedScriptURL":l=_.createScriptURL(l)}try{i?e.setAttributeNS(i,a,l):e.setAttribute(a,l),_isClobbered(e)?_forceRemove(e):_e(DOMPurify.removed)}catch(e){}}}_executeHooks(S.afterSanitizeAttributes,e,null)},dt=function _sanitizeShadowDOM(e){let t=null;const r=_createNodeIterator(e);for(_executeHooks(S.beforeSanitizeShadowDOM,e,null);t=r.nextNode();)_executeHooks(S.uponSanitizeShadowNode,t,null),_sanitizeElements(t),_sanitizeAttributes(t),t.content instanceof o&&_sanitizeShadowDOM(t.content);_executeHooks(S.afterSanitizeShadowDOM,e,null)};return DOMPurify.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,a=null,c=null,s=null;if($e=!e,$e&&(e="\x3c!--\x3e"),"string"!=typeof e&&!_isNode(e)){if("function"!=typeof e.toString)throw Pe("toString is not a function");if("string"!=typeof(e=e.toString()))throw Pe("dirty is not a string, aborting")}if(!DOMPurify.isSupported)return e;if(Z||_parseConfig(t),DOMPurify.removed=[],"string"==typeof e&&(ie=!1),ie){if(e.nodeName){const t=lt(e.nodeName);if(!M[t]||U[t])throw Pe("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof i)n=_initDocument("\x3c!----\x3e"),a=n.ownerDocument.importNode(e,!0),a.nodeType===et&&"BODY"===a.nodeName||"HTML"===a.nodeName?n=a:n.appendChild(a);else{if(!J&&!X&&!q&&-1===e.indexOf("<"))return _&&te?_.createHTML(e):e;if(n=_initDocument(e),!n)return J?null:te?b:""}n&&Q&&_forceRemove(n.firstChild);const l=_createNodeIterator(ie?e:n);for(;c=l.nextNode();)_sanitizeElements(c),_sanitizeAttributes(c),c.content instanceof o&&dt(c.content);if(ie)return e;if(J){if(ee)for(s=E.call(n.ownerDocument);n.firstChild;)s.appendChild(n.firstChild);else s=n;return(j.shadowroot||j.shadowrootmode)&&(s=k.call(r,s,!0)),s}let u=q?n.outerHTML:n.innerHTML;return q&&M["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&Le(Ze,n.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+u),X&&ve([A,I,L],(e=>{u=ke(u,e," ")})),_&&te?_.createHTML(u):u},DOMPurify.setConfig=function(){_parseConfig(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Z=!0},DOMPurify.clearConfig=function(){ut=null,Z=!1},DOMPurify.isValidAttribute=function(e,t,r){ut||_parseConfig({});const n=lt(e),o=lt(t);return _isValidAttribute(n,o,r)},DOMPurify.addHook=function(e,t){"function"==typeof t&&be(S[e],t)},DOMPurify.removeHook=function(e,t){if(void 0!==t){const r=me(S[e],t);return-1===r?void 0:xe(S[e],r,1)[0]}return _e(S[e])},DOMPurify.removeHooks=function(e){S[e]=[]},DOMPurify.removeAllHooks=function(){S={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},DOMPurify}();function $(e){return document.getElementById(e)}const st={translationForm:$("translationForm"),sourceText:$("sourceText"),translationResult:$("translationResult"),sourceContainer:null===(at=$("sourceText"))||void 0===at?void 0:at.parentElement,resultContainer:null===(it=$("translationResult"))||void 0===it?void 0:it.parentElement,sourceLanguageInput:$("sourceLanguageInput"),targetLanguageInput:$("targetLanguageInput"),sourceLanguagesList:$("sourceLanguagesList"),targetLanguagesList:$("targetLanguagesList"),clearSourceLanguage:$("clearSourceLanguage"),clearTargetLanguage:$("clearTargetLanguage"),swapLanguagesBtn:$("swapLanguagesBtn"),translateBtn:$("translateBtn"),copySourceBtn:$("copySourceBtn"),pasteSourceBtn:$("pasteSourceBtn"),voiceSourceIcon:$("voiceSourceIcon"),copyTargetBtn:$("copyTargetBtn"),voiceTargetIcon:$("voiceTargetIcon"),translatePageLink:$("translatePageLink"),selectElementIcon:$("selectElementIcon"),clearStorageBtn:$("clearStorageBtn"),revertIcon:$("revertActionIcon"),settingsIcon:$("settingsIcon"),popupContainer:document.body,$};function toggleClearButtonVisibility(e,t){var r=null==e?void 0:e.parentElement;r&&t&&r.classList.toggle("has-value",!!e.value)}function toggleInlineToolbarVisibility(e){var t=null==e?void 0:e.parentElement;if(t){var r=(e.value||e.textContent||"").trim();t.classList.toggle("has-content",r&&r!==i18n_getTranslationString("popup_string_during_translate")||"در حال ترجمه...")}}function showVisualFeedback(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(e){var r="feedback-".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success");e.classList.add(r),setTimeout((function(){e.classList.remove(r)}),t)}}var lt="Auto Detect";function getLanguageCode(e){if(!e)return null;var t=e.trim();if(t===lt)return lt;var r=U.find((function(e){return e.name===t||e.promptName===t||e.voiceCode===t}));return r?r.voiceCode:null}function languageManager_typeof(e){return languageManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},languageManager_typeof(e)}function languageManager_regeneratorRuntime(){languageManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==languageManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(languageManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function languageManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function languageManager_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){languageManager_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){languageManager_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function getLanguagePromptName(e){if(!e)return null;var t=e.trim();if(t===lt)return lt;var r=U.find((function(e){return e.name===t||e.promptName===t}));return r?r.promptName||r.name:null}function getLanguageDisplayValue(e){if(!e||e===lt)return lt;var t=U.find((function(t){return t.code===e||t.name===e||t.promptName===e}));return t?t.promptName||t.name:""}function populateLists(){if(U.forEach((function(e){var t,r=document.createElement("option");if(r.value=e.promptName||e.name,null===(t=st.sourceLanguagesList)||void 0===t||t.appendChild(r),e.code!==lt){var n,o=document.createElement("option");o.value=e.promptName||e.name,null===(n=st.targetLanguagesList)||void 0===n||n.appendChild(o)}})),!U.some((function(e){return e.name===lt||e.promptName===lt}))){var e,t=document.createElement("option");t.value=lt,null===(e=st.sourceLanguagesList)||void 0===e||e.prepend(t)}}function setInitialValues(){return _setInitialValues.apply(this,arguments)}function _setInitialValues(){return(_setInitialValues=languageManager_asyncToGenerator(languageManager_regeneratorRuntime().mark((function _callee2(){var e;return languageManager_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return st.sourceLanguageInput.value=lt,toggleClearButtonVisibility(st.sourceLanguageInput,st.clearSourceLanguage),t.prev=2,t.next=5,F();case 5:e=t.sent,st.targetLanguageInput.value=getLanguageDisplayValue(e)||getLanguageDisplayValue("en"),t.next=13;break;case 9:t.prev=9,t.t0=t["catch"](2),helpers_logME("[LangManager]: Error getting target language:",t.t0),st.targetLanguageInput.value=getLanguageDisplayValue("en");case 13:return t.prev=13,toggleClearButtonVisibility(st.targetLanguageInput,st.clearTargetLanguage),t.finish(13);case 16:case"end":return t.stop()}}),_callee2,null,[[2,9,13,16]])})))).apply(this,arguments)}function handleLanguageInputClick(e){null==e||e.focus()}function init(){return _init.apply(this,arguments)}function _init(){return(_init=languageManager_asyncToGenerator(languageManager_regeneratorRuntime().mark((function _callee3(){return languageManager_regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return populateLists(),e.next=3,setInitialValues();case 3:t=void 0,r=void 0,n=void 0,o=void 0,a=void 0,i=void 0,c=void 0,null===(t=st.sourceLanguageInput)||void 0===t||t.addEventListener("click",(function(){return handleLanguageInputClick(st.sourceLanguageInput)})),null===(r=st.targetLanguageInput)||void 0===r||r.addEventListener("click",(function(){return handleLanguageInputClick(st.targetLanguageInput)})),null===(n=st.clearSourceLanguage)||void 0===n||n.addEventListener("click",(function(){st.sourceLanguageInput.value="",toggleClearButtonVisibility(st.sourceLanguageInput,st.clearSourceLanguage),st.sourceLanguageInput.focus()})),null===(o=st.clearTargetLanguage)||void 0===o||o.addEventListener("click",(function(){st.targetLanguageInput.value="",toggleClearButtonVisibility(st.targetLanguageInput,st.clearTargetLanguage),st.targetLanguageInput.focus()})),null===(a=st.sourceLanguageInput)||void 0===a||a.addEventListener("input",(function(){return toggleClearButtonVisibility(st.sourceLanguageInput,st.clearSourceLanguage)})),null===(i=st.targetLanguageInput)||void 0===i||i.addEventListener("input",(function(){return toggleClearButtonVisibility(st.targetLanguageInput,st.clearTargetLanguage)})),null===(c=st.swapLanguagesBtn)||void 0===c||c.addEventListener("click",languageManager_asyncToGenerator(languageManager_regeneratorRuntime().mark((function _callee(){var e,t,r,n,o,a,i,c,s,l;return languageManager_regeneratorRuntime().wrap((function(u){for(;1;)switch(u.prev=u.next){case 0:if(e=st.sourceLanguageInput.value,t=st.targetLanguageInput.value,r=getLanguageCode(e),n=getLanguageCode(t),o=r,a=n,r!==lt){u.next=16;break}return u.prev=7,u.next=10,M();case 10:o=u.sent,u.next=16;break;case 13:u.prev=13,u.t0=u["catch"](7),helpers_logME("[LangManager]: Failed to load source language from settings",u.t0);case 16:if(n!==lt){u.next=26;break}return u.prev=17,u.next=20,F();case 20:a=u.sent,u.next=26;break;case 23:u.prev=23,u.t1=u["catch"](17),helpers_logME("[LangManager]: Failed to load target language from settings",u.t1);case 26:if(!o||!a){u.next=52;break}if(i=getLanguageDisplayValue(a),c=getLanguageDisplayValue(o),st.sourceLanguageInput.value=i||t,st.targetLanguageInput.value=c||e,toggleClearButtonVisibility(st.sourceLanguageInput,st.clearSourceLanguage),toggleClearButtonVisibility(st.targetLanguageInput,st.clearTargetLanguage),s=st.sourceText.value,l=st.translationResult.textContent,u.t2=l,!u.t2){u.next=42;break}return u.t3=l,u.next=40,i18n_getTranslationString("popup_string_during_translate");case 40:u.t4=u.sent,u.t2=u.t3!==u.t4;case 42:if(!u.t2){u.next=50;break}st.sourceText.value=l,st.translationResult.textContent=s,correctTextDirection(st.sourceText,l),correctTextDirection(st.translationResult,s),toggleInlineToolbarVisibility(st.sourceText),toggleInlineToolbarVisibility(st.translationResult),document.dispatchEvent(new CustomEvent("translationSwapped"));case 50:u.next=54;break;case 52:helpers_logME("[LangManager]: Cannot swap - invalid language selection.",{sourceCode:r,targetCode:n}),st.swapLanguagesBtn&&showVisualFeedback(st.swapLanguagesBtn,"error",500);case 54:case"end":return u.stop()}}),_callee,null,[[7,13],[17,23]])})))),helpers_logME("[LangManager]: Initialized.");case 5:case"end":return e.stop()}var t,r,n,o,a,i,c}),_callee3)})))).apply(this,arguments)}function clipboardManager_typeof(e){return clipboardManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},clipboardManager_typeof(e)}function clipboardManager_regeneratorRuntime(){clipboardManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==clipboardManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(clipboardManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function clipboardManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function clipboardManager_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){clipboardManager_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){clipboardManager_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}var ut=!1;function hasClipboardReadPermission(){return _hasClipboardReadPermission.apply(this,arguments)}function _hasClipboardReadPermission(){return(_hasClipboardReadPermission=clipboardManager_asyncToGenerator(clipboardManager_regeneratorRuntime().mark((function _callee4(){return clipboardManager_regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.readText();case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e["catch"](0),helpers_logME("[Clipboard]: Clipboard read permission denied.",e.t0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),_callee4,null,[[0,6]])})))).apply(this,arguments)}function updatePasteButtonVisibility(){return _updatePasteButtonVisibility.apply(this,arguments)}function _updatePasteButtonVisibility(){return(_updatePasteButtonVisibility=clipboardManager_asyncToGenerator(clipboardManager_regeneratorRuntime().mark((function _callee5(){var e,t;return clipboardManager_regeneratorRuntime().wrap((function(r){for(;1;)switch(r.prev=r.next){case 0:if(e=st.pasteSourceBtn){r.next=3;break}return r.abrupt("return");case 3:if(e.classList.add("hidden-by-clipboard"),!ut||document.hasFocus()){r.next=7;break}return helpers_logME("[Clipboard]: Visibility check deferred until window focus."),r.abrupt("return");case 7:if(navigator.clipboard&&navigator.clipboard.readText){r.next=10;break}return helpers_logME("[Clipboard]: Clipboard API unavailable."),r.abrupt("return");case 10:return r.prev=10,r.next=13,navigator.clipboard.readText();case 13:t=r.sent,ut=!1,null!=t&&t.trim()?(e.classList.remove("hidden-by-clipboard"),helpers_logME("[Clipboard]: Clipboard has text, showing Paste button.")):helpers_logME("[Clipboard]: Clipboard empty or no text, hiding Paste button."),r.next=21;break;case 18:r.prev=18,r.t0=r["catch"](10),"NotAllowedError"!==r.t0.name||document.hasFocus()||ut?(helpers_logME("[Clipboard]: Error reading clipboard.",r.t0),ut=!1):(ut=!0,helpers_logME("[Clipboard]: Permission error; deferring until focus."),window.addEventListener("focus",updatePasteButtonVisibility,{once:!0}));case 21:case"end":return r.stop()}}),_callee5,null,[[10,18]])})))).apply(this,arguments)}function clipboardManager_init(){return popup_clipboardManager_init.apply(this,arguments)}function popup_clipboardManager_init(){return(popup_clipboardManager_init=clipboardManager_asyncToGenerator(clipboardManager_regeneratorRuntime().mark((function _callee6(){return clipboardManager_regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return t=void 0,r=void 0,n=void 0,null===(t=st.copySourceBtn)||void 0===t||t.addEventListener("click",clipboardManager_asyncToGenerator(clipboardManager_regeneratorRuntime().mark((function _callee(){var e,t;return clipboardManager_regeneratorRuntime().wrap((function(r){for(;1;)switch(r.prev=r.next){case 0:if(e=st.sourceText.value){r.next=3;break}return r.abrupt("return");case 3:return r.prev=3,r.next=6,navigator.clipboard.writeText(e);case 6:helpers_logME("[Clipboard]: Source text copied successfully."),null===(t=st.pasteSourceBtn)||void 0===t||t.classList.remove("hidden-by-clipboard"),showVisualFeedback(st.copySourceBtn),r.next=15;break;case 11:r.prev=11,r.t0=r["catch"](3),helpers_logME("[Clipboard]: Failed to copy source text.",r.t0),showVisualFeedback(st.copySourceBtn,"error");case 15:case"end":return r.stop()}}),_callee,null,[[3,11]])})))),null===(r=st.pasteSourceBtn)||void 0===r||r.addEventListener("click",clipboardManager_asyncToGenerator(clipboardManager_regeneratorRuntime().mark((function _callee2(){var e;return clipboardManager_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,hasClipboardReadPermission();case 2:if(t.sent){t.next=6;break}return showVisualFeedback(st.pasteSourceBtn,"error"),st.pasteSourceBtn.classList.add("hidden-by-clipboard"),t.abrupt("return");case 6:return t.prev=6,t.next=9,navigator.clipboard.readText();case 9:return(e=t.sent)&&(st.sourceText.value=e,st.sourceText.dispatchEvent(new Event("input",{bubbles:!0})),st.sourceText.focus()),t.next=13,updatePasteButtonVisibility();case 13:t.next=20;break;case 15:t.prev=15,t.t0=t["catch"](6),helpers_logME("[Clipboard]: Error pasting text.",t.t0),showVisualFeedback(st.pasteSourceBtn,"error"),st.pasteSourceBtn.classList.add("hidden-by-clipboard");case 20:case"end":return t.stop()}}),_callee2,null,[[6,15]])})))),null===(n=st.copyTargetBtn)||void 0===n||n.addEventListener("click",clipboardManager_asyncToGenerator(clipboardManager_regeneratorRuntime().mark((function _callee3(){var e,t;return clipboardManager_regeneratorRuntime().wrap((function(r){for(;1;)switch(r.prev=r.next){case 0:if(e=st.translationResult.textContent,r.t0=!e,r.t0){r.next=8;break}return r.t1=e,r.next=6,i18n_getTranslationString("popup_string_during_translate");case 6:r.t2=r.sent,r.t0=r.t1===r.t2;case 8:if(!r.t0){r.next=10;break}return r.abrupt("return");case 10:return r.prev=10,r.next=13,navigator.clipboard.writeText(e);case 13:helpers_logME("[Clipboard]: Translation copied successfully."),null===(t=st.pasteSourceBtn)||void 0===t||t.classList.remove("hidden-by-clipboard"),showVisualFeedback(st.copyTargetBtn),r.next=22;break;case 18:r.prev=18,r.t3=r["catch"](10),helpers_logME("[Clipboard]: Failed to copy translation.",r.t3),showVisualFeedback(st.copyTargetBtn,"error");case 22:case"end":return r.stop()}}),_callee3,null,[[10,18]])})))),document.addEventListener("translationSwapped",updatePasteButtonVisibility),e.next=3,updatePasteButtonVisibility();case 3:helpers_logME("[Clipboard]: Clipboard manager initialized.");case 4:case"end":return e.stop()}var t,r,n}),_callee6)})))).apply(this,arguments)}function ttsManager_typeof(e){return ttsManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ttsManager_typeof(e)}function ttsManager_regeneratorRuntime(){ttsManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==ttsManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(ttsManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function ttsManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function ttsManager_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){ttsManager_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){ttsManager_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function ttsManager_init(){var e,r,n,o,a,i;e=document.querySelector("#sourceLanguageInput"),r=document.querySelector("#targetLanguageInput"),n=document.querySelector("#voiceSourceIcon"),o=document.querySelector("#voiceTargetIcon"),a=document.querySelector("#sourceText"),i=document.querySelector("#translationResult"),null==n||n.addEventListener("click",ttsManager_asyncToGenerator(ttsManager_regeneratorRuntime().mark((function _callee(){var r,n,o;return ttsManager_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(r=null==a?void 0:a.value.trim()){i.next=4;break}return a.focus(),i.abrupt("return");case 4:return i.prev=4,n=(null==e?void 0:e.value)||lt,i.next=8,t().runtime.sendMessage({action:"speak",text:r,lang:n});case 8:(o=i.sent)?o.success?helpers_logME("[Popup TTS]: TTS playback started."):helpers_logME("[Popup TTS]: TTS error:",o.error):helpers_logME("[Popup TTS]: No response from background."),i.next=15;break;case 12:i.prev=12,i.t0=i["catch"](4),helpers_logME("[Popup TTS]: Error sending message:",i.t0);case 15:case"end":return i.stop()}}),_callee,null,[[4,12]])})))),null==o||o.addEventListener("click",ttsManager_asyncToGenerator(ttsManager_regeneratorRuntime().mark((function _callee2(){var e,n,o,a;return ttsManager_regeneratorRuntime().wrap((function(c){for(;1;)switch(c.prev=c.next){case 0:if(n=null==i||null===(e=i.textContent)||void 0===e?void 0:e.trim()){c.next=4;break}return i.scrollIntoView({behavior:"smooth",block:"center"}),c.abrupt("return");case 4:return c.prev=4,o=(null==r?void 0:r.value)||lt,c.next=8,t().runtime.sendMessage({action:"speak",text:n,lang:o});case 8:(a=c.sent)?a.success?helpers_logME("[Popup TTS]: TTS playback started for target text."):helpers_logME("[Popup TTS]: TTS error (target):",a.error):helpers_logME("[Popup TTS]: No response from background."),c.next=15;break;case 12:c.prev=12,c.t0=c["catch"](4),helpers_logME("[Popup TTS]: Error sending message (target):",c.t0);case 15:case"end":return c.stop()}}),_callee2,null,[[4,12]])})))),helpers_logME("[Popup TTS]: Initialized.")}function _getDefaults(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let ft={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function changeDefaults(e){ft=e}const pt={exec:()=>null};function edit(e,t=""){let r="string"==typeof e?e:e.source;const n={replace:(e,t)=>{let o="string"==typeof t?t:t.source;return o=o.replace(ht.caret,"$1"),r=r.replace(e,o),n},getRegex:()=>new RegExp(r,t)};return n}const ht={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},dt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,yt=/(?:[*+-]|\d{1,9}[.)])/,gt=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,vt=edit(gt).replace(/bull/g,yt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),mt=edit(gt).replace(/bull/g,yt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),_t=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,bt=/(?!\s*\])(?:\\.|[^\[\]\\])+/,xt=edit(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",bt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),wt=edit(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,yt).getRegex(),Et="address|article|aside|base|basefont|blockquote|body|caption"+"|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption"+"|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe"+"|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option"+"|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title"+"|tr|track|ul",Tt=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,kt=edit("^ {0,3}(?:"+"<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)"+"|comment[^\\n]*(\\n+|$)"+"|<\\?[\\s\\S]*?(?:\\?>\\n*|$)"+"|<![A-Z][\\s\\S]*?(?:>\\n*|$)"+"|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)"+"|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)"+"|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)"+"|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)"+")","i").replace("comment",Tt).replace("tag",Et).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),St=edit(_t).replace("hr",dt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Et).getRegex(),At={blockquote:edit(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",St).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:xt,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:dt,html:kt,lheading:vt,list:wt,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:St,table:pt,text:/^[^\n]+/},It=edit("^ *([^\\n ].*)\\n"+" {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)"+"(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",dt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Et).getRegex(),Lt={...At,lheading:mt,table:It,paragraph:edit(_t).replace("hr",dt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",It).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Et).getRegex()},Pt={...At,html:edit("^ *(?:comment *(?:\\n|\\s*$)"+"|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)"+"|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",Tt).replace(/tag/g,"(?!(?:"+"a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub"+"|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)"+"\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:pt,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:edit(_t).replace("hr",dt).replace("heading"," *#{1,6} *[^\n]").replace("lheading",vt).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Ot=/^( {2,}|\\)\n(?!\s*$)/,Gt=/[\p{P}\p{S}]/u,Ct=/[\s\p{P}\p{S}]/u,Rt=/[^\s\p{P}\p{S}]/u,Nt=edit(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Ct).getRegex(),Mt=/(?!~)[\p{P}\p{S}]/u,Ft=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,jt=edit(Ft,"u").replace(/punct/g,Gt).getRegex(),Dt=edit(Ft,"u").replace(/punct/g,Mt).getRegex(),Ht="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)"+"|[^*]+(?=[^*])"+"|(?!\\*)punct(\\*+)(?=[\\s]|$)"+"|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)"+"|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)"+"|[\\s](\\*+)(?!\\*)(?=punct)"+"|(?!\\*)punct(\\*+)(?!\\*)(?=punct)"+"|notPunctSpace(\\*+)(?=notPunctSpace)",Ut=edit(Ht,"gu").replace(/notPunctSpace/g,Rt).replace(/punctSpace/g,Ct).replace(/punct/g,Gt).getRegex(),Wt=edit(Ht,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,Mt).getRegex(),Bt=edit("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)"+"|[^_]+(?=[^_])"+"|(?!_)punct(_+)(?=[\\s]|$)"+"|notPunctSpace(_+)(?!_)(?=punctSpace|$)"+"|(?!_)punctSpace(_+)(?=notPunctSpace)"+"|[\\s](_+)(?!_)(?=punct)"+"|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Rt).replace(/punctSpace/g,Ct).replace(/punct/g,Gt).getRegex(),zt=edit(/\\(punct)/,"gu").replace(/punct/g,Gt).getRegex(),Yt=edit(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),$t=edit(Tt).replace("(?:--\x3e|$)","--\x3e").getRegex(),Vt=edit("^comment"+"|^</[a-zA-Z][\\w:-]*\\s*>"+"|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>"+"|^<\\?[\\s\\S]*?\\?>"+"|^<![a-zA-Z]+\\s[\\s\\S]*?>"+"|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",$t).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Xt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Kt=edit(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Xt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),qt=edit(/^!?\[(label)\]\[(ref)\]/).replace("label",Xt).replace("ref",bt).getRegex(),Zt=edit(/^!?\[(ref)\](?:\[\])?/).replace("ref",bt).getRegex(),Qt={_backpedal:pt,anyPunctuation:zt,autolink:Yt,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:Ot,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:pt,emStrongLDelim:jt,emStrongRDelimAst:Ut,emStrongRDelimUnd:Bt,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:Kt,nolink:Zt,punctuation:Nt,reflink:qt,reflinkSearch:edit("reflink|nolink(?!\\()","g").replace("reflink",qt).replace("nolink",Zt).getRegex(),tag:Vt,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:pt},Jt={...Qt,link:edit(/^!?\[(label)\]\((.*?)\)/).replace("label",Xt).getRegex(),reflink:edit(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Xt).getRegex()},er={...Qt,emStrongRDelimAst:Wt,emStrongLDelim:Dt,url:edit(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},tr={...er,br:edit(Ot).replace("{2,}","*").getRegex(),text:edit(er.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},rr={normal:At,gfm:Lt,pedantic:Pt},nr={normal:Qt,gfm:er,breaks:tr,pedantic:Jt},or={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},getEscapeReplacement=e=>or[e];function marked_esm_escape(e,t){if(t){if(ht.escapeTest.test(e))return e.replace(ht.escapeReplace,getEscapeReplacement)}else if(ht.escapeTestNoEncode.test(e))return e.replace(ht.escapeReplaceNoEncode,getEscapeReplacement);return e}function cleanUrl(e){try{e=encodeURI(e).replace(ht.percentDecode,"%")}catch{return null}return e}function splitCells(e,t){const r=e.replace(ht.findPipe,((e,t,r)=>{let n=!1,o=t;for(;--o>=0&&"\\"===r[o];)n=!n;return n?"|":" |"})).split(ht.splitPipe);let n=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;n<r.length;n++)r[n]=r[n].trim().replace(ht.slashPipe,"|");return r}function rtrim(e,t,r){const n=e.length;if(0===n)return"";let o=0;for(;o<n;){if(e.charAt(n-o-1)!==t||!1)break;o++}return e.slice(0,n-o)}function outputLink(e,t,r,n,o){const a=t.href,i=t.title||null,c=e[1].replace(o.other.outputLinkReplace,"$1");if("!"!==e[0].charAt(0)){n.state.inLink=!0;const e={type:"link",raw:r,href:a,title:i,text:c,tokens:n.inlineTokens(c)};return n.state.inLink=!1,e}return{type:"image",raw:r,href:a,title:i,text:c}}class _Tokenizer{options;rules;lexer;constructor(e){this.options=e||ft}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:rtrim(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],r=function(e,t,r){const n=e.match(r.other.indentCodeCompensation);if(null===n)return t;const o=n[1];return t.split("\n").map((e=>{const t=e.match(r.other.beginningSpace);if(null===t)return e;const[n]=t;return n.length>=o.length?e.slice(o.length):e})).join("\n")}(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){const t=rtrim(e,"#");this.options.pedantic?e=t.trim():t&&!this.rules.other.endingSpaceChar.test(t)||(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:rtrim(t[0],"\n")}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let e=rtrim(t[0],"\n").split("\n"),r="",n="";const o=[];for(;e.length>0;){let t=!1;const a=[];let i;for(i=0;i<e.length;i++)if(this.rules.other.blockquoteStart.test(e[i]))a.push(e[i]),t=!0;else{if(t)break;a.push(e[i])}e=e.slice(i);const c=a.join("\n"),s=c.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}\n${c}`:c,n=n?`${n}\n${s}`:s;const l=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(s,o,!0),this.lexer.state.top=l,0===e.length)break;const u=o.at(-1);if("code"===u?.type)break;if("blockquote"===u?.type){const t=u,a=t.raw+"\n"+e.join("\n"),i=this.blockquote(a);o[o.length-1]=i,r=r.substring(0,r.length-t.raw.length)+i.raw,n=n.substring(0,n.length-t.text.length)+i.text;break}if("list"!==u?.type);else{const t=u,a=t.raw+"\n"+e.join("\n"),i=this.list(a);o[o.length-1]=i,r=r.substring(0,r.length-u.raw.length)+i.raw,n=n.substring(0,n.length-t.raw.length)+i.raw,e=a.substring(o.at(-1).raw.length).split("\n")}}return{type:"blockquote",raw:r,tokens:o,text:n}}}list(e){let t=this.rules.block.list.exec(e);if(t){let r=t[1].trim();const n=r.length>1,o={type:"list",raw:"",ordered:n,start:n?+r.slice(0,-1):"",loose:!1,items:[]};r=n?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=n?r:"[*+-]");const a=this.rules.other.listItemRegex(r);let i=!1;for(;e;){let r=!1,n="",c="";if(!(t=a.exec(e)))break;if(this.rules.block.hr.test(e))break;n=t[0],e=e.substring(n.length);let s=t[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,(e=>" ".repeat(3*e.length))),l=e.split("\n",1)[0],u=!s.trim(),f=0;if(this.options.pedantic?(f=2,c=s.trimStart()):u?f=t[1].length+1:(f=t[2].search(this.rules.other.nonSpaceChar),f=f>4?1:f,c=s.slice(f),f+=t[1].length),u&&this.rules.other.blankLine.test(l)&&(n+=l+"\n",e=e.substring(l.length+1),r=!0),!r){const t=this.rules.other.nextBulletRegex(f),r=this.rules.other.hrRegex(f),o=this.rules.other.fencesBeginRegex(f),a=this.rules.other.headingBeginRegex(f),i=this.rules.other.htmlBeginRegex(f);for(;e;){const p=e.split("\n",1)[0];let h;if(l=p,this.options.pedantic?(l=l.replace(this.rules.other.listReplaceNesting,"  "),h=l):h=l.replace(this.rules.other.tabCharGlobal,"    "),o.test(l))break;if(a.test(l))break;if(i.test(l))break;if(t.test(l))break;if(r.test(l))break;if(h.search(this.rules.other.nonSpaceChar)>=f||!l.trim())c+="\n"+h.slice(f);else{if(u)break;if(s.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(o.test(s))break;if(a.test(s))break;if(r.test(s))break;c+="\n"+l}u||l.trim()||(u=!0),n+=p+"\n",e=e.substring(p.length+1),s=h.slice(f)}}o.loose||(i?o.loose=!0:this.rules.other.doubleBlankLine.test(n)&&(i=!0));let p,h=null;this.options.gfm&&(h=this.rules.other.listIsTask.exec(c),h&&(p="[ ] "!==h[0],c=c.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:n,task:!!h,checked:p,loose:!1,text:c,tokens:[]}),o.raw+=n}const c=o.items.at(-1);if(!c)return;c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd(),o.raw=o.raw.trimEnd();for(let e=0;e<o.items.length;e++)if(this.lexer.state.top=!1,o.items[e].tokens=this.lexer.blockTokens(o.items[e].text,[]),!o.loose){const t=o.items[e].tokens.filter((e=>"space"===e.type)),r=t.length>0&&t.some((e=>this.rules.other.anyLine.test(e.raw)));o.loose=r}if(o.loose)for(let e=0;e<o.items.length;e++)o.items[e].loose=!0;return o}}html(e){const t=this.rules.block.html.exec(e);if(t){return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",n=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:r,title:n}}}table(e){const t=this.rules.block.table.exec(e);if(!t)return;if(!this.rules.other.tableDelimiter.test(t[2]))return;const r=splitCells(t[1]),n=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(r.length===n.length){for(const e of n)this.rules.other.tableAlignRight.test(e)?a.align.push("right"):this.rules.other.tableAlignCenter.test(e)?a.align.push("center"):this.rules.other.tableAlignLeft.test(e)?a.align.push("left"):a.align.push(null);for(let e=0;e<r.length;e++)a.header.push({text:r[e],tokens:this.lexer.inline(r[e]),header:!0,align:a.align[e]});for(const e of o)a.rows.push(splitCells(e,a.header.length).map(((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:a.align[t]}))));return a}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;const t=rtrim(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let r=0;for(let n=0;n<e.length;n++)if("\\"===e[n])n++;else if(e[n]===t[0])r++;else if(e[n]===t[1]&&(r--,r<0))return n;return-1}(t[2],"()");if(e>-1){const r=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,r).trim(),t[3]=""}}let r=t[2],n="";if(this.options.pedantic){const e=this.rules.other.pedanticHrefTitle.exec(r);e&&(r=e[1],n=e[3])}else n=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(r=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?r.slice(1):r.slice(1,-1)),outputLink(t,{href:r?r.replace(this.rules.inline.anyPunctuation,"$1"):r,title:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n},t[0],this.lexer,this.rules)}}reflink(e,t){let r;if((r=this.rules.inline.reflink.exec(e))||(r=this.rules.inline.nolink.exec(e))){const e=t[(r[2]||r[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){const e=r[0].charAt(0);return{type:"text",raw:e,text:e}}return outputLink(r,e,r[0],this.lexer,this.rules)}}emStrong(e,t,r=""){let n=this.rules.inline.emStrongLDelim.exec(e);if(!n)return;if(n[3]&&r.match(this.rules.other.unicodeAlphaNumeric))return;if(!(n[1]||n[2]||"")||!r||this.rules.inline.punctuation.exec(r)){const r=[...n[0]].length-1;let o,a,i=r,c=0;const s="*"===n[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(s.lastIndex=0,t=t.slice(-1*e.length+r);null!=(n=s.exec(t));){if(o=n[1]||n[2]||n[3]||n[4]||n[5]||n[6],!o)continue;if(a=[...o].length,n[3]||n[4]){i+=a;continue}if((n[5]||n[6])&&r%3&&!((r+a)%3)){c+=a;continue}if(i-=a,i>0)continue;a=Math.min(a,a+i+c);const t=[...n[0]][0].length,s=e.slice(0,r+n.index+t+a);if(Math.min(r,a)%2){const e=s.slice(1,-1);return{type:"em",raw:s,text:e,tokens:this.lexer.inlineTokens(e)}}const l=s.slice(2,-2);return{type:"strong",raw:s,text:l,tokens:this.lexer.inlineTokens(l)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," ");const r=this.rules.other.nonSpaceChar.test(e),n=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return r&&n&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let e,r;return"@"===t[2]?(e=t[1],r="mailto:"+e):(e=t[1],r=e),{type:"link",raw:t[0],text:e,href:r,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,r;if("@"===t[2])e=t[0],r="mailto:"+e;else{let n;do{n=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??""}while(n!==t[0]);e=t[0],r="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:r,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}}class _Lexer{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||ft,this.options.tokenizer=this.options.tokenizer||new _Tokenizer,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:ht,block:rr.normal,inline:nr.normal};this.options.pedantic?(t.block=rr.pedantic,t.inline=nr.pedantic):this.options.gfm&&(t.block=rr.gfm,this.options.breaks?t.inline=nr.breaks:t.inline=nr.gfm),this.tokenizer.rules=t}static get rules(){return{block:rr,inline:nr}}static lex(e,t){return new _Lexer(t).lex(e)}static lexInline(e,t){return new _Lexer(t).inlineTokens(e)}lex(e){e=e.replace(ht.carriageReturn,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(ht.tabCharGlobal,"    ").replace(ht.spaceLine,""));e;){let n;if(this.options.extensions?.block?.some((r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))continue;if(n=this.tokenizer.space(e)){e=e.substring(n.raw.length);const r=t.at(-1);1===n.raw.length&&void 0!==r?r.raw+="\n":t.push(n);continue}if(n=this.tokenizer.code(e)){e=e.substring(n.raw.length);const r=t.at(-1);"paragraph"===r?.type||"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.at(-1).src=r.text):t.push(n);continue}if(n=this.tokenizer.fences(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.heading(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.hr(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.blockquote(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.list(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.html(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.def(e)){e=e.substring(n.raw.length);const r=t.at(-1);"paragraph"===r?.type||"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.raw,this.inlineQueue.at(-1).src=r.text):this.tokens.links[n.tag]||(this.tokens.links[n.tag]={href:n.href,title:n.title});continue}if(n=this.tokenizer.table(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.lheading(e)){e=e.substring(n.raw.length),t.push(n);continue}let o=e;if(this.options.extensions?.startBlock){let t=1/0;const r=e.slice(1);let n;this.options.extensions.startBlock.forEach((e=>{n=e.call({lexer:this},r),"number"==typeof n&&n>=0&&(t=Math.min(t,n))})),t<1/0&&t>=0&&(o=e.substring(0,t+1))}if(this.state.top&&(n=this.tokenizer.paragraph(o))){const a=t.at(-1);r&&"paragraph"===a?.type?(a.raw+="\n"+n.raw,a.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(n),r=o.length!==e.length,e=e.substring(n.raw.length)}else if(n=this.tokenizer.text(e)){e=e.substring(n.raw.length);const r=t.at(-1);"text"===r?.type?(r.raw+="\n"+n.raw,r.text+="\n"+n.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=r.text):t.push(n)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,n=null;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(n=this.tokenizer.rules.inline.reflinkSearch.exec(r));)e.includes(n[0].slice(n[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(n=this.tokenizer.rules.inline.blockSkip.exec(r));)r=r.slice(0,n.index)+"["+"a".repeat(n[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(n=this.tokenizer.rules.inline.anyPunctuation.exec(r));)r=r.slice(0,n.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let o=!1,a="";for(;e;){let n;if(o||(a=""),o=!1,this.options.extensions?.inline?.some((r=>!!(n=r.call({lexer:this},e,t))&&(e=e.substring(n.raw.length),t.push(n),!0))))continue;if(n=this.tokenizer.escape(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.tag(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.link(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(n.raw.length);const r=t.at(-1);"text"===n.type&&"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):t.push(n);continue}if(n=this.tokenizer.emStrong(e,r,a)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.codespan(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.br(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.del(e)){e=e.substring(n.raw.length),t.push(n);continue}if(n=this.tokenizer.autolink(e)){e=e.substring(n.raw.length),t.push(n);continue}if(!this.state.inLink&&(n=this.tokenizer.url(e))){e=e.substring(n.raw.length),t.push(n);continue}let i=e;if(this.options.extensions?.startInline){let t=1/0;const r=e.slice(1);let n;this.options.extensions.startInline.forEach((e=>{n=e.call({lexer:this},r),"number"==typeof n&&n>=0&&(t=Math.min(t,n))})),t<1/0&&t>=0&&(i=e.substring(0,t+1))}if(n=this.tokenizer.inlineText(i)){e=e.substring(n.raw.length),"_"!==n.raw.slice(-1)&&(a=n.raw.slice(-1)),o=!0;const r=t.at(-1);"text"===r?.type?(r.raw+=n.raw,r.text+=n.text):t.push(n)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return t}}class _Renderer{options;parser;constructor(e){this.options=e||ft}space(e){return""}code({text:e,lang:t,escaped:r}){const n=(t||"").match(ht.notSpaceStart)?.[0],o=e.replace(ht.endingNewline,"")+"\n";return n?'<pre><code class="language-'+marked_esm_escape(n)+'">'+(r?o:marked_esm_escape(o,!0))+"</code></pre>\n":"<pre><code>"+(r?o:marked_esm_escape(o,!0))+"</code></pre>\n"}blockquote({tokens:e}){return`<blockquote>\n${this.parser.parse(e)}</blockquote>\n`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>\n`}hr(e){return"<hr>\n"}list(e){const t=e.ordered,r=e.start;let n="";for(let t=0;t<e.items.length;t++){const r=e.items[t];n+=this.listitem(r)}const o=t?"ol":"ul";return"<"+o+(t&&1!==r?' start="'+r+'"':"")+">\n"+n+"</"+o+">\n"}listitem(e){let t="";if(e.task){const r=this.checkbox({checked:!!e.checked});e.loose?"paragraph"===e.tokens[0]?.type?(e.tokens[0].text=r+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=r+" "+marked_esm_escape(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>\n`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>\n`}table(e){let t="",r="";for(let t=0;t<e.header.length;t++)r+=this.tablecell(e.header[t]);t+=this.tablerow({text:r});let n="";for(let t=0;t<e.rows.length;t++){const o=e.rows[t];r="";for(let e=0;e<o.length;e++)r+=this.tablecell(o[e]);n+=this.tablerow({text:r})}return n&&(n=`<tbody>${n}</tbody>`),"<table>\n"+"<thead>\n"+t+"</thead>\n"+n+"</table>\n"}tablerow({text:e}){return`<tr>\n${e}</tr>\n`}tablecell(e){const t=this.parser.parseInline(e.tokens),r=e.header?"th":"td";return(e.align?`<${r} align="${e.align}">`:`<${r}>`)+t+`</${r}>\n`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${marked_esm_escape(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:r}){const n=this.parser.parseInline(r),o=cleanUrl(e);if(null===o)return n;let a='<a href="'+(e=o)+'"';return t&&(a+=' title="'+marked_esm_escape(t)+'"'),a+=">"+n+"</a>",a}image({href:e,title:t,text:r}){const n=cleanUrl(e);if(null===n)return marked_esm_escape(r);let o=`<img src="${e=n}" alt="${r}"`;return t&&(o+=` title="${marked_esm_escape(t)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:marked_esm_escape(e.text)}}class _TextRenderer{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class _Parser{options;renderer;textRenderer;constructor(e){this.options=e||ft,this.options.renderer=this.options.renderer||new _Renderer,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new _TextRenderer}static parse(e,t){return new _Parser(t).parse(e)}static parseInline(e,t){return new _Parser(t).parseInline(e)}parse(e,t=!0){let r="";for(let n=0;n<e.length;n++){const o=e[n];if(this.options.extensions?.renderers?.[o.type]){const e=o,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){r+=t||"";continue}}const a=o;switch(a.type){case"space":r+=this.renderer.space(a);continue;case"hr":r+=this.renderer.hr(a);continue;case"heading":r+=this.renderer.heading(a);continue;case"code":r+=this.renderer.code(a);continue;case"table":r+=this.renderer.table(a);continue;case"blockquote":r+=this.renderer.blockquote(a);continue;case"list":r+=this.renderer.list(a);continue;case"html":r+=this.renderer.html(a);continue;case"paragraph":r+=this.renderer.paragraph(a);continue;case"text":{let o=a,i=this.renderer.text(o);for(;n+1<e.length&&"text"===e[n+1].type;)o=e[++n],i+="\n"+this.renderer.text(o);r+=t?this.renderer.paragraph({type:"paragraph",raw:i,text:i,tokens:[{type:"text",raw:i,text:i,escaped:!0}]}):i;continue}default:{const e='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return r}parseInline(e,t=this.renderer){let r="";for(let n=0;n<e.length;n++){const o=e[n];if(this.options.extensions?.renderers?.[o.type]){const e=this.options.extensions.renderers[o.type].call({parser:this},o);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){r+=e||"";continue}}const a=o;switch(a.type){case"escape":case"text":r+=t.text(a);break;case"html":r+=t.html(a);break;case"link":r+=t.link(a);break;case"image":r+=t.image(a);break;case"strong":r+=t.strong(a);break;case"em":r+=t.em(a);break;case"codespan":r+=t.codespan(a);break;case"br":r+=t.br(a);break;case"del":r+=t.del(a);break;default:{const e='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return r}}class _Hooks{options;block;constructor(e){this.options=e||ft}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?_Lexer.lex:_Lexer.lexInline}provideParser(){return this.block?_Parser.parse:_Parser.parseInline}}const ar=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=_Parser;Renderer=_Renderer;TextRenderer=_TextRenderer;Lexer=_Lexer;Tokenizer=_Tokenizer;Hooks=_Hooks;constructor(...e){this.use(...e)}walkTokens(e,t){let r=[];for(const n of e)switch(r=r.concat(t.call(this,n)),n.type){case"table":{const e=n;for(const n of e.header)r=r.concat(this.walkTokens(n.tokens,t));for(const n of e.rows)for(const e of n)r=r.concat(this.walkTokens(e.tokens,t));break}case"list":{const e=n;r=r.concat(this.walkTokens(e.items,t));break}default:{const e=n;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach((n=>{const o=e[n].flat(1/0);r=r.concat(this.walkTokens(o,t))})):e.tokens&&(r=r.concat(this.walkTokens(e.tokens,t)))}}return r}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach((e=>{const r={...e};if(r.async=this.defaults.async||r.async||!1,e.extensions&&(e.extensions.forEach((e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){const r=t.renderers[e.name];t.renderers[e.name]=r?function(...t){let n=e.renderer.apply(this,t);return!1===n&&(n=r.apply(this,t)),n}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");const r=t[e.level];r?r.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),r.extensions=t),e.renderer){const t=this.defaults.renderer||new _Renderer(this.defaults);for(const r in e.renderer){if(!(r in t))throw new Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;const n=r,o=e.renderer[n],a=t[n];t[n]=(...e)=>{let r=o.apply(t,e);return!1===r&&(r=a.apply(t,e)),r||""}}r.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new _Tokenizer(this.defaults);for(const r in e.tokenizer){if(!(r in t))throw new Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;const n=r,o=e.tokenizer[n],a=t[n];t[n]=(...e)=>{let r=o.apply(t,e);return!1===r&&(r=a.apply(t,e)),r}}r.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new _Hooks;for(const r in e.hooks){if(!(r in t))throw new Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;const n=r,o=e.hooks[n],a=t[n];_Hooks.passThroughHooks.has(r)?t[n]=e=>{if(this.defaults.async)return Promise.resolve(o.call(t,e)).then((e=>a.call(t,e)));const r=o.call(t,e);return a.call(t,r)}:t[n]=(...e)=>{let r=o.apply(t,e);return!1===r&&(r=a.apply(t,e)),r}}r.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens,n=e.walkTokens;r.walkTokens=function(e){let r=[];return r.push(n.call(this,e)),t&&(r=r.concat(t.call(this,e))),r}}this.defaults={...this.defaults,...r}})),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return _Lexer.lex(e,t??this.defaults)}parser(e,t){return _Parser.parse(e,t??this.defaults)}parseMarkdown(e){return(t,r)=>{const n={...r},o={...this.defaults,...n},a=this.onError(!!o.silent,!!o.async);if(!0===this.defaults.async&&!1===n.async)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==t)return a(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=e);const i=o.hooks?o.hooks.provideLexer():e?_Lexer.lex:_Lexer.lexInline,c=o.hooks?o.hooks.provideParser():e?_Parser.parse:_Parser.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(t):t).then((e=>i(e,o))).then((e=>o.hooks?o.hooks.processAllTokens(e):e)).then((e=>o.walkTokens?Promise.all(this.walkTokens(e,o.walkTokens)).then((()=>e)):e)).then((e=>c(e,o))).then((e=>o.hooks?o.hooks.postprocess(e):e)).catch(a);try{o.hooks&&(t=o.hooks.preprocess(t));let e=i(t,o);o.hooks&&(e=o.hooks.processAllTokens(e)),o.walkTokens&&this.walkTokens(e,o.walkTokens);let r=c(e,o);return o.hooks&&(r=o.hooks.postprocess(r)),r}catch(e){return a(e)}}}onError(e,t){return r=>{if(r.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+marked_esm_escape(r.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(r);throw r}}};function marked(e,t){return ar.parse(e,t)}marked.options=marked.setOptions=function(e){return ar.setOptions(e),marked.defaults=ar.defaults,changeDefaults(marked.defaults),marked},marked.getDefaults=_getDefaults,marked.defaults=ft,marked.use=function(...e){return ar.use(...e),marked.defaults=ar.defaults,changeDefaults(marked.defaults),marked},marked.walkTokens=function(e,t){return ar.walkTokens(e,t)},marked.parseInline=ar.parseInline,marked.Parser=_Parser,marked.parser=_Parser.parse,marked.Renderer=_Renderer,marked.TextRenderer=_TextRenderer,marked.Lexer=_Lexer,marked.lexer=_Lexer.lex,marked.Tokenizer=_Tokenizer,marked.Hooks=_Hooks,marked.parse=marked;marked.options,marked.setOptions,marked.use,marked.walkTokens,marked.parseInline,_Parser.parse,_Lexer.lex;var ir=new Set(["the","a","an","is","are","was","were","in","on","at","to","of","for","with","by","from"]),cr=30;function determineTranslationMode(e,t){return function(e){var t=e.trim(),r=t.split(/\s+/),n=t.length,o=1===r.length&&!ir.has(r[0].toLowerCase())&&n<=cr,a=r.length>1&&n<=cr;return o||a}(e)?a:t}function translationManager_typeof(e){return translationManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},translationManager_typeof(e)}function translationManager_regeneratorRuntime(){translationManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==translationManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(translationManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function translationManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function translationManager_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){translationManager_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){translationManager_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function extractErrorMessage(e){if(!e)return"";if("string"==typeof e)return e;if(e._originalMessage&&"string"==typeof e._originalMessage)return e._originalMessage;if("string"==typeof e.message)return e.message;try{return JSON.stringify(e)}catch(e){return""}}function handleTranslationResponse(e,t,r,n){return _handleTranslationResponse.apply(this,arguments)}function _handleTranslationResponse(){return _handleTranslationResponse=translationManager_asyncToGenerator(translationManager_regeneratorRuntime().mark((function _callee(e,r,n,o){var a,i,c,s,l,u,f,p,h,d,y,g,v;return translationManager_regeneratorRuntime().wrap((function(m){for(;1;)switch(m.prev=m.next){case 0:if(!t().runtime.lastError){m.next=6;break}return i=t().runtime.lastError.message,st.translationResult.textContent=i,correctTextDirection(st.translationResult,i),toggleInlineToolbarVisibility(st.translationResult),m.abrupt("return");case 6:if(null==e||!e.success||null===(a=e.data)||void 0===a||!a.translatedText){m.next=24;break}c=e.data.translatedText,st.translationResult.classList.remove("fade-in"),st.translationResult.offsetWidth,s=marked.parse(c),l=ct.sanitize(s,{RETURN_TRUSTED_TYPE:!0}),u=new DOMParser,f=u.parseFromString(l.toString(),"text/html"),st.translationResult.textContent="",Array.from(f.body.childNodes).forEach((function(e){st.translationResult.appendChild(e)})),st.translationResult.classList.add("fade-in"),correctTextDirection(st.translationResult,c),p=getLanguageCode(n),h=getLanguageCode(o),t().storage.local.set({lastTranslation:{sourceText:r,translatedText:c,sourceLanguage:p||lt,targetLanguage:h}}).then((function(){helpers_logME("[Translate]: Last translation saved to storage.")}))["catch"]((function(e){helpers_logME("[Translate]: Error saving last translation:",e)})),!e.data.detectedSourceLang||p&&p!==lt||(d=getLanguageDisplayValue(e.data.detectedSourceLang))&&(st.sourceLanguageInput.value=d,toggleClearButtonVisibility(st.sourceLanguageInput,st.clearSourceLanguage),helpers_logME("[Translate]: Source language updated to detected: ".concat(d))),m.next=37;break;case 24:return m.next=26,i18n_getTranslationString("popup_string_translate_error_response");case 26:if(m.t0=m.sent,m.t0){m.next=29;break}m.t0="(⚠️ خطایی در ترجمه رخ داد.)";case 29:y=m.t0,g=extractErrorMessage(null==e?void 0:e.error)||y,b=void 0,(v="string"!=typeof(_=g)?null:null!==(b=ee[_])&&void 0!==b?b:null)&&(g=v),st.translationResult.innerHTML="",st.translationResult.textContent=g,correctTextDirection(st.translationResult,g),helpers_logME("[Translate-Popup] API error:",g);case 37:toggleInlineToolbarVisibility(st.translationResult);case 38:case"end":return m.stop()}var _,b}),_callee)}))),_handleTranslationResponse.apply(this,arguments)}function triggerTranslation(){return _triggerTranslation.apply(this,arguments)}function _triggerTranslation(){return _triggerTranslation=translationManager_asyncToGenerator(translationManager_regeneratorRuntime().mark((function _callee2(){var e,r,n,o,a,c,s,l,u,f,p,h,d;return translationManager_regeneratorRuntime().wrap((function(y){for(;1;)switch(y.prev=y.next){case 0:if(e=st.sourceText.value.trim(),r=st.targetLanguageInput.value.trim(),n=st.sourceLanguageInput.value.trim(),e){y.next=7;break}return st.sourceText.focus(),helpers_logME("[Translate-Popup]: No text to translate."),y.abrupt("return");case 7:return correctTextDirection(st.sourceText,e),y.t0=textDetection_applyElementDirection,y.t1=st.translationResult,y.t2=parseBoolean,y.next=13,i18n_getTranslationString("IsRTL");case 13:if(y.t3=y.sent,y.t4=(0,y.t2)(y.t3),(0,y.t0)(y.t1,y.t4),r){y.next=21;break}return helpers_logME("[Translate-Popup]: Missing target language identifier."),st.targetLanguageInput.focus(),showVisualFeedback(st.targetLanguageInput.parentElement,"error",500),y.abrupt("return");case 21:if((o=getLanguagePromptName(r))&&o!==lt){y.next=27;break}return helpers_logME("[Translate-Popup]: Invalid target language selected:",r),st.targetLanguageInput.focus(),showVisualFeedback(st.targetLanguageInput.parentElement,"error",500),y.abrupt("return");case 27:return(a=getLanguagePromptName(n))&&a!==lt||(a=null),c='\n<div class="spinner-overlay">\n  <div class="spinner-center">\n    <div class="spinner"></div>\n  </div>\n</div>\n',s=ct.sanitize(c,{RETURN_TRUSTED_TYPE:!0}),l=new DOMParser,u=l.parseFromString(s.toString(),"text/html"),st.translationResult.textContent="",Array.from(u.body.childNodes).forEach((function(e){st.translationResult.appendChild(e)})),toggleInlineToolbarVisibility(st.translationResult),f=determineTranslationMode(e,i),y.prev=37,y.next=40,t().runtime.sendMessage({action:"fetchTranslation",payload:{promptText:e,sourceLanguage:a,targetLanguage:o,translateMode:f}});case 40:return p=y.sent,helpers_logME("[Translate-Popup]: Response from background:",p),y.next=44,handleTranslationResponse(p,e,n,r);case 44:y.next=60;break;case 46:return y.prev=46,y.t5=y["catch"](37),helpers_logME("[Translate-Popup]: Error sending message to background:",y.t5),y.next=51,i18n_getTranslationString("popup_string_translate_error_trigger");case 51:if(y.t6=y.sent,y.t6){y.next=54;break}y.t6="(⚠️ خطایی در ترجمه پاپ‌آپ رخ داد.)";case 54:h=y.t6,d=extractErrorMessage(y.t5)||h,st.translationResult.innerHTML="",st.translationResult.textContent=d,correctTextDirection(st.translationResult,d),toggleInlineToolbarVisibility(st.translationResult);case 60:case"end":return y.stop()}}),_callee2,null,[[37,46]])}))),_triggerTranslation.apply(this,arguments)}function translationManager_init(){var e,t,r;null===(e=st.translationForm)||void 0===e||e.addEventListener("submit",(function(e){e.preventDefault(),helpers_logME("[Translate-Popup]: Translation form submitted via button."),triggerTranslation()})),null===(t=st.sourceText)||void 0===t||t.addEventListener("keydown",(function(e){var t=e.ctrlKey||e.metaKey,r="Enter"===e.key,n="/"===e.key;t&&(r||n)&&(e.preventDefault(),helpers_logME("[Translate-Popup]: Shortcut (".concat(e.ctrlKey?"Ctrl":"Cmd","+").concat(e.key,") triggered translation.")),triggerTranslation())})),null===(r=st.sourceText)||void 0===r||r.addEventListener("input",(function(){toggleInlineToolbarVisibility(st.sourceText)})),helpers_logME("[Translate-Popup]: Initialized.")}function PlatformStrategy_typeof(e){return PlatformStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},PlatformStrategy_typeof(e)}function PlatformStrategy_regeneratorRuntime(){PlatformStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==PlatformStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(PlatformStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function PlatformStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function PlatformStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,PlatformStrategy_toPropertyKey(n.key),n)}}function PlatformStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=PlatformStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=PlatformStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==PlatformStrategy_typeof(t)?t:t+""}var sr=function(){return e=function PlatformStrategy(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,PlatformStrategy),this.notifier=e,this.errorHandler=t},t=[{key:"extractText",value:function(e){try{var t,r,n;return e?e.isContentEditable?(null===(n=e.innerText)||void 0===n?void 0:n.trim())||"":(null===(t=e.value)||void 0===t?void 0:t.trim())||(null===(r=e.textContent)||void 0===r?void 0:r.trim())||"":""}catch(e){var o;return null===(o=this.errorHandler)||void 0===o||o.handle(e,{type:H.UI,context:"platform-strategy-extractText"}),""}}},{key:"findField",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,n=e,o=0;o<r&&n;o++){var a=n.closest(t);if(a)return a;n=n.parentElement}return document.querySelector(t)}},{key:"validateField",value:function(e){return e&&e.isConnected&&(this.isInputElement(e)||e.hasAttribute("contenteditable"))}},{key:"applyVisualFeedback",value:(o=PlatformStrategy_regeneratorRuntime().mark((function _callee(e){var t,r;return PlatformStrategy_regeneratorRuntime().wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:try{t=e.style.backgroundColor,e.style.transition="background-color 0.5s ease",e.style.backgroundColor="#d4f8d4",requestAnimationFrame((function(){setTimeout((function(){e.style.backgroundColor=t}),300)}))}catch(e){null===(r=this.errorHandler)||void 0===r||r.handle(e,{type:H.UI,context:"platform-strategy-animation"})}case 3:case"end":return n.stop()}}),_callee,this)})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function _next(e){PlatformStrategy_asyncGeneratorStep(a,r,n,_next,_throw,"next",e)}function _throw(e){PlatformStrategy_asyncGeneratorStep(a,r,n,_next,_throw,"throw",e)}_next(void 0)}))},function(e){return a.apply(this,arguments)})},{key:"applyTextDirection",value:function(e,t){try{var n=r.RTL_REGEX.test(t);"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.setAttribute("dir",n?"rtl":"ltr"):(e.style.direction=n?"rtl":"ltr",e.style.textAlign=n?"right":"left")}catch(e){var o;throw null===(o=this.errorHandler)||void 0===o?void 0:o.handle(e,{type:H.UI,code:"text-direction-error",context:"platform-strategy-TextDirection"})}}},{key:"handleFieldError",value:function(e,t){var r={FIELD_NOT_FOUND:"لطفا روی فیلد متن ".concat(t," کلیک کنید"),CLIPBOARD_ERROR:"خطای دسترسی به کلیپبورد"};if(this.notifier&&this.notifier.show(r[e],"warning"),!this.errorHandler)throw new Error(e);this.errorHandler.handle(new Error(e),{type:H.UI,context:"platform-strategy-field-error"})}}],t&&PlatformStrategy_defineProperties(e.prototype,t),n&&PlatformStrategy_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,a}();function WhatsAppStrategy_typeof(e){return WhatsAppStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},WhatsAppStrategy_typeof(e)}function WhatsAppStrategy_regeneratorRuntime(){WhatsAppStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==WhatsAppStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(WhatsAppStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function WhatsAppStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function WhatsAppStrategy_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){WhatsAppStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){WhatsAppStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function WhatsAppStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,WhatsAppStrategy_toPropertyKey(n.key),n)}}function WhatsAppStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=WhatsAppStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=WhatsAppStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==WhatsAppStrategy_typeof(t)?t:t+""}function _callSuper(e,t,r){return t=_getPrototypeOf(t),function(e,t){if(t&&("object"==WhatsAppStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_isNativeReflectConstruct()?Reflect.construct(t,r||[],_getPrototypeOf(e).constructor):t.apply(e,r))}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}var lr=function(e){function WhatsAppStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,WhatsAppStrategy),(r=_callSuper(this,WhatsAppStrategy,[e])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}(WhatsAppStrategy,e),t=WhatsAppStrategy,r=[{key:"isWhatsAppElement",value:function(e){return!!e.closest('[aria-label="Type a message"]')}},{key:"updateElement",value:(c=WhatsAppStrategy_asyncToGenerator(WhatsAppStrategy_regeneratorRuntime().mark((function _callee(e,t){var r,n;return WhatsAppStrategy_regeneratorRuntime().wrap((function(o){for(;1;)switch(o.prev=o.next){case 0:if(o.prev=0,r='[role="textbox"], .copyable-text.selectable-text',n=this.findField(e,r)){o.next=6;break}return helpers_logME("فیلد واتساپ یافت نشد"),o.abrupt("return");case 6:if(("INPUT"===n.tagName||"TEXTAREA"===n.tagName||n.hasAttribute("contenteditable"))&&n.isConnected){o.next=10;break}return helpers_logME("فیلد واتساپ نامعتبر است"),o.abrupt("return",!1);case 10:if(this.isWhatsAppElement(e)){o.next=13;break}return o.abrupt("return",!1);case 13:if(document.body.contains(e)){o.next=16;break}return helpers_logME("Element removed from DOM"),o.abrupt("return",!1);case 16:return o.next=18,this.safeFocus(e);case 18:return this.applyVisualFeedback(n),o.next=21,this.selectAllContent(n);case 21:return o.next=23,this.simulatePaste(n,t);case 23:return this.triggerStateUpdate(n),o.abrupt("return",!0);case 27:return o.prev=27,o.t0=o["catch"](0),this.errorHandler.handle(o.t0,{type:H.PARSE_INPUT,context:"whatsapp-strategy-updateElement"}),o.abrupt("return",!1);case 31:case"end":return o.stop()}}),_callee,this,[[0,27]])}))),function(e,t){return c.apply(this,arguments)})},{key:"extractText",value:function(e){try{if(!e)return"";if(e.isContentEditable)return e.innerText.trim();if(e.value)return e.value.trim();if(e.textContent)return e.textContent.trim()}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"WhatsApp-strategy-extractText-fallback"})}return""}},{key:"safeFocus",value:(i=WhatsAppStrategy_asyncToGenerator(WhatsAppStrategy_regeneratorRuntime().mark((function _callee2(e){return WhatsAppStrategy_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return e.focus({preventScroll:!0}),t.next=3,delay(100);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),_callee2)}))),function(e){return i.apply(this,arguments)})},{key:"selectAllContent",value:(a=WhatsAppStrategy_asyncToGenerator(WhatsAppStrategy_regeneratorRuntime().mark((function _callee3(e){var t,r;return WhatsAppStrategy_regeneratorRuntime().wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:return n.prev=0,t=window.getSelection(),(r=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(r),n.next=8,delay(100);case 8:return n.abrupt("return",e);case 11:n.prev=11,n.t0=n["catch"](0),this.errorHandler.handle(n.t0,{type:H.PARSE_INPUT,context:"whatsapp-strategy-selectAllContent"});case 14:case"end":return n.stop()}}),_callee3,this,[[0,11]])}))),function(e){return a.apply(this,arguments)})},{key:"simulatePaste",value:(o=WhatsAppStrategy_asyncToGenerator(WhatsAppStrategy_regeneratorRuntime().mark((function _callee4(e,t){var r,n,o,a;return WhatsAppStrategy_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(e&&null!=t){i.next=2;break}return i.abrupt("return");case 2:return i.prev=2,r=(r=t.trim()).replace(/\n{2,}/g,"\n"),n=r.replace(/\n/g,"<br>"),(o=new DataTransfer).setData("text/plain",r),o.setData("text/html",n),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:o}),e.dispatchEvent(a),i.next=13,delay(50);case 13:i.next=18;break;case 15:i.prev=15,i.t0=i["catch"](2),this.errorHandler.handle(i.t0,{type:H.PARSE_INPUT,context:"whatsapp-strategy-simulatePaste"});case 18:case"end":return i.stop()}}),_callee4,this,[[2,15]])}))),function(e,t){return o.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(e){e.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],r&&WhatsAppStrategy_defineProperties(t.prototype,r),n&&WhatsAppStrategy_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,a,i,c}(sr);function InstagramStrategy_typeof(e){return InstagramStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},InstagramStrategy_typeof(e)}function InstagramStrategy_regeneratorRuntime(){InstagramStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==InstagramStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(InstagramStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function InstagramStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function InstagramStrategy_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){InstagramStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){InstagramStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function InstagramStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,InstagramStrategy_toPropertyKey(n.key),n)}}function InstagramStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=InstagramStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=InstagramStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==InstagramStrategy_typeof(t)?t:t+""}function InstagramStrategy_callSuper(e,t,r){return t=InstagramStrategy_getPrototypeOf(t),function(e,t){if(t&&("object"==InstagramStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,InstagramStrategy_isNativeReflectConstruct()?Reflect.construct(t,r||[],InstagramStrategy_getPrototypeOf(e).constructor):t.apply(e,r))}function InstagramStrategy_isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(InstagramStrategy_isNativeReflectConstruct=function(){return!!e})()}function InstagramStrategy_getPrototypeOf(e){return InstagramStrategy_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},InstagramStrategy_getPrototypeOf(e)}function InstagramStrategy_setPrototypeOf(e,t){return InstagramStrategy_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},InstagramStrategy_setPrototypeOf(e,t)}var ur=function(e){function InstagramStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,InstagramStrategy),(r=InstagramStrategy_callSuper(this,InstagramStrategy,[e])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&InstagramStrategy_setPrototypeOf(e,t)}(InstagramStrategy,e),t=InstagramStrategy,r=[{key:"isDirectMessageInputField",value:function(e){return!(!e||!e.matches('div[role="textbox"][contenteditable="true"]'))}},{key:"updateElement",value:(l=InstagramStrategy_asyncToGenerator(InstagramStrategy_regeneratorRuntime().mark((function _callee(e,t){var r,n,o;return InstagramStrategy_regeneratorRuntime().wrap((function(a){for(;1;)switch(a.prev=a.next){case 0:if(a.prev=0,!this.isDirectMessageInputField(e)){a.next=10;break}return a.next=4,this.clearContent(e);case 4:return a.next=6,this.pasteText(e,t);case 6:this.triggerStateUpdate(e),this.applyVisualFeedback(e),a.next=11;break;case 10:e.isContentEditable?(r=ct.sanitize(t,{RETURN_TRUSTED_TYPE:!0}),n=new DOMParser,o=n.parseFromString(r.toString(),"text/html"),e.textContent="",Array.from(o.body.childNodes).forEach((function(t){e.appendChild(t)})),this.applyTextDirection(e,t),this.applyVisualFeedback(e)):(e.value=t,this.applyTextDirection(e,t),this.applyVisualFeedback(e));case 11:return a.abrupt("return",!0);case 14:return a.prev=14,a.t0=a["catch"](0),this.errorHandler.handle(a.t0,{type:H.UI,context:"instagram-strategy-updateElement"}),a.abrupt("return",!1);case 18:case"end":return a.stop()}}),_callee,this,[[0,14]])}))),function(e,t){return l.apply(this,arguments)})},{key:"clearContent",value:(s=InstagramStrategy_asyncToGenerator(InstagramStrategy_regeneratorRuntime().mark((function _callee2(e){return InstagramStrategy_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,this.safeFocus(e);case 5:return t.next=7,this.selectAllContent(e);case 7:return t.next=9,this.simulatePaste(e,"");case 9:return t.next=11,delay(50);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:H.UI,context:"instagram-strategy-clearContent"});case 16:case"end":return t.stop()}}),_callee2,this,[[2,13]])}))),function(e){return s.apply(this,arguments)})},{key:"pasteText",value:(c=InstagramStrategy_asyncToGenerator(InstagramStrategy_regeneratorRuntime().mark((function _callee3(e,t){var r,n;return InstagramStrategy_regeneratorRuntime().wrap((function(o){for(;1;)switch(o.prev=o.next){case 0:if(e){o.next=2;break}return o.abrupt("return");case 2:return o.prev=2,(r=new DataTransfer).setData("text/plain",t),r.setData("text/html",t.replace(/\n/g,"<br>")),n=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:r}),e.dispatchEvent(n),o.next=10,delay(50);case 10:o.next=15;break;case 12:o.prev=12,o.t0=o["catch"](2),this.errorHandler.handle(o.t0,{type:H.UI,context:"instagram-strategy-pasteText"});case 15:case"end":return o.stop()}}),_callee3,this,[[2,12]])}))),function(e,t){return c.apply(this,arguments)})},{key:"extractText",value:function(e){try{var t,r,n,o,a,i;return e?null!=e&&e.isContentEditable?(null==e||null===(n=e.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":"INPUT"===(null==e?void 0:e.tagName)||"TEXTAREA"===(null==e?void 0:e.tagName)?(null==e||null===(a=e.value)||void 0===a||null===(i=a.trim)||void 0===i?void 0:i.call(a))||"":(null==e||null===(t=e.textContent)||void 0===t||null===(r=t.trim)||void 0===r?void 0:r.call(t))||"":""}catch(e){return this.errorHandler.handle(e,{type:H.UI,context:"instagram-strategy-extractText"}),""}}},{key:"safeFocus",value:(i=InstagramStrategy_asyncToGenerator(InstagramStrategy_regeneratorRuntime().mark((function _callee4(e){return InstagramStrategy_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,e.focus({preventScroll:!0}),t.next=4,delay(100);case 4:return t.abrupt("return",e);case 7:t.prev=7,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:H.UI,context:"instagram-strategy-safeFocus"});case 10:case"end":return t.stop()}}),_callee4,this,[[0,7]])}))),function(e){return i.apply(this,arguments)})},{key:"selectAllContent",value:(a=InstagramStrategy_asyncToGenerator(InstagramStrategy_regeneratorRuntime().mark((function _callee5(e){var t,r;return InstagramStrategy_regeneratorRuntime().wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:return n.prev=0,t=window.getSelection(),(r=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(r),n.next=8,delay(100);case 8:n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](0),this.errorHandler.handle(n.t0,{type:H.UI,context:"instagram-strategy-selectAllContent"});case 13:return n.abrupt("return",e);case 14:case"end":return n.stop()}}),_callee5,this,[[0,10]])}))),function(e){return a.apply(this,arguments)})},{key:"simulatePaste",value:(o=InstagramStrategy_asyncToGenerator(InstagramStrategy_regeneratorRuntime().mark((function _callee6(e,t){var r,n;return InstagramStrategy_regeneratorRuntime().wrap((function(o){for(;1;)switch(o.prev=o.next){case 0:return(r=new DataTransfer).setData("text/plain",t),r.setData("text/html",t.replace(/\n/g,"<br>")),n=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:r}),e.dispatchEvent(n),o.next=7,delay(50);case 7:case"end":return o.stop()}}),_callee6)}))),function(e,t){return o.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(e){e.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],r&&InstagramStrategy_defineProperties(t.prototype,r),n&&InstagramStrategy_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,a,i,c,s,l}(sr);function TwitterStrategy_typeof(e){return TwitterStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},TwitterStrategy_typeof(e)}function TwitterStrategy_regeneratorRuntime(){TwitterStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==TwitterStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(TwitterStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function TwitterStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function TwitterStrategy_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){TwitterStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){TwitterStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function TwitterStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,TwitterStrategy_toPropertyKey(n.key),n)}}function TwitterStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=TwitterStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=TwitterStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==TwitterStrategy_typeof(t)?t:t+""}function TwitterStrategy_callSuper(e,t,r){return t=TwitterStrategy_getPrototypeOf(t),function(e,t){if(t&&("object"==TwitterStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,TwitterStrategy_isNativeReflectConstruct()?Reflect.construct(t,r||[],TwitterStrategy_getPrototypeOf(e).constructor):t.apply(e,r))}function TwitterStrategy_isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(TwitterStrategy_isNativeReflectConstruct=function(){return!!e})()}function TwitterStrategy_getPrototypeOf(e){return TwitterStrategy_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},TwitterStrategy_getPrototypeOf(e)}function TwitterStrategy_setPrototypeOf(e,t){return TwitterStrategy_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},TwitterStrategy_setPrototypeOf(e,t)}var fr=function(e){function TwitterStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,TwitterStrategy),(r=TwitterStrategy_callSuper(this,TwitterStrategy,[e])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TwitterStrategy_setPrototypeOf(e,t)}(TwitterStrategy,e),t=TwitterStrategy,r=[{key:"isTwitterElement",value:function(e){if(!(e&&e instanceof Element))return!1;try{return!!e.closest('[data-testid="tweetTextarea_0"], [data-testid="tweetTextarea"]')}catch(e){return!1}}},{key:"isDMElement",value:function(e){if(!(e&&e instanceof Element))return!1;try{return!!e.closest('[data-testid="dmComposerTextInput"], [role="textbox"][aria-label="Text message"]')}catch(e){return!1}}},{key:"clearTweetField",value:function(e){if(e)try{e.focus();var t=window.getSelection();if(!(t.toString().length>0)){var r=document.createRange();r.selectNodeContents(e),t.removeAllRanges(),t.addRange(r)}var n=new DataTransfer;n.setData("text/plain","");var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n});e.dispatchEvent(o)}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"twitter-strategy-clearTweetField"})}}},{key:"pasteText_OLD",value:(i=TwitterStrategy_asyncToGenerator(TwitterStrategy_regeneratorRuntime().mark((function _callee(e,t){var r,n,o,a;return TwitterStrategy_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(e){i.next=2;break}return i.abrupt("return");case 2:if(i.prev=2,t&&"string"==typeof t){for(r=t.split("\n");r.length>0&&""===r[r.length-1].trim();)r.pop();n=r.join("\n"),(o=new DataTransfer).setData("text/plain",n),o.setData("text/html",n.replace(/\n/g,"<br>")),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:o}),e.dispatchEvent(a)}i.next=10;break;case 6:throw i.prev=6,i.t0=i["catch"](2),this.errorHandler.handle(i.t0,{type:H.UI,context:"twitter-strategy-pasteText"});case 10:case"end":return i.stop()}}),_callee,this,[[2,6]])}))),function(e,t){return i.apply(this,arguments)})},{key:"pasteText",value:(a=TwitterStrategy_asyncToGenerator(TwitterStrategy_regeneratorRuntime().mark((function _callee2(e,t){var r,n,o,a,i,c;return TwitterStrategy_regeneratorRuntime().wrap((function(s){for(;1;)switch(s.prev=s.next){case 0:if(e){s.next=2;break}return s.abrupt("return");case 2:if(s.prev=2,!t||"string"!=typeof t){s.next=22;break}return r=t.split("\n").filter((function(e){return""!==e.trim()})),n=r.join("\n"),e.focus(),s.next=9,delay(20);case 9:(o=document.createRange()).selectNodeContents(e),o.collapse(!1),(a=window.getSelection()).removeAllRanges(),a.addRange(o),(i=new DataTransfer).setData("text/plain",n),i.setData("text/html",n.replace(/\n/g,"<br>")),c=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.dispatchEvent(c)&&""!==e.innerText.trim()||(e.innerText=n,e.dispatchEvent(new Event("beforeinput",{bubbles:!0})),e.dispatchEvent(new Event("input",{bubbles:!0}))),this.setCursorToEnd(e);case 22:s.next=28;break;case 24:throw s.prev=24,s.t0=s["catch"](2),this.errorHandler.handle(s.t0,{type:H.UI,context:"twitter-strategy-pasteText"});case 28:case"end":return s.stop()}}),_callee2,this,[[2,24]])}))),function(e,t){return a.apply(this,arguments)})},{key:"setCursorToEnd",value:function(e){if(e)try{var t=window.getSelection(),r=document.createRange();r.selectNodeContents(e),r.collapse(!1),t.removeAllRanges(),t.addRange(r)}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"twitter-strategy-setCursorToEnd"})}}},{key:"isInputElement",value:function(e){return!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName)}},{key:"updateElement",value:(o=TwitterStrategy_asyncToGenerator(TwitterStrategy_regeneratorRuntime().mark((function _callee3(e,t){var r,n,o,a,i;return TwitterStrategy_regeneratorRuntime().wrap((function(c){for(;1;)switch(c.prev=c.next){case 0:if(c.prev=0,!(r=document.querySelector('[data-testid="SearchBox_Search_Input"]'))){c.next=11;break}n=!1;try{e&&"function"==typeof e.contains&&(n=e.contains(r))}catch(e){}if(!this.validateField(r)||e!==r&&!n&&document.activeElement!==r){c.next=11;break}return this.applyVisualFeedback(r),r.value=t,r.dispatchEvent(new Event("input",{bubbles:!0})),this.applyTextDirection(r,t),c.abrupt("return",!0);case 11:if(o=!1,e&&(o=this.isDMElement(e)),a=this.isDMElement(document.activeElement),!o&&!a){c.next=31;break}if(i=null,!(i=this.findField(e||document.activeElement,'[data-testid="dmComposerTextInput"]'))){c.next=31;break}try{window.getSelection().removeAllRanges()}catch(e){helpers_logME("[DEBUG] updateElement - Error removing selection ranges:",e)}return i.focus(),this.applyVisualFeedback(i),this.clearTweetField(i),c.next=25,delay(50);case 25:return this.pasteText(i,t),this.applyTextDirection(i,t),c.next=29,delay(100);case 29:return this.setCursorToEnd(i),c.abrupt("return",!0);case 31:return c.abrupt("return",!1);case 34:return c.prev=34,c.t0=c["catch"](0),helpers_logME("[DEBUG] Critical error in updateElement:",c.t0),this.errorHandler.handle(c.t0,{type:H.UI,context:"twitter-strategy-updateElement"}),c.abrupt("return",!1);case 39:case"end":return c.stop()}}),_callee3,this,[[0,34]])}))),function(e,t){return o.apply(this,arguments)})},{key:"extractText",value:function(e){var t=document.querySelector('[data-testid="SearchBox_Search_Input"]');if(t){var r=!1;if(e&&"function"==typeof e.contains&&(r=e.contains(t)),this.validateField(t)&&(e===t||document.activeElement===t||r))return t.value.trim()}var n,o=!1;if(e&&(o=this.isDMElement(e)),n=this.isDMElement(document.activeElement),o||n){var a=null;if(a=this.findField(e||document.activeElement,'[data-testid="dmComposerTextInput"]')){var i="";if("DIV"===a.tagName){var c=a.querySelector('[data-contents="true"]');i=c?Array.from(c.querySelectorAll(":scope > div")).map((function(e){return e.textContent})).join("\n").trim():a.textContent.trim()}else i=(a.value||"").trim();return i}}var s,l=null;s=this.isTwitterElement(document.activeElement);var u=!1;if(e&&(u=this.isTwitterElement(e)),!(l=s?document.activeElement:u?e:this.findField(e||document.body,'[data-testid="tweetTextarea_0"], [data-testid="tweetTextarea"]')))return"";var f="";if("DIV"===l.tagName){var p=l.querySelector('[data-contents="true"]');f=p?Array.from(p.querySelectorAll(":scope > div")).map((function(e){return e.textContent})).join("\n").trim():l.textContent.trim()}else f=(l.value||"").trim();return f}},{key:"validateField",value:function(e){try{return!!e&&e instanceof Element}catch(e){return!1}}},{key:"findField",value:function(e,t){if(!e)return null;try{return e.matches&&e.matches(t)?e:"function"==typeof e.querySelector?e.querySelector(t):document.querySelector(t)}catch(e){return null}}}],r&&TwitterStrategy_defineProperties(t.prototype,r),n&&TwitterStrategy_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,a,i}(sr);function TelegramStrategy_typeof(e){return TelegramStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},TelegramStrategy_typeof(e)}function TelegramStrategy_regeneratorRuntime(){TelegramStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==TelegramStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(TelegramStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function TelegramStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function TelegramStrategy_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){TelegramStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){TelegramStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function TelegramStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,TelegramStrategy_toPropertyKey(n.key),n)}}function TelegramStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=TelegramStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=TelegramStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==TelegramStrategy_typeof(t)?t:t+""}function TelegramStrategy_callSuper(e,t,r){return t=TelegramStrategy_getPrototypeOf(t),function(e,t){if(t&&("object"==TelegramStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,TelegramStrategy_isNativeReflectConstruct()?Reflect.construct(t,r||[],TelegramStrategy_getPrototypeOf(e).constructor):t.apply(e,r))}function TelegramStrategy_isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(TelegramStrategy_isNativeReflectConstruct=function(){return!!e})()}function TelegramStrategy_getPrototypeOf(e){return TelegramStrategy_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},TelegramStrategy_getPrototypeOf(e)}function TelegramStrategy_setPrototypeOf(e,t){return TelegramStrategy_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},TelegramStrategy_setPrototypeOf(e,t)}var pr=function(e){function TelegramStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,TelegramStrategy),(r=TelegramStrategy_callSuper(this,TelegramStrategy,[e])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&TelegramStrategy_setPrototypeOf(e,t)}(TelegramStrategy,e),t=TelegramStrategy,n=[{key:"isInputField",value:function(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName}},{key:"isContentEditable",value:function(e){return e.isContentEditable}},{key:"getTelegramField",value:function(e){if(e)try{if(this.isInputField(e)||this.isContentEditable(e))return e;var t=e.closest('[aria-label="Message input"]')||e.closest(".composer_rich_textarea")||e.closest(".public_DraftEditor-content");if(!t){var r=document.querySelectorAll('[contenteditable="true"]');t=1===r.length?r[0]:null}if(t&&!this.isContentEditable(t)){var n=t.querySelector('[contenteditable="true"]');n&&(t=n)}return t}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"telegram-strategy-getTelegramField"})}}},{key:"clearField",value:(l=TelegramStrategy_asyncToGenerator(TelegramStrategy_regeneratorRuntime().mark((function _callee(e){var t,r,n,o;return TelegramStrategy_regeneratorRuntime().wrap((function(a){for(;1;)switch(a.prev=a.next){case 0:if(a.prev=0,e){a.next=3;break}return a.abrupt("return");case 3:if(!this.isInputField(e)){a.next=7;break}e.value="",a.next=18;break;case 7:return(t=window.getSelection())&&((r=document.createRange()).selectNodeContents(e),t.removeAllRanges(),t.addRange(r)),a.next=11,delay(50);case 11:return e.innerHTML="",(n=new DataTransfer).setData("text/plain",""),o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n}),a.next=17,delay(50);case 17:e.dispatchEvent(o);case 18:a.next=23;break;case 20:a.prev=20,a.t0=a["catch"](0),this.errorHandler.handle(a.t0,{type:H.UI,context:"telegram-strategy-Clearfield"});case 23:case"end":return a.stop()}}),_callee,this,[[0,20]])}))),function(e){return l.apply(this,arguments)})},{key:"pasteText",value:function(e,t){try{if(!e)return;if(null!=t){var r=new DataTransfer;r.setData("text/plain",t);var n=t.replace(/\n/g,"<br>");r.setData("text/html",n);var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:r});e.dispatchEvent(o)}}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"telegram-strategy-pasteText"})}}},{key:"setCursorToEnd",value:function(e){try{if(!e)return;if(this.isInputField(e)){var t=e.value.length;e.setSelectionRange(t,t)}else{var r=window.getSelection(),n=document.createRange();n.selectNodeContents(e),n.collapse(!1),r.removeAllRanges(),r.addRange(n)}}catch(e){this.errorHandler.handle(e,{type:H.SERVICE,context:"telegram-strategy-setCursorToEnd"})}}},{key:"updateElement",value:(s=TelegramStrategy_asyncToGenerator(TelegramStrategy_regeneratorRuntime().mark((function _callee2(e,t){var n,o;return TelegramStrategy_regeneratorRuntime().wrap((function(a){for(;1;)switch(a.prev=a.next){case 0:if(t){a.next=2;break}return a.abrupt("return",!1);case 2:if(e){a.next=4;break}return a.abrupt("return",!1);case 4:return n='[aria-label="Message input"], .composer_rich_textarea, .public_DraftEditor-content, [contenteditable="true"]',a.prev=5,a.next=8,delay(100);case 8:if(o=this.findField(e,n)||this.getTelegramField(e)||document.querySelector(n),this.validateField(o)){a.next=12;break}return helpers_logME("فیلد تلگرام یافت نشد"),a.abrupt("return",!1);case 12:if(e===o||o.contains(e)){a.next=14;break}return a.abrupt("return",!1);case 14:return a.next=16,this.safeFocus(o);case 16:if(this.applyVisualFeedback(document.getElementById("message-input-text")),!this.isInputField(o)){a.next=23;break}o.value=t,o.setAttribute("dir",r.RTL_REGEX.test(t)?"rtl":"ltr"),o.dispatchEvent(new Event("input",{bubbles:!0})),a.next=26;break;case 23:return a.next=25,this.clearField(o);case 25:this.pasteText(o,t);case 26:return this.setCursorToEnd(o),a.abrupt("return",!0);case 30:return a.prev=30,a.t0=a["catch"](5),this.errorHandler.handle(a.t0,{type:H.SERVICE,context:"telegram-strategy-updateElement"}),a.abrupt("return",!1);case 34:case"end":return a.stop()}}),_callee2,this,[[5,30]])}))),function(e,t){return s.apply(this,arguments)})},{key:"extractText",value:function(e){try{if(!e)return"";if(e.isContentEditable)return e.innerText.trim();if(e.value)return e.value.trim();if(e.textContent)return e.textContent.trim()}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"Telegram-strategy-extractText-fallback"})}return""}},{key:"validateField",value:function(e){var t=null==e?void 0:e.querySelector('[contenteditable="true"]');return e&&e.isConnected&&(this.isInputField(e)||this.isContentEditable(e)||t)}},{key:"safeFocus",value:(c=TelegramStrategy_asyncToGenerator(TelegramStrategy_regeneratorRuntime().mark((function _callee3(e){return TelegramStrategy_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.focus({preventScroll:!0}),t.next=6,delay(100);case 6:return t.abrupt("return",e);case 9:t.prev=9,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:H.UI,context:"telegram-strategy-safeFocus"});case 12:case"end":return t.stop()}}),_callee3,this,[[2,9]])}))),function(e){return c.apply(this,arguments)})},{key:"selectAllContent",value:(i=TelegramStrategy_asyncToGenerator(TelegramStrategy_regeneratorRuntime().mark((function _callee4(e){return TelegramStrategy_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,document.execCommand("selectAll"),t.next=6,delay(100);case 6:return t.abrupt("return",e);case 9:t.prev=9,t.t0=t["catch"](2),this.errorHandler.handle(t.t0,{type:H.UI,context:"telegram-strategy-SelectAllContent"});case 12:case"end":return t.stop()}}),_callee4,this,[[2,9]])}))),function(e){return i.apply(this,arguments)})},{key:"simulatePaste",value:(a=TelegramStrategy_asyncToGenerator(TelegramStrategy_regeneratorRuntime().mark((function _callee5(e,t){var r,n,o,a;return TelegramStrategy_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(e&&null!=t){i.next=2;break}return i.abrupt("return");case 2:return i.prev=2,r=(r=t.trim()).replace(/\n{2,}/g,"\n"),n=r.replace(/\n/g,"<br>"),(o=new DataTransfer).setData("text/plain",r),o.setData("text/html",n),a=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:o}),e.dispatchEvent(a),i.next=13,delay(50);case 13:i.next=18;break;case 15:i.prev=15,i.t0=i["catch"](2),this.errorHandler.handle(i.t0,{type:H.UI,context:"telegram-strategy-simulatePaste"});case 18:case"end":return i.stop()}}),_callee5,this,[[2,15]])}))),function(e,t){return a.apply(this,arguments)})},{key:"triggerStateUpdate",value:function(e){e.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],n&&TelegramStrategy_defineProperties(t.prototype,n),o&&TelegramStrategy_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o,a,i,c,s,l}(sr);function MediumStrategy_typeof(e){return MediumStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},MediumStrategy_typeof(e)}function MediumStrategy_regeneratorRuntime(){MediumStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==MediumStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(MediumStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function MediumStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function MediumStrategy_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){MediumStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){MediumStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function MediumStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,MediumStrategy_toPropertyKey(n.key),n)}}function MediumStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=MediumStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=MediumStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==MediumStrategy_typeof(t)?t:t+""}function MediumStrategy_callSuper(e,t,r){return t=MediumStrategy_getPrototypeOf(t),function(e,t){if(t&&("object"==MediumStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,MediumStrategy_isNativeReflectConstruct()?Reflect.construct(t,r||[],MediumStrategy_getPrototypeOf(e).constructor):t.apply(e,r))}function MediumStrategy_isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(MediumStrategy_isNativeReflectConstruct=function(){return!!e})()}function MediumStrategy_getPrototypeOf(e){return MediumStrategy_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},MediumStrategy_getPrototypeOf(e)}function MediumStrategy_setPrototypeOf(e,t){return MediumStrategy_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},MediumStrategy_setPrototypeOf(e,t)}var hr=function(e){function MediumStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MediumStrategy),(r=MediumStrategy_callSuper(this,MediumStrategy,[e])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MediumStrategy_setPrototypeOf(e,t)}(MediumStrategy,e),t=MediumStrategy,r=[{key:"shouldShowDefaultIcon",value:function(){return!0}},{key:"isMediumElement",value:function(e){return!(!e.closest('[role="textbox"]')&&!e.closest('[data-testid="editor-container"]'))}},{key:"updateElement",value:(c=MediumStrategy_asyncToGenerator(MediumStrategy_regeneratorRuntime().mark((function _callee(e,t){return MediumStrategy_regeneratorRuntime().wrap((function(r){for(;1;)switch(r.prev=r.next){case 0:if("INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName){r.next=5;break}return e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0})),this.applyVisualFeedback(e),r.abrupt("return",!0);case 5:return r.abrupt("return",!1);case 6:case"end":return r.stop()}}),_callee,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"extractText",value:function(e){try{var t,r,n,o;if(!e)return"";if("INPUT"===e.tagName||"TEXTAREA"===e.tagName)return(null==e||null===(n=e.value)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"";var a=this.findMediumTextField(e);return(null==a||null===(t=a.innerText)||void 0===t||null===(r=t.trim)||void 0===r?void 0:r.call(t))||""}catch(e){return this.errorHandler.handle(e,{type:H.UI,context:"medium-strategy-extractText"}),""}}},{key:"safeFocus",value:(i=MediumStrategy_asyncToGenerator(MediumStrategy_regeneratorRuntime().mark((function _callee2(e){return MediumStrategy_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,e.isConnected){t.next=3;break}return t.abrupt("return",null);case 3:return e.focus({preventScroll:!0}),t.next=6,delay(150);case 6:if(document.activeElement===e){t.next=10;break}return e.focus({preventScroll:!0}),t.next=10,delay(100);case 10:return t.abrupt("return",e);case 13:t.prev=13,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:H.UI,context:"medium-strategy-safeFocus"});case 16:case"end":return t.stop()}}),_callee2,this,[[0,13]])}))),function(e){return i.apply(this,arguments)})},{key:"selectAllContent",value:(a=MediumStrategy_asyncToGenerator(MediumStrategy_regeneratorRuntime().mark((function _callee3(e){return MediumStrategy_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return document.execCommand("selectAll"),t.next=3,delay(100);case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),_callee3)}))),function(e){return a.apply(this,arguments)})},{key:"simulatePaste",value:(o=MediumStrategy_asyncToGenerator(MediumStrategy_regeneratorRuntime().mark((function _callee4(e,t){var r,n;return MediumStrategy_regeneratorRuntime().wrap((function(o){for(;1;)switch(o.prev=o.next){case 0:return(r=new DataTransfer).setData("text/plain",t),r.setData("text/html",t.replace(/\n/g,"<br>")),n=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:r}),e.dispatchEvent(n),o.next=7,delay(50);case 7:case"end":return o.stop()}}),_callee4)}))),function(e,t){return o.apply(this,arguments)})},{key:"findMediumTextField",value:function(e){for(var t=e,r=0;r<5&&t;r++){var n=t.closest('[role="textbox"][contenteditable="true"], [data-testid="editor-container"]');if(n)return n;t=t.parentElement}return document.querySelector('[role="textbox"][contenteditable="true"], [data-testid="editor-container"]')}},{key:"triggerStateUpdate",value:function(e){e.dispatchEvent(new InputEvent("input",{bubbles:!0,composed:!0}))}}],r&&MediumStrategy_defineProperties(t.prototype,r),n&&MediumStrategy_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,a,i,c}(sr),setCursorToEnd=function(e){try{if(null==e||!e.isConnected)return;if(e.focus(),"INPUT"===e.tagName||"TEXTAREA"===e.tagName)e.selectionStart=e.selectionEnd=e.value.length;else if(e.isContentEditable){var t=document.createRange(),r=window.getSelection();t.selectNodeContents(e),t.collapse(!1),r.removeAllRanges(),r.addRange(t)}e.scrollTop=e.scrollHeight}catch(e){throw(new oe).handle(e,{type:H.UI,context:"helpers-setCursorToEnd"})}};function ChatGPTStrategy_typeof(e){return ChatGPTStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ChatGPTStrategy_typeof(e)}function ChatGPTStrategy_regeneratorRuntime(){ChatGPTStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==ChatGPTStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(ChatGPTStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function ChatGPTStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function ChatGPTStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ChatGPTStrategy_toPropertyKey(n.key),n)}}function ChatGPTStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=ChatGPTStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=ChatGPTStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ChatGPTStrategy_typeof(t)?t:t+""}function ChatGPTStrategy_callSuper(e,t,r){return t=ChatGPTStrategy_getPrototypeOf(t),function(e,t){if(t&&("object"==ChatGPTStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ChatGPTStrategy_isNativeReflectConstruct()?Reflect.construct(t,r||[],ChatGPTStrategy_getPrototypeOf(e).constructor):t.apply(e,r))}function ChatGPTStrategy_isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ChatGPTStrategy_isNativeReflectConstruct=function(){return!!e})()}function ChatGPTStrategy_getPrototypeOf(e){return ChatGPTStrategy_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ChatGPTStrategy_getPrototypeOf(e)}function ChatGPTStrategy_setPrototypeOf(e,t){return ChatGPTStrategy_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ChatGPTStrategy_setPrototypeOf(e,t)}var dr=function(e){function ChatGPTStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ChatGPTStrategy),(r=ChatGPTStrategy_callSuper(this,ChatGPTStrategy,[e])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ChatGPTStrategy_setPrototypeOf(e,t)}(ChatGPTStrategy,e),t=ChatGPTStrategy,n=[{key:"isChatGPTElement",value:function(e){return"prompt-textarea"===e.id}},{key:"extractText",value:function(e){try{if(document.querySelector(".absolute .inset-0"))return"";var t=e;if(t&&this.isChatGPTElement(t)||(t=document.querySelector("#prompt-textarea")),!t)throw new Error("عنصر ChatGPT برای استخراج متن شناسایی نشد.");return Array.from(t.querySelectorAll("p")).map((function(e){return e.textContent.trim()})).join("\n")}catch(e){return this.errorHandler.handle(e,{type:H.UI,context:"chatgpt-strategy-extractText"}),""}}},{key:"updateElement",value:(a=ChatGPTStrategy_regeneratorRuntime().mark((function _callee(e,t){var r,n,o,a;return ChatGPTStrategy_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(i.prev=0,!document.querySelector(".absolute .inset-0")){i.next=4;break}return i.abrupt("return",!1);case 4:return r=t.replace(/\n/g,"<br>"),n=ct.sanitize(r,{RETURN_TRUSTED_TYPE:!0}),o=new DOMParser,a=o.parseFromString(n.toString(),"text/html"),e.textContent="",Array.from(a.body.childNodes).forEach((function(t){e.appendChild(t)})),this.applyBaseStyling(e,t),setCursorToEnd(e),this.applyVisualFeedback(e),i.abrupt("return",!0);case 16:return i.prev=16,i.t0=i["catch"](0),this.errorHandler.handle(i.t0,{type:H.UI,context:"chatgpt-strategy-updateElement"}),i.abrupt("return",!1);case 20:case"end":return i.stop()}}),_callee,this,[[0,16]])})),i=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=a.apply(e,t);function _next(e){ChatGPTStrategy_asyncGeneratorStep(o,r,n,_next,_throw,"next",e)}function _throw(e){ChatGPTStrategy_asyncGeneratorStep(o,r,n,_next,_throw,"throw",e)}_next(void 0)}))},function(e,t){return i.apply(this,arguments)})},{key:"applyBaseStyling",value:function(e,t){var n=r.RTL_REGEX.test(t);e.style.direction=n?"rtl":"ltr",e.style.textAlign=n?"right":"left"}}],n&&ChatGPTStrategy_defineProperties(t.prototype,n),o&&ChatGPTStrategy_defineProperties(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o,a,i}(sr);function YoutubeStrategy_typeof(e){return YoutubeStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},YoutubeStrategy_typeof(e)}function YoutubeStrategy_regeneratorRuntime(){YoutubeStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==YoutubeStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(YoutubeStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function YoutubeStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function YoutubeStrategy_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){YoutubeStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){YoutubeStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function YoutubeStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,YoutubeStrategy_toPropertyKey(n.key),n)}}function YoutubeStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=YoutubeStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=YoutubeStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==YoutubeStrategy_typeof(t)?t:t+""}function YoutubeStrategy_callSuper(e,t,r){return t=YoutubeStrategy_getPrototypeOf(t),function(e,t){if(t&&("object"==YoutubeStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,YoutubeStrategy_isNativeReflectConstruct()?Reflect.construct(t,r||[],YoutubeStrategy_getPrototypeOf(e).constructor):t.apply(e,r))}function YoutubeStrategy_isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(YoutubeStrategy_isNativeReflectConstruct=function(){return!!e})()}function YoutubeStrategy_getPrototypeOf(e){return YoutubeStrategy_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},YoutubeStrategy_getPrototypeOf(e)}function YoutubeStrategy_setPrototypeOf(e,t){return YoutubeStrategy_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},YoutubeStrategy_setPrototypeOf(e,t)}var yr=function(e){function YoutubeStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,YoutubeStrategy),(r=YoutubeStrategy_callSuper(this,YoutubeStrategy,[e,t])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&YoutubeStrategy_setPrototypeOf(e,t)}(YoutubeStrategy,e),t=YoutubeStrategy,r=[{key:"isYoutube_ExtraField",value:function(e){return!(!e||"INPUT"!==e.tagName||"search_query"!==e.getAttribute("name")&&"end"!==e.getAttribute("id"))}},{key:"extractText",value:function(e){try{var t,r,n,o,a,i;return e?null!=e&&e.isContentEditable?(null==e||null===(n=e.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":null==e||!e.tagName||"TEXTAREA"!==e.tagName&&"INPUT"!==e.tagName?(null==e||null===(t=e.textContent)||void 0===t||null===(r=t.trim)||void 0===r?void 0:r.call(t))||"":(null==e||null===(a=e.value)||void 0===a||null===(i=a.trim)||void 0===i?void 0:i.call(a))||"":""}catch(e){return this.errorHandler.handle(e,{type:H.UI,context:"youtube-strategy-extractText"}),""}}},{key:"updateElement",value:(a=YoutubeStrategy_asyncToGenerator(YoutubeStrategy_regeneratorRuntime().mark((function _callee(e,t){var r,n,o,a;return YoutubeStrategy_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(i.prev=0,e&&e.isConnected){i.next=4;break}return helpers_logME("عنصر معتبر برای به‌روزرسانی وجود ندارد"),i.abrupt("return",!1);case 4:return null!=t&&(e.isContentEditable?(r=t.replace(/\n/g,"<br>"),n=ct.sanitize(r,{RETURN_TRUSTED_TYPE:!0}),o=new DOMParser,a=o.parseFromString(n.toString(),"text/html"),e.textContent="",Array.from(a.body.childNodes).forEach((function(t){e.appendChild(t)})),this.applyVisualFeedback(e),this.applyTextDirection(e,r)):(e.value=t,this.applyVisualFeedback(e),this.applyTextDirection(e,t))),i.abrupt("return",!0);case 8:return i.prev=8,i.t0=i["catch"](0),this.errorHandler.handle(i.t0,{type:H.UI,context:"youtube-strategy-updateElement",element:null==e?void 0:e.tagName}),i.abrupt("return",!1);case 12:case"end":return i.stop()}}),_callee,this,[[0,8]])}))),function(e,t){return a.apply(this,arguments)})},{key:"clearContent",value:(o=YoutubeStrategy_asyncToGenerator(YoutubeStrategy_regeneratorRuntime().mark((function _callee2(e){return YoutubeStrategy_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&e.isConnected){t.next=3;break}return t.abrupt("return");case 3:"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value="":e.innerHTML="",this.applyVisualFeedback(e),t.next=11;break;case 7:throw t.prev=7,t.t0=t["catch"](0),this.errorHandler.handle(t.t0,{type:H.UI,context:"youtube-strategy-clearContent",element:null==e?void 0:e.tagName});case 11:case"end":return t.stop()}}),_callee2,this,[[0,7]])}))),function(e){return o.apply(this,arguments)})}],r&&YoutubeStrategy_defineProperties(t.prototype,r),n&&YoutubeStrategy_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,a}(sr);function DefaultStrategy_typeof(e){return DefaultStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},DefaultStrategy_typeof(e)}function DefaultStrategy_regeneratorRuntime(){DefaultStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==DefaultStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(DefaultStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function DefaultStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function DefaultStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,DefaultStrategy_toPropertyKey(n.key),n)}}function DefaultStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=DefaultStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=DefaultStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==DefaultStrategy_typeof(t)?t:t+""}function DefaultStrategy_callSuper(e,t,r){return t=DefaultStrategy_getPrototypeOf(t),function(e,t){if(t&&("object"==DefaultStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,DefaultStrategy_isNativeReflectConstruct()?Reflect.construct(t,r||[],DefaultStrategy_getPrototypeOf(e).constructor):t.apply(e,r))}function DefaultStrategy_isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(DefaultStrategy_isNativeReflectConstruct=function(){return!!e})()}function DefaultStrategy_getPrototypeOf(e){return DefaultStrategy_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},DefaultStrategy_getPrototypeOf(e)}function DefaultStrategy_setPrototypeOf(e,t){return DefaultStrategy_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},DefaultStrategy_setPrototypeOf(e,t)}var gr=function(e){function DefaultStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DefaultStrategy),(r=DefaultStrategy_callSuper(this,DefaultStrategy,[e])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DefaultStrategy_setPrototypeOf(e,t)}(DefaultStrategy,e),t=DefaultStrategy,r=[{key:"extractText",value:function(e){try{var t,r,n,o,a,i;return e&&e instanceof Element?e.isContentEditable?(null===(n=e.innerText)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":["TEXTAREA","INPUT"].includes(e.tagName)?(null===(a=e.value)||void 0===a||null===(i=a.trim)||void 0===i?void 0:i.call(a))||"":(null===(t=e.textContent)||void 0===t||null===(r=t.trim)||void 0===r?void 0:r.call(t))||"":""}catch(e){return this.errorHandler.handle(e,{type:H.UI,context:"default-strategy-extractText"}),""}}},{key:"updateElement",value:(o=DefaultStrategy_regeneratorRuntime().mark((function _callee(e,t){var r,n,o,a;return DefaultStrategy_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(i.prev=0,null==t){i.next=7;break}return this.applyVisualFeedback(e),e.isContentEditable?(r=t.replace(/\n/g,"<br>"),n=ct.sanitize(r,{RETURN_TRUSTED_TYPE:!0}),o=new DOMParser,a=o.parseFromString(n.toString(),"text/html"),e.textContent="",Array.from(a.body.childNodes).forEach((function(t){e.appendChild(t)})),this.applyTextDirection(e,r)):(e.value=t,this.applyTextDirection(e,t)),i.next=6,delay(500);case 6:return i.abrupt("return",!0);case 7:i.next=13;break;case 9:return i.prev=9,i.t0=i["catch"](0),this.errorHandler.handle(i.t0,{type:H.UI,context:"default-strategy-updateElement"}),i.abrupt("return",!1);case 13:case"end":return i.stop()}}),_callee,this,[[0,9]])})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function _next(e){DefaultStrategy_asyncGeneratorStep(a,r,n,_next,_throw,"next",e)}function _throw(e){DefaultStrategy_asyncGeneratorStep(a,r,n,_next,_throw,"throw",e)}_next(void 0)}))},function(e,t){return a.apply(this,arguments)})},{key:"clearContent",value:function(e){if(e)try{"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value="":e.innerHTML=""}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"default-strategy-clearContent"})}}}],r&&DefaultStrategy_defineProperties(t.prototype,r),n&&DefaultStrategy_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,a}(sr);function DiscordStrategy_typeof(e){return DiscordStrategy_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},DiscordStrategy_typeof(e)}function DiscordStrategy_regeneratorRuntime(){DiscordStrategy_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==DiscordStrategy_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(DiscordStrategy_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function DiscordStrategy_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function DiscordStrategy_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){DiscordStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){DiscordStrategy_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function DiscordStrategy_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,DiscordStrategy_toPropertyKey(n.key),n)}}function DiscordStrategy_toPropertyKey(e){var t=function(e,t){if("object"!=DiscordStrategy_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=DiscordStrategy_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==DiscordStrategy_typeof(t)?t:t+""}function DiscordStrategy_callSuper(e,t,r){return t=DiscordStrategy_getPrototypeOf(t),function(e,t){if(t&&("object"==DiscordStrategy_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,DiscordStrategy_isNativeReflectConstruct()?Reflect.construct(t,r||[],DiscordStrategy_getPrototypeOf(e).constructor):t.apply(e,r))}function DiscordStrategy_isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(DiscordStrategy_isNativeReflectConstruct=function(){return!!e})()}function DiscordStrategy_getPrototypeOf(e){return DiscordStrategy_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},DiscordStrategy_getPrototypeOf(e)}function DiscordStrategy_setPrototypeOf(e,t){return DiscordStrategy_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},DiscordStrategy_setPrototypeOf(e,t)}var vr=function(e){function DiscordStrategy(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DiscordStrategy),(r=DiscordStrategy_callSuper(this,DiscordStrategy,[e])).errorHandler=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DiscordStrategy_setPrototypeOf(e,t)}(DiscordStrategy,e),t=DiscordStrategy,r=[{key:"extractText",value:function(e){try{var t,r,n,o,a,i;return e&&e instanceof HTMLElement?e.isContentEditable?(null===(a=e.innerText)||void 0===a||null===(i=a.trim)||void 0===i?void 0:i.call(a))||"":(null===(t=e.value)||void 0===t||null===(r=t.trim)||void 0===r?void 0:r.call(t))||(null===(n=e.textContent)||void 0===n||null===(o=n.trim)||void 0===o?void 0:o.call(n))||"":""}catch(e){return this.errorHandler.handle(e,{type:H.UI,context:"discord-strategy-extractText"}),""}}},{key:"updateElement",value:(a=DiscordStrategy_asyncToGenerator(DiscordStrategy_regeneratorRuntime().mark((function _callee(e,t){return DiscordStrategy_regeneratorRuntime().wrap((function(r){for(;1;)switch(r.prev=r.next){case 0:if(r.prev=0,!document.querySelector(".keyboardShortcutsModal_f061f6")){r.next=4;break}return r.abrupt("return",!1);case 4:if(null==t){r.next=25;break}if(!e.isContentEditable){r.next=16;break}return e.focus(),e.value=t,this.applyVisualFeedback(e),this.clearField(e),r.next=12,delay(200);case 12:this.pasteText(e,t),this.applyTextDirection(e,t),r.next=24;break;case 16:return e.focus(),e.value=t,this.applyVisualFeedback(e),this.clearField(e),r.next=22,delay(200);case 22:this.pasteText(e,t),this.applyTextDirection(e,t);case 24:return r.abrupt("return",!0);case 25:r.next=31;break;case 27:return r.prev=27,r.t0=r["catch"](0),this.errorHandler.handle(r.t0,{type:H.UI,context:"Discord-strategy-updateElement"}),r.abrupt("return",!1);case 31:case"end":return r.stop()}}),_callee,this,[[0,27]])}))),function(e,t){return a.apply(this,arguments)})},{key:"clearField",value:function(e){if(e)try{e.focus();var t=window.getSelection();if(!(t.toString().length>0)){var r=document.createRange();r.selectNodeContents(e),t.removeAllRanges(),t.addRange(r)}var n=new DataTransfer;n.setData("text/plain","");var o=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:n});e.dispatchEvent(o)}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"Discord-strategy-clearField"})}}},{key:"pasteText",value:(o=DiscordStrategy_asyncToGenerator(DiscordStrategy_regeneratorRuntime().mark((function _callee2(e,t){var r,n,o,a,i,c,s=this;return DiscordStrategy_regeneratorRuntime().wrap((function(l){for(;1;)switch(l.prev=l.next){case 0:if(e&&t&&"string"==typeof t){l.next=2;break}return l.abrupt("return");case 2:for(l.prev=2,r=t.split("\n");r.length>0&&""===r[r.length-1].trim();)r.pop();if(n=r.join("\n"),!navigator.clipboard||!navigator.clipboard.writeText){l.next=18;break}return o=window.getSelection(),a=o.getRangeAt(0).cloneRange(),l.next=11,navigator.clipboard.writeText(n);case 11:if(e.focus(),o.removeAllRanges(),o.addRange(a),!document.execCommand("paste")){l.next=16;break}return l.abrupt("return");case 16:return this.simulateInputInsertion(e,n),l.abrupt("return");case 18:(i=new DataTransfer).setData("text/plain",n),i.setData("text/html",n.replace(/\n/g,"<br>")),c=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:i}),e.focus(),e.dispatchEvent(c),setTimeout((function(){s.simulateInputInsertion(e,n)}),100),l.next=31;break;case 27:throw l.prev=27,l.t0=l["catch"](2),this.errorHandler.handle(l.t0,{type:H.UI,context:"Discord-strategy-pasteText"});case 31:case"end":return l.stop()}}),_callee2,this,[[2,27]])}))),function(e,t){return o.apply(this,arguments)})},{key:"simulateInputInsertion",value:function(e,t){try{if(document.execCommand("insertText",!1,t))return}catch(e){}if("INPUT"===e.tagName||"TEXTAREA"===e.tagName){var r=e.selectionStart||0,n=e.selectionEnd||0,o=e.value.substring(0,r),a=e.value.substring(n);return e.value=o+t+a,e.selectionStart=e.selectionEnd=r+t.length,void e.dispatchEvent(new Event("input",{bubbles:!0}))}if(e.isContentEditable){var i=window.getSelection(),c=i.getRangeAt(0);c.deleteContents();var s=document.createTextNode(t);c.insertNode(s),c.setStartAfter(s),c.setEndAfter(s),i.removeAllRanges(),i.addRange(c),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0}))}}}],r&&DiscordStrategy_defineProperties(t.prototype,r),n&&DiscordStrategy_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,n,o,a}(sr);function IconManager_typeof(e){return IconManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},IconManager_typeof(e)}function IconManager_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,IconManager_toPropertyKey(n.key),n)}}function IconManager_toPropertyKey(e){var t=function(e,t){if("object"!=IconManager_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=IconManager_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==IconManager_typeof(t)?t:t+""}var mr=function(){return e=function IconManager(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,IconManager),this.errorHandler=e},(n=[{key:"cleanup",value:function(){c.highlightedElement&&(c.highlightedElement.style.outline="",c.highlightedElement=null),document.querySelectorAll(".AIWritingCompanion-translation-icon-extension").forEach((function(e){e.classList.add("fade-out"),setTimeout((function(){return e.remove()}),50)})),c.activeTranslateIcon=null}},{key:"applyTextDirection",value:function(e,t){if(null!=e&&e.style){var n=r.RTL_REGEX.test(t);e.style.direction=n?"rtl":"ltr",e.style.textAlign=n?"right":"left"}}},{key:"createTranslateIcon",value:function(e){try{if(null==e||!e.isConnected)return null;o="styles/icon.css",(a=document.createElement("link")).rel="stylesheet",a.type="text/css",a.href=t().runtime.getURL(o),document.head.appendChild(a);var n=document.createElement("button");return n.className="AIWritingCompanion-translation-icon-extension",n.textContent=r.ICON_TRANSLATION,n.title=r.TRANSLATION_ICON_TITLE,n.style.display="none",document.body.appendChild(n),requestAnimationFrame((function(){if(e.isConnected){var t=e.getBoundingClientRect();n.style.top="".concat(t.top+window.scrollY+10,"px"),n.style.left="".concat(t.left+window.scrollX+t.width+10,"px"),n.style.display="block",n.classList.add("AIWritingCompanion-translation-icon-extension-fade-in")}})),n}catch(e){return this.errorHandler.handle(e,{type:H.UI,context:"IconManager-createTranslateIcon"}),null}var o,a}}])&&IconManager_defineProperties(e.prototype,n),o&&IconManager_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,o}();var _r="default",br="whatsapp",xr="telegram",wr="instagram",Er="twitter",Tr="medium",kr="chatgpt",Sr="youtube",Ar="discrod";function detectPlatform(){var e=window.location.hostname.toLowerCase();return{"web.whatsapp.com":br,"web.telegram.org":xr,"www.instagram.com":wr,"twitter.com":Er,"x.com":Er,"medium.com":Tr,"chat.openai.com":kr,"chat.com":kr,"chatgpt.com":kr,"www.youtube.com":Sr,"discord.com":Ar}[e]||_r}function textExtraction_typeof(e){return textExtraction_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},textExtraction_typeof(e)}function textExtraction_regeneratorRuntime(){textExtraction_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==textExtraction_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(textExtraction_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function textExtraction_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}var Ir=new Map;function separateCachedAndNewTexts(e){var t=[],r=new Map;return Array.from(e.keys()).forEach((function(e){Ir.has(e)?r.set(e,Ir.get(e)):t.push(e)})),{textsToTranslate:t,cachedTranslations:r}}function collectTextNodes(e){for(var t,r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),n=[],o=new Map;t=r.nextNode();){var a=t.textContent.trim();n.push(t),a&&(o.has(a)?o.get(a).push(t):o.set(a,[t]))}return{textNodes:n,originalTextsMap:o}}function applyTranslationsToNodes(e,t,r){e.forEach((function(e){if(e.parentNode&&e.nodeType===Node.TEXT_NODE){var n=e.textContent,o=n.trim(),a=t.get(o);if(a&&o){var i=e.parentNode;!function(e){e.dataset.aiwcOriginalDirection||(e.dataset.aiwcOriginalDirection=e.style.direction||"");e.dataset.aiwcOriginalTextAlign||(e.dataset.aiwcOriginalTextAlign=e.style.textAlign||"")}(i);var c=document.createElement("span"),s="aiwc-".concat(Math.random().toString(36).substring(2,15));c.setAttribute("data-aiwc-original-id",s),c.setAttribute("data-aiwc-original-text",n);var l=n.split("\n"),u=a.split("\n");l.forEach((function(e,t){var n=void 0!==u[t]?u[t]:"",o=document.createElement("span");if(o.textContent=n,r.state.originalTexts.set(s,{originalText:e,wrapperElement:o}),c.appendChild(o),t<l.length-1){var a=document.createElement("br");a.setAttribute("data-aiwc-br","true"),c.appendChild(a)}})),function(e,t){if(e&&e.style){var r=isRtlText(t);e.style.direction=r?"rtl":"ltr",e.style.textAlign=r?"right":"left"}}(i,!0),correctTextDirection(i,u);try{i.replaceChild(c,e)}catch(t){helpers_logME("[AIWC-textExtraction] Error replacing text node with container:",t,{textNode:e,containerSpan:c,parentElement:i}),r.state.originalTexts["delete"](s);var f=oe.processError(t);r.errorHandler.handle(f,{type:H.PARSE_SELECT_ELEMENT,context:"textExtraction-apply-translations-replace",elementId:"multiple"})}}}}))}function _revertTranslations(){var e;return e=textExtraction_regeneratorRuntime().mark((function _callee(e){var t,r;return textExtraction_regeneratorRuntime().wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:if(r=0,document.querySelectorAll("span[data-aiwc-original-text]").forEach((function(t){var n=t.getAttribute("data-aiwc-original-text");if(null!==n)try{var o=t.parentNode;restoreOriginalParentStyles(o);var a=document.createTextNode(n);o.replaceChild(a,t),r++;for(var i=a.nextSibling;i&&"BR"===i.nodeName&&"true"===i.getAttribute("data-aiwc-br");){var c=i;i=i.nextSibling,c.parentNode.removeChild(c)}}catch(r){e.errorHandler.handle(r,{type:H.PARSE_SELECT_ELEMENT,context:"revert-translations-replace",elementId:t.getAttribute("data-aiwc-original-id")}),helpers_logME("Failed to revert container with original text.",r)}})),!(r>0)){n.next=16;break}return n.t0=e.notifier,n.t1="".concat(r," "),n.next=8,i18n_getTranslationString("STATUS_Revert_Number");case 8:if(n.t2=n.sent,n.t2){n.next=11;break}n.t2="(مورد بازگردانی شد)";case 11:n.t3=n.t2,n.t4=n.t1.concat.call(n.t1,n.t3),n.t0.show.call(n.t0,n.t4,"revert"),n.next=27;break;case 16:return n.next=18,C();case 18:if(!n.sent){n.next=27;break}return n.t5=e.notifier,n.next=22,i18n_getTranslationString("STATUS_REVERT_NOT_FOUND");case 22:if(n.t6=n.sent,n.t6){n.next=25;break}n.t6="(هیچ متنی برای بازگردانی یافت نشد)";case 25:n.t7=n.t6,n.t5.show.call(n.t5,n.t7,"warning");case 27:return null===(t=e.IconManager)||void 0===t||t.cleanup(),e.state.originalTexts.clear(),n.abrupt("return",r);case 30:case"end":return n.stop()}}),_callee)})),_revertTranslations=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){textExtraction_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){textExtraction_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))},_revertTranslations.apply(this,arguments)}function parseAndCleanTranslationResponse(e,t){var r=e.trim().match(/(\[(?:[^]|\n|\r)*\]|\{(?:[^]|\n|\r)*\})/);if(!r||!r[1]){helpers_logME("No JSON structure (array or object) found in the response string.");var n=new Error("هیچ ساختار JSON معتبری در پاسخ یافت نشد.");return t.errorHandler.handle(n,{type:H.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-NoJsonFound"}),[]}var o=r[1].trim();try{return JSON.parse(o)}catch(e){if(helpers_logME("Initial JSON.parse failed. Attempting repair by removing the last element.",e.message),!(o.startsWith("[")&&e instanceof SyntaxError)){helpers_logME("Initial parse failed, and repair condition not met (not array or not SyntaxError).");var a=oe.processError(e);return t.errorHandler.handle(a,{type:H.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-InitialErrorNotRepaired"}),helpers_logME("Original problematic string:",o),[]}var i=o.lastIndexOf(",",o.length-2);if(-1===i){helpers_logME("Could not repair JSON: No comma found to separate the last element.");var c=oe.processError(e);return t.errorHandler.handle(c,{type:H.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-NoCommaForRepair"}),helpers_logME("Original problematic string:",o),[]}var s=o.substring(0,i);s=s.trimEnd()+"]",helpers_logME("Attempting to parse repaired JSON string:",s);try{var l=JSON.parse(s);return helpers_logME("Successfully parsed JSON after removing the potentially corrupted last element.","warning"),l}catch(r){helpers_logME("Repair attempt also failed.",r.message);var u=oe.processError(e);return t.errorHandler.handle(u,{type:H.PARSE_SELECT_ELEMENT,context:"parseAndCleanTranslationResponse-RepairFailed"}),helpers_logME("Original problematic string:",o),[]}}}function expandTextsForTranslation(e){var t=[],r=[],n=new Map;return e.forEach((function(e,o){var a=e.split("\n"),i=[];a.forEach((function(e,n){t.push(e),r.push({originalIndex:o,segmentIndex:n}),i.push(t.length-1)})),n.set(o,i)})),{expandedTexts:t,originMapping:r,originalToExpandedIndices:n}}function handleTranslationLengthMismatch(e,t){return Array.isArray(e)?e.length===t.length||(helpers_logME("عدم تطابق طول.","طول مورد انتظار (بر اساس متن‌های گسترش‌یافته): ".concat(t.length),"طول دریافت شده: ".concat(e.length),"علت احتمالی: تقسیم/ادغام متفاوت متن توسط API یا افزودن/حذف آیتم‌ها.","تلاش برای پردازش با داده‌های موجود ادامه می‌یابد..."),Math.abs(e.length-t.length)<3/7*t.length):(helpers_logME("پاسخ ترجمه یک آرایه نیست.","داده پارس شده:",e),!1)}function restoreOriginalParentStyles(e){void 0!==e.dataset.aiwcOriginalDirection&&(e.style.direction=e.dataset.aiwcOriginalDirection,delete e.dataset.aiwcOriginalDirection),void 0!==e.dataset.aiwcOriginalTextAlign&&(e.style.textAlign=e.dataset.aiwcOriginalTextAlign,delete e.dataset.aiwcOriginalTextAlign)}function reassembleTranslations(e,t,r,n,o){for(var a=new Map,i=new Map,c=Math.min(t.length,e.length),s=0;s<c;s++){var l=e[s],u=r[s];if(l&&"string"==typeof l.text&&u){var f=u.originalIndex;i.has(f)||i.set(f,[]),i.get(f).push(l.text)}else if(helpers_logME("داده ترجمه نامعتبر یا گمشده برای آیتم در اندیس ".concat(s,"."),"آیتم دریافتی:",l,"اطلاعات نگاشت:",u),u){var p=u.originalIndex;i.has(p)||i.set(p,[]),i.get(p).push(t[s])}}return n.forEach((function(e,t){if(i.has(t)){var r=i.get(t).join("\n");a.set(e,r),Ir.set(e,r)}else o.has(e)||a.set(e,e)})),a}function bridgeIntegration_typeof(e){return bridgeIntegration_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bridgeIntegration_typeof(e)}function bridgeIntegration_regeneratorRuntime(){bridgeIntegration_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==bridgeIntegration_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(bridgeIntegration_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function bridgeIntegration_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function bridgeIntegration_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bridgeIntegration_ownKeys(Object(r),!0).forEach((function(t){bridgeIntegration_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bridgeIntegration_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function bridgeIntegration_defineProperty(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=bridgeIntegration_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=bridgeIntegration_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==bridgeIntegration_typeof(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bridgeIntegration_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function injectPageBridge(){if(!document.getElementById("__AI_WRITING_BRIDGE")){var e=document.createElement("script");e.src=t().runtime.getURL("./pageBridge.js"),e.id="__AI_WRITING_BRIDGE",(document.head||document.documentElement).appendChild(e)}}function smartTranslate(e){return _smartTranslate.apply(this,arguments)}function _smartTranslate(){var e;return e=bridgeIntegration_regeneratorRuntime().mark((function _callee(e){var r,n,o,a=arguments;return bridgeIntegration_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:"Popup_Translate",i.prev=1,i.next=4,t().runtime.sendMessage({action:"fetchTranslation",payload:{promptText:e,translationMode:r}});case 4:return n=i.sent,i.abrupt("return",bridgeIntegration_objectSpread(bridgeIntegration_objectSpread({},n),{},{viaBridge:!1}));case 8:return i.prev=8,i.t0=i["catch"](1),helpers_logME("[BridgeIntegration] Normal translate failed. Falling back to bridge."),i.next=13,sendTranslationViaBridge(e,r);case 13:return o=i.sent,i.abrupt("return",o);case 15:case"end":return i.stop()}}),_callee,null,[[1,8]])})),_smartTranslate=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){bridgeIntegration_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){bridgeIntegration_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))},_smartTranslate.apply(this,arguments)}function sendTranslationViaBridge(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Popup_Translate";return new Promise((function(r,n){var o="".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2)),_handler=function(e){var t,a;e.source===window&&"AI_WRITING_TRANSLATE_RESPONSE"===(null===(t=e.data)||void 0===t?void 0:t.type)&&(null===(a=e.data)||void 0===a||null===(a=a.original)||void 0===a?void 0:a.__requestId)===o&&(window.removeEventListener("message",_handler),e.data.error?n(new Error(e.data.error)):r(bridgeIntegration_objectSpread(bridgeIntegration_objectSpread({},e.data.result),{},{viaBridge:!0})))};window.addEventListener("message",_handler),window.postMessage({type:"AI_WRITING_TRANSLATE_REQUEST",text:e,translateMode:t,__requestId:o},"*")}))}function smartTranslationIntegration_typeof(e){return smartTranslationIntegration_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},smartTranslationIntegration_typeof(e)}function smartTranslationIntegration_regeneratorRuntime(){smartTranslationIntegration_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==smartTranslationIntegration_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(smartTranslationIntegration_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function smartTranslationIntegration_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function translateFieldViaSmartHandler(e){return _translateFieldViaSmartHandler.apply(this,arguments)}function _translateFieldViaSmartHandler(){var e;return e=smartTranslationIntegration_regeneratorRuntime().mark((function _callee(e){var r,a,i,c,s,l,u,f,p,h,d,y,g,v,m,_,b,x,w,E,T,k,S,A,I,L;return smartTranslationIntegration_regeneratorRuntime().wrap((function(P){for(;1;)switch(P.prev=P.next){case 0:if(i=e.text,c=e.translationHandler,s=e.target,l=e.selectionRange,u=void 0===l?null:l,i&&c){P.next=3;break}return P.abrupt("return");case 3:return f=u?o:n,p=null!==(r=null===(a=c.detectPlatform)||void 0===a?void 0:a.call(c,s))&&void 0!==r?r:detectPlatform(),P.prev=5,injectPageBridge(),P.next=9,smartTranslate(i,f);case 9:if(!1!==(null==(x=P.sent)?void 0:x.success)){P.next=16;break}return(w=new Error(x.error||H.API)).type=H.API,P.next=15,c.errorHandler.handle(w,{type:H.API,context:"smartTranslate-response-handler",statusCode:x.statusCode||400,isPrimary:!0});case 15:return P.abrupt("return");case 16:if(E=(null!==(h=null!==(d=null!==(y=null!==(g=null===(v=x.data)||void 0===v?void 0:v.translatedText)&&void 0!==g?g:x.translatedText)&&void 0!==y?y:null===(m=x.result)||void 0===m||null===(m=m.data)||void 0===m?void 0:m.translatedText)&&void 0!==d?d:null===(_=x.result)||void 0===_?void 0:_.translatedText)&&void 0!==h?h:"").trim()){P.next=23;break}return(T=new Error(H.TRANSLATION_NOT_FOUND)).type=H.API,P.next=22,c.errorHandler.handle(T,{type:H.API,context:"smartTranslate-handler-main",isPrimary:!0});case 22:return P.abrupt("return");case 23:if(k=null!=s&&s.isContentEditable?s.innerText.trim():s&&"value"in s?s.value.trim():null,helpers_logME("[SmartTranslateHandler] Initial value:",k),S=!1,!u||null===(b=c.strategies[p])||void 0===b||!b.updateElement){P.next=32;break}return P.next=29,c.strategies[p].updateElement(u,E);case 29:S=P.sent,P.next=36;break;case 32:if(!s){P.next=36;break}return P.next=35,c.updateTargetElement(s,E);case 35:S=P.sent;case 36:if(helpers_logME("[SmartTranslateHandler] updateElement result:",S),A=null!=s&&s.isContentEditable?s.innerText.trim():s&&"value"in s?s.value.trim():null,!S||k===A){P.next=41;break}return helpers_logME("[SmartTranslateHandler] Strategy applied successfully"),P.abrupt("return");case 41:if(A!==E){P.next=44;break}return helpers_logME("[SmartTranslateHandler] DOM already updated"),P.abrupt("return");case 44:return helpers_logME("[SmartTranslateHandler] ❗ Fallback to manual apply"),P.next=47,t().runtime.sendMessage({action:"applyTranslationToActiveElement",payload:{translatedText:E}});case 47:if(!0===(I=P.sent)||I&&!0===I.success){P.next=53;break}throw(L=new Error((null==I?void 0:I.error)||H.API_SERVICE)).type=H.API,L;case 53:return helpers_logME("[SmartTranslateHandler] Fallback applied successfully"),P.prev=54,P.next=57,navigator.clipboard.writeText(E);case 57:return P.t0=c.notifier,P.next=60,i18n_getTranslationString("STATUS_SMARTTRANSLATE_COPIED");case 60:if(P.t1=P.sent,P.t1){P.next=63;break}P.t1="ترجمه در حافظه کپی شد. (Ctrl+V)";case 63:P.t2=P.t1,P.t0.show.call(P.t0,P.t2,"success",!0,3e3),P.next=71;break;case 67:return P.prev=67,P.t3=P["catch"](54),P.next=71,c.errorHandler.handle(P.t3,{type:H.UI,context:"smartTranslation-clipboard"});case 71:P.next=77;break;case 73:return P.prev=73,P.t4=P["catch"](5),P.next=77,c.errorHandler.handle(P.t4,{type:P.t4.type||H.API,context:"smartTranslate-handler-main-second"});case 77:case"end":return P.stop()}}),_callee,null,[[5,73],[54,67]])})),_translateFieldViaSmartHandler=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){smartTranslationIntegration_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){smartTranslationIntegration_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))},_translateFieldViaSmartHandler.apply(this,arguments)}function IconBehavior_typeof(e){return IconBehavior_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},IconBehavior_typeof(e)}function IconBehavior_regeneratorRuntime(){IconBehavior_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==IconBehavior_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(IconBehavior_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function IconBehavior_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function setupIconBehavior(e,t,r,n,o){if(e&&t){var a,i=!1,s=new Set,cleanupIcon=function(){var r;i||(i=!0,s.forEach((function(e){return cancelAnimationFrame(e)})),null===(r=a)||void 0===r||r.disconnect(),e.removeEventListener("click",l),e.removeEventListener("blur",blurHandler),t.removeEventListener("blur",blurHandler),e.classList.add("fade-out"),setTimeout((function(){return e.remove()}),50),c.activeTranslateIcon=null)},l=function(){var e,a=(e=IconBehavior_regeneratorRuntime().mark((function _callee(e){var a,i,c,s;return IconBehavior_regeneratorRuntime().wrap((function(l){for(;1;)switch(l.prev=l.next){case 0:if(e.preventDefault(),e.stopPropagation(),isExtensionContextValid()){l.next=7;break}throw(a=new Error(H.CONTEXT)).type=H.CONTEXT,a.context="iconbehavior-click-context",a;case 7:if(i=null,l.prev=8,c=detectPlatform(),s=o[c].extractText(t)){l.next=13;break}return l.abrupt("return");case 13:return l.t0=n,l.next=16,i18n_getTranslationString("STATUS_TRANSLATING_ICON");case 16:if(l.t1=l.sent,l.t1){l.next=19;break}l.t1="در حال ترجمه...";case 19:return l.t2=l.t1,i=l.t0.show.call(l.t0,l.t2,"status",!1),l.next=23,translateFieldViaSmartHandler({text:s,target:t,translationHandler:r});case 23:l.next=28;break;case 25:l.prev=25,l.t3=l["catch"](8),helpers_logME("[IconBehavior] ",l.t3);case 28:return l.prev=28,i&&n.dismiss(i),cleanupIcon(),l.finish(28);case 32:case"end":return l.stop()}}),_callee,null,[[8,25,28,32]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){IconBehavior_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){IconBehavior_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))});return function(e){return a.apply(this,arguments)}}(),blurHandler=function(t){t.relatedTarget&&e.contains(t.relatedTarget)||setTimeout(cleanupIcon,50)},updatePosition=function(){if(t.isConnected&&e.isConnected){var r=requestAnimationFrame((function(){var r=t.getBoundingClientRect();e.style.top="".concat(r.bottom+window.scrollY+5,"px"),e.style.left="".concat(r.left+window.scrollX,"px"),e.style.display="block",e.classList.add("fade-in")}));s.add(r)}else cleanupIcon()};try{e instanceof HTMLElement&&e.isConnected||helpers_logME("[IconBehavior] آیکون معتبر نیست"),t.isConnected&&document.contains(t)||helpers_logME("[IconBehavior] المان هدف در DOM وجود ندارد"),e.style.display="none",document.body.appendChild(e),(a=new ResizeObserver(updatePosition)).observe(t),e.addEventListener("click",l),e.addEventListener("blur",blurHandler),t.addEventListener("blur",blurHandler),updatePosition(),c.activeTranslateIcon=e}catch(e){cleanupIcon(),r.errorHandler.handle(e,{type:H.UI,context:"IconBehavior-setup"})}}}function SelectionWindows_typeof(e){return SelectionWindows_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},SelectionWindows_typeof(e)}function SelectionWindows_regeneratorRuntime(){SelectionWindows_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==SelectionWindows_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(SelectionWindows_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function SelectionWindows_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function SelectionWindows_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){SelectionWindows_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){SelectionWindows_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function SelectionWindows_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,SelectionWindows_toPropertyKey(n.key),n)}}function SelectionWindows_toPropertyKey(e){var t=function(e,t){if("object"!=SelectionWindows_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=SelectionWindows_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==SelectionWindows_typeof(t)?t:t+""}var Lr,Pr=function(){return e=function SelectionWindows(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SelectionWindows),this.fadeInDuration=e.fadeInDuration||50,this.fadeOutDuration=e.fadeOutDuration||125,this.isVisible=!1,this.displayElement=null,this.innerContainer=null,this.removeMouseDownListener=null,this.translationHandler=e.translationHandler,this.notifier=e.notifier,this.originalText=null,this.isTranslationCancelled=!1,this.show=this.show.bind(this),this.cancelCurrentTranslation=this.cancelCurrentTranslation.bind(this)},o=[{key:"show",value:(s=SelectionWindows_asyncToGenerator(SelectionWindows_regeneratorRuntime().mark((function _callee2(e,r){var o,a,i,c,s,l,u=this;return SelectionWindows_regeneratorRuntime().wrap((function(f){for(;1;)switch(f.prev=f.next){case 0:if(isExtensionContextValid()){f.next=6;break}return(o=new Error(H.CONTEXT)).type=H.CONTEXT,f.next=5,this.translationHandler.errorHandler.handle(o,{type:H.CONTEXT,context:"SelectionWindows-show-context",statusCode:"context-invalid"});case 5:return f.abrupt("return",f.sent);case 6:if(e&&(!this.isVisible||e!==this.originalText)){f.next=8;break}return f.abrupt("return");case 8:if(this.dismiss(!1),this.originalText=e,this.isTranslationCancelled=!1,a=determineTranslationMode(e,n),this.displayElement=document.createElement("div"),this.displayElement.classList.add("aiwc-selection-popup-host"),this.applyInitialStyles(r),this.displayElement){f.next=17;break}return f.abrupt("return");case 17:i=this.displayElement.attachShadow({mode:"open"}),(c=document.createElement("style"))&&(c.textContent="\n        .popup-container {\n          background-color: #f8f8f8;\n          color: #333;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          padding: 8px 12px;\n          font-size: 14px;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n          max-width: 300px;\n          overflow-wrap: break-word;\n        }\n        .loading-container {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n        }\n        @keyframes blink {\n          0% { opacity: 0.3; }\n          50% { opacity: 0.8; }\n          100% { opacity: 0.3; }\n        }\n        .loading-dot {\n          font-size: 1.2em;\n          margin: 0 2px;\n          animation: blink 0.7s infinite;\n        }\n        .first-line { margin-bottom: 6px; display: flex; align-items: center; }\n        .original-text { font-weight: bold; margin-left: 6px; }\n        .second-line { margin-top: 4px; }\n        .tts-icon { width: 16px; height: 16px; cursor: pointer; margin-right: 6px; }\n      ",i.appendChild(c)),this.innerContainer=document.createElement("div"),this.innerContainer.classList.add("popup-container"),i.appendChild(this.innerContainer),s=this.createLoadingDots(),this.innerContainer.appendChild(s),document.body.appendChild(this.displayElement),this.isVisible=!0,requestAnimationFrame((function(){u.displayElement.style.opacity="0.9",u.displayElement.style.transform="scale(1)"})),t().runtime.sendMessage({action:"fetchTranslationBackground",payload:{promptText:e,translationMode:a}}).then((function(t){if(!u.isTranslationCancelled&&u.originalText===e){if(null==t||!t.success)throw new Error(t.error||H.SERVICE);var r=(t.data.translatedText||"").trim();if(!r)throw new Error(H.TRANSLATION_NOT_FOUND);u.transitionToTranslatedText(r,s,e,a)}}))["catch"](function(){var e=SelectionWindows_asyncToGenerator(SelectionWindows_regeneratorRuntime().mark((function _callee(e){return SelectionWindows_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,u.handleTranslationError(e,s);case 2:case"end":return t.stop()}}),_callee)})));return function(t){return e.apply(this,arguments)}}()),isExtensionContextValid()&&(l=function(e){u.displayElement.contains(e.target)||u.cancelCurrentTranslation()},document.addEventListener("mousedown",l),this.removeMouseDownListener=l);case 30:case"end":return f.stop()}}),_callee2,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"cancelCurrentTranslation",value:function(){this.dismiss(),this.isTranslationCancelled=!0,this.originalText=null,this.translatedText=null,this.stoptts_playing()}},{key:"stoptts_playing",value:function(){isExtensionContextValid()&&t().runtime.sendMessage({action:"stopTTS"})}},{key:"applyInitialStyles",value:function(e){Object.assign(this.displayElement.style,{position:"absolute",zIndex:"2147483637",left:"".concat(e.x,"px"),top:"".concat(e.y,"px"),transform:"scale(0.1)",transformOrigin:"top left",opacity:"0.6",transition:"transform 0.1s ease-out, opacity ".concat(this.fadeInDuration,"ms ease-in-out")})}},{key:"createLoadingDots",value:function(){var e=document.createElement("div");return e.classList.add("loading-container"),[0,1,2].forEach((function(){var t=document.createElement("span");t.classList.add("loading-dot"),t.textContent=".",e.appendChild(t)})),e}},{key:"transitionToTranslatedText",value:function(e,t,r,n){var o=this;t.remove(),this.innerContainer.innerHTML="";var i=document.createElement("div");i.classList.add("first-line");var c=this.createTTSIcon(r);if(i.appendChild(c),n===a){var s=document.createElement("span");s.classList.add("original-text"),s.textContent=r,i.appendChild(s)}this.innerContainer.appendChild(i);var l=document.createElement("div");l.classList.add("second-line");var u=document.createElement("span");u.classList.add("text-content");var f=marked.parse(e),p=ct.sanitize(f,{RETURN_TRUSTED_TYPE:!0}),h=(new DOMParser).parseFromString(p.toString(),"text/html");Array.from(h.body.childNodes).forEach((function(e){u.appendChild(e)})),l.appendChild(u),this.applyTextDirection(l,e),this.innerContainer.appendChild(l),requestAnimationFrame((function(){o.displayElement.style.transition="opacity 0.15s ease-in-out",o.displayElement.style.opacity="0.9"}))}},{key:"createTTSIcon",value:function(e){var r=document.createElement("img");return r.src=t().runtime.getURL("icons/speaker.png"),r.classList.add("tts-icon"),r.addEventListener("click",(function(r){r.stopPropagation(),isExtensionContextValid()&&t().runtime.sendMessage({action:"speak",text:e,lang:lt})})),r}},{key:"handleTranslationError",value:(c=SelectionWindows_asyncToGenerator(SelectionWindows_regeneratorRuntime().mark((function _callee3(e,t){var r;return SelectionWindows_regeneratorRuntime().wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:return t.remove(),r=e instanceof Error?e:new Error(String(e)),n.next=4,this.translationHandler.errorHandler.handle(r,{type:r.type||H.API,context:"selection-window-translate"});case 4:this.dismiss(!1);case 5:case"end":return n.stop()}}),_callee3,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"dismiss",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.displayElement&&this.isVisible&&(this.removeMouseDownListener&&(document.removeEventListener("mousedown",this.removeMouseDownListener),this.removeMouseDownListener=null),this.isVisible=!1,t&&this.fadeOutDuration>0?(this.displayElement.style.transition="opacity ".concat(this.fadeOutDuration,"ms ease-in-out"),this.displayElement.style.opacity="0",this.displayElement.addEventListener("transitionend",(function(){return e.removeElement()}),{once:!0})):this.removeElement())}},{key:"removeElement",value:function(){this.displayElement&&this.displayElement.parentNode&&this.displayElement.remove(),this.displayElement=null,this.innerContainer=null,this.isVisible=!1,this.originalText=null,this.isTranslationCancelled=!1}},{key:"applyTextDirection",value:function(e,t){if(e){var n=r.RTL_REGEX.test(t);e.style.direction=n?"rtl":"ltr",e.style.textAlign=n?"right":"left"}}}],o&&SelectionWindows_defineProperties(e.prototype,o),i&&SelectionWindows_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,o,i,c,s}();function EventHandler_typeof(e){return EventHandler_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},EventHandler_typeof(e)}function _toConsumableArray(e){return function(e){if(Array.isArray(e))return EventHandler_arrayLikeToArray(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return EventHandler_arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?EventHandler_arrayLikeToArray(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function EventHandler_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function EventHandler_regeneratorRuntime(){EventHandler_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==EventHandler_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(EventHandler_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function EventHandler_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function EventHandler_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){EventHandler_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){EventHandler_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function EventHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EventHandler_toPropertyKey(n.key),n)}}function EventHandler_toPropertyKey(e){var t=function(e,t){if("object"!=EventHandler_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=EventHandler_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==EventHandler_typeof(t)?t:t+""}function _applyDecoratedDescriptor(e,t,r,n,o){var a={};return Object.keys(n).forEach((function(e){a[e]=n[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}var Or=(Lr=function(){return e=function EventHandler(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,EventHandler),this.translationHandler=e,this.featureManager=t,this.IconManager=e.IconManager,this.notifier=e.notifier,this.strategies=e.strategies,this.isProcessing=e.isProcessing,this.SelectionWindows=new Pr({translationHandler:e,notifier:e.notifier}),this.select_Element_ModeActive=e.select_Element_ModeActive,this.handleEvent=this.handleEvent.bind(this),this.handleSelect_ElementModeClick=this.handleSelect_ElementClick.bind(this),this.handleEscape=this.handleEscape.bind(this),this.handleMouseUp=this.handleMouseUp.bind(this),this.selectionTimeoutId=null,this.cancelSelectionTranslation=this.cancelSelectionTranslation.bind(this)},r=[{key:"setFeatureManager",value:function(e){this.featureManager=e}},{key:"handleEvent",value:(p=EventHandler_asyncToGenerator(EventHandler_regeneratorRuntime().mark((function _callee(e){var t,r;return EventHandler_regeneratorRuntime().wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:if(n.prev=0,!this.isEscapeEvent(e)){n.next=4;break}return this.handleEscape(e),n.abrupt("return");case 4:if(!this.select_Element_ModeActive||"click"!==e.type){n.next=8;break}return n.next=7,this.handleSelect_ElementClick(e);case 7:case 11:case 15:return n.abrupt("return");case 8:if(!this.isCtrlSlashEvent(e)){n.next=12;break}return n.next=11,this.handleCtrlSlash(e);case 12:if(!this.isEditableTarget(e.target)||null===(t=this.featureManager)||void 0===t||!t.isOn("TEXT_FIELDS")){n.next=16;break}return n.next=15,this.handleEditableElement(e);case 16:if(!this.isMouseUp(e)){n.next=24;break}return n.next=19,D();case 19:if(!n.sent||this.isMouseUpCtrl(e)){n.next=22;break}return n.abrupt("return");case 22:return n.next=24,this.handleMouseUp(e);case 24:n.next=33;break;case 26:return n.prev=26,n.t0=n["catch"](0),n.next=30,this.translationHandler.processError(n.t0);case 30:return r=n.sent,n.next=33,this.translationHandler.errorHandler.handle(r,{type:H.UI,context:"event-handling",eventType:e.type});case 33:case"end":return n.stop()}}),_callee,this,[[0,26]])}))),function(e){return p.apply(this,arguments)})},{key:"isMouseUpCtrl",value:function(e){return"mouseup"===e.type&&(e.ctrlKey||e.metaKey)}},{key:"isMouseUp",value:function(e){return"mouseup"===e.type}},{key:"isCtrlSlashEvent",value:function(e){return(e.ctrlKey||e.metaKey)&&"/"===e.key&&!e.repeat}},{key:"isEscapeEvent",value:function(e){return"Escape"===e.key&&!e.repeat}},{key:"_getSelectedTextWithDash",value:function(){var e=window.getSelection(),t="";if(e.rangeCount>1)for(var r=0;r<e.rangeCount;r++)t+=e.getRangeAt(r).toString().trim(),r<e.rangeCount-1&&(t+=" - \n");else t=e.toString().trim();return t.trim()}},{key:"_getEventPath",value:function(e){var t=e.composedPath?e.composedPath():[];if(!t||0===t.length){var r=e.target;for(t=[];r;)t.push(r),r=r.parentNode}return t}},{key:"handleMouseUp",value:(f=EventHandler_asyncToGenerator(EventHandler_regeneratorRuntime().mark((function _callee2(e){var t,r,n,o,a,i=this;return EventHandler_regeneratorRuntime().wrap((function(c){for(;1;)switch(c.prev=c.next){case 0:if(n=this._getSelectedTextWithDash(),o=this._getEventPath(e),null===(t=this.SelectionWindows)||void 0===t||!t.isVisible||!o.includes(null===(r=this.SelectionWindows)||void 0===r?void 0:r.displayElement)){c.next=4;break}return c.abrupt("return");case 4:n?this.selectionTimeoutId||(this.selectionTimeoutId=setTimeout((function(){i.selectionTimeoutId=null,i.processSelectedText(n,e)}),250),document.addEventListener("mousedown",this.cancelSelectionTranslation)):(this.selectionTimeoutId&&(clearTimeout(this.selectionTimeoutId),this.selectionTimeoutId=null,document.removeEventListener("mousedown",this.cancelSelectionTranslation)),null!==(a=this.SelectionWindows)&&void 0!==a&&a.isVisible&&this.SelectionWindows.dismiss());case 5:case"end":return c.stop()}}),_callee2,this)}))),function(e){return f.apply(this,arguments)})},{key:"cancelSelectionTranslation",value:function(){if(this.selectionTimeoutId){clearTimeout(this.selectionTimeoutId),this.selectionTimeoutId=null;try{document.removeEventListener("mousedown",this.cancelSelectionTranslation)}catch(e){}}}},{key:"processSelectedText",value:(u=EventHandler_asyncToGenerator(EventHandler_regeneratorRuntime().mark((function _callee3(e){var t,r,n,o,a,i,c;return EventHandler_regeneratorRuntime().wrap((function(s){for(;1;)switch(s.prev=s.next){case 0:r=window.getSelection(),n={x:0,y:0},r.rangeCount>0&&(o=r.getRangeAt(0),a=o.getBoundingClientRect(),n={x:a.left+window.scrollX,y:a.bottom+window.scrollY+15},i=300,c=window.innerWidth,n.x<10?n.x=10:n.x+i>c-10&&(n.x=c-i-10)),null===(t=this.SelectionWindows)||void 0===t||t.show(e,n),document.removeEventListener("mousedown",this.cancelSelectionTranslation);case 5:case"end":return s.stop()}}),_callee3,this)}))),function(e){return u.apply(this,arguments)})},{key:"isEditableTarget",value:function(e){return(null==e?void 0:e.isContentEditable)||["INPUT","TEXTAREA"].includes(null==e?void 0:e.tagName)||(null==e?void 0:e.closest)&&e.closest('[contenteditable="true"]')}},{key:"_processEditableElement",value:function(e){if(!this.IconManager||!this.featureManager.isOn("EXTENSION_ENABLED"))return null;if(!this.IconManager)return null;if(this.IconManager.cleanup(),detectPlatform()===Sr){var t,r=this.strategies["youtube"];if(null!=r&&null!==(t=r.isYoutube_ExtraField)&&void 0!==t&&t.call(r,e))return null}var n=this.IconManager.createTranslateIcon(e);return n?(setupIconBehavior(n,e,this.translationHandler,this.notifier,this.strategies),n):null}},{key:"handleEditableFocus",value:function(e){var t;c.activeTranslateIcon||null!==(t=this.featureManager)&&void 0!==t&&t.isOn("TEXT_FIELDS")&&this._processEditableElement(e)}},{key:"handleEditableElement",value:(l=EventHandler_asyncToGenerator(EventHandler_regeneratorRuntime().mark((function _callee4(e){var t,r;return EventHandler_regeneratorRuntime().wrap((function(n){for(;1;)switch(n.prev=n.next){case 0:if(!c.activeTranslateIcon){n.next=2;break}return n.abrupt("return");case 2:e.stopPropagation(),r=e.target,null!==(t=this.featureManager)&&void 0!==t&&t.isOn("TEXT_FIELDS")&&this._processEditableElement(r);case 5:case"end":return n.stop()}}),_callee4,this)}))),function(e){return l.apply(this,arguments)})},{key:"handleEditableBlur",value:function(){var e=this;setTimeout((function(){var t,r;null!==(t=document.activeElement)&&void 0!==t&&t.isConnected&&(document.activeElement===c.activeTranslateIcon||document.activeElement.closest(".AIWritingCompanion-translation-icon-extension"))||null===(r=e.IconManager)||void 0===r||r.cleanup()}),100)}},{key:"cleanCache",value:(s=EventHandler_asyncToGenerator(EventHandler_regeneratorRuntime().mark((function _callee5(){return EventHandler_regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return t={state:c},Ir.clear(),t&&t.state&&t.state.originalTexts&&t.state.originalTexts.clear(),e.t0=this.notifier,e.next=4,i18n_getTranslationString("STATUS_REMOVE_MEMORY");case 4:if(e.t1=e.sent,e.t1){e.next=7;break}e.t1="Memory Cleared";case 7:e.t2=e.t1,e.t0.show.call(e.t0,e.t2,"info",!0,2e3);case 9:case"end":return e.stop()}var t}),_callee5,this)}))),function(){return s.apply(this,arguments)})},{key:"handleSelect_ElementClick",value:(i=EventHandler_asyncToGenerator(EventHandler_regeneratorRuntime().mark((function _callee6(e){var r,n,a,i,s,l,u,f,p,h,d,y,g,v,m,_,b,x,w,E,T,k,S,A,I=this;return EventHandler_regeneratorRuntime().wrap((function(L){for(;1;)switch(L.prev=L.next){case 0:if(taggleLinks(!1),this.translationHandler.select_Element_ModeActive=!1,c.selectElementActive=!1,this.IconManager&&this.IconManager.cleanup(),r=e.target,n=collectTextNodes(r),a=n.textNodes,(i=n.originalTextsMap).size){L.next=8;break}return L.abrupt("return",{status:"empty",reason:"no_text_found"});case 8:if(s=separateCachedAndNewTexts(i),l=s.textsToTranslate,u=s.cachedTranslations,l.length||!u.size){L.next=21;break}return applyTranslationsToNodes(a,u,{state:c,IconManager:this.IconManager}),L.t0=this.notifier,L.next=14,i18n_getTranslationString("STATUS_FROM_MEMORY");case 14:if(L.t1=L.sent,L.t1){L.next=17;break}L.t1="از حافظه";case 17:return L.t2=L.t1,L.t3=function(){return I.cleanCache()},L.t0.show.call(L.t0,L.t2,"info",!0,2e3,L.t3),L.abrupt("return",{status:"success",source:"cache",translatedCount:u.size});case 21:if(l.length){L.next=23;break}return L.abrupt("return",{status:"skip",reason:"no_new_texts"});case 23:return L.t4=this.notifier,L.next=26,i18n_getTranslationString("STATUS_TRANSLATING_SELECT_ELEMENT");case 26:if(L.t5=L.sent,L.t5){L.next=29;break}L.t5="در حال ترجمه…";case 29:if(L.t6=L.t5,f=L.t4.show.call(L.t4,L.t6,"status",!1),c.translateMode=o,L.prev=32,h=expandTextsForTranslation(l),d=h.expandedTexts,y=h.originMapping,!((g=JSON.stringify(d.map((function(e){return{text:e}})))).length>2e4)){L.next=39;break}return v="متن انتخابی بسیار بزرگ است (".concat(g.length," بایت)"),this.notifier.show(v,"warning",!0,3e3),L.abrupt("return",{status:"error",reason:"payload_large",message:v});case 39:return L.next=41,t().runtime.sendMessage({action:"fetchTranslationBackground",payload:{promptText:g,translationMode:o}});case 41:if(null!=(m=L.sent)&&m.success){L.next=47;break}return _=(null==m?void 0:m.error)||"(⚠️ خطایی در ترجمه رخ داد.)",L.next=46,this.translationHandler.errorHandler.handle(new Error(_),{type:H.API,statusCode:(null==m?void 0:m.statusCode)||401,context:"select-element-response"});case 46:return L.abrupt("return",{status:"error",reason:"backend_error",message:_});case 47:if(!m||!1!==m.success){L.next=52;break}return x="string"==typeof m.error?m.error:(null===(b=m.error)||void 0===b?void 0:b.message)||"(⚠️ خطایی در ترجمه رخ داد.)",L.next=51,this.translationHandler.errorHandler.handle(new Error(x),{type:H.API,context:"select-element-response"});case 51:return L.abrupt("return",{status:"error",reason:"api_error",message:x});case 52:if("string"==typeof(w=null==m||null===(p=m.data)||void 0===p?void 0:p.translatedText)&&w.trim()){L.next=57;break}return E="(⚠️ ترجمه‌ای دریافت نشد.)",this.notifier.show(E,"warning",!0,3e3),L.abrupt("return",{status:"error",reason:"empty_translation",message:E});case 57:if(T=parseAndCleanTranslationResponse(w,this.translationHandler)){L.next=62;break}return L.next=61,this.translationHandler.errorHandler.handle(new Error(H.API_RESPONSE_INVALID),{type:H.API,context:"select-element-response-format"});case 61:return L.abrupt("return",{status:"error",reason:"api_error",message:H.API_RESPONSE_INVALID});case 62:return handleTranslationLengthMismatch(T,d)||this.notifier.show("(طول پاسخ ناهمخوان؛ مجدداً امتحان کنید.)","info",!0,1500),k=reassembleTranslations(T,d,y,l,u),S=new Map([].concat(_toConsumableArray(u),_toConsumableArray(k))),applyTranslationsToNodes(a,S,{state:c,IconManager:this.IconManager}),f&&this.notifier.dismiss(f),L.abrupt("return",{status:"success",source:"translated",translatedCount:k.size,fromCache:u.size});case 70:return L.prev=70,L.t7=L["catch"](32),L.next=74,oe.processError(L.t7);case 74:return A=L.sent,L.next=77,this.translationHandler.errorHandler.handle(A,{type:A.type||H.SERVICE,context:"EventHandler-handleSelect_ElementClick"});case 77:return L.abrupt("return",{status:"error",reason:"exception",message:A.message});case 78:return L.prev=78,f&&this.notifier.dismiss(f),L.finish(78);case 81:case"end":return L.stop()}}),_callee6,this,[[32,70,78,81]])}))),function(e){return i.apply(this,arguments)})},{key:"handleEscape",value:function(){taggleLinks(!1),this.cancelSelectionTranslation(),this.SelectionWindows.cancelCurrentTranslation(),this.translationHandler.select_Element_ModeActive=!1,c.selectElementActive=!1,c.translateMode===o&&function(e){_revertTranslations.apply(this,arguments)}({state:c,errorHandler:this.translationHandler.errorHandler,notifier:this.notifier,IconManager:this.IconManager}),this.IconManager&&this.IconManager.cleanup()}},{key:"handleCtrlSlash",value:(a=EventHandler_asyncToGenerator(EventHandler_regeneratorRuntime().mark((function _callee7(e){var t,r,n,o,a,i,c;return EventHandler_regeneratorRuntime().wrap((function(s){for(;1;)switch(s.prev=s.next){case 0:if(e.preventDefault(),e.stopPropagation(),!this.isProcessing){s.next=4;break}return s.abrupt("return");case 4:if(this.isProcessing=!0,s.prev=5,t=this.translationHandler.getSelectElementContext(),r=t.activeElement,isEditable(r)){s.next=9;break}return s.abrupt("return");case 9:if(n=this.translationHandler.extractFromActiveElement(r)){s.next=12;break}return s.abrupt("return");case 12:return s.next=14,this.translationHandler.processTranslation_with_CtrlSlash({text:n,originalText:n,target:r,selectionRange:null});case 14:s.next=25;break;case 16:return s.prev=16,s.t0=s["catch"](5),s.next=20,oe.processError(s.t0);case 20:if(a=s.sent,helpers_logME("[EventHandler] Ctrl+/ Error: ",a),!a.isFinal){s.next=24;break}return s.abrupt("return");case 24:null!==(o=a.originalError)&&void 0!==o&&o.isPrimary||(i=a.type||H.API,c=a.statusCode||500,this.translationHandler.errorHandler.handle(a,{type:i,statusCode:c,context:"ctrl-slash",suppressSecondary:!0}));case 25:return s.prev=25,this.isProcessing=!1,s.finish(25);case 28:case"end":return s.stop()}}),_callee7,this,[[5,16,25,28]])}))),function(e){return a.apply(this,arguments)})}],r&&EventHandler_defineProperties(e.prototype,r),n&&EventHandler_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n,a,i,s,l,u,f,p}(),_applyDecoratedDescriptor(Lr.prototype,"handleEvent",[logMethod],Object.getOwnPropertyDescriptor(Lr.prototype,"handleEvent"),Lr.prototype),_applyDecoratedDescriptor(Lr.prototype,"handleMouseUp",[logMethod],Object.getOwnPropertyDescriptor(Lr.prototype,"handleMouseUp"),Lr.prototype),_applyDecoratedDescriptor(Lr.prototype,"handleSelect_ElementClick",[logMethod],Object.getOwnPropertyDescriptor(Lr.prototype,"handleSelect_ElementClick"),Lr.prototype),Lr);function FeatureManager_typeof(e){return FeatureManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},FeatureManager_typeof(e)}function _slicedToArray(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],s=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=r["return"]&&(i=r["return"](),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return FeatureManager_arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?FeatureManager_arrayLikeToArray(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function FeatureManager_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function FeatureManager_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,FeatureManager_toPropertyKey(n.key),n)}}function FeatureManager_toPropertyKey(e){var t=function(e,t){if("object"!=FeatureManager_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=FeatureManager_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==FeatureManager_typeof(t)?t:t+""}var Gr=function(){return e=function FeatureManager(){var e,n,o,a,i,c,s=this,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FeatureManager),this.keyMap={EXTENSION_ENABLED:"EXTENSION_ENABLED",TRANSLATE_ON_TEXT_FIELDS:"TEXT_FIELDS",ENABLE_SHORTCUT_FOR_TEXT_FIELDS:"SHORTCUT_TEXT_FIELDS",TRANSLATE_WITH_SELECT_ELEMENT:"SELECT_ELEMENT",TRANSLATE_ON_TEXT_SELECTION:"TEXT_SELECTION",ENABLE_DICTIONARY:"DICTIONARY"},this.flags={EXTENSION_ENABLED:null===(e=l.EXTENSION_ENABLED)||void 0===e||e,TEXT_FIELDS:null!==(n=l.TEXT_FIELDS)&&void 0!==n?n:r.TRANSLATE_ON_TEXT_FIELDS,SHORTCUT_TEXT_FIELDS:null!==(o=l.SHORTCUT_TEXT_FIELDS)&&void 0!==o?o:r.ENABLE_SHORTCUT_FOR_TEXT_FIELDS,SELECT_ELEMENT:null!==(a=l.SELECT_ELEMENT)&&void 0!==a?a:r.TRANSLATE_WITH_SELECT_ELEMENT,TEXT_SELECTION:null!==(i=l.TEXT_SELECTION)&&void 0!==i?i:r.TRANSLATE_ON_TEXT_SELECTION,DICTIONARY:null!==(c=l.DICTIONARY)&&void 0!==c?c:r.ENABLE_DICTIONARY},this._subscribers={},t().storage.local.get(Object.keys(this.keyMap)).then((function(e){Object.entries(e).forEach((function(e){var t,r=_slicedToArray(e,2),n=r[0],o=r[1],a=s.keyMap[n];a&&void 0!==o&&(s.flags[a]=o,null===(t=s._subscribers[a])||void 0===t||t.forEach((function(e){return e()})))}))}))["catch"]((function(e){helpers_logME("[FeatureManager] failed to load initial flags",e)})),t().storage.onChanged.addListener(this._onStorageChanged.bind(this))},n=[{key:"isOn",value:function(e){return this.flags[e]}},{key:"on",value:function(e,t){var r,n;(null!==(n=(r=this._subscribers)[e])&&void 0!==n?n:r[e]=[]).push(t)}},{key:"_onStorageChanged",value:function(e){var t=this;Object.entries(e).forEach((function(e){var r=_slicedToArray(e,2),n=r[0],o=r[1].newValue,a=t.keyMap[n];if(a){var i,c=null!=o?o:t.flags[a];t.flags[a]!==c&&(t.flags[a]=c,null===(i=t._subscribers[a])||void 0===i||i.forEach((function(e){return e()})))}}))}}],n&&FeatureManager_defineProperties(e.prototype,n),o&&FeatureManager_defineProperties(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n,o}();function EventRouter_typeof(e){return EventRouter_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},EventRouter_typeof(e)}function EventRouter_regeneratorRuntime(){EventRouter_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==EventRouter_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(EventRouter_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function EventRouter_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function EventRouter_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){EventRouter_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){EventRouter_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function EventRouter_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EventRouter_toPropertyKey(n.key),n)}}function EventRouter_toPropertyKey(e){var t=function(e,t){if("object"!=EventRouter_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=EventRouter_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==EventRouter_typeof(t)?t:t+""}var Cr,Rr=function(){return e=function EventRouter(e,t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,EventRouter),this.translationHandler=e,this.errorHandler=e.errorHandler;var wrap=function(e){return function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];try{return e.apply(r,n)}catch(e){var a;!function(e){_handleUIError.apply(this,arguments)}(e,{type:H.UI,context:"event-router",eventType:null===(a=n[0])||void 0===a?void 0:a.type})}}};this.handleFocus=wrap(this.handleFocusMethod),this.handleBlur=wrap(this.handleBlurMethod),this.handleClick=wrap(this.handleClickMethod),this.handleKeyDown=wrap(this.handleKeyDownMethod),this.handleMouseOver=wrap(this.handleMouseOverMethod),this.handleMouseUp=wrap(this.handleMouseUpMethod),this.featureManager=t,this._attached=new Set,this.featureEventMap={TEXT_FIELDS:[{target:document,type:"focus",listener:this.handleFocus,options:!0},{target:document,type:"blur",listener:this.handleBlur,options:!0}],SHORTCUT_TEXT_FIELDS:[{target:document,type:"keydown",listener:this.handleKeyDown}],SELECT_ELEMENT:[{target:document,type:"mouseover",listener:this.handleMouseOver},{target:document,type:"click",listener:this.handleClick}],TEXT_SELECTION:[{target:document,type:"mouseup",listener:this.handleMouseUp}]},this.initEventListeners(),this.featureManager.on("EXTENSION_ENABLED",(function(){return r.initEventListeners()})),Object.keys(this.featureEventMap).forEach((function(e){r.featureManager.on(e,(function(){return r.updateListeners(e)}))}))},t=[{key:"initEventListeners",value:function(){var e=this,t=this.featureManager.isOn("EXTENSION_ENABLED");Object.keys(this.featureEventMap).forEach((function(r){t?e.updateListeners(r):e.removeListeners(r)}))}},{key:"updateListeners",value:function(e){var t=this,r=this.featureManager.isOn(e)&&this.featureManager.isOn("EXTENSION_ENABLED");this.featureEventMap[e].forEach((function(n){var o=n.target,a=n.type,i=n.listener,c=n.options,s="".concat(a,"_").concat(e);r&&!t._attached.has(s)?(o.addEventListener(a,i,c),t._attached.add(s)):!r&&t._attached.has(s)&&(o.removeEventListener(a,i,c),t._attached["delete"](s))}))}},{key:"removeListeners",value:function(e){var t=this;this.featureEventMap[e].forEach((function(r){var n=r.target,o=r.type,a=r.listener,i=r.options,c="".concat(o,"_").concat(e);t._attached.has(c)&&(n.removeEventListener(o,a,i),t._attached["delete"](c))}))}},{key:"handleFocusMethod",value:(f=EventRouter_asyncToGenerator(EventRouter_regeneratorRuntime().mark((function _callee(e){return EventRouter_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:this.featureManager.isOn("TEXT_FIELDS")&&e.target.isContentEditable&&this.translationHandler.handleEditableFocus(e.target);case 1:case"end":return t.stop()}}),_callee,this)}))),function(e){return f.apply(this,arguments)})},{key:"handleBlurMethod",value:(u=EventRouter_asyncToGenerator(EventRouter_regeneratorRuntime().mark((function _callee2(e){return EventRouter_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:this.featureManager.isOn("TEXT_FIELDS")&&e.target.isContentEditable&&this.translationHandler.handleEditableBlur(e.target);case 1:case"end":return t.stop()}}),_callee2,this)}))),function(e){return u.apply(this,arguments)})},{key:"handleClickMethod",value:(l=EventRouter_asyncToGenerator(EventRouter_regeneratorRuntime().mark((function _callee3(e){return EventRouter_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:if(c.selectElementActive){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.translationHandler.eventHandler.handleSelect_ElementClick(e);case 4:case"end":return t.stop()}}),_callee3,this)}))),function(e){return l.apply(this,arguments)})},{key:"handleKeyDownMethod",value:(s=EventRouter_asyncToGenerator(EventRouter_regeneratorRuntime().mark((function _callee4(e){return EventRouter_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:this.translationHandler.handleEvent(e);case 1:case"end":return t.stop()}}),_callee4,this)}))),function(e){return s.apply(this,arguments)})},{key:"handleMouseOverMethod",value:(i=EventRouter_asyncToGenerator(EventRouter_regeneratorRuntime().mark((function _callee5(e){var t,n,o,a;return EventRouter_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(c.selectElementActive){i.next=2;break}return i.abrupt("return");case 2:if(null!=(a=(null===(t=e.composedPath)||void 0===t?void 0:t.call(e)[0])||e.target)&&null!==(n=a.innerText)&&void 0!==n&&n.trim()){i.next=5;break}return i.abrupt("return");case 5:(null===(o=c.highlightedElement)||void 0===o||null===(o=o.style)||void 0===o?void 0:o.outline)&&(c.highlightedElement.style.outline=""),c.highlightedElement=a,a.style.outline=r.HIGHLIGHT_STYLE;case 8:case"end":return i.stop()}}),_callee5)}))),function(e){return i.apply(this,arguments)})},{key:"handleMouseUpMethod",value:(a=EventRouter_asyncToGenerator(EventRouter_regeneratorRuntime().mark((function _callee6(e){return EventRouter_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:this.translationHandler.handleEvent(e);case 1:case"end":return t.stop()}}),_callee6,this)}))),function(e){return a.apply(this,arguments)})},{key:"dispose",value:(o=EventRouter_asyncToGenerator(EventRouter_regeneratorRuntime().mark((function _callee7(){var e=this;return EventRouter_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:Object.keys(this.featureEventMap).forEach((function(t){return e.removeListeners(t)}));case 1:case"end":return t.stop()}}),_callee7,this)}))),function(){return o.apply(this,arguments)})}],t&&EventRouter_defineProperties(e.prototype,t),n&&EventRouter_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,o,a,i,s,l,u,f}();function TranslationHandler_typeof(e){return TranslationHandler_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},TranslationHandler_typeof(e)}function TranslationHandler_slicedToArray(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,c=[],s=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=a.call(r)).done)&&(c.push(n.value),c.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=r["return"]&&(i=r["return"](),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return TranslationHandler_arrayLikeToArray(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?TranslationHandler_arrayLikeToArray(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function TranslationHandler_arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function TranslationHandler_ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function TranslationHandler_objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?TranslationHandler_ownKeys(Object(r),!0).forEach((function(t){TranslationHandler_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TranslationHandler_ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function TranslationHandler_defineProperty(e,t,r){return(t=TranslationHandler_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TranslationHandler_defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,TranslationHandler_toPropertyKey(n.key),n)}}function TranslationHandler_toPropertyKey(e){var t=function(e,t){if("object"!=TranslationHandler_typeof(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=TranslationHandler_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==TranslationHandler_typeof(t)?t:t+""}function TranslationHandler_applyDecoratedDescriptor(e,t,r,n,o){var a={};return Object.keys(n).forEach((function(e){a[e]=n[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce((function(r,n){return n(e,t,r)||r}),a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer?(Object.defineProperty(e,t,a),null):a}function TranslationHandler_regeneratorRuntime(){TranslationHandler_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==TranslationHandler_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(TranslationHandler_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function TranslationHandler_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function TranslationHandler_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){TranslationHandler_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){TranslationHandler_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}var Nr=(Cr=function(){return e=function TranslationHandler(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,TranslationHandler),this.notifier=new J,this.errorHandler=new oe(this.notifier),this.ErrorTypes=H,this.handleEvent=function(e,t){var r;return function(){for(var n=this,o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];clearTimeout(r),r=setTimeout((function(){clearTimeout(r),e.apply(n,a)}),t)}}(this.handleEvent.bind(this),300),this.strategies=TranslationHandler_defineProperty(TranslationHandler_defineProperty(TranslationHandler_defineProperty(TranslationHandler_defineProperty(TranslationHandler_defineProperty(TranslationHandler_defineProperty(TranslationHandler_defineProperty(TranslationHandler_defineProperty(TranslationHandler_defineProperty({},br,new lr(this.notifier,this.errorHandler)),wr,new ur(this.notifier,this.errorHandler)),Tr,new hr(this.notifier,this.errorHandler)),xr,new pr(this.notifier,this.errorHandler)),Er,new fr(this.notifier,this.errorHandler)),kr,new dr(this.notifier,this.errorHandler)),Sr,new yr(this.notifier,this.errorHandler)),_r,new gr(this.notifier,this.errorHandler)),Ar,new vr(this.notifier,this.errorHandler)),this.validateStrategies(),this.IconManager=new mr(this.errorHandler),this.displayedErrors=new Set,this.isProcessing=!1,this.select_Element_ModeActive=!1,this.featureManager=new Gr({TEXT_FIELDS:r.TRANSLATE_ON_TEXT_FIELDS,SHORTCUT_TEXT_FIELDS:r.ENABLE_SHORTCUT_FOR_TEXT_FIELDS,SELECT_ELEMENT:r.TRANSLATE_WITH_SELECT_ELEMENT,TEXT_SELECTION:r.TRANSLATE_ON_TEXT_SELECTION,DICTIONARY:r.ENABLE_DICTIONARY}),this.eventHandler=new Or(this,this.featureManager),this.eventRouter=new Rr(this,this.featureManager)},t=[{key:"reinitialize",value:function(){helpers_logME("[TranslationHandler] Reinitializing state after update..."),this.isProcessing=!1,this.select_Element_ModeActive=!1}},{key:"handleEvent",value:(p=TranslationHandler_asyncToGenerator(TranslationHandler_regeneratorRuntime().mark((function _callee2(e){return TranslationHandler_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.eventHandler.handleEvent(e);case 3:t.next=10;break;case 5:return t.prev=5,t.t0=t["catch"](0),t.next=9,this.errorHandler.handle(t.t0,{type:t.t0.type||H.UI,context:"handleEvent",eventType:e.type});case 9:throw t.sent;case 10:case"end":return t.stop()}}),_callee2,this,[[0,5]])}))),function(e){return p.apply(this,arguments)})},{key:"handleError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e instanceof Error?e:new Error(String(e));this.errorHandler.handle(r,TranslationHandler_objectSpread(TranslationHandler_objectSpread({},t),{},{origin:"TranslationHandler"}))}},{key:"handleError_OLD",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var r=e instanceof Error?e:new Error(String(e));this.errorHandler.handle(r,TranslationHandler_objectSpread(TranslationHandler_objectSpread({},t),{},{origin:"TranslationHandler"}))}catch(e){throw helpers_logME("[TranslationHandler] Error handling failed:",e),this.errorHandler.handle(e,{type:H.UI,context:"TranslationHandler-handleError"})}}},{key:"handleEditableFocus",value:function(e){this.eventHandler.handleEditableFocus(e)}},{key:"handleEditableBlur",value:function(){this.eventHandler.handleEditableBlur()}},{key:"handleEscape",value:function(e){this.eventHandler.handleEscape(e)}},{key:"handleCtrlSlash",value:(f=TranslationHandler_asyncToGenerator(TranslationHandler_regeneratorRuntime().mark((function _callee3(e){return TranslationHandler_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,this.eventHandler.handleCtrlSlash(e);case 2:case"end":return t.stop()}}),_callee3,this)}))),function(e){return f.apply(this,arguments)})},{key:"handleEditableElement",value:(u=TranslationHandler_asyncToGenerator(TranslationHandler_regeneratorRuntime().mark((function _callee4(e){return TranslationHandler_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return t.next=2,this.eventHandler.handleEditableElement(e);case 2:case"end":return t.stop()}}),_callee4,this)}))),function(e){return u.apply(this,arguments)})},{key:"processTranslation_with_CtrlSlash",value:(l=TranslationHandler_asyncToGenerator(TranslationHandler_regeneratorRuntime().mark((function _callee5(e){var t,r,a,i;return TranslationHandler_regeneratorRuntime().wrap((function(s){for(;1;)switch(s.prev=s.next){case 0:if(t=null,s.prev=1,isExtensionContextValid()){s.next=6;break}if(e.target){s.next=6;break}return this.errorHandler.handle(new Error(H.CONTEXT),{type:H.CONTEXT,context:"TranslationHandler-processTranslation-context",code:"context-invalid",statusCode:"context-invalid"}),s.abrupt("return");case 6:return s.t0=this.notifier,s.next=9,i18n_getTranslationString("STATUS_TRANSLATING_CTRLSLASH");case 9:if(s.t1=s.sent,s.t1){s.next=12;break}s.t1="(translating...)";case 12:return s.t2=s.t1,t=s.t0.show.call(s.t0,s.t2,"status"),c.translateMode=e.selectionRange?o:n,s.next=17,translateFieldViaSmartHandler({text:e.text,translationHandler:this,target:e.target,selectionRange:e.selectionRange});case 17:s.next=33;break;case 19:return s.prev=19,s.t3=s["catch"](1),s.next=23,oe.processError(s.t3);case 23:return r=s.sent,s.next=26,this.errorHandler.handle(r,{type:r.type||H.CONTEXT,context:"TranslationHandler-processTranslation",translationParams:e,isPrimary:!0});case 26:if(a=s.sent,t&&this.notifier.dismiss(t),!a.isFinal&&!a.suppressSecondary){s.next=30;break}return s.abrupt("return");case 30:throw i=new Error(a.message),Object.assign(i,{type:a.type,statusCode:a.statusCode,isFinal:!0,originalError:s.t3}),i;case 33:return s.prev=33,t&&this.notifier.dismiss(t),s.finish(33);case 36:case"end":return s.stop()}}),_callee5,this,[[1,19,33,36]])}))),function(e){return l.apply(this,arguments)})},{key:"validateStrategies",value:(s=TranslationHandler_asyncToGenerator(TranslationHandler_regeneratorRuntime().mark((function _callee6(){return TranslationHandler_regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:try{Object.entries(this.strategies).forEach((function(e){var t=TranslationHandler_slicedToArray(e,2),r=t[0];if("function"!=typeof t[1].extractText)throw new Error("استراتژی ".concat(r," متد extractText را پیاده‌سازی نکرده است"))}))}catch(e){this.errorHandler.handle(e,{type:H.INTEGRATION,context:"strategy-validation"})}case 1:case"end":return e.stop()}}),_callee6,this)}))),function(){return s.apply(this,arguments)})},{key:"updateTargetElement",value:(i=TranslationHandler_asyncToGenerator(TranslationHandler_regeneratorRuntime().mark((function _callee7(e,t){var r,n;return TranslationHandler_regeneratorRuntime().wrap((function(o){for(;1;)switch(o.prev=o.next){case 0:if(o.prev=0,"string"!=typeof t||!t){o.next=7;break}if(n=detectPlatform(),null===(r=this.strategies[n])||void 0===r||!r.updateElement||"function"!=typeof this.strategies[n].updateElement){o.next=7;break}return o.next=6,this.strategies[n].updateElement(e,t);case 6:return o.abrupt("return",o.sent);case 7:o.next=12;break;case 9:o.prev=9,o.t0=o["catch"](0),this.errorHandler.handle(o.t0,{type:H.SERVICE,context:"update-target-element",platform:detectPlatform()});case 12:return o.abrupt("return",!1);case 13:case"end":return o.stop()}}),_callee7,this,[[0,9]])}))),function(e,t){return i.apply(this,arguments)})},{key:"getSelectElementContext",value:function(){return{select_element:window.getSelection(),activeElement:document.activeElement}}},{key:"extractFromActiveElement",value:function(e){var t=detectPlatform(),r=this.strategies[t];return r&&"function"==typeof r.extractText?r.extractText(e):(this.errorHandler.handle(new Error("extractText method not implemented for this platform"),{type:H.SERVICE,context:"TranslationHandler-extractFromActiveElement-".concat(t)}),"")}},{key:"pasteContent",value:function(e,t){try{var r=detectPlatform();this.strategies[r].pasteContent(e,t)}catch(e){this.errorHandler.handle(e,{type:H.UI,context:"paste-content",platform:detectPlatform()})}}}],t&&TranslationHandler_defineProperties(e.prototype,t),a&&TranslationHandler_defineProperties(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a,i,s,l,u,f,p}(),TranslationHandler_applyDecoratedDescriptor(Cr.prototype,"reinitialize",[logMethod],Object.getOwnPropertyDescriptor(Cr.prototype,"reinitialize"),Cr.prototype),TranslationHandler_applyDecoratedDescriptor(Cr.prototype,"handleEvent",[logMethod],Object.getOwnPropertyDescriptor(Cr.prototype,"handleEvent"),Cr.prototype),TranslationHandler_applyDecoratedDescriptor(Cr.prototype,"handleError",[logMethod],Object.getOwnPropertyDescriptor(Cr.prototype,"handleError"),Cr.prototype),TranslationHandler_applyDecoratedDescriptor(Cr.prototype,"handleError_OLD",[logMethod],Object.getOwnPropertyDescriptor(Cr.prototype,"handleError_OLD"),Cr.prototype),TranslationHandler_applyDecoratedDescriptor(Cr.prototype,"processTranslation_with_CtrlSlash",[logMethod],Object.getOwnPropertyDescriptor(Cr.prototype,"processTranslation_with_CtrlSlash"),Cr.prototype),TranslationHandler_applyDecoratedDescriptor(Cr.prototype,"updateTargetElement",[logMethod],Object.getOwnPropertyDescriptor(Cr.prototype,"updateTargetElement"),Cr.prototype),TranslationHandler_applyDecoratedDescriptor(Cr.prototype,"pasteContent",[logMethod],Object.getOwnPropertyDescriptor(Cr.prototype,"pasteContent"),Cr.prototype),Cr),Mr=null,Fr=null;function select_element_typeof(e){return select_element_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},select_element_typeof(e)}function select_element_regeneratorRuntime(){select_element_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==select_element_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(select_element_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function select_element_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function Active_SelectElement(){return _Active_SelectElement.apply(this,arguments)}function _Active_SelectElement(){var e;return e=select_element_regeneratorRuntime().mark((function _callee(){var e,r,n,o,a,i,c=arguments;return select_element_regeneratorRuntime().wrap((function(s){for(;1;)switch(s.prev=s.next){case 0:return e=c.length>0&&void 0!==c[0]?c[0]:null,r=c.length>1&&void 0!==c[1]&&c[1],n=c.length>2&&void 0!==c[2]&&c[2],s.prev=3,s.next=6,t().tabs.query({active:!0,currentWindow:!0});case 6:if(0!==s.sent.length){s.next=9;break}return s.abrupt("return");case 9:if(isExtensionContextValid()){s.next=11;break}return s.abrupt("return");case 11:return o=!1,s.next=14,t().storage.local.get(["selectElementState"]);case 14:if(a=s.sent,o=a.selectElementState,null===e&&(e=!o),!n&&e===o){s.next=24;break}return s.next=20,t().storage.local.set({selectElementState:e});case 20:return s.next=22,t().runtime.sendMessage({action:"activateSelectElementMode",data:e});case 22:i=s.sent,helpers_logME("Select Mode Updated:",i);case 24:r&&window.close(),s.next=30;break;case 27:s.prev=27,s.t0=s["catch"](3),helpers_logME("Error in Active_SelectElement:",s.t0);case 30:case"end":return s.stop()}}),_callee,null,[[3,27]])})),_Active_SelectElement=function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){select_element_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){select_element_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))},_Active_SelectElement.apply(this,arguments)}function headerActionsManager_typeof(e){return headerActionsManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},headerActionsManager_typeof(e)}function headerActionsManager_regeneratorRuntime(){headerActionsManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==headerActionsManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(headerActionsManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function headerActionsManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function headerActionsManager_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){headerActionsManager_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){headerActionsManager_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}!function(){if(!Fr){var e=(Mr||(Mr=new Nr),Mr);t=e,r=e.featureManager,Fr=new Rr(t,r)}var t,r}();function headerActionsManager_init(){var e,r,n,o,a;null===(e=st.clearStorageBtn)||void 0===e||e.addEventListener("click",(function(){t().storage.local.remove("lastTranslation").then(headerActionsManager_asyncToGenerator(headerActionsManager_regeneratorRuntime().mark((function _callee(){var e;return headerActionsManager_regeneratorRuntime().wrap((function(t){for(;1;)switch(t.prev=t.next){case 0:return st.sourceText.value="",st.translationResult.textContent="",toggleInlineToolbarVisibility(st.sourceText),toggleInlineToolbarVisibility(st.translationResult),st.sourceLanguageInput.value=lt,t.prev=5,t.next=8,F();case 8:e=t.sent,st.targetLanguageInput.value=getLanguageDisplayValue(e),t.next=15;break;case 12:t.prev=12,t.t0=t["catch"](5),st.targetLanguageInput.value=getLanguageDisplayValue("en");case 15:return t.prev=15,toggleClearButtonVisibility(st.targetLanguageInput,st.clearTargetLanguage),t.finish(15);case 18:toggleClearButtonVisibility(st.sourceLanguageInput,st.clearSourceLanguage),st.sourceText.focus(),helpers_logME("[HeaderActions]: Translation history and fields cleared."),updatePasteButtonVisibility();case 22:case"end":return t.stop()}}),_callee,null,[[5,12,15,18]])}))))["catch"]((function(e){helpers_logME("[HeaderActions]: Error removing last translation:",e)}))})),null===(r=st.translatePageLink)||void 0===r||r.addEventListener("click",(function(){helpers_logME("[HeaderActions]: Translate page icon clicked - using Google Translate tab.");var e=st.targetLanguageInput.value,r=getLanguageCode(e);r&&r!==lt||(helpers_logME("[HeaderActions]: Invalid target language for page translation: '".concat(e,"'. Defaulting to 'en'.")),r="en"),t().tabs.query({active:!0,currentWindow:!0}).then((function(e){var n;if(e.length>0&&null!==(n=e[0])&&void 0!==n&&n.url){var o=e[0].url;if(!o.startsWith("http"))return helpers_logME("[HeaderActions]: Cannot translate non-HTTP(S) URL: ".concat(o)),void window.close();var a=encodeURIComponent(o),i="https://translate.google.com/translate?sl=auto&tl=".concat(r,"&u=").concat(a);helpers_logME("[HeaderActions]: Opening Google Translate for page: ".concat(i)),t().tabs.create({url:i}),window.close()}else helpers_logME("[HeaderActions]: No active tab found or URL is missing."),window.close()}))["catch"]((function(e){helpers_logME("[HeaderActions]: Error querying active tab:",e),window.close()}))})),null===(n=st.settingsIcon)||void 0===n||n.addEventListener("click",(function(){helpers_logME("[Popup]: Opening options page."),openOptionsPage(),window.close()})),null===(o=st.selectElementIcon)||void 0===o||o.addEventListener("click",(function(){helpers_logME("[HeaderActions]: Select element icon clicked."),Active_SelectElement(!0,!0)})),null===(a=st.revertIcon)||void 0===a||a.addEventListener("click",(function(){t().runtime.sendMessage({action:"revertTranslation"})["catch"]((function(e){helpers_logME("[Popup-Header] Could not send revert message:",e)})),window.close()})),helpers_logME("[HeaderActions]: Initialized.")}function initializationManager_typeof(e){return initializationManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},initializationManager_typeof(e)}function initializationManager_regeneratorRuntime(){initializationManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==initializationManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(initializationManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function initializationManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function initializationManager_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){initializationManager_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){initializationManager_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function loadLastTranslationFromStorage(){return _loadLastTranslationFromStorage.apply(this,arguments)}function _loadLastTranslationFromStorage(){return _loadLastTranslationFromStorage=initializationManager_asyncToGenerator(initializationManager_regeneratorRuntime().mark((function _callee(){var e,r,n,o,a,i,c,s,l=arguments;return initializationManager_regeneratorRuntime().wrap((function(u){for(;1;)switch(u.prev=u.next){case 0:return e=!(l.length>0&&void 0!==l[0])||l[0],u.prev=1,u.next=4,t().storage.local.get(["lastTranslation"]);case 4:if(r=u.sent,n="",r.lastTranslation?(helpers_logME("[InitManager]: Loading last translation from storage."),st.sourceText.value=r.lastTranslation.sourceText||"",correctTextDirection(st.sourceText,r.lastTranslation.sourceText),o=marked.parse(r.lastTranslation.translatedText||""),a=ct.sanitize(o,{RETURN_TRUSTED_TYPE:!0}),i=new DOMParser,c=i.parseFromString(a.toString(),"text/html"),st.translationResult.textContent="",Array.from(c.body.childNodes).forEach((function(e){st.translationResult.appendChild(e)})),correctTextDirection(st.translationResult,r.lastTranslation.translatedText),st.sourceLanguageInput.value=getLanguageDisplayValue(r.lastTranslation.sourceLanguage)||lt,n=getLanguageDisplayValue(r.lastTranslation.targetLanguage)):(helpers_logME("[InitManager]: No last translation found in storage."),st.sourceText.value="",st.translationResult.textContent="",st.sourceLanguageInput.value=lt),(!e||n)&&n!==lt){u.next=19;break}return u.prev=8,u.next=11,F();case 11:s=u.sent,n=getLanguageDisplayValue(s)||getLanguageDisplayValue("en"),u.next=19;break;case 15:u.prev=15,u.t0=u["catch"](8),helpers_logME("[InitManager]: Error getting default target language:",u.t0),n=getLanguageDisplayValue("en");case 19:n&&(st.targetLanguageInput.value=n),toggleClearButtonVisibility(st.sourceLanguageInput,st.clearSourceLanguage),toggleClearButtonVisibility(st.targetLanguageInput,st.clearTargetLanguage),toggleInlineToolbarVisibility(st.sourceText),toggleInlineToolbarVisibility(st.translationResult),u.next=29;break;case 26:u.prev=26,u.t1=u["catch"](1),helpers_logME("[InitManager]: Error loading last translation:",u.t1);case 29:case"end":return u.stop()}}),_callee,null,[[1,26],[8,15]])}))),_loadLastTranslationFromStorage.apply(this,arguments)}function loadInitialState(){return _loadInitialState.apply(this,arguments)}function _loadInitialState(){return(_loadInitialState=initializationManager_asyncToGenerator(initializationManager_regeneratorRuntime().mark((function _callee2(){var e,r,n,o;return initializationManager_regeneratorRuntime().wrap((function(a){for(;1;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t().tabs.query({active:!0,currentWindow:!0});case 3:if(!((e=a.sent).length>0&&null!=e[0].id)){a.next=40;break}return r=e[0].id,a.prev=6,o={},a.prev=8,a.next=11,t().tabs.sendMessage(r,{action:"getSelectedText"});case 11:o=a.sent,a.next=17;break;case 14:a.prev=14,a.t0=a["catch"](8),helpers_logME("[InitManager]: Failed to sendMessage to content script: ".concat(a.t0.message));case 17:if(null===(n=o)||void 0===n||!n.selectedText){a.next=28;break}helpers_logME("[InitManager]: Received selected text from content script."),st.sourceText.value=o.selectedText,st.translationResult.textContent="",st.sourceLanguageInput.value=lt,toggleClearButtonVisibility(st.sourceLanguageInput,st.clearSourceLanguage),toggleClearButtonVisibility(st.targetLanguageInput,st.clearTargetLanguage),toggleInlineToolbarVisibility(st.sourceText),toggleInlineToolbarVisibility(st.translationResult),a.next=31;break;case 28:return helpers_logME("[InitManager]: No selected text received. Loading from storage."),a.next=31,loadLastTranslationFromStorage();case 31:a.next=38;break;case 33:return a.prev=33,a.t1=a["catch"](6),helpers_logME("[InitManager]: Error getting selected text (Tab ".concat(r,"): ").concat(a.t1.message,". Loading from storage.")),a.next=38,loadLastTranslationFromStorage();case 38:a.next=43;break;case 40:return helpers_logME("[InitManager]: No active/valid tab. Loading from storage."),a.next=43,loadLastTranslationFromStorage();case 43:a.next=48;break;case 45:a.prev=45,a.t2=a["catch"](0),helpers_logME("[InitManager]: Error loading initial state:",a.t2);case 48:case"end":return a.stop()}}),_callee2,null,[[0,45],[6,33],[8,14]])})))).apply(this,arguments)}function initializationManager_init(){return popup_initializationManager_init.apply(this,arguments)}function popup_initializationManager_init(){return(popup_initializationManager_init=initializationManager_asyncToGenerator(initializationManager_regeneratorRuntime().mark((function _callee3(){return initializationManager_regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.next=2,loadInitialState();case 2:helpers_logME("[InitManager]: Initialized.");case 3:case"end":return e.stop()}}),_callee3)})))).apply(this,arguments)}function popupInteractionManager_typeof(e){return popupInteractionManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},popupInteractionManager_typeof(e)}function popupInteractionManager_regeneratorRuntime(){popupInteractionManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==popupInteractionManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(popupInteractionManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function popupInteractionManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function popupInteractionManager_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){popupInteractionManager_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){popupInteractionManager_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}var jr=1e3,Dr=800,Hr=!1,Ur=null,Wr=null,Br=null,zr=!1;function cancelAutoClose(){Wr&&(clearTimeout(Wr),Wr=null)}function cancelHoverTimer(){Ur&&(clearTimeout(Ur),Ur=null)}function cancelInitialEntryTimer(){Br&&(clearTimeout(Br),Br=null)}function ensureSelectElementActive(){return _ensureSelectElementActive.apply(this,arguments)}function _ensureSelectElementActive(){return(_ensureSelectElementActive=popupInteractionManager_asyncToGenerator(popupInteractionManager_regeneratorRuntime().mark((function _callee(){var e,t;return popupInteractionManager_regeneratorRuntime().wrap((function(r){for(;1;)switch(r.prev=r.next){case 0:return r.next=2,N();case 2:return e=r.sent,r.next=5,j();case 5:if(t=r.sent,!e||!t){r.next=11;break}return setTimeout((function(){Active_SelectElement(!0,!1,!0)}),100),r.abrupt("return",!0);case 11:return r.abrupt("return",!1);case 13:case"end":return r.stop()}}),_callee)})))).apply(this,arguments)}function popupInteractionManager_init(){return popup_popupInteractionManager_init.apply(this,arguments)}function popup_popupInteractionManager_init(){return(popup_popupInteractionManager_init=popupInteractionManager_asyncToGenerator(popupInteractionManager_regeneratorRuntime().mark((function _callee2(){return popupInteractionManager_regeneratorRuntime().wrap((function(e){for(;1;)switch(e.prev=e.next){case 0:return e.next=3,ensureSelectElementActive();case 3:e.sent&&(t=void 0,r=void 0,n=void 0,null===(t=st.popupContainer)||void 0===t||t.addEventListener("mouseenter",(function(){Hr=!0,cancelAutoClose("mouseenter"),cancelInitialEntryTimer(),zr||(Ur=setTimeout((function(){zr=!0,Active_SelectElement(!1)}),jr))})),null===(r=st.popupContainer)||void 0===r||r.addEventListener("mouseleave",(function(){Hr=!1,cancelHoverTimer(),zr||(Wr=setTimeout((function(){Active_SelectElement(!0,!0)}),Dr))})),null===(n=st.popupContainer)||void 0===n||n.addEventListener("mousedown",(function(){zr||(zr=!0,cancelHoverTimer(),cancelAutoClose("mousedown"),cancelInitialEntryTimer(),Active_SelectElement(!1))})),Br=setTimeout((function(){Hr||zr||Active_SelectElement(!0,!0)}),Dr));case 6:case"end":return e.stop()}var t,r,n}),_callee2)})))).apply(this,arguments)}function excludeManager_typeof(e){return excludeManager_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},excludeManager_typeof(e)}function excludeManager_regeneratorRuntime(){excludeManager_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==excludeManager_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(excludeManager_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function excludeManager_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function excludeManager_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){excludeManager_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){excludeManager_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}function getOrigin(e){try{return new URL(e).origin}catch(t){return helpers_logME("[excludeManager]: Invalid URL for origin extraction:",e),e}}function excludeManager_init(){return popup_excludeManager_init.apply(this,arguments)}function popup_excludeManager_init(){return popup_excludeManager_init=excludeManager_asyncToGenerator(excludeManager_regeneratorRuntime().mark((function _callee2(){var e,r,n,o,a,i,c,s,l;return excludeManager_regeneratorRuntime().wrap((function(u){for(;1;)switch(u.prev=u.next){case 0:if(e=document.getElementById("excludeCurrentPageToggle")){u.next=3;break}return u.abrupt("return");case 3:return u.prev=3,u.next=6,t().tabs.query({active:!0,currentWindow:!0});case 6:r=u.sent,u.next=12;break;case 9:return u.prev=9,u.t0=u["catch"](3),u.abrupt("return");case 12:n=r[0],o=getOrigin(n.url);try{a=new URL(n.url).protocol}catch(e){a=null}if(i="http:"===a||"https:"===a,e.disabled=!i,i){u.next=25;break}return e.checked=!1,u.next=21,i18n_getTranslationString("popup_exclude_toggle_title");case 21:if(u.t1=u.sent,u.t1){u.next=24;break}u.t1="(فعال/غیرفعال در این صفحه)";case 24:e.title=u.t1;case 25:return u.next=27,t().storage.local.get("EXCLUDED_SITES");case 27:c=u.sent,s=c.EXCLUDED_SITES,l=void 0===s?[]:s,e.checked=i&&!l.includes(o),e.addEventListener("change",excludeManager_asyncToGenerator(excludeManager_regeneratorRuntime().mark((function _callee(){var r,n,a;return excludeManager_regeneratorRuntime().wrap((function(i){for(;1;)switch(i.prev=i.next){case 0:if(!e.disabled){i.next=2;break}return i.abrupt("return");case 2:return i.next=4,t().storage.local.get("EXCLUDED_SITES");case 4:return r=i.sent,n=r.EXCLUDED_SITES,a=(a=void 0===n?[]:n).filter((function(e){return e!==o})),e.checked||a.push(o),i.next=11,t().storage.local.set({EXCLUDED_SITES:a});case 11:helpers_logME("[excludeManager]: ".concat(o," ").concat(e.checked?"removed from":"added to"," exclude list"));case 12:case"end":return i.stop()}}),_callee)}))));case 32:case"end":return u.stop()}}),_callee2,null,[[3,9]])}))),popup_excludeManager_init.apply(this,arguments)}function main_typeof(e){return main_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},main_typeof(e)}function main_regeneratorRuntime(){main_regeneratorRuntime=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function define(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{define({},"")}catch(e){define=function(e,t,r){return e[t]=r}}function wrap(e,t,r,n){var a=t&&t.prototype instanceof Generator?t:Generator,i=Object.create(a.prototype),c=new Context(n||[]);return o(i,"_invoke",{value:makeInvokeMethod(e,r,c)}),i}function tryCatch(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=wrap;var l="suspendedStart",u="suspendedYield",f="executing",p="completed",h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var d={};define(d,i,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(values([])));g&&g!==r&&n.call(g,i)&&(d=g);var v=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(d);function defineIteratorMethods(e){["next","throw","return"].forEach((function(t){define(e,t,(function(e){return this._invoke(t,e)}))}))}function AsyncIterator(e,t){function invoke(r,o,a,i){var c=tryCatch(e[r],e,o);if("throw"!==c.type){var s=c.arg,l=s.value;return l&&"object"==main_typeof(l)&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){invoke("next",e,a,i)}),(function(e){invoke("throw",e,a,i)})):t.resolve(l).then((function(e){s.value=e,a(s)}),(function(e){return invoke("throw",e,a,i)}))}i(c.arg)}var r;o(this,"_invoke",{value:function(e,n){function callInvokeWithMethodAndArg(){return new t((function(t,r){invoke(e,n,t,r)}))}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(t,r,n){var o=l;return function(a,i){if(o===f)throw Error("Generator is already running");if(o===p){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var c=n.delegate;if(c){var s=maybeInvokeDelegate(c,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===l)throw o=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var d=tryCatch(t,r,n);if("normal"===d.type){if(o=n.done?p:u,d.arg===h)continue;return{value:d.arg,done:n.done}}"throw"===d.type&&(o=p,n.method="throw",n.arg=d.arg)}}}function maybeInvokeDelegate(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator["return"]&&(r.method="return",r.arg=e,maybeInvokeDelegate(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=tryCatch(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,h):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function pushTryEntry(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function resetTryEntry(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Context(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(pushTryEntry,this),this.reset(!0)}function values(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function next(){for(;++o<t.length;)if(n.call(t,o))return next.value=t[o],next.done=!1,next;return next.value=e,next.done=!0,next};return a.next=a}}throw new TypeError(main_typeof(t)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(v,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===GeneratorFunction||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,GeneratorFunctionPrototype):(e.__proto__=GeneratorFunctionPrototype,define(e,s,"GeneratorFunction")),e.prototype=Object.create(v),e},t.awrap=function(e){return{__await:e}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,(function(){return this})),t.AsyncIterator=AsyncIterator,t.async=function(e,r,n,o,a){void 0===a&&(a=Promise);var i=new AsyncIterator(wrap(e,r,n,o),a);return t.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},defineIteratorMethods(v),define(v,s,"Generator"),define(v,i,(function(){return this})),define(v,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function next(){for(;r.length;){var e=r.pop();if(e in t)return next.value=e,next.done=!1,next}return next.done=!0,next}},t.values=values,Context.prototype={constructor:Context,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(resetTryEntry),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function handle(n,o){return i.type="throw",i.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a.completion;if("root"===a.tryLoc)return handle("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),s=n.call(a,"finallyLoc");if(c&&s){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0);if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return handle(a.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return handle(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:values(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),h}},t}function main_asyncGeneratorStep(e,t,r,n,o,a,i){try{var c=e[a](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function main_asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function _next(e){main_asyncGeneratorStep(a,n,o,_next,_throw,"next",e)}function _throw(e){main_asyncGeneratorStep(a,n,o,_next,_throw,"throw",e)}_next(void 0)}))}}document.addEventListener("DOMContentLoaded",main_asyncToGenerator(main_regeneratorRuntime().mark((function _callee(){var e,n,o;return main_regeneratorRuntime().wrap((function(a){for(;1;)switch(a.prev=a.next){case 0:return helpers_logME("[Popup Main]: DOMContentLoaded event fired."),a.prev=1,a.next=4,init();case 4:return a.next=6,clipboardManager_init();case 6:return ttsManager_init(),translationManager_init(),headerActionsManager_init(),a.next=11,initializationManager_init();case 11:return a.next=13,popupInteractionManager_init();case 13:return a.next=15,excludeManager_init();case 15:try{t().runtime.connect({name:"popup"}).postMessage({action:"popupOpened"})}catch(e){helpers_logME("[Popup Main]: Failed to connect popup port:",e.message)}helpers_logME("[Popup Main]: All modules initialized successfully."),a.next=28;break;case 19:a.prev=19,a.t0=a["catch"](1),helpers_logME("[Popup Main]: Error during initialization:",a.t0),helpers_logME("Popup initialization failed:",a.t0),e=ct.sanitize('<div style="padding: 10px; color: red;">[AIWC] Failed to initialize extension popup. Please try reloading.</div>',{RETURN_TRUSTED_TYPE:!0}),n=new DOMParser,o=n.parseFromString(e.toString(),"text/html"),document.body.textContent="",Array.from(o.body.childNodes).forEach((function(e){return document.body.appendChild(e)}));case 28:return a.prev=28,app_localize_popup(r.APPLICATION_LOCALIZE),a.finish(28);case 31:case"end":return a.stop()}}),_callee,null,[[1,19,28,31]])}))))})()})();